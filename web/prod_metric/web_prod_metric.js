(()=>{"use strict";let t="https://tejassrinivasan.pythonanywhere.com/";var e=!1,n=[];let i=-1,o=null,s=-1,a=-1,r=-1,u=0,l=0,d=0,_=0,c=0,h=0;function b(t){s=t,$("#button_answeronly_usertrusts").attr("disabled","true"),$("#button_answeronly_userdistrusts").attr("disabled","true"),$("#button_answeronly_userunsure").attr("disabled","true"),0==t?$("#button_answeronly_usertrusts").attr("activedecision","true"):1==t?$("#button_answeronly_userdistrusts").attr("activedecision","true"):2==t&&$("#button_answeronly_userunsure").attr("activedecision","true"),$("#ai_explanation_div").show()}function m(t){a=t,$("#button_withexplanation_usertrusts").attr("disabled","true"),$("#button_withexplanation_userdistrusts").attr("disabled","true"),$("#button_withexplanation_userunsure").attr("disabled","true"),0==t?$("#button_withexplanation_usertrusts").attr("activedecision","true"):1==t?$("#button_withexplanation_userdistrusts").attr("activedecision","true"):2==t&&$("#button_withexplanation_userunsure").attr("activedecision","true"),$("#ai_explanation_quality_div").show()}function w(t){r=t,$("#button_withexplanationquality_usertrusts").attr("disabled","true"),$("#button_withexplanationquality_userdistrusts").attr("disabled","true"),$("#button_withexplanationquality_userunsure").attr("disabled","true"),0==t?$("#button_withexplanationquality_usertrusts").attr("activedecision","true"):1==t?$("#button_withexplanationquality_userdistrusts").attr("activedecision","true"):2==t&&$("#button_withexplanationquality_userunsure").attr("activedecision","true"),$("#button_next").show(),$("#button_next").removeAttr("disabled")}function y(t){c+=t,0==c?$("#button_instructions_prev").attr("disabled","true"):$("#button_instructions_prev").removeAttr("disabled"),c>=5?($("#instructions_and_decorations").show(),$("#button_instructions_next").val("Start study")):($("#instructions_and_decorations").hide(),$("#button_instructions_next").val("Next")),6==c&&($("#instructions_and_decorations").show(),$("#main_box_instructions").hide(),$("#main_box_experiment").show(),f()),$("#main_box_instructions").children(":not(input)").each(((t,e)=>{$(e).hide()})),$(`#instructions_${c}`).show()}function p(t){let e=0;return e=2==t?0:t==1-o.prediction_is_correct?1:-1,e}function v(t){return 2!=t?t==1-o.prediction_is_correct?1:0:-1}document.getElementById("button_answeronly_usertrusts")?.addEventListener("click",(()=>b(0))),document.getElementById("button_answeronly_userdistrusts")?.addEventListener("click",(()=>b(1))),document.getElementById("button_answeronly_userunsure")?.addEventListener("click",(()=>b(2))),document.getElementById("button_withexplanation_usertrusts")?.addEventListener("click",(()=>m(0))),document.getElementById("button_withexplanation_userdistrusts")?.addEventListener("click",(()=>m(1))),document.getElementById("button_withexplanation_userunsure")?.addEventListener("click",(()=>m(2))),document.getElementById("button_withexplanationquality_usertrusts")?.addEventListener("click",(()=>w(0))),document.getElementById("button_withexplanationquality_userdistrusts")?.addEventListener("click",(()=>w(1))),document.getElementById("button_withexplanationquality_userunsure")?.addEventListener("click",(()=>w(2))),$("#button_instructions_next").on("click",(()=>y(1))),$("#button_instructions_prev").on("click",(()=>y(-1))),$("#button_next").on("click",(()=>{let e=_;if(function(){if(2!=r){let t=1-o.prediction_is_correct;r==t?(_+=.1,u+=1):(_+=-.1,l+=1)}else d+=1}(),-1!=i){let n={question_i:i,user_selections:{answeronly:s,withexplanation:a,withexplanationquality:r},user_is_correct:{answeronly:v(s),withexplanation:v(a),withexplanationquality:v(r)},utility_of_explanation:p(a)-p(s),utility_of_quality_metrics:p(r)-p(a),balance:{old:e,new:_}};n.question=o,n.count_exited_page=h,async function(e){e.url_data=globalThis.url_data,console.log("Data"),"study_id"in e.url_data||(e.url_data.study_id="demo_study"),"prolific_id"in e.url_data||(e.url_data.prolific_id="demo_user"),"session_id"in e.url_data||(e.url_data.session_id="demo_session"),e.url_data.queue_id=globalThis.uid,console.log("logged",e),console.log("Logging to",t+"log");try{let n=await $.ajax(t+"log",{data:JSON.stringify({project:"vlm-rationales-study/"+e.url_data.study_id,uid:globalThis.uid.replace("/","_")+"_"+e.url_data.prolific_id,payload:JSON.stringify(e)}),type:"POST",contentType:"application/json"});return await async function(){return new Promise((t=>setTimeout(t,2e3)))}(),n}catch(t){console.log(t)}}(n),h=0}f()}));let g=null;function x(t,e,n,i){g&&(clearInterval(g),g=null),n.forEach((t=>t.setAttribute("disabled","true")));let o=document.createElement("div");o.id=`timer_${e.id}`,o.style.fontWeight="bold",o.style.marginTop="10px",e.appendChild(o);let s=t;o.textContent=`Please wait ${s} second(s) before making your selection.`,g=setInterval((()=>{s--,s>=0?o.textContent=`Please wait ${s} second(s) before making your selection.`:(null!==g&&(clearInterval(g),g=null),g=null,e.removeChild(o),n.forEach((t=>t.removeAttribute("disabled"))),i&&i())}),1e3)}function f(){if(g&&(clearInterval(g),g=null),$("#button_readytoanswer").removeAttr("activedecision"),$("#button_readytoanswer").removeAttr("disabled"),$("#button_readytoanswer").show(),$("#button_answeronly_usertrusts").removeAttr("activedecision"),$("#button_answeronly_usertrusts").removeAttr("disabled"),$("#button_answeronly_userdistrusts").removeAttr("activedecision"),$("#button_answeronly_userdistrusts").removeAttr("disabled"),$("#button_answeronly_userunsure").removeAttr("activedecision"),$("#button_answeronly_userunsure").removeAttr("disabled"),$("#button_withexplanation_usertrusts").removeAttr("activedecision"),$("#button_withexplanation_usertrusts").removeAttr("disabled"),$("#button_withexplanation_userdistrusts").removeAttr("activedecision"),$("#button_withexplanation_userdistrusts").removeAttr("disabled"),$("#button_withexplanation_userunsure").removeAttr("activedecision"),$("#button_withexplanation_userunsure").removeAttr("disabled"),$("#button_withexplanationquality_usertrusts").removeAttr("activedecision"),$("#button_withexplanationquality_usertrusts").removeAttr("disabled"),$("#button_withexplanationquality_userdistrusts").removeAttr("activedecision"),$("#button_withexplanationquality_userdistrusts").removeAttr("disabled"),$("#button_withexplanationquality_userunsure").removeAttr("activedecision"),$("#button_withexplanationquality_userunsure").removeAttr("disabled"),$("#ai_explanation_div").hide(),$("#ai_explanation_quality_div").hide(),$("#button_next").hide(),$("#button_quit").hide(),i+=1,i>=n.length){$("#main_box_experiment").hide(),_=Math.max(0,_);let t=`Your total reward is <b>$${_.toFixed(2)} + $2</b>.`;return t+=`<br>You answered a total of ${i} questions: ${u} correct, ${l} incorrect, ${d} unsure.`,void(e?($("#reward_box_mock").html(t),$("#reward_box_mock").show(),$("#main_box_end_mock").show()):($("#reward_box").html(t),$("#reward_box").show(),$("#main_box_end").show()))}o=n[i];const t=o.question.replace("Choices:","<br><b>Choices:</b>");$("#question_span").html(t),$("#ai_prediction_span").html(o.predicted_answer),$("#ai_explanation_span").html(o.generated_rationale);let s=o.visual_fidelity*o.contrastiveness,a=Math.round(100*s);$("#explanation_product_span").html(`${a}%`),$("#progress").text(`Progress: ${i+1} / ${n.length}`),function(t){const e=document.getElementById("ai_answer_div"),n=[document.getElementById("button_answeronly_usertrusts"),document.getElementById("button_answeronly_userdistrusts"),document.getElementById("button_answeronly_userunsure")];function i(){n.forEach((t=>t?.removeEventListener("click",i))),function(t){const e=document.getElementById("ai_explanation_div"),n=t.split(" ").length,i=Math.max(Math.ceil(3+n/238*60),5),o=[document.getElementById("button_withexplanation_usertrusts"),document.getElementById("button_withexplanation_userdistrusts"),document.getElementById("button_withexplanation_userunsure")];function s(){o.forEach((t=>t?.removeEventListener("click",s))),function(){const t=document.getElementById("ai_explanation_quality_div"),e=[document.getElementById("button_withexplanationquality_usertrusts"),document.getElementById("button_withexplanationquality_userdistrusts"),document.getElementById("button_withexplanationquality_userunsure")];function n(){e.forEach((t=>t?.removeEventListener("click",n))),$("#button_next").show()}e.forEach((t=>t?.removeEventListener("click",n))),e.forEach((t=>t?.addEventListener("click",n))),$("#ai_explanation_quality_div").show(),x(5,t,e,null)}()}o.forEach((t=>t?.removeEventListener("click",s))),o.forEach((t=>t?.addEventListener("click",s))),$("#ai_explanation_div").show(),x(i,e,o,null)}(t)}n.forEach((t=>t?.removeEventListener("click",i))),n.forEach((t=>t?.addEventListener("click",i))),$("#ai_answer_div").show(),x(5,e,n,null)}(o.generated_rationale)}document.onvisibilitychange=()=>{document.hidden?(console.log("Window lost focus."),null!==g&&(clearInterval(g),g=null)):console.log("Window regained focus.")};const E=new URLSearchParams(window.location.search),q=E.get("start"),I=E.get("uid");if(globalThis.url_data=function(t){const e={};for(const[n,i]of t)e[n]=i;return e}(E.entries()),null==globalThis.url_data.study_id&&(globalThis.url_data.study_id="demo_study"),null==globalThis.url_data.prolific_id&&(globalThis.url_data.prolific_id="demo_user"),null==globalThis.url_data.session_id&&(globalThis.url_data.session_id="demo_session"),null!=I){if(globalThis.uid=I,"prolific_random"==globalThis.uid){let t=`${Math.floor(10*Math.random())}`.padStart(3,"0");globalThis.uid=`${E.get("prolific_queue_name")}/${t}`}}else{let t=null;for(;null==t;)t=prompt("Enter your user id. Please get in touch if you were not assigned an id but wish to participate in this experiment.");globalThis.uid=t}globalThis.url_data.session_id.startsWith("demo")&&(e=!0),console.log("Running with UID",globalThis.uid),async function(){return await $.getJSON(`baked_queues/${globalThis.uid}.json?t=${Date.now()}`)}().catch((t=>{console.log("Invalid user id."),console.log(globalThis.uid),window.location.reload()})).then((t=>{n=t,null!=q&&(i=parseInt(q)-1,console.log("Starting from",i)),y(0),function(){const t=document.getElementById("reward_instructions");t&&(t.innerHTML=`\n            If your final decision is correct, you gain a reward of $${.1.toFixed(2)}. \n            If your final decision is incorrect, you lose $${Math.abs(-.1).toFixed(2)} from your reward. \n            You will see your total reward at the end of the experiment. \n            Your payment is $2.0 plus whatever you accumulate during this experiment.\n        `)}(),$("#main_box_instructions").show(),$("#instructions_and_decorations").hide()})),console.log("Starting session with UID:",globalThis.uid);let k=!1;document.onvisibilitychange=()=>{k||(h+=1,k=!0,globalThis.uid.startsWith("demo")||alert("Please don't leave the page. If you do so again, we may restrict paying you."),k=!1)}})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ViX3Byb2RfbWV0cmljLmpzIiwibWFwcGluZ3MiOiJtQkFHQSxJQUFJQSxFQUF1RCw4Q0NGcEQsSUFDSUMsR0FBb0IsRUFJM0JDLEVBQWMsR0FDbEIsSUFBSUMsR0FBYyxFQUNkQyxFQUFnQixLQUNoQkMsR0FBb0MsRUFDcENDLEdBQXlDLEVBQ3pDQyxHQUFnRCxFQUNoREMsRUFBYyxFQUNkQyxFQUFnQixFQUNoQkMsRUFBYSxFQUViQyxFQUFVLEVBRVZDLEVBQXdCLEVBQ3hCQyxFQUE0QixFQVFoQyxTQUFTQyxFQUFnQ0MsR0FDckNWLEVBQTJCVSxFQUUzQkMsRUFBRSxpQ0FBaUNDLEtBQUssV0FBWSxRQUNwREQsRUFBRSxvQ0FBb0NDLEtBQUssV0FBWSxRQUN2REQsRUFBRSxpQ0FBaUNDLEtBQUssV0FBWSxRQUNqQyxHQUFmRixFQUNBQyxFQUFFLGlDQUFpQ0MsS0FBSyxpQkFBa0IsUUFDcEMsR0FBZkYsRUFDUEMsRUFBRSxvQ0FBb0NDLEtBQUssaUJBQWtCLFFBQ3ZDLEdBQWZGLEdBQ1BDLEVBQUUsaUNBQWlDQyxLQUFLLGlCQUFrQixRQUU5REQsRUFBRSx1QkFBdUJFLE1BQzdCLENBT0EsU0FBU0MsRUFBcUNKLEdBQzFDVCxFQUFnQ1MsRUFFaENDLEVBQUUsc0NBQXNDQyxLQUFLLFdBQVksUUFDekRELEVBQUUseUNBQXlDQyxLQUFLLFdBQVksUUFDNURELEVBQUUsc0NBQXNDQyxLQUFLLFdBQVksUUFDdEMsR0FBZkYsRUFDQUMsRUFBRSxzQ0FBc0NDLEtBQUssaUJBQWtCLFFBQ3pDLEdBQWZGLEVBQ1BDLEVBQUUseUNBQXlDQyxLQUFLLGlCQUFrQixRQUM1QyxHQUFmRixHQUNQQyxFQUFFLHNDQUFzQ0MsS0FBSyxpQkFBa0IsUUFFbkVELEVBQUUsK0JBQStCRSxNQUNyQyxDQU1BLFNBQVNFLEVBQTRDTCxHQUNqRFIsRUFBdUNRLEVBRXZDQyxFQUFFLDZDQUE2Q0MsS0FBSyxXQUFZLFFBQ2hFRCxFQUFFLGdEQUFnREMsS0FBSyxXQUFZLFFBQ25FRCxFQUFFLDZDQUE2Q0MsS0FBSyxXQUFZLFFBQzdDLEdBQWZGLEVBQ0FDLEVBQUUsNkNBQTZDQyxLQUFLLGlCQUFrQixRQUNoRCxHQUFmRixFQUNQQyxFQUFFLGdEQUFnREMsS0FBSyxpQkFBa0IsUUFDbkQsR0FBZkYsR0FDUEMsRUFBRSw2Q0FBNkNDLEtBQUssaUJBQWtCLFFBRTFFRCxFQUFFLGdCQUFnQkUsT0FDbEJGLEVBQUUsZ0JBQWdCSyxXQUFXLFdBQ2pDLENBc0JBLFNBQVNDLEVBQWtCQyxHQUN2QlgsR0FBaUJXLEVBRUksR0FBakJYLEVBQ0FJLEVBQUUsNkJBQTZCQyxLQUFLLFdBQVksUUFFaERELEVBQUUsNkJBQTZCSyxXQUFXLFlBRTFDVCxHQUFpQixHQUNqQkksRUFBRSxpQ0FBaUNFLE9BQ25DRixFQUFFLDZCQUE2QlEsSUFBSSxpQkFFbkNSLEVBQUUsaUNBQWlDUyxPQUNuQ1QsRUFBRSw2QkFBNkJRLElBQUksU0FFbEIsR0FBakJaLElBQ0FJLEVBQUUsaUNBQWlDRSxPQUNuQ0YsRUFBRSwwQkFBMEJTLE9BQzVCVCxFQUFFLHdCQUF3QkUsT0FDMUJRLEtBR0pWLEVBQUUsMEJBQTBCVyxTQUFTLGVBQWVDLE1BQUssQ0FBQ0MsRUFBR0MsS0FDekRkLEVBQUVjLEdBQUlMLE1BQU0sSUFFaEJULEVBQUUsaUJBQWlCSixLQUFpQk0sTUFDeEMsQ0FJQSxTQUFTYSxFQUFxQkMsR0FDMUIsSUFBSUMsRUFBa0IsRUFPdEIsT0FMSUEsRUFEYSxHQUFiRCxFQUNVLEVBR0NBLEdBRGEsRUFBSTVCLEVBQWdDLHNCQUNmLEdBQUssRUFFL0M2QixDQUNYLENBd0NBLFNBQVNDLEVBQWdCRixHQUNyQixPQUFpQixHQUFiQSxFQUVPQSxHQURpQixFQUFJNUIsRUFBZ0Msc0JBQ3BCLEVBQUksR0FFeEMsQ0FDWixDQW5KQStCLFNBQVNDLGVBQWUsaUNBQWlDQyxpQkFBaUIsU0FBUyxJQUFNdkIsRUFBZ0MsS0FDekhxQixTQUFTQyxlQUFlLG9DQUFvQ0MsaUJBQWlCLFNBQVMsSUFBTXZCLEVBQWdDLEtBQzVIcUIsU0FBU0MsZUFBZSxpQ0FBaUNDLGlCQUFpQixTQUFTLElBQU12QixFQUFnQyxLQW1CekhxQixTQUFTQyxlQUFlLHNDQUFzQ0MsaUJBQWlCLFNBQVMsSUFBTWxCLEVBQXFDLEtBQ25JZ0IsU0FBU0MsZUFBZSx5Q0FBeUNDLGlCQUFpQixTQUFTLElBQU1sQixFQUFxQyxLQUN0SWdCLFNBQVNDLGVBQWUsc0NBQXNDQyxpQkFBaUIsU0FBUyxJQUFNbEIsRUFBcUMsS0FtQm5JZ0IsU0FBU0MsZUFBZSw2Q0FBNkNDLGlCQUFpQixTQUFTLElBQU1qQixFQUE0QyxLQUNqSmUsU0FBU0MsZUFBZSxnREFBZ0RDLGlCQUFpQixTQUFTLElBQU1qQixFQUE0QyxLQUNwSmUsU0FBU0MsZUFBZSw2Q0FBNkNDLGlCQUFpQixTQUFTLElBQU1qQixFQUE0QyxLQTZDakpKLEVBQUUsNkJBQTZCc0IsR0FBRyxTQUFTLElBQU1oQixFQUFrQixLQUNuRU4sRUFBRSw2QkFBNkJzQixHQUFHLFNBQVMsSUFBTWhCLEdBQW1CLEtBYXBFTixFQUFFLGdCQUFnQnNCLEdBQUcsU0FBUyxLQUcxQixJQUFJQyxFQUFjNUIsRUFHbEIsR0F3Q0osV0FDSSxHQUE0QyxHQUF4Q0osRUFBMkMsQ0FDM0MsSUFBSWlDLEVBQW9CLEVBQUlwQyxFQUFnQyxzQkFDeERHLEdBQXdDaUMsR0FDeEM3QixHQy9Ma0IsR0RnTWxCSCxHQUFlLElBRWZHLElDak1xQixHRGtNckJGLEdBQWlCLEUsTUFHckJDLEdBQWMsQ0FFdEIsQ0F2REkrQixJQUVtQixHQUFmdEMsRUFBa0IsQ0FDbEIsSUFBSXVDLEVBQWMsQ0FDZCxXQUFjdkMsRUFDZCxnQkFBbUIsQ0FDZixXQUFjRSxFQUNkLGdCQUFtQkMsRUFDbkIsdUJBQTBCQyxHQUU5QixnQkFBbUIsQ0FDZixXQUFjMkIsRUFBZ0I3QixHQUM5QixnQkFBbUI2QixFQUFnQjVCLEdBQ25DLHVCQUEwQjRCLEVBQWdCM0IsSUFFOUMsdUJBQTBCd0IsRUFBcUJ6QixHQUFpQ3lCLEVBQXFCMUIsR0FDckcsMkJBQThCMEIsRUFBcUJ4QixHQUF3Q3dCLEVBQXFCekIsR0FDaEgsUUFBVyxDQUNQLElBQU9pQyxFQUNQLElBQU81QixJQUlmK0IsRUFBc0IsU0FBSXRDLEVBQzFCc0MsRUFBK0Isa0JBQUk3QixFRDlKcEM4QixlQUF3QnpDLEdBTTNCQSxFQUFlLFNBQUkwQyxXQUFXQyxTQUM5QkMsUUFBUUMsSUFBSSxRQUNOLGFBQWM3QyxFQUFlLFdBQy9CQSxFQUFlLFNBQVksU0FBSSxjQUU3QixnQkFBaUJBLEVBQWUsV0FDbENBLEVBQWUsU0FBZSxZQUFJLGFBRWhDLGVBQWdCQSxFQUFlLFdBQ2pDQSxFQUFlLFNBQWMsV0FBSSxnQkFFckNBLEVBQWUsU0FBWSxTQUFJMEMsV0FBV0ksSUFDMUNGLFFBQVFDLElBQUksU0FBVTdDLEdBQ3RCNEMsUUFBUUMsSUFBSSxhQUFjL0MsRUFBa0IsT0FFNUMsSUFDSSxJQUFJaUQsUUFBZWpDLEVBQUVrQyxLQUNqQmxELEVBQWtCLE1BQ2xCLENBQ0lFLEtBQU1pRCxLQUFLQyxVQUFVLENBQ2pCQyxRQUFTLHdCQUF3Qm5ELEVBQWUsU0FBWSxTQUM1RDhDLElBQUtKLFdBQVdJLElBQUlNLFFBQVEsSUFBSyxLQUFPLElBQU1wRCxFQUFlLFNBQWUsWUFDNUVxRCxRQUFTSixLQUFLQyxVQUFVbEQsS0FFNUJzRCxLQUFNLE9BQ05DLFlBQWEscUJBSXJCLGFBOUNSZCxpQkFDSSxPQUFPLElBQUllLFNBQVNDLEdBQVlDLFdBQVdELEVBNEMzQixNQTNDcEIsQ0EyQ2NFLEdBQ0NaLEMsQ0FDVCxNQUFPYSxHQUNMaEIsUUFBUUMsSUFBSWUsRSxDQUVwQixDQ3dIUUMsQ0FBU3JCLEdBQ1Q3QixFQUFvQixDLENBSXhCYSxHQUFlLElBaUNuQixJQUFJc0MsRUFBcUQsS0FFekQsU0FBU0MsRUFBV0MsRUFBVUMsRUFBU0MsRUFBU0MsR0FTeENMLElBQ0FNLGNBQWNOLEdBQ2RBLEVBQWMsTUFJbEJJLEVBQVFHLFNBQVFDLEdBQVVBLEVBQU9DLGFBQWEsV0FBWSxVQUcxRCxJQUFJQyxFQUFldkMsU0FBU3dDLGNBQWMsT0FDMUNELEVBQWFFLEdBQUssU0FBU1QsRUFBUVMsS0FDbkNGLEVBQWFHLE1BQU1DLFdBQWEsT0FDaENKLEVBQWFHLE1BQU1FLFVBQVksT0FDL0JaLEVBQVFhLFlBQVlOLEdBRXBCLElBQUlPLEVBQWdCZixFQUdwQlEsRUFBYVEsWUFBYyxlQUFlRCw0Q0FFMUNqQixFQUFjbUIsYUFBWSxLQUN0QkYsSUFDSUEsR0FBaUIsRUFDakJQLEVBQWFRLFlBQWMsZUFBZUQsNkNBR3RCLE9BQWhCakIsSUFDQU0sY0FBY04sR0FDZEEsRUFBYyxNQUVsQkEsRUFBYyxLQUdkRyxFQUFRaUIsWUFBWVYsR0FHcEJOLEVBQVFHLFNBQVFDLEdBQVVBLEVBQU9hLGdCQUFnQixjQUU3Q2hCLEdBQVVBLEksR0FFbkIsSUFDUCxDQXVHQSxTQUFTM0MsSUEwQ0wsR0F4Q0lzQyxJQUNBTSxjQUFjTixHQUNkQSxFQUFjLE1BSWxCaEQsRUFBRSx5QkFBeUJLLFdBQVcsa0JBQ3RDTCxFQUFFLHlCQUF5QkssV0FBVyxZQUN0Q0wsRUFBRSx5QkFBeUJFLE9BRTNCRixFQUFFLGlDQUFpQ0ssV0FBVyxrQkFDOUNMLEVBQUUsaUNBQWlDSyxXQUFXLFlBQzlDTCxFQUFFLG9DQUFvQ0ssV0FBVyxrQkFDakRMLEVBQUUsb0NBQW9DSyxXQUFXLFlBQ2pETCxFQUFFLGlDQUFpQ0ssV0FBVyxrQkFDOUNMLEVBQUUsaUNBQWlDSyxXQUFXLFlBRTlDTCxFQUFFLHNDQUFzQ0ssV0FBVyxrQkFDbkRMLEVBQUUsc0NBQXNDSyxXQUFXLFlBQ25ETCxFQUFFLHlDQUF5Q0ssV0FBVyxrQkFDdERMLEVBQUUseUNBQXlDSyxXQUFXLFlBQ3RETCxFQUFFLHNDQUFzQ0ssV0FBVyxrQkFDbkRMLEVBQUUsc0NBQXNDSyxXQUFXLFlBRW5ETCxFQUFFLDZDQUE2Q0ssV0FBVyxrQkFDMURMLEVBQUUsNkNBQTZDSyxXQUFXLFlBQzFETCxFQUFFLGdEQUFnREssV0FBVyxrQkFDN0RMLEVBQUUsZ0RBQWdESyxXQUFXLFlBQzdETCxFQUFFLDZDQUE2Q0ssV0FBVyxrQkFDMURMLEVBQUUsNkNBQTZDSyxXQUFXLFlBRTFETCxFQUFFLHVCQUF1QlMsT0FDekJULEVBQUUsK0JBQStCUyxPQUdqQ1QsRUFBRSxnQkFBZ0JTLE9BQ2xCVCxFQUFFLGdCQUFnQlMsT0FHbEJ0QixHQUFjLEVBQ1ZBLEdBQWNELEVBQUtvRixPQUFRLENBQzNCdEUsRUFBRSx3QkFBd0JTLE9BMU05QmQsRUFBVTRFLEtBQUtDLElBQUksRUFBRzdFLEdBNk1sQixJQUFJOEUsRUFBYyw0QkFBNEI5RSxFQUFRK0UsUUFBUSxlQVc5RCxPQVZBRCxHQUFlLCtCQUErQnRGLGdCQUF5QkssY0FBd0JDLGdCQUE0QkMsaUJBQ3ZIVCxHQUNBZSxFQUFFLG9CQUFvQjJFLEtBQUtGLEdBQzNCekUsRUFBRSxvQkFBb0JFLE9BQ3RCRixFQUFFLHNCQUFzQkUsU0FFeEJGLEVBQUUsZUFBZTJFLEtBQUtGLEdBQ3RCekUsRUFBRSxlQUFlRSxPQUNqQkYsRUFBRSxpQkFBaUJFLFEsQ0FLM0JkLEVBQVdGLEVBQUtDLEdBRWhCLE1BQ015RixFQURleEYsRUFBb0IsU0FDQWtELFFBQVEsV0FBWSx1QkFDN0R0QyxFQUFFLGtCQUFrQjJFLEtBQUtDLEdBRXpCNUUsRUFBRSx1QkFBdUIyRSxLQUFLdkYsRUFBNEIsa0JBQzFEWSxFQUFFLHdCQUF3QjJFLEtBQUt2RixFQUErQixxQkFROUQsSUFJSXlGLEVBSld6RixFQUEyQixnQkFDM0JBLEVBQTJCLGdCQU10QzBGLEVBQWlCUCxLQUFLUSxNQUFnQixJQUFWRixHQUdoQzdFLEVBQUUsNkJBQTZCMkUsS0FBSyxHQUFHRyxNQWV2QzlFLEVBQUUsYUFBYWdGLEtBQUssYUFBYTdGLEVBQWEsT0FBT0QsRUFBS29GLFVBMUw5RCxTQUF3QlcsR0FDcEIsTUFBTUMsRUFBZS9ELFNBQVNDLGVBQWUsaUJBQ3ZDZ0MsRUFBVSxDQUNaakMsU0FBU0MsZUFBZSxnQ0FDeEJELFNBQVNDLGVBQWUsbUNBQ3hCRCxTQUFTQyxlQUFlLGlDQU01QixTQUFTK0QsSUFDTC9CLEVBQVFHLFNBQVFDLEdBQVVBLEdBQVE0QixvQkFBb0IsUUFBU0QsS0FzQnZFLFNBQXlCRixHQUNyQixNQUFNSSxFQUFnQmxFLFNBQVNDLGVBQWUsc0JBQ3hDa0UsRUFBUUwsRUFBZ0JNLE1BQU0sS0FBS2pCLE9BQ25Da0IsRUFBY2pCLEtBQUtDLElBQUlELEtBQUtrQixLQUFLLEVBQUtILEVBQVEsSUFBTyxJQUFLLEdBRTFEbEMsRUFBVSxDQUNaakMsU0FBU0MsZUFBZSxxQ0FDeEJELFNBQVNDLGVBQWUsd0NBQ3hCRCxTQUFTQyxlQUFlLHNDQVM1QixTQUFTc0UsSUFFTHRDLEVBQVFHLFNBQVFDLEdBQVVBLEdBQVE0QixvQkFBb0IsUUFBU00sS0FTdkUsV0FDSSxNQUFNQyxFQUFleEUsU0FBU0MsZUFBZSw4QkFDdkNnQyxFQUFVLENBQ1pqQyxTQUFTQyxlQUFlLDRDQUN4QkQsU0FBU0MsZUFBZSwrQ0FDeEJELFNBQVNDLGVBQWUsNkNBUzVCLFNBQVN3RSxJQUVMeEMsRUFBUUcsU0FBUUMsR0FBVUEsR0FBUTRCLG9CQUFvQixRQUFTUSxLQUMvRDVGLEVBQUUsZ0JBQWdCRSxNQUN0QixDQVRBa0QsRUFBUUcsU0FBUUMsR0FBVUEsR0FBUTRCLG9CQUFvQixRQUFTUSxLQUcvRHhDLEVBQVFHLFNBQVFDLEdBQVVBLEdBQVFuQyxpQkFBaUIsUUFBU3VFLEtBUTVENUYsRUFBRSwrQkFBK0JFLE9BQ2pDK0MsRUFBVyxFQUFHMEMsRUFBY3ZDLEVBQVMsS0FDekMsQ0E5QlF5QyxFQUNKLENBVEF6QyxFQUFRRyxTQUFRQyxHQUFVQSxHQUFRNEIsb0JBQW9CLFFBQVNNLEtBRy9EdEMsRUFBUUcsU0FBUUMsR0FBVUEsR0FBUW5DLGlCQUFpQixRQUFTcUUsS0FRNUQxRixFQUFFLHVCQUF1QkUsT0FDekIrQyxFQUFXdUMsRUFBYUgsRUFBZWpDLEVBQVMsS0FDcEQsQ0E5Q1EwQyxDQUFnQmIsRUFDcEIsQ0FOQTdCLEVBQVFHLFNBQVFDLEdBQVVBLEdBQVE0QixvQkFBb0IsUUFBU0QsS0FDL0QvQixFQUFRRyxTQUFRQyxHQUFVQSxHQUFRbkMsaUJBQWlCLFFBQVM4RCxLQU81RG5GLEVBQUUsa0JBQWtCRSxPQUNwQitDLEVBQVcsRUFBR2lDLEVBQWM5QixFQUFTLEtBY3pDLENBNkpJMkMsQ0FBZTNHLEVBQThCLG9CQUNqRCxDQTNNQStCLFNBQVM2RSxtQkFBcUIsS0FDdEI3RSxTQUFTOEUsUUFDVG5FLFFBQVFDLElBQUksc0JBQ1EsT0FBaEJpQixJQUNBTSxjQUFjTixHQUNkQSxFQUFjLE9BSWxCbEIsUUFBUUMsSUFBSSx5QixFQXdNcEIsTUFBTW1FLEVBQVksSUFBSUMsZ0JBQWdCQyxPQUFPQyxTQUFTQyxRQUNoREMsRUFBZ0JMLEVBQVVNLElBQUksU0FDOUJDLEVBQWFQLEVBQVVNLElBQUksT0FhakMsR0FaQTVFLFdBQVdDLFNFaGVYLFNBQXdCNkUsR0FDdEIsTUFBTXpFLEVBQVMsQ0FBQyxFQUVoQixJQUFLLE1BQU8wRSxFQUFLQyxLQUFVRixFQUN6QnpFLEVBQU8wRSxHQUFPQyxFQUVoQixPQUFPM0UsQ0FDVCxDRnlkc0I0RSxDQUFlWCxFQUFVUSxXQUVSLE1BQW5DOUUsV0FBV0MsU0FBbUIsV0FDOUJELFdBQVdDLFNBQW1CLFNBQUksY0FFSSxNQUF0Q0QsV0FBV0MsU0FBc0IsY0FDakNELFdBQVdDLFNBQXNCLFlBQUksYUFFQSxNQUFyQ0QsV0FBV0MsU0FBcUIsYUFDaENELFdBQVdDLFNBQXFCLFdBQUksZ0JBR3RCLE1BQWQ0RSxHQUVBLEdBREE3RSxXQUFXSSxJQUFNeUUsRUFDSyxtQkFBbEI3RSxXQUFXSSxJQUEwQixDQUNyQyxJQUFJOEUsRUFBVyxHQUFHdkMsS0FBS3dDLE1BQXNCLEdBQWhCeEMsS0FBS3lDLFlBQWlCQyxTQUFTLEVBQUcsS0FDL0RyRixXQUFXSSxJQUFNLEdBQUdrRSxFQUFVTSxJQUFJLDBCQUEwQk0sRyxNQUk3RCxDQUNILElBQUlJLEVBQWlCLEtBQ3JCLEtBQW9CLE1BQWJBLEdBQ0hBLEVBQVlDLE9BQU8sc0hBRXZCdkYsV0FBV0ksSUFBTWtGLEMsQ0FNVnRGLFdBQVdDLFNBQXFCLFdBQUV1RixXQUFXLFVBQ3BEbkksR0FBVyxHQUdmNkMsUUFBUUMsSUFBSSxtQkFBb0JILFdBQVdJLEtEMWZwQ0wsaUJBS0gsYUFIbUIzQixFQUFFcUgsUUFDakIsZ0JBQWdCekYsV0FBV0ksY0FBY3NGLEtBQUtDLFFBR3RELENDcWZBQyxHQUFZQyxPQUFPQyxJQUVmNUYsUUFBUUMsSUFBSSxvQkFDWkQsUUFBUUMsSUFBSUgsV0FBV0ksS0FDdkJvRSxPQUFPQyxTQUFTc0IsUUFBUSxJQUUxQkMsTUFBTUMsSUFDSjNJLEVBQU8ySSxFQUNjLE1BQWpCdEIsSUFDQXBILEVBQWEySSxTQUFTdkIsR0FBaUIsRUFDdkN6RSxRQUFRQyxJQUFJLGdCQUFpQjVDLElBR2pDbUIsRUFBa0IsR0F2YnRCLFdBQ0ksTUFBTXlILEVBQXFCNUcsU0FBU0MsZUFBZSx1QkFFL0MyRyxJQUNBQSxFQUFtQkMsVUFBWSwwRUN6RlQsR0QwRndEdEQsUUFBUSxvRUFDakNILEtBQUswRCxLQzFGakMsSUQwRndEdkQsUUFBUSxvTUFPakcsQ0EyYUl3RCxHQUNBbEksRUFBRSwwQkFBMEJFLE9BQzVCRixFQUFFLGlDQUFpQ1MsTUFBTSxJQTZCN0NxQixRQUFRQyxJQUFJLDZCQUE4QkgsV0FBV0ksS0FFckQsSUFBSW1HLEdBQWUsRUFDbkJoSCxTQUFTNkUsbUJBQXFCLEtBQ3JCbUMsSUFDRHRJLEdBQXFCLEVBQ3JCc0ksR0FBZSxFQUNUdkcsV0FBV0ksSUFBS29GLFdBQVcsU0FFOUJnQixNQUFNLGdGQUVURCxHQUFlLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvY29ubmVjdG9yLnRzIiwid2VicGFjazovLy8uL3NyYy9tYWluX3Byb2RfbWV0cmljLnRzIiwid2VicGFjazovLy8uL3NyYy9nbG9iYWxzLnRzIiwid2VicGFjazovLy8uL3NyYy91dGlscy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBERVZNT0RFIH0gZnJvbSAnLi9nbG9iYWxzJ1xuaW1wb3J0IHsgTU9DS01PREUgfSBmcm9tICcuL21haW4nXG5cbmxldCBTRVJWRVJfTE9HX1JPT1QgPSBERVZNT0RFID8gXCJodHRwOi8vMTI3LjAuMC4xOjUwMDAvXCIgOiBcImh0dHBzOi8vdGVqYXNzcmluaXZhc2FuLnB5dGhvbmFueXdoZXJlLmNvbS9cIlxuXG5hc3luYyBmdW5jdGlvbiBzbGVlcChtczogbnVtYmVyKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIG1zKSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2FkX2RhdGEoKTogUHJvbWlzZTxhbnk+IHtcbiAgICAvLyBpbmNsdWRlIHRpbWVzdGFtcCBzbyB0aGF0IHRoaW5ncyBkb24ndCBnZXQgY2FjaGVkXG4gICAgbGV0IHJlc3VsdCA9IGF3YWl0ICQuZ2V0SlNPTihcbiAgICAgICAgYGJha2VkX3F1ZXVlcy8ke2dsb2JhbFRoaXMudWlkfS5qc29uP3Q9JHtEYXRlLm5vdygpfWAsXG4gICAgKVxuICAgIHJldHVybiByZXN1bHRcbn1cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2dfZGF0YShkYXRhKTogUHJvbWlzZTxhbnk+IHtcbiAgICAvL2lmIChNT0NLTU9ERSkge1xuICAgIC8vICAgIGNvbnNvbGUubG9nKFwibG9nZ2VkIChtb2NrKVwiLCBkYXRhKVxuICAgIC8vICAgIHJldHVyblxuICAgIC8vfVxuICAgIFxuICAgIGRhdGFbXCJ1cmxfZGF0YVwiXSA9IGdsb2JhbFRoaXMudXJsX2RhdGFcbiAgICBjb25zb2xlLmxvZyhcIkRhdGFcIilcbiAgICBpZiAoIShcInN0dWR5X2lkXCIgaW4gZGF0YVsndXJsX2RhdGEnXSkpIHtcbiAgICAgICAgZGF0YVsndXJsX2RhdGEnXVtcInN0dWR5X2lkXCJdID0gXCJkZW1vX3N0dWR5XCJcbiAgICB9XG4gICAgaWYgKCEoXCJwcm9saWZpY19pZFwiIGluIGRhdGFbJ3VybF9kYXRhJ10pKSB7XG4gICAgICAgIGRhdGFbJ3VybF9kYXRhJ11bXCJwcm9saWZpY19pZFwiXSA9IFwiZGVtb191c2VyXCJcbiAgICB9XG4gICAgaWYgKCEoXCJzZXNzaW9uX2lkXCIgaW4gZGF0YVsndXJsX2RhdGEnXSkpIHtcbiAgICAgICAgZGF0YVsndXJsX2RhdGEnXVtcInNlc3Npb25faWRcIl0gPSBcImRlbW9fc2Vzc2lvblwiXG4gICAgfVxuICAgIGRhdGFbXCJ1cmxfZGF0YVwiXVtcInF1ZXVlX2lkXCJdID0gZ2xvYmFsVGhpcy51aWRcbiAgICBjb25zb2xlLmxvZyhcImxvZ2dlZFwiLCBkYXRhKVxuICAgIGNvbnNvbGUubG9nKFwiTG9nZ2luZyB0b1wiLCBTRVJWRVJfTE9HX1JPT1QgKyBcImxvZ1wiKVxuXG4gICAgdHJ5IHtcbiAgICAgICAgbGV0IHJlc3VsdCA9IGF3YWl0ICQuYWpheChcbiAgICAgICAgICAgIFNFUlZFUl9MT0dfUk9PVCArIFwibG9nXCIsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgICAgICBwcm9qZWN0OiBcInZsbS1yYXRpb25hbGVzLXN0dWR5L1wiK2RhdGFbJ3VybF9kYXRhJ11bJ3N0dWR5X2lkJ10sXG4gICAgICAgICAgICAgICAgICAgIHVpZDogZ2xvYmFsVGhpcy51aWQucmVwbGFjZShcIi9cIiwgXCJfXCIpICsgXCJfXCIgKyBkYXRhWyd1cmxfZGF0YSddWydwcm9saWZpY19pZCddLFxuICAgICAgICAgICAgICAgICAgICBwYXlsb2FkOiBKU09OLnN0cmluZ2lmeShkYXRhKSxcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAgIH1cbiAgICAgICAgKVxuICAgICAgICBhd2FpdCBzbGVlcCgyMDAwKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdFxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS5sb2coZSlcbiAgICB9XG59IiwiaW1wb3J0IHsgREVWTU9ERSwgUkVXQVJEX0NPUlJFQ1QsIFBFTkFMVFlfSU5DT1JSRUNULCBFTkFCTEVfVElNRVIgfSBmcm9tIFwiLi9nbG9iYWxzXCJcbmV4cG9ydCB2YXIgVUlEOiBzdHJpbmdcbmV4cG9ydCB2YXIgTU9DS01PREU6IGJvb2xlYW4gPSBmYWxzZVxuaW1wb3J0IHsgbG9hZF9kYXRhLCBsb2dfZGF0YSB9IGZyb20gJy4vY29ubmVjdG9yJ1xuaW1wb3J0IHsgcGFyYW1zVG9PYmplY3QgfSBmcm9tIFwiLi91dGlsc1wiXG5cbnZhciBkYXRhOiBhbnlbXSA9IFtdXG5sZXQgcXVlc3Rpb25faSA9IC0xXG5sZXQgcXVlc3Rpb246IGFueSA9IG51bGxcbmxldCB1c2Vyc2VsZWN0aW9uX2Fuc3dlcm9ubHk6IG51bWJlciA9IC0xXG5sZXQgdXNlcnNlbGVjdGlvbl93aXRoZXhwbGFuYXRpb246IG51bWJlciA9IC0xXG5sZXQgdXNlcnNlbGVjdGlvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5OiBudW1iZXIgPSAtMVxubGV0IG51bV9jb3JyZWN0ID0gMFxubGV0IG51bV9pbmNvcnJlY3QgPSAwXG5sZXQgbnVtX3Vuc3VyZSA9IDBcblxubGV0IGJhbGFuY2UgPSAwXG5cbmxldCBpbnN0cnVjdGlvbl9pOiBudW1iZXIgPSAwXG5sZXQgY291bnRfZXhpdGVkX3BhZ2U6IG51bWJlciA9IDBcblxuZnVuY3Rpb24gYXNzZXJ0KGNvbmRpdGlvbiwgbWVzc2FnZSkge1xuICAgIGlmICghY29uZGl0aW9uKSB7XG4gICAgICAgIHRocm93IG1lc3NhZ2UgfHwgXCJBc3NlcnRpb24gZmFpbGVkXCI7XG4gICAgfVxufVxuXG5mdW5jdGlvbiByZWdpc3RlckFuc3dlck9ubHlVc2VyU2VsZWN0aW9uKHVzZXJfY2hvaWNlOiBudW1iZXIpIHtcbiAgICB1c2Vyc2VsZWN0aW9uX2Fuc3dlcm9ubHkgPSB1c2VyX2Nob2ljZVxuXG4gICAgJChcIiNidXR0b25fYW5zd2Vyb25seV91c2VydHJ1c3RzXCIpLmF0dHIoXCJkaXNhYmxlZFwiLCBcInRydWVcIilcbiAgICAkKFwiI2J1dHRvbl9hbnN3ZXJvbmx5X3VzZXJkaXN0cnVzdHNcIikuYXR0cihcImRpc2FibGVkXCIsIFwidHJ1ZVwiKVxuICAgICQoXCIjYnV0dG9uX2Fuc3dlcm9ubHlfdXNlcnVuc3VyZVwiKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJ0cnVlXCIpXG4gICAgaWYgKHVzZXJfY2hvaWNlID09IDApIHtcbiAgICAgICAgJChcIiNidXR0b25fYW5zd2Vyb25seV91c2VydHJ1c3RzXCIpLmF0dHIoXCJhY3RpdmVkZWNpc2lvblwiLCBcInRydWVcIilcbiAgICB9IGVsc2UgaWYgKHVzZXJfY2hvaWNlID09IDEpIHtcbiAgICAgICAgJChcIiNidXR0b25fYW5zd2Vyb25seV91c2VyZGlzdHJ1c3RzXCIpLmF0dHIoXCJhY3RpdmVkZWNpc2lvblwiLCBcInRydWVcIilcbiAgICB9IGVsc2UgaWYgKHVzZXJfY2hvaWNlID09IDIpIHtcbiAgICAgICAgJChcIiNidXR0b25fYW5zd2Vyb25seV91c2VydW5zdXJlXCIpLmF0dHIoXCJhY3RpdmVkZWNpc2lvblwiLCBcInRydWVcIilcbiAgICB9XG4gICAgJChcIiNhaV9leHBsYW5hdGlvbl9kaXZcIikuc2hvdygpXG59XG4vLyBFdmVudCBsaXN0ZW5lciBmb3IgdGhlIGJ1dHRvbiBjbGlja1xuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1dHRvbl9hbnN3ZXJvbmx5X3VzZXJ0cnVzdHMnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiByZWdpc3RlckFuc3dlck9ubHlVc2VyU2VsZWN0aW9uKDApKTtcbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXR0b25fYW5zd2Vyb25seV91c2VyZGlzdHJ1c3RzJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gcmVnaXN0ZXJBbnN3ZXJPbmx5VXNlclNlbGVjdGlvbigxKSk7XG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnV0dG9uX2Fuc3dlcm9ubHlfdXNlcnVuc3VyZScpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHJlZ2lzdGVyQW5zd2VyT25seVVzZXJTZWxlY3Rpb24oMikpO1xuXG5cbmZ1bmN0aW9uIHJlZ2lzdGVyV2l0aEV4cGxhbmF0aW9uVXNlclNlbGVjdGlvbih1c2VyX2Nob2ljZTogbnVtYmVyKSB7XG4gICAgdXNlcnNlbGVjdGlvbl93aXRoZXhwbGFuYXRpb24gPSB1c2VyX2Nob2ljZVxuXG4gICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9uX3VzZXJ0cnVzdHNcIikuYXR0cihcImRpc2FibGVkXCIsIFwidHJ1ZVwiKVxuICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbl91c2VyZGlzdHJ1c3RzXCIpLmF0dHIoXCJkaXNhYmxlZFwiLCBcInRydWVcIilcbiAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25fdXNlcnVuc3VyZVwiKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJ0cnVlXCIpXG4gICAgaWYgKHVzZXJfY2hvaWNlID09IDApIHtcbiAgICAgICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9uX3VzZXJ0cnVzdHNcIikuYXR0cihcImFjdGl2ZWRlY2lzaW9uXCIsIFwidHJ1ZVwiKVxuICAgIH0gZWxzZSBpZiAodXNlcl9jaG9pY2UgPT0gMSkge1xuICAgICAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25fdXNlcmRpc3RydXN0c1wiKS5hdHRyKFwiYWN0aXZlZGVjaXNpb25cIiwgXCJ0cnVlXCIpXG4gICAgfSBlbHNlIGlmICh1c2VyX2Nob2ljZSA9PSAyKSB7XG4gICAgICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbl91c2VydW5zdXJlXCIpLmF0dHIoXCJhY3RpdmVkZWNpc2lvblwiLCBcInRydWVcIilcbiAgICB9XG4gICAgJChcIiNhaV9leHBsYW5hdGlvbl9xdWFsaXR5X2RpdlwiKS5zaG93KClcbn1cblxuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1dHRvbl93aXRoZXhwbGFuYXRpb25fdXNlcnRydXN0cycpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHJlZ2lzdGVyV2l0aEV4cGxhbmF0aW9uVXNlclNlbGVjdGlvbigwKSk7XG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnV0dG9uX3dpdGhleHBsYW5hdGlvbl91c2VyZGlzdHJ1c3RzJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gcmVnaXN0ZXJXaXRoRXhwbGFuYXRpb25Vc2VyU2VsZWN0aW9uKDEpKTtcbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXR0b25fd2l0aGV4cGxhbmF0aW9uX3VzZXJ1bnN1cmUnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiByZWdpc3RlcldpdGhFeHBsYW5hdGlvblVzZXJTZWxlY3Rpb24oMikpO1xuICBcbmZ1bmN0aW9uIHJlZ2lzdGVyV2l0aEV4cGxhbmF0aW9uUXVhbGl0eVVzZXJTZWxlY3Rpb24odXNlcl9jaG9pY2U6IG51bWJlcikge1xuICAgIHVzZXJzZWxlY3Rpb25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eSA9IHVzZXJfY2hvaWNlXG5cbiAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5X3VzZXJ0cnVzdHNcIikuYXR0cihcImRpc2FibGVkXCIsIFwidHJ1ZVwiKVxuICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHlfdXNlcmRpc3RydXN0c1wiKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJ0cnVlXCIpXG4gICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eV91c2VydW5zdXJlXCIpLmF0dHIoXCJkaXNhYmxlZFwiLCBcInRydWVcIilcbiAgICBpZiAodXNlcl9jaG9pY2UgPT0gMCkge1xuICAgICAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5X3VzZXJ0cnVzdHNcIikuYXR0cihcImFjdGl2ZWRlY2lzaW9uXCIsIFwidHJ1ZVwiKVxuICAgIH0gZWxzZSBpZiAodXNlcl9jaG9pY2UgPT0gMSkge1xuICAgICAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5X3VzZXJkaXN0cnVzdHNcIikuYXR0cihcImFjdGl2ZWRlY2lzaW9uXCIsIFwidHJ1ZVwiKVxuICAgIH0gZWxzZSBpZiAodXNlcl9jaG9pY2UgPT0gMikge1xuICAgICAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5X3VzZXJ1bnN1cmVcIikuYXR0cihcImFjdGl2ZWRlY2lzaW9uXCIsIFwidHJ1ZVwiKVxuICAgIH1cbiAgICAkKFwiI2J1dHRvbl9uZXh0XCIpLnNob3coKVxuICAgICQoXCIjYnV0dG9uX25leHRcIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpXG59XG5cbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXR0b25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eV91c2VydHJ1c3RzJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gcmVnaXN0ZXJXaXRoRXhwbGFuYXRpb25RdWFsaXR5VXNlclNlbGVjdGlvbigwKSk7XG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnV0dG9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHlfdXNlcmRpc3RydXN0cycpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHJlZ2lzdGVyV2l0aEV4cGxhbmF0aW9uUXVhbGl0eVVzZXJTZWxlY3Rpb24oMSkpO1xuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1dHRvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5X3VzZXJ1bnN1cmUnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiByZWdpc3RlcldpdGhFeHBsYW5hdGlvblF1YWxpdHlVc2VyU2VsZWN0aW9uKDIpKTtcblxuXG5mdW5jdGlvbiB1cGRhdGVSZXdhcmRJbnN0cnVjdGlvbnMoKSB7XG4gICAgY29uc3QgcmV3YXJkSW5zdHJ1Y3Rpb25zID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jld2FyZF9pbnN0cnVjdGlvbnMnKTtcblxuICAgIGlmIChyZXdhcmRJbnN0cnVjdGlvbnMpIHtcbiAgICAgICAgcmV3YXJkSW5zdHJ1Y3Rpb25zLmlubmVySFRNTCA9IGBcbiAgICAgICAgICAgIElmIHlvdXIgZmluYWwgZGVjaXNpb24gaXMgY29ycmVjdCwgeW91IGdhaW4gYSByZXdhcmQgb2YgJCR7UkVXQVJEX0NPUlJFQ1QudG9GaXhlZCgyKX0uIFxuICAgICAgICAgICAgSWYgeW91ciBmaW5hbCBkZWNpc2lvbiBpcyBpbmNvcnJlY3QsIHlvdSBsb3NlICQke01hdGguYWJzKFBFTkFMVFlfSU5DT1JSRUNUKS50b0ZpeGVkKDIpfSBmcm9tIHlvdXIgcmV3YXJkLiBcbiAgICAgICAgICAgIFlvdSB3aWxsIHNlZSB5b3VyIHRvdGFsIHJld2FyZCBhdCB0aGUgZW5kIG9mIHRoZSBleHBlcmltZW50LiBcbiAgICAgICAgICAgIFlvdXIgcGF5bWVudCBpcyAkMi4wIHBsdXMgd2hhdGV2ZXIgeW91IGFjY3VtdWxhdGUgZHVyaW5nIHRoaXMgZXhwZXJpbWVudC5cbiAgICAgICAgYDtcbiAgICAgICAgLy8gSWYgeW91ciBmaW5hbCBkZWNpc2lvbiBpcyBjb3JyZWN0LCB5b3UgZ2FpbiBhIHJld2FyZCBvZiAkMC4xMC4gSWYgeW91ciBmaW5hbCBkZWNpc2lvbiBpcyBpbmNvcnJlY3QsIHlvdSBsb3NlICQwLjEwIGZyb20geW91ciByZXdhcmQuXG4gICAgICAgIC8vIFlvdSB3aWxsIHNlZSB5b3VyIHRvdGFsIHJld2FyZCBhdCB0aGUgZW5kIG9mIHRoZSBleHBlcmltZW50LiBZb3VyIHBheW1lbnQgaXMgJDIuMCBwbHVzIHdoYXRldmVyIHlvdSBhY2N1bXVsYXRlIGR1cmluZyB0aGlzIGV4cGVyaW1lbnQuXG4gICAgfVxufVxuXG5mdW5jdGlvbiBuZXh0X2luc3RydWN0aW9ucyhpbmNyZW1lbnQ6IG51bWJlcikge1xuICAgIGluc3RydWN0aW9uX2kgKz0gaW5jcmVtZW50XG5cbiAgICBpZiAoaW5zdHJ1Y3Rpb25faSA9PSAwKSB7XG4gICAgICAgICQoXCIjYnV0dG9uX2luc3RydWN0aW9uc19wcmV2XCIpLmF0dHIoXCJkaXNhYmxlZFwiLCBcInRydWVcIilcbiAgICB9IGVsc2Uge1xuICAgICAgICAkKFwiI2J1dHRvbl9pbnN0cnVjdGlvbnNfcHJldlwiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIilcbiAgICB9XG4gICAgaWYgKGluc3RydWN0aW9uX2kgPj0gNSkge1xuICAgICAgICAkKFwiI2luc3RydWN0aW9uc19hbmRfZGVjb3JhdGlvbnNcIikuc2hvdygpXG4gICAgICAgICQoXCIjYnV0dG9uX2luc3RydWN0aW9uc19uZXh0XCIpLnZhbChcIlN0YXJ0IHN0dWR5XCIpXG4gICAgfSBlbHNlIHtcbiAgICAgICAgJChcIiNpbnN0cnVjdGlvbnNfYW5kX2RlY29yYXRpb25zXCIpLmhpZGUoKVxuICAgICAgICAkKFwiI2J1dHRvbl9pbnN0cnVjdGlvbnNfbmV4dFwiKS52YWwoXCJOZXh0XCIpXG4gICAgfVxuICAgIGlmIChpbnN0cnVjdGlvbl9pID09IDYpIHtcbiAgICAgICAgJChcIiNpbnN0cnVjdGlvbnNfYW5kX2RlY29yYXRpb25zXCIpLnNob3coKVxuICAgICAgICAkKFwiI21haW5fYm94X2luc3RydWN0aW9uc1wiKS5oaWRlKClcbiAgICAgICAgJChcIiNtYWluX2JveF9leHBlcmltZW50XCIpLnNob3coKVxuICAgICAgICBuZXh0X3F1ZXN0aW9uKClcbiAgICB9XG5cbiAgICAkKFwiI21haW5fYm94X2luc3RydWN0aW9uc1wiKS5jaGlsZHJlbihcIjpub3QoaW5wdXQpXCIpLmVhY2goKF8sIGVsKSA9PiB7XG4gICAgICAgICQoZWwpLmhpZGUoKVxuICAgIH0pXG4gICAgJChgI2luc3RydWN0aW9uc18ke2luc3RydWN0aW9uX2l9YCkuc2hvdygpXG59XG4kKFwiI2J1dHRvbl9pbnN0cnVjdGlvbnNfbmV4dFwiKS5vbihcImNsaWNrXCIsICgpID0+IG5leHRfaW5zdHJ1Y3Rpb25zKCsxKSlcbiQoXCIjYnV0dG9uX2luc3RydWN0aW9uc19wcmV2XCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4gbmV4dF9pbnN0cnVjdGlvbnMoLTEpKVxuXG5mdW5jdGlvbiB1dGlsaXR5X29mX3NlbGVjdGlvbihzZWxlY3Rpb246IG51bWJlcikge1xuICAgIGxldCB1dGlsaXR5OiBudW1iZXIgPSAwXG4gICAgaWYgKHNlbGVjdGlvbiA9PSAyKSB7XG4gICAgICAgIHV0aWxpdHkgPSAwXG4gICAgfSBlbHNlIHtcbiAgICAgICAgbGV0IGNvcnJlY3Rfc2VsZWN0aW9uID0gMSAtIHF1ZXN0aW9uW1wicHJlZGljdGlvbl9pc19jb3JyZWN0XCJdIC8vIDAgaWYgQUkgaXMgY29ycmVjdCwgMSBpZiBpbmNvcnJlY3RcbiAgICAgICAgdXRpbGl0eSA9IChzZWxlY3Rpb24gPT0gY29ycmVjdF9zZWxlY3Rpb24pID8gMSA6IC0xXG4gICAgfVxuICAgIHJldHVybiB1dGlsaXR5XG59XG5cbiQoXCIjYnV0dG9uX25leHRcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG5cbiAgICAvLyBVcGRhdGUgdGhlIHVzZXIgYmFsYW5jZVxuICAgIGxldCBvbGRfYmFsYW5jZSA9IGJhbGFuY2VcbiAgICB1cGRhdGVfYmFsYW5jZSgpXG5cbiAgICBpZiAocXVlc3Rpb25faSAhPSAtMSkge1xuICAgICAgICBsZXQgbG9nZ2VkX2RhdGEgPSB7XG4gICAgICAgICAgICBcInF1ZXN0aW9uX2lcIjogcXVlc3Rpb25faSxcbiAgICAgICAgICAgIFwidXNlcl9zZWxlY3Rpb25zXCI6IHtcbiAgICAgICAgICAgICAgICBcImFuc3dlcm9ubHlcIjogdXNlcnNlbGVjdGlvbl9hbnN3ZXJvbmx5LFxuICAgICAgICAgICAgICAgIFwid2l0aGV4cGxhbmF0aW9uXCI6IHVzZXJzZWxlY3Rpb25fd2l0aGV4cGxhbmF0aW9uLFxuICAgICAgICAgICAgICAgIFwid2l0aGV4cGxhbmF0aW9ucXVhbGl0eVwiOiB1c2Vyc2VsZWN0aW9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHlcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcInVzZXJfaXNfY29ycmVjdFwiOiB7XG4gICAgICAgICAgICAgICAgXCJhbnN3ZXJvbmx5XCI6IGlzX3VzZXJfY29ycmVjdCh1c2Vyc2VsZWN0aW9uX2Fuc3dlcm9ubHkpLFxuICAgICAgICAgICAgICAgIFwid2l0aGV4cGxhbmF0aW9uXCI6IGlzX3VzZXJfY29ycmVjdCh1c2Vyc2VsZWN0aW9uX3dpdGhleHBsYW5hdGlvbiksXG4gICAgICAgICAgICAgICAgXCJ3aXRoZXhwbGFuYXRpb25xdWFsaXR5XCI6IGlzX3VzZXJfY29ycmVjdCh1c2Vyc2VsZWN0aW9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHkpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJ1dGlsaXR5X29mX2V4cGxhbmF0aW9uXCI6IHV0aWxpdHlfb2Zfc2VsZWN0aW9uKHVzZXJzZWxlY3Rpb25fd2l0aGV4cGxhbmF0aW9uKSAtIHV0aWxpdHlfb2Zfc2VsZWN0aW9uKHVzZXJzZWxlY3Rpb25fYW5zd2Vyb25seSksXG4gICAgICAgICAgICBcInV0aWxpdHlfb2ZfcXVhbGl0eV9tZXRyaWNzXCI6IHV0aWxpdHlfb2Zfc2VsZWN0aW9uKHVzZXJzZWxlY3Rpb25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eSkgLSB1dGlsaXR5X29mX3NlbGVjdGlvbih1c2Vyc2VsZWN0aW9uX3dpdGhleHBsYW5hdGlvbiksXG4gICAgICAgICAgICBcImJhbGFuY2VcIjoge1xuICAgICAgICAgICAgICAgIFwib2xkXCI6IG9sZF9iYWxhbmNlLFxuICAgICAgICAgICAgICAgIFwibmV3XCI6IGJhbGFuY2VcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGxvZ2dlZF9kYXRhWydxdWVzdGlvbiddID0gcXVlc3Rpb25cbiAgICAgICAgbG9nZ2VkX2RhdGFbJ2NvdW50X2V4aXRlZF9wYWdlJ10gPSBjb3VudF9leGl0ZWRfcGFnZVxuICAgICAgICBsb2dfZGF0YShsb2dnZWRfZGF0YSlcbiAgICAgICAgY291bnRfZXhpdGVkX3BhZ2UgPSAwXG4gICAgfVxuICAgIFxuXG4gICAgbmV4dF9xdWVzdGlvbigpXG59KTtcblxuXG5mdW5jdGlvbiBpc191c2VyX2NvcnJlY3Qoc2VsZWN0aW9uKSB7XG4gICAgaWYgKHNlbGVjdGlvbiAhPSAyKSB7XG4gICAgICAgIGxldCBjb3JyZWN0X3NlbGVjdGlvbiA9IDEgLSBxdWVzdGlvbltcInByZWRpY3Rpb25faXNfY29ycmVjdFwiXSAvLyAwIGlmIEFJIGlzIGNvcnJlY3QsIDEgaWYgaW5jb3JyZWN0XG4gICAgICAgIHJldHVybiBzZWxlY3Rpb24gPT0gY29ycmVjdF9zZWxlY3Rpb24gPyAxIDogMFxuICAgIH1cbiAgICByZXR1cm4gLTFcbn1cblxuZnVuY3Rpb24gdXBkYXRlX2JhbGFuY2UoKSB7XG4gICAgaWYgKHVzZXJzZWxlY3Rpb25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eSAhPSAyKSB7XG4gICAgICAgIGxldCBjb3JyZWN0X3NlbGVjdGlvbiA9IDEgLSBxdWVzdGlvbltcInByZWRpY3Rpb25faXNfY29ycmVjdFwiXSAvLyAwIGlmIEFJIGlzIGNvcnJlY3QsIDEgaWYgaW5jb3JyZWN0XG4gICAgICAgIGlmICh1c2Vyc2VsZWN0aW9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHkgPT0gY29ycmVjdF9zZWxlY3Rpb24pIHtcbiAgICAgICAgICAgIGJhbGFuY2UgKz0gUkVXQVJEX0NPUlJFQ1Q7XG4gICAgICAgICAgICBudW1fY29ycmVjdCArPSAxO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYmFsYW5jZSArPSBQRU5BTFRZX0lOQ09SUkVDVDtcbiAgICAgICAgICAgIG51bV9pbmNvcnJlY3QgKz0gMTtcbiAgICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAgIG51bV91bnN1cmUgKz0gMTtcbiAgICB9XG59XG5cbi8vIFRvIGVuc3VyZSBiYWxhbmNlIGlzIG5vbi1uZWdhdGl2ZVxuZnVuY3Rpb24gZmluYWxpemVfYmFsYW5jZSgpIHtcbiAgICBiYWxhbmNlID0gTWF0aC5tYXgoMCwgYmFsYW5jZSk7XG4gICAgcmV0dXJuIGJhbGFuY2U7XG59XG5cbmxldCBhY3RpdmVUaW1lcjogUmV0dXJuVHlwZTx0eXBlb2Ygc2V0SW50ZXJ2YWw+IHwgbnVsbCA9IG51bGw7IC8vIFRpbWVyIGludGVydmFsXG5cbmZ1bmN0aW9uIHN0YXJ0VGltZXIoZHVyYXRpb24sIHN0ZXBEaXYsIGJ1dHRvbnMsIGNhbGxiYWNrKSB7XG4gICAgaWYgKCFFTkFCTEVfVElNRVIpIHtcbiAgICAgICAgLy8gSWYgdGhlIHRpbWVyIGlzIGRpc2FibGVkLCBlbmFibGUgdGhlIGJ1dHRvbnMgaW1tZWRpYXRlbHlcbiAgICAgICAgYnV0dG9ucy5mb3JFYWNoKGJ1dHRvbiA9PiBidXR0b24ucmVtb3ZlQXR0cmlidXRlKFwiZGlzYWJsZWRcIikpO1xuICAgICAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBDbGVhciBhbnkgZXhpc3RpbmcgdGltZXIgdG8gcHJldmVudCBtdWx0aXBsZSBpbnRlcnZhbHNcbiAgICBpZiAoYWN0aXZlVGltZXIpIHtcbiAgICAgICAgY2xlYXJJbnRlcnZhbChhY3RpdmVUaW1lcik7XG4gICAgICAgIGFjdGl2ZVRpbWVyID0gbnVsbDtcbiAgICB9XG5cbiAgICAvLyBEaXNhYmxlIGJ1dHRvbnNcbiAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IGJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCBcInRydWVcIikpO1xuICAgIFxuICAgIC8vIFNob3cgdGltZXIgdmlzdWFsbHlcbiAgICBsZXQgdGltZXJEaXNwbGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgdGltZXJEaXNwbGF5LmlkID0gYHRpbWVyXyR7c3RlcERpdi5pZH1gO1xuICAgIHRpbWVyRGlzcGxheS5zdHlsZS5mb250V2VpZ2h0ID0gJ2JvbGQnO1xuICAgIHRpbWVyRGlzcGxheS5zdHlsZS5tYXJnaW5Ub3AgPSAnMTBweCc7XG4gICAgc3RlcERpdi5hcHBlbmRDaGlsZCh0aW1lckRpc3BsYXkpO1xuXG4gICAgbGV0IHJlbWFpbmluZ1RpbWUgPSBkdXJhdGlvbjtcblxuICAgIC8vIEluaXRpYWwgZGlzcGxheVxuICAgIHRpbWVyRGlzcGxheS50ZXh0Q29udGVudCA9IGBQbGVhc2Ugd2FpdCAke3JlbWFpbmluZ1RpbWV9IHNlY29uZChzKSBiZWZvcmUgbWFraW5nIHlvdXIgc2VsZWN0aW9uLmA7XG5cbiAgICBhY3RpdmVUaW1lciA9IHNldEludGVydmFsKCgpID0+IHtcbiAgICAgICAgcmVtYWluaW5nVGltZS0tO1xuICAgICAgICBpZiAocmVtYWluaW5nVGltZSA+PSAwKSB7XG4gICAgICAgICAgICB0aW1lckRpc3BsYXkudGV4dENvbnRlbnQgPSBgUGxlYXNlIHdhaXQgJHtyZW1haW5pbmdUaW1lfSBzZWNvbmQocykgYmVmb3JlIG1ha2luZyB5b3VyIHNlbGVjdGlvbi5gO1xuICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICBpZiAoYWN0aXZlVGltZXIgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKGFjdGl2ZVRpbWVyKTsgLy8gU3RvcCB0aGUgdGltZXJcbiAgICAgICAgICAgICAgICBhY3RpdmVUaW1lciA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhY3RpdmVUaW1lciA9IG51bGw7XG5cbiAgICAgICAgICAgIC8vIFJlbW92ZSB0aW1lciBkaXNwbGF5XG4gICAgICAgICAgICBzdGVwRGl2LnJlbW92ZUNoaWxkKHRpbWVyRGlzcGxheSk7XG5cbiAgICAgICAgICAgIC8vIEVuYWJsZSBidXR0b25zXG4gICAgICAgICAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IGJ1dHRvbi5yZW1vdmVBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKSk7XG5cbiAgICAgICAgICAgIGlmIChjYWxsYmFjaykgY2FsbGJhY2soKTtcbiAgICAgICAgfVxuICAgIH0sIDEwMDApO1xufVxuXG4vLyBXaGVuIHRoZSB1c2VyIHN3aXRjaGVzIHRhYnMgb3IgbWluaW1pemVzIHRoZSB3aW5kb3csIHBhdXNlIHRoZSB0aW1lclxuZG9jdW1lbnQub252aXNpYmlsaXR5Y2hhbmdlID0gKCkgPT4ge1xuICAgIGlmIChkb2N1bWVudC5oaWRkZW4pIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJXaW5kb3cgbG9zdCBmb2N1cy5cIik7XG4gICAgICAgIGlmIChhY3RpdmVUaW1lciAhPT0gbnVsbCkge1xuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChhY3RpdmVUaW1lcik7IC8vIFBhdXNlIHRoZSB0aW1lclxuICAgICAgICAgICAgYWN0aXZlVGltZXIgPSBudWxsO1xuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgLy8gSGFuZGxlIGxvZ2ljIHdoZW4gdGhlIHVzZXIgcmV0dXJuc1xuICAgICAgICBjb25zb2xlLmxvZyhcIldpbmRvdyByZWdhaW5lZCBmb2N1cy5cIik7XG4gICAgfVxufTtcblxuLy8gRmlyc3Qgc3RlcDogZW5mb3JjZSBhIDUtc2Vjb25kIHdhaXRcbmZ1bmN0aW9uIHNldHVwRmlyc3RTdGVwKGV4cGxhbmF0aW9uVGV4dCkge1xuICAgIGNvbnN0IGZpcnN0U3RlcERpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhaV9hbnN3ZXJfZGl2Jyk7XG4gICAgY29uc3QgYnV0dG9ucyA9IFtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1dHRvbl9hbnN3ZXJvbmx5X3VzZXJ0cnVzdHMnKSxcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1dHRvbl9hbnN3ZXJvbmx5X3VzZXJkaXN0cnVzdHMnKSxcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1dHRvbl9hbnN3ZXJvbmx5X3VzZXJ1bnN1cmUnKVxuICAgIF07XG5cbiAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IGJ1dHRvbj8ucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVGaXJzdFN0ZXBDbGljaykpOyAvLyBSZW1vdmUgb2xkIGxpc3RlbmVyc1xuICAgIGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gYnV0dG9uPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUZpcnN0U3RlcENsaWNrKSk7IC8vIEFkZCBuZXcgb25lc1xuXG4gICAgZnVuY3Rpb24gaGFuZGxlRmlyc3RTdGVwQ2xpY2soKSB7XG4gICAgICAgIGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gYnV0dG9uPy5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUZpcnN0U3RlcENsaWNrKSk7IC8vIENsZWFudXBcbiAgICAgICAgc2V0dXBTZWNvbmRTdGVwKGV4cGxhbmF0aW9uVGV4dCk7XG4gICAgfVxuXG4gICAgJChcIiNhaV9hbnN3ZXJfZGl2XCIpLnNob3coKTtcbiAgICBzdGFydFRpbWVyKDUsIGZpcnN0U3RlcERpdiwgYnV0dG9ucywgbnVsbCk7XG4gICAgLy8gJChcIiNhaV9hbnN3ZXJfZGl2XCIpLnNob3coKTsgLy8gU2hvdyB0aGUgZmlyc3Qgc3RlcFxuICAgIC8vIHN0YXJ0VGltZXIoNSwgZmlyc3RTdGVwRGl2LCBidXR0b25zLCAoKSA9PiB7XG4gICAgLy8gICAgIC8vIEJ1dHRvbnMgYXJlIG5vdyBlbmFibGVkOyB1c2VyIG11c3QgY2xpY2sgb25lIHRvIHByb2NlZWRcbiAgICAvLyAgICAgYnV0dG9ucy5mb3JFYWNoKGJ1dHRvbiA9PiB7XG4gICAgLy8gICAgICAgICBidXR0b24/LmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgLy8gICAgICAgICAgICAgJ2NsaWNrJyxcbiAgICAvLyAgICAgICAgICAgICAoKSA9PiB7XG4gICAgLy8gICAgICAgICAgICAgICAgIHNldHVwU2Vjb25kU3RlcChleHBsYW5hdGlvblRleHQpOyAvLyBQcm9jZWVkIHRvIHRoZSBzZWNvbmQgc3RlcCBhZnRlciBidXR0b24gY2xpY2tcbiAgICAvLyAgICAgICAgICAgICB9LFxuICAgIC8vICAgICAgICAgICAgIHsgb25jZTogdHJ1ZSB9IC8vIEVuc3VyZSB0aGUgZXZlbnQgbGlzdGVuZXIgaXMgZXhlY3V0ZWQgb25seSBvbmNlXG4gICAgLy8gICAgICAgICApO1xuICAgIC8vICAgICB9KTtcbiAgICAvLyB9KTtcbn1cblxuLy8gU2Vjb25kIHN0ZXAgdGltZXIgKGR5bmFtaWMgYmFzZWQgb24gcmVhZGluZyB0aW1lKVxuZnVuY3Rpb24gc2V0dXBTZWNvbmRTdGVwKGV4cGxhbmF0aW9uVGV4dCkge1xuICAgIGNvbnN0IHNlY29uZFN0ZXBEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWlfZXhwbGFuYXRpb25fZGl2Jyk7XG4gICAgY29uc3Qgd29yZHMgPSBleHBsYW5hdGlvblRleHQuc3BsaXQoJyAnKS5sZW5ndGg7XG4gICAgY29uc3QgcmVhZGluZ1RpbWUgPSBNYXRoLm1heChNYXRoLmNlaWwoMyArICh3b3JkcyAvIDIzOCkgKiA2MCksIDUpO1xuXG4gICAgY29uc3QgYnV0dG9ucyA9IFtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1dHRvbl93aXRoZXhwbGFuYXRpb25fdXNlcnRydXN0cycpLFxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnV0dG9uX3dpdGhleHBsYW5hdGlvbl91c2VyZGlzdHJ1c3RzJyksXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXR0b25fd2l0aGV4cGxhbmF0aW9uX3VzZXJ1bnN1cmUnKVxuICAgIF07XG5cbiAgICAvLyBSZW1vdmUgb2xkIGV2ZW50IGxpc3RlbmVyc1xuICAgIGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gYnV0dG9uPy5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZVNlY29uZFN0ZXBDbGljaykpO1xuXG4gICAgLy8gQWRkIG5ldyBldmVudCBsaXN0ZW5lcnNcbiAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IGJ1dHRvbj8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVTZWNvbmRTdGVwQ2xpY2spKTtcblxuICAgIGZ1bmN0aW9uIGhhbmRsZVNlY29uZFN0ZXBDbGljaygpIHtcbiAgICAgICAgLy8gQ2xlYW51cDogcmVtb3ZlIGV2ZW50IGxpc3RlbmVyc1xuICAgICAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IGJ1dHRvbj8ucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVTZWNvbmRTdGVwQ2xpY2spKTtcbiAgICAgICAgc2V0dXBUaGlyZFN0ZXAoZXhwbGFuYXRpb25UZXh0KTtcbiAgICB9XG5cbiAgICAkKFwiI2FpX2V4cGxhbmF0aW9uX2RpdlwiKS5zaG93KCk7IC8vIFNob3cgdGhlIHNlY29uZCBzdGVwXG4gICAgc3RhcnRUaW1lcihyZWFkaW5nVGltZSwgc2Vjb25kU3RlcERpdiwgYnV0dG9ucywgbnVsbCk7IC8vIFN0YXJ0IHRpbWVyXG59XG5cbi8vIFRoaXJkIHN0ZXAgdGltZXIgKDUgc2Vjb25kcylcbmZ1bmN0aW9uIHNldHVwVGhpcmRTdGVwKGV4cGxhbmF0aW9uVGV4dCkge1xuICAgIGNvbnN0IHRoaXJkU3RlcERpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhaV9leHBsYW5hdGlvbl9xdWFsaXR5X2RpdicpO1xuICAgIGNvbnN0IGJ1dHRvbnMgPSBbXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXR0b25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eV91c2VydHJ1c3RzJyksXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXR0b25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eV91c2VyZGlzdHJ1c3RzJyksXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXR0b25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eV91c2VydW5zdXJlJylcbiAgICBdO1xuXG4gICAgLy8gUmVtb3ZlIG9sZCBldmVudCBsaXN0ZW5lcnNcbiAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IGJ1dHRvbj8ucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVUaGlyZFN0ZXBDbGljaykpO1xuXG4gICAgLy8gQWRkIG5ldyBldmVudCBsaXN0ZW5lcnNcbiAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IGJ1dHRvbj8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVUaGlyZFN0ZXBDbGljaykpO1xuXG4gICAgZnVuY3Rpb24gaGFuZGxlVGhpcmRTdGVwQ2xpY2soKSB7XG4gICAgICAgIC8vIENsZWFudXA6IHJlbW92ZSBldmVudCBsaXN0ZW5lcnNcbiAgICAgICAgYnV0dG9ucy5mb3JFYWNoKGJ1dHRvbiA9PiBidXR0b24/LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlVGhpcmRTdGVwQ2xpY2spKTtcbiAgICAgICAgJChcIiNidXR0b25fbmV4dFwiKS5zaG93KCk7IC8vIEVuYWJsZSB0aGUgbmV4dCBxdWVzdGlvbiBidXR0b25cbiAgICB9XG5cbiAgICAkKFwiI2FpX2V4cGxhbmF0aW9uX3F1YWxpdHlfZGl2XCIpLnNob3coKTsgLy8gU2hvdyB0aGUgdGhpcmQgc3RlcFxuICAgIHN0YXJ0VGltZXIoNSwgdGhpcmRTdGVwRGl2LCBidXR0b25zLCBudWxsKTsgLy8gU3RhcnQgdGltZXJcbn1cblxuZnVuY3Rpb24gbmV4dF9xdWVzdGlvbigpIHtcbiAgICAvLyBSZXNldCB0aW1lcnMgYW5kIHN0YXRlXG4gICAgaWYgKGFjdGl2ZVRpbWVyKSB7XG4gICAgICAgIGNsZWFySW50ZXJ2YWwoYWN0aXZlVGltZXIpO1xuICAgICAgICBhY3RpdmVUaW1lciA9IG51bGw7XG4gICAgfVxuXG4gICAgLy8gcmVzdG9yZSBwcmV2aW91cyBzdGF0ZSBvZiBVSVxuICAgICQoXCIjYnV0dG9uX3JlYWR5dG9hbnN3ZXJcIikucmVtb3ZlQXR0cihcImFjdGl2ZWRlY2lzaW9uXCIpXG4gICAgJChcIiNidXR0b25fcmVhZHl0b2Fuc3dlclwiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIilcbiAgICAkKFwiI2J1dHRvbl9yZWFkeXRvYW5zd2VyXCIpLnNob3coKVxuXG4gICAgJChcIiNidXR0b25fYW5zd2Vyb25seV91c2VydHJ1c3RzXCIpLnJlbW92ZUF0dHIoXCJhY3RpdmVkZWNpc2lvblwiKVxuICAgICQoXCIjYnV0dG9uX2Fuc3dlcm9ubHlfdXNlcnRydXN0c1wiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIilcbiAgICAkKFwiI2J1dHRvbl9hbnN3ZXJvbmx5X3VzZXJkaXN0cnVzdHNcIikucmVtb3ZlQXR0cihcImFjdGl2ZWRlY2lzaW9uXCIpXG4gICAgJChcIiNidXR0b25fYW5zd2Vyb25seV91c2VyZGlzdHJ1c3RzXCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKVxuICAgICQoXCIjYnV0dG9uX2Fuc3dlcm9ubHlfdXNlcnVuc3VyZVwiKS5yZW1vdmVBdHRyKFwiYWN0aXZlZGVjaXNpb25cIilcbiAgICAkKFwiI2J1dHRvbl9hbnN3ZXJvbmx5X3VzZXJ1bnN1cmVcIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpXG5cbiAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25fdXNlcnRydXN0c1wiKS5yZW1vdmVBdHRyKFwiYWN0aXZlZGVjaXNpb25cIilcbiAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25fdXNlcnRydXN0c1wiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIilcbiAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25fdXNlcmRpc3RydXN0c1wiKS5yZW1vdmVBdHRyKFwiYWN0aXZlZGVjaXNpb25cIilcbiAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25fdXNlcmRpc3RydXN0c1wiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIilcbiAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25fdXNlcnVuc3VyZVwiKS5yZW1vdmVBdHRyKFwiYWN0aXZlZGVjaXNpb25cIilcbiAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25fdXNlcnVuc3VyZVwiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIilcblxuICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHlfdXNlcnRydXN0c1wiKS5yZW1vdmVBdHRyKFwiYWN0aXZlZGVjaXNpb25cIilcbiAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5X3VzZXJ0cnVzdHNcIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpXG4gICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eV91c2VyZGlzdHJ1c3RzXCIpLnJlbW92ZUF0dHIoXCJhY3RpdmVkZWNpc2lvblwiKVxuICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHlfdXNlcmRpc3RydXN0c1wiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIilcbiAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5X3VzZXJ1bnN1cmVcIikucmVtb3ZlQXR0cihcImFjdGl2ZWRlY2lzaW9uXCIpXG4gICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eV91c2VydW5zdXJlXCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKVxuXG4gICAgJChcIiNhaV9leHBsYW5hdGlvbl9kaXZcIikuaGlkZSgpXG4gICAgJChcIiNhaV9leHBsYW5hdGlvbl9xdWFsaXR5X2RpdlwiKS5oaWRlKClcbiAgICBcblxuICAgICQoXCIjYnV0dG9uX25leHRcIikuaGlkZSgpXG4gICAgJCgnI2J1dHRvbl9xdWl0JykuaGlkZSgpXG4gICAgLy8kKFwiI3JhbmdlX3ZhbFwiKS52YWwodXNlcl90cnVzdClcblxuICAgIHF1ZXN0aW9uX2kgKz0gMVxuICAgIGlmIChxdWVzdGlvbl9pID49IGRhdGEubGVuZ3RoKSB7XG4gICAgICAgICQoXCIjbWFpbl9ib3hfZXhwZXJpbWVudFwiKS5oaWRlKClcbiAgICAgICAgYmFsYW5jZSA9IGZpbmFsaXplX2JhbGFuY2UoKVxuXG4gICAgICAgIGxldCByZXdhcmRfdGV4dCA9IGBZb3VyIHRvdGFsIHJld2FyZCBpcyA8Yj4kJHtiYWxhbmNlLnRvRml4ZWQoMil9ICsgJDI8L2I+LmBcbiAgICAgICAgcmV3YXJkX3RleHQgKz0gYDxicj5Zb3UgYW5zd2VyZWQgYSB0b3RhbCBvZiAke3F1ZXN0aW9uX2l9IHF1ZXN0aW9uczogJHtudW1fY29ycmVjdH0gY29ycmVjdCwgJHtudW1faW5jb3JyZWN0fSBpbmNvcnJlY3QsICR7bnVtX3Vuc3VyZX0gdW5zdXJlLmBcbiAgICAgICAgaWYgKE1PQ0tNT0RFKSB7XG4gICAgICAgICAgICAkKCcjcmV3YXJkX2JveF9tb2NrJykuaHRtbChyZXdhcmRfdGV4dClcbiAgICAgICAgICAgICQoJyNyZXdhcmRfYm94X21vY2snKS5zaG93KClcbiAgICAgICAgICAgICQoXCIjbWFpbl9ib3hfZW5kX21vY2tcIikuc2hvdygpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkKCcjcmV3YXJkX2JveCcpLmh0bWwocmV3YXJkX3RleHQpXG4gICAgICAgICAgICAkKCcjcmV3YXJkX2JveCcpLnNob3coKVxuICAgICAgICAgICAgJChcIiNtYWluX2JveF9lbmRcIikuc2hvdygpXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgcXVlc3Rpb24gPSBkYXRhW3F1ZXN0aW9uX2ldXG5cbiAgICBjb25zdCBxdWVzdGlvblRleHQgPSBxdWVzdGlvbiFbXCJxdWVzdGlvblwiXTtcbiAgICBjb25zdCB1cGRhdGVkUXVlc3Rpb25UZXh0ID0gcXVlc3Rpb25UZXh0LnJlcGxhY2UoXCJDaG9pY2VzOlwiLCBcIjxicj48Yj5DaG9pY2VzOjwvYj5cIik7XG4gICAgJChcIiNxdWVzdGlvbl9zcGFuXCIpLmh0bWwodXBkYXRlZFF1ZXN0aW9uVGV4dCk7XG5cbiAgICAkKFwiI2FpX3ByZWRpY3Rpb25fc3BhblwiKS5odG1sKHF1ZXN0aW9uIVtcInByZWRpY3RlZF9hbnN3ZXJcIl0pXG4gICAgJChcIiNhaV9leHBsYW5hdGlvbl9zcGFuXCIpLmh0bWwocXVlc3Rpb24hW1wiZ2VuZXJhdGVkX3JhdGlvbmFsZVwiXSlcblxuICAgIC8vIGxldCB2aXN1YWxfZmlkZWxpdHlfY29uZiA9IE1hdGgucm91bmQocXVlc3Rpb24hW1widmlzdWFsX2ZpZGVsaXR5XCJdICogMTAwKVxuICAgIC8vICQoXCIjZXhwbGFuYXRpb25fZmlkZWxpdHlfc3BhblwiKS5odG1sKGAke3Zpc3VhbF9maWRlbGl0eV9jb25mfSVgKVxuICAgIC8vIGxldCB2aXN1YWxfY29udHJhc3RpdmVuZXNzX2NvbmYgPSBNYXRoLnJvdW5kKHF1ZXN0aW9uIVtcImNvbnRyYXN0aXZlbmVzc1wiXSAqIDEwMClcbiAgICAvLyAkKFwiI2V4cGxhbmF0aW9uX2NvbnRyYXN0aXZlbmVzc19zcGFuXCIpLmh0bWwoYCR7dmlzdWFsX2NvbnRyYXN0aXZlbmVzc19jb25mfSVgKVxuXG4gICAgLy8gU3VwcG9zZSB0aGUgcmF3IGZsb2F0aW5nIHZhbHVlcyBhcmUgaW4gcXVlc3Rpb24hW1widmlzdWFsX2ZpZGVsaXR5XCJdIGFuZCBxdWVzdGlvbiFbXCJjb250cmFzdGl2ZW5lc3NcIl1cbiAgICBsZXQgZmlkZWxpdHkgPSBxdWVzdGlvbiFbXCJ2aXN1YWxfZmlkZWxpdHlcIl1cbiAgICBsZXQgY29udHJhc3QgPSBxdWVzdGlvbiFbXCJjb250cmFzdGl2ZW5lc3NcIl1cblxuICAgIC8vIE5vdyBkZWZpbmUgeW91ciDigJxwcm9kdWN04oCdIG1ldHJpYzpcbiAgICBsZXQgcHJvZHVjdCA9IGZpZGVsaXR5ICogY29udHJhc3Q7XG5cbiAgICAvLyBJZiB5b3Ugd2FudCBhIHBlcmNlbnRhZ2UsIG11bHRpcGx5IGJ5IDEwMCBhbmQgcm91bmRcbiAgICBsZXQgcHJvZHVjdFBlcmNlbnQgPSBNYXRoLnJvdW5kKHByb2R1Y3QgKiAxMDApO1xuXG4gICAgLy8gVGhlbiBzaG93IGl0XG4gICAgJChcIiNleHBsYW5hdGlvbl9wcm9kdWN0X3NwYW5cIikuaHRtbChgJHtwcm9kdWN0UGVyY2VudH0lYCk7XG5cblxuXG4gICAgLy8gc2V0IGJldCB2YWx1ZSByYXRpb1xuICAgIC8vaWYocXVlc3Rpb24uaGFzT3duUHJvcGVydHkoXCJyZXdhcmRfcmF0aW9cIikpIHtcbiAgICAvLyAgICBsZXQgW3JhdGlvMSwgcmF0aW8yXSA9IHF1ZXN0aW9uW1wicmV3YXJkX3JhdGlvXCJdXG4gICAgLy8gICAgcmF0aW8xID0gTnVtYmVyKHJhdGlvMSlcbiAgICAvLyAgICByYXRpbzIgPSBOdW1iZXIocmF0aW8yKVxuICAgIC8vICAgIGJldF92YWxfcmF0aW8gPSByYXRpbzEvcmF0aW8yXG4gICAgLy99IGVsc2Uge1xuICAgIC8vICAgIGJldF92YWxfcmF0aW8gPSAxXG4gICAgLy99XG5cbiAgICAvL3RpbWVfcXVlc3Rpb25fc3RhcnQgPSBEYXRlLm5vdygpXG4gICAgJChcIiNwcm9ncmVzc1wiKS50ZXh0KGBQcm9ncmVzczogJHtxdWVzdGlvbl9pICsgMX0gLyAke2RhdGEubGVuZ3RofWApXG5cbiAgICBzZXR1cEZpcnN0U3RlcChxdWVzdGlvbltcImdlbmVyYXRlZF9yYXRpb25hbGVcIl0pO1xufVxuXG5cblxuLy8gZ2V0IHVzZXIgaWQgYW5kIGxvYWQgcXVldWVcbi8vIHRyeSB0byBzZWUgaWYgc3RhcnQgb3ZlcnJpZGUgd2FzIHBhc3NlZFxuY29uc3QgdXJsUGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh3aW5kb3cubG9jYXRpb24uc2VhcmNoKTtcbmNvbnN0IHN0YXJ0T3ZlcnJpZGUgPSB1cmxQYXJhbXMuZ2V0KCdzdGFydCcpO1xuY29uc3QgVUlERnJvbVVSTCA9IHVybFBhcmFtcy5nZXQoXCJ1aWRcIilcbmdsb2JhbFRoaXMudXJsX2RhdGEgPSBwYXJhbXNUb09iamVjdCh1cmxQYXJhbXMuZW50cmllcygpKVxuXG5pZiAoZ2xvYmFsVGhpcy51cmxfZGF0YVsnc3R1ZHlfaWQnXSA9PSBudWxsKSB7XG4gICAgZ2xvYmFsVGhpcy51cmxfZGF0YVsnc3R1ZHlfaWQnXSA9IFwiZGVtb19zdHVkeVwiXG59XG5pZiAoZ2xvYmFsVGhpcy51cmxfZGF0YVsncHJvbGlmaWNfaWQnXSA9PSBudWxsKSB7XG4gICAgZ2xvYmFsVGhpcy51cmxfZGF0YVsncHJvbGlmaWNfaWQnXSA9IFwiZGVtb191c2VyXCJcbn1cbmlmIChnbG9iYWxUaGlzLnVybF9kYXRhWydzZXNzaW9uX2lkJ10gPT0gbnVsbCkge1xuICAgIGdsb2JhbFRoaXMudXJsX2RhdGFbJ3Nlc3Npb25faWQnXSA9IFwiZGVtb19zZXNzaW9uXCJcbn1cblxuaWYgKFVJREZyb21VUkwgIT0gbnVsbCkge1xuICAgIGdsb2JhbFRoaXMudWlkID0gVUlERnJvbVVSTCBhcyBzdHJpbmdcbiAgICBpZiAoZ2xvYmFsVGhpcy51aWQgPT0gXCJwcm9saWZpY19yYW5kb21cIikge1xuICAgICAgICBsZXQgcXVldWVfaWQgPSBgJHtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCl9YC5wYWRTdGFydCgzLCBcIjBcIilcbiAgICAgICAgZ2xvYmFsVGhpcy51aWQgPSBgJHt1cmxQYXJhbXMuZ2V0KFwicHJvbGlmaWNfcXVldWVfbmFtZVwiKX0vJHtxdWV1ZV9pZH1gXG4gICAgfVxufSBlbHNlIGlmIChERVZNT0RFKSB7XG4gICAgZ2xvYmFsVGhpcy51aWQgPSBcImRlbW9cIlxufSBlbHNlIHtcbiAgICBsZXQgVUlEX21heWJlOiBhbnkgPSBudWxsXG4gICAgd2hpbGUgKFVJRF9tYXliZSA9PSBudWxsKSB7XG4gICAgICAgIFVJRF9tYXliZSA9IHByb21wdChcIkVudGVyIHlvdXIgdXNlciBpZC4gUGxlYXNlIGdldCBpbiB0b3VjaCBpZiB5b3Ugd2VyZSBub3QgYXNzaWduZWQgYW4gaWQgYnV0IHdpc2ggdG8gcGFydGljaXBhdGUgaW4gdGhpcyBleHBlcmltZW50LlwiKVxuICAgIH1cbiAgICBnbG9iYWxUaGlzLnVpZCA9IFVJRF9tYXliZSFcbn1cblxuLy8gdmVyc2lvbiBmb3IgcGFwZXJcbmlmIChERVZNT0RFKSB7XG4gICAgTU9DS01PREUgPSB0cnVlXG59IGVsc2UgaWYgKGdsb2JhbFRoaXMudXJsX2RhdGFbJ3Nlc3Npb25faWQnXS5zdGFydHNXaXRoKFwiZGVtb1wiKSkge1xuICAgIE1PQ0tNT0RFID0gdHJ1ZVxufVxuXG5jb25zb2xlLmxvZyhcIlJ1bm5pbmcgd2l0aCBVSURcIiwgZ2xvYmFsVGhpcy51aWQpXG5sb2FkX2RhdGEoKS5jYXRjaCgoX2Vycm9yKSA9PiB7XG4gICAgLy9hbGVydChcIkludmFsaWQgdXNlciBpZC5cIilcbiAgICBjb25zb2xlLmxvZyhcIkludmFsaWQgdXNlciBpZC5cIilcbiAgICBjb25zb2xlLmxvZyhnbG9iYWxUaGlzLnVpZCEpXG4gICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpXG59XG4pLnRoZW4oKG5ld19kYXRhKSA9PiB7XG4gICAgZGF0YSA9IG5ld19kYXRhXG4gICAgaWYgKHN0YXJ0T3ZlcnJpZGUgIT0gbnVsbCkge1xuICAgICAgICBxdWVzdGlvbl9pID0gcGFyc2VJbnQoc3RhcnRPdmVycmlkZSkgLSAxXG4gICAgICAgIGNvbnNvbGUubG9nKFwiU3RhcnRpbmcgZnJvbVwiLCBxdWVzdGlvbl9pKVxuICAgIH1cbiAgICAvLyBuZXh0X3F1ZXN0aW9uKClcbiAgICBuZXh0X2luc3RydWN0aW9ucygwKVxuICAgIHVwZGF0ZVJld2FyZEluc3RydWN0aW9ucygpO1xuICAgICQoXCIjbWFpbl9ib3hfaW5zdHJ1Y3Rpb25zXCIpLnNob3coKVxuICAgICQoXCIjaW5zdHJ1Y3Rpb25zX2FuZF9kZWNvcmF0aW9uc1wiKS5oaWRlKClcbn0pXG5cbi8vIC8vIER5bmFtaWNhbGx5IGxvYWQgZGF0YXNldCBiYXNlZCBvbiBEQVRBU0VUXG4vLyBmZXRjaChgLi9iYWtlZF9xdWV1ZXMvJHtEQVRBU0VUfWApXG4vLyAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuLy8gICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4vLyAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJGYWlsZWQgdG8gbG9hZCBkYXRhc2V0LlwiKTtcbi8vICAgICAgICAgfVxuLy8gICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuLy8gICAgIH0pXG4vLyAgICAgLnRoZW4oKG5ld19kYXRhKSA9PiB7XG4vLyAgICAgICAgIGRhdGEgPSBuZXdfZGF0YTtcbi8vICAgICAgICAgaWYgKHN0YXJ0T3ZlcnJpZGUgIT0gbnVsbCkge1xuLy8gICAgICAgICAgICAgcXVlc3Rpb25faSA9IHBhcnNlSW50KHN0YXJ0T3ZlcnJpZGUpIC0gMTtcbi8vICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiU3RhcnRpbmcgZnJvbVwiLCBxdWVzdGlvbl9pKTtcbi8vICAgICAgICAgfVxuLy8gICAgICAgICBuZXh0X2luc3RydWN0aW9ucygwKTtcbi8vICAgICAgICAgdXBkYXRlUmV3YXJkSW5zdHJ1Y3Rpb25zKCk7XG4vLyAgICAgICAgICQoXCIjbWFpbl9ib3hfaW5zdHJ1Y3Rpb25zXCIpLnNob3coKTtcbi8vICAgICAgICAgJChcIiNpbnN0cnVjdGlvbnNfYW5kX2RlY29yYXRpb25zXCIpLmhpZGUoKTtcbi8vICAgICB9KVxuLy8gICAgIC5jYXRjaCgoX2Vycm9yKSA9PiB7XG4vLyAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJJbnZhbGlkIHVzZXIgaWQgb3IgZGF0YXNldCBsb2FkaW5nIGZhaWxlZC5cIik7XG4vLyAgICAgICAgIGNvbnNvbGUubG9nKGdsb2JhbFRoaXMudWlkISk7XG4vLyAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbi8vICAgICB9KTtcblxuXG5jb25zb2xlLmxvZyhcIlN0YXJ0aW5nIHNlc3Npb24gd2l0aCBVSUQ6XCIsIGdsb2JhbFRoaXMudWlkISlcblxubGV0IGFsZXJ0X2FjdGl2ZSA9IGZhbHNlXG5kb2N1bWVudC5vbnZpc2liaWxpdHljaGFuZ2UgPSAoKSA9PiB7XG4gICAgaWYgKCFhbGVydF9hY3RpdmUpIHtcbiAgICAgICAgY291bnRfZXhpdGVkX3BhZ2UgKz0gMVxuICAgICAgICBhbGVydF9hY3RpdmUgPSB0cnVlXG4gICAgICAgIGlmICghKGdsb2JhbFRoaXMudWlkIS5zdGFydHNXaXRoKFwiZGVtb1wiKSkpIHtcbiAgICAgICAgICAgIC8vIHBhdXNlIHRoZSB0aW1lclxuICAgICAgICAgICBhbGVydChcIlBsZWFzZSBkb24ndCBsZWF2ZSB0aGUgcGFnZS4gSWYgeW91IGRvIHNvIGFnYWluLCB3ZSBtYXkgcmVzdHJpY3QgcGF5aW5nIHlvdS5cIilcbiAgICAgICAgfVxuICAgICAgICBhbGVydF9hY3RpdmUgPSBmYWxzZVxuICAgIH1cbiAgICBlbHNle1xuICAgICAgICAvL2NvbnRpbnVlIHRoZSB0aW1lcj9cbiAgICB9XG59IiwiZGVjbGFyZSBsZXQgX0RFVk1PREU6IGJvb2xlYW5cblxuZXhwb3J0IHZhciBERVZNT0RFID0gX0RFVk1PREVcbmV4cG9ydCBjb25zdCBFTkFCTEVfVElNRVIgPSB0cnVlOyAgLy8gU2V0IHRvIGBmYWxzZWAgdG8gZGlzYWJsZSB0aGUgdGltZXIgZm9yIGRlYnVnZ2luZ1xuXG5leHBvcnQgY29uc3QgUkVXQVJEX0NPUlJFQ1QgPSAwLjE7IC8vIFJld2FyZCBmb3IgYSBjb3JyZWN0IGFuc3dlclxuZXhwb3J0IGNvbnN0IFBFTkFMVFlfSU5DT1JSRUNUID0gLTAuMTsgLy8gUGVuYWx0eSBmb3IgYW4gaW5jb3JyZWN0IGFuc3dlciIsImZ1bmN0aW9uIHBhcmFtc1RvT2JqZWN0KGVudHJpZXMpIHtcbiAgY29uc3QgcmVzdWx0ID0ge31cbiAgLy8gZWFjaCAnZW50cnknIGlzIGEgW2tleSwgdmFsdWVdIHR1cHBsZVxuICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBlbnRyaWVzKSB7XG4gICAgcmVzdWx0W2tleV0gPSB2YWx1ZTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuXG5leHBvcnQgeyBwYXJhbXNUb09iamVjdCB9Il0sIm5hbWVzIjpbIlNFUlZFUl9MT0dfUk9PVCIsIk1PQ0tNT0RFIiwiZGF0YSIsInF1ZXN0aW9uX2kiLCJxdWVzdGlvbiIsInVzZXJzZWxlY3Rpb25fYW5zd2Vyb25seSIsInVzZXJzZWxlY3Rpb25fd2l0aGV4cGxhbmF0aW9uIiwidXNlcnNlbGVjdGlvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5IiwibnVtX2NvcnJlY3QiLCJudW1faW5jb3JyZWN0IiwibnVtX3Vuc3VyZSIsImJhbGFuY2UiLCJpbnN0cnVjdGlvbl9pIiwiY291bnRfZXhpdGVkX3BhZ2UiLCJyZWdpc3RlckFuc3dlck9ubHlVc2VyU2VsZWN0aW9uIiwidXNlcl9jaG9pY2UiLCIkIiwiYXR0ciIsInNob3ciLCJyZWdpc3RlcldpdGhFeHBsYW5hdGlvblVzZXJTZWxlY3Rpb24iLCJyZWdpc3RlcldpdGhFeHBsYW5hdGlvblF1YWxpdHlVc2VyU2VsZWN0aW9uIiwicmVtb3ZlQXR0ciIsIm5leHRfaW5zdHJ1Y3Rpb25zIiwiaW5jcmVtZW50IiwidmFsIiwiaGlkZSIsIm5leHRfcXVlc3Rpb24iLCJjaGlsZHJlbiIsImVhY2giLCJfIiwiZWwiLCJ1dGlsaXR5X29mX3NlbGVjdGlvbiIsInNlbGVjdGlvbiIsInV0aWxpdHkiLCJpc191c2VyX2NvcnJlY3QiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiYWRkRXZlbnRMaXN0ZW5lciIsIm9uIiwib2xkX2JhbGFuY2UiLCJjb3JyZWN0X3NlbGVjdGlvbiIsInVwZGF0ZV9iYWxhbmNlIiwibG9nZ2VkX2RhdGEiLCJhc3luYyIsImdsb2JhbFRoaXMiLCJ1cmxfZGF0YSIsImNvbnNvbGUiLCJsb2ciLCJ1aWQiLCJyZXN1bHQiLCJhamF4IiwiSlNPTiIsInN0cmluZ2lmeSIsInByb2plY3QiLCJyZXBsYWNlIiwicGF5bG9hZCIsInR5cGUiLCJjb250ZW50VHlwZSIsIlByb21pc2UiLCJyZXNvbHZlIiwic2V0VGltZW91dCIsInNsZWVwIiwiZSIsImxvZ19kYXRhIiwiYWN0aXZlVGltZXIiLCJzdGFydFRpbWVyIiwiZHVyYXRpb24iLCJzdGVwRGl2IiwiYnV0dG9ucyIsImNhbGxiYWNrIiwiY2xlYXJJbnRlcnZhbCIsImZvckVhY2giLCJidXR0b24iLCJzZXRBdHRyaWJ1dGUiLCJ0aW1lckRpc3BsYXkiLCJjcmVhdGVFbGVtZW50IiwiaWQiLCJzdHlsZSIsImZvbnRXZWlnaHQiLCJtYXJnaW5Ub3AiLCJhcHBlbmRDaGlsZCIsInJlbWFpbmluZ1RpbWUiLCJ0ZXh0Q29udGVudCIsInNldEludGVydmFsIiwicmVtb3ZlQ2hpbGQiLCJyZW1vdmVBdHRyaWJ1dGUiLCJsZW5ndGgiLCJNYXRoIiwibWF4IiwicmV3YXJkX3RleHQiLCJ0b0ZpeGVkIiwiaHRtbCIsInVwZGF0ZWRRdWVzdGlvblRleHQiLCJwcm9kdWN0IiwicHJvZHVjdFBlcmNlbnQiLCJyb3VuZCIsInRleHQiLCJleHBsYW5hdGlvblRleHQiLCJmaXJzdFN0ZXBEaXYiLCJoYW5kbGVGaXJzdFN0ZXBDbGljayIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJzZWNvbmRTdGVwRGl2Iiwid29yZHMiLCJzcGxpdCIsInJlYWRpbmdUaW1lIiwiY2VpbCIsImhhbmRsZVNlY29uZFN0ZXBDbGljayIsInRoaXJkU3RlcERpdiIsImhhbmRsZVRoaXJkU3RlcENsaWNrIiwic2V0dXBUaGlyZFN0ZXAiLCJzZXR1cFNlY29uZFN0ZXAiLCJzZXR1cEZpcnN0U3RlcCIsIm9udmlzaWJpbGl0eWNoYW5nZSIsImhpZGRlbiIsInVybFBhcmFtcyIsIlVSTFNlYXJjaFBhcmFtcyIsIndpbmRvdyIsImxvY2F0aW9uIiwic2VhcmNoIiwic3RhcnRPdmVycmlkZSIsImdldCIsIlVJREZyb21VUkwiLCJlbnRyaWVzIiwia2V5IiwidmFsdWUiLCJwYXJhbXNUb09iamVjdCIsInF1ZXVlX2lkIiwiZmxvb3IiLCJyYW5kb20iLCJwYWRTdGFydCIsIlVJRF9tYXliZSIsInByb21wdCIsInN0YXJ0c1dpdGgiLCJnZXRKU09OIiwiRGF0ZSIsIm5vdyIsImxvYWRfZGF0YSIsImNhdGNoIiwiX2Vycm9yIiwicmVsb2FkIiwidGhlbiIsIm5ld19kYXRhIiwicGFyc2VJbnQiLCJyZXdhcmRJbnN0cnVjdGlvbnMiLCJpbm5lckhUTUwiLCJhYnMiLCJ1cGRhdGVSZXdhcmRJbnN0cnVjdGlvbnMiLCJhbGVydF9hY3RpdmUiLCJhbGVydCJdLCJzb3VyY2VSb290IjoiIn0=