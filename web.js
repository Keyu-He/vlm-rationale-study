(()=>{"use strict";let t="https://tejassrinivasan.pythonanywhere.com/";var e=!1,n=[];let i=-1,o=null,s=-1,a=-1,r=-1,u=0,l=0,d=0;function _(t){s=t,$("#button_answeronly_usertrusts").attr("disabled","true"),$("#button_answeronly_userdistrusts").attr("disabled","true"),$("#button_answeronly_userunsure").attr("disabled","true"),0==t?$("#button_answeronly_usertrusts").attr("activedecision","true"):1==t?$("#button_answeronly_userdistrusts").attr("activedecision","true"):2==t&&$("#button_answeronly_userunsure").attr("activedecision","true"),$("#ai_explanation_div").show()}function c(t){a=t,$("#button_withexplanation_usertrusts").attr("disabled","true"),$("#button_withexplanation_userdistrusts").attr("disabled","true"),$("#button_withexplanation_userunsure").attr("disabled","true"),0==t?$("#button_withexplanation_usertrusts").attr("activedecision","true"):1==t?$("#button_withexplanation_userdistrusts").attr("activedecision","true"):2==t&&$("#button_withexplanation_userunsure").attr("activedecision","true"),$("#ai_explanation_quality_div").show()}function h(t){r=t,$("#button_withexplanationquality_usertrusts").attr("disabled","true"),$("#button_withexplanationquality_userdistrusts").attr("disabled","true"),$("#button_withexplanationquality_userunsure").attr("disabled","true"),0==t?$("#button_withexplanationquality_usertrusts").attr("activedecision","true"):1==t?$("#button_withexplanationquality_userdistrusts").attr("activedecision","true"):2==t&&$("#button_withexplanationquality_userunsure").attr("activedecision","true"),$("#button_next").show(),$("#button_next").removeAttr("disabled")}function b(t){l+=t,0==l?$("#button_instructions_prev").attr("disabled","true"):$("#button_instructions_prev").removeAttr("disabled"),l>=5?($("#instructions_and_decorations").show(),$("#button_instructions_next").val("Start study")):($("#instructions_and_decorations").hide(),$("#button_instructions_next").val("Next")),6==l&&($("#instructions_and_decorations").show(),$("#main_box_instructions").hide(),$("#main_box_experiment").show(),v()),$("#main_box_instructions").children(":not(input)").each(((t,e)=>{$(e).hide()})),$(`#instructions_${l}`).show()}function m(t){return 2!=t?t==1-o.prediction_is_correct?1:0:-1}document.getElementById("button_answeronly_usertrusts")?.addEventListener("click",(()=>_(0))),document.getElementById("button_answeronly_userdistrusts")?.addEventListener("click",(()=>_(1))),document.getElementById("button_answeronly_userunsure")?.addEventListener("click",(()=>_(2))),document.getElementById("button_withexplanation_usertrusts")?.addEventListener("click",(()=>c(0))),document.getElementById("button_withexplanation_userdistrusts")?.addEventListener("click",(()=>c(1))),document.getElementById("button_withexplanation_userunsure")?.addEventListener("click",(()=>c(2))),document.getElementById("button_withexplanationquality_usertrusts")?.addEventListener("click",(()=>h(0))),document.getElementById("button_withexplanationquality_userdistrusts")?.addEventListener("click",(()=>h(1))),document.getElementById("button_withexplanationquality_userunsure")?.addEventListener("click",(()=>h(2))),$("#button_instructions_next").on("click",(()=>b(1))),$("#button_instructions_prev").on("click",(()=>b(-1))),$("#button_next").on("click",(()=>{let e=u;if(function(){if(2!=r){let t=1-o.prediction_is_correct;u+=r==t?.1:-.1}}(),-1!=i){let n={question_i:i,user_selections:{answeronly:s,withexplanation:a,withexplanationquality:r},user_is_correct:{answeronly:m(s),withexplanation:m(a),withexplanationquality:m(r)},balance:{old:e,new:u}};n.question=o,n.count_exited_page=d,async function(e){e.url_data=globalThis.url_data,console.log("Data"),"study_id"in e.url_data||(e.url_data.study_id="demo_study"),"prolific_id"in e.url_data||(e.url_data.prolific_id="demo_user"),"session_id"in e.url_data||(e.url_data.session_id="demo_session"),e.url_data.queue_id=globalThis.uid,console.log("logged",e),console.log("Logging to",t+"log");try{let n=await $.ajax(t+"log",{data:JSON.stringify({project:"vlm-rationales-study/"+e.url_data.study_id,uid:globalThis.uid+"_"+e.url_data.prolific_id,payload:JSON.stringify(e)}),type:"POST",contentType:"application/json"});return await async function(){return new Promise((t=>setTimeout(t,2e3)))}(),n}catch(t){console.log(t)}}(n),d=0}v()}));let w=null;function y(t,e,n,i){w&&(clearInterval(w),w=null),n.forEach((t=>t.setAttribute("disabled","true")));let o=document.createElement("div");o.id=`timer_${e.id}`,o.style.fontWeight="bold",e.appendChild(o);let s=t;o.textContent=`Please wait ${s} second(s) before making your selection.`,w=setInterval((()=>{s--,s>=0?o.textContent=`Please wait ${s} second(s) before making your selection.`:(null!==w&&(clearInterval(w),w=null),w=null,e.removeChild(o),n.forEach((t=>t.removeAttribute("disabled"))),i&&i())}),1e3)}function v(){if(w&&(clearInterval(w),w=null),$("#button_readytoanswer").removeAttr("activedecision"),$("#button_readytoanswer").removeAttr("disabled"),$("#button_readytoanswer").show(),$("#button_answeronly_usertrusts").removeAttr("activedecision"),$("#button_answeronly_usertrusts").removeAttr("disabled"),$("#button_answeronly_userdistrusts").removeAttr("activedecision"),$("#button_answeronly_userdistrusts").removeAttr("disabled"),$("#button_answeronly_userunsure").removeAttr("activedecision"),$("#button_answeronly_userunsure").removeAttr("disabled"),$("#button_withexplanation_usertrusts").removeAttr("activedecision"),$("#button_withexplanation_usertrusts").removeAttr("disabled"),$("#button_withexplanation_userdistrusts").removeAttr("activedecision"),$("#button_withexplanation_userdistrusts").removeAttr("disabled"),$("#button_withexplanation_userunsure").removeAttr("activedecision"),$("#button_withexplanation_userunsure").removeAttr("disabled"),$("#button_withexplanationquality_usertrusts").removeAttr("activedecision"),$("#button_withexplanationquality_usertrusts").removeAttr("disabled"),$("#button_withexplanationquality_userdistrusts").removeAttr("activedecision"),$("#button_withexplanationquality_userdistrusts").removeAttr("disabled"),$("#button_withexplanationquality_userunsure").removeAttr("activedecision"),$("#button_withexplanationquality_userunsure").removeAttr("disabled"),$("#ai_explanation_div").hide(),$("#ai_explanation_quality_div").hide(),$("#button_next").hide(),$("#button_quit").hide(),i+=1,i>=n.length)return $("#main_box_experiment").hide(),u=Math.max(0,u),void(e?($("#reward_box_mock").text(`Your total reward is $${u.toFixed(2)} (${i} questions answered) + $2.`),$("#reward_box_mock").show(),$("#main_box_end_mock").show()):($("#reward_box").text(`Your total reward is $${u.toFixed(2)} (${i} questions answered) + $2.`),$("#reward_box").show(),$("#main_box_end").show()));o=n[i];const t=o.question.replace("Choices:","<br><b>Choices:</b>");$("#question_span").html(t),$("#ai_prediction_span").html(o.predicted_answer),$("#ai_explanation_span").html(o.generated_rationale);let s=Math.round(100*o["visual fidelity"]);$("#explanation_fidelity_span").html(`${s}%`);let a=Math.round(100*o.contrastiveness);$("#explanation_contrastiveness_span").html(`${a}%`),$("#progress").text(`Progress: ${i+1} / ${n.length}`),function(t){const e=document.getElementById("ai_answer_div"),n=[document.getElementById("button_answeronly_usertrusts"),document.getElementById("button_answeronly_userdistrusts"),document.getElementById("button_answeronly_userunsure")];function i(){n.forEach((t=>t?.removeEventListener("click",i))),function(t){const e=document.getElementById("ai_explanation_div"),n=t.split(" ").length,i=Math.max(Math.ceil(3+n/238*60),5),o=[document.getElementById("button_withexplanation_usertrusts"),document.getElementById("button_withexplanation_userdistrusts"),document.getElementById("button_withexplanation_userunsure")];function s(){o.forEach((t=>t?.removeEventListener("click",s))),function(){const t=document.getElementById("ai_explanation_quality_div"),e=[document.getElementById("button_withexplanationquality_usertrusts"),document.getElementById("button_withexplanationquality_userdistrusts"),document.getElementById("button_withexplanationquality_userunsure")];function n(){e.forEach((t=>t?.removeEventListener("click",n))),$("#button_next").show()}e.forEach((t=>t?.removeEventListener("click",n))),e.forEach((t=>t?.addEventListener("click",n))),$("#ai_explanation_quality_div").show(),y(5,t,e,null)}()}o.forEach((t=>t?.removeEventListener("click",s))),o.forEach((t=>t?.addEventListener("click",s))),$("#ai_explanation_div").show(),y(i,e,o,null)}(t)}n.forEach((t=>t?.removeEventListener("click",i))),n.forEach((t=>t?.addEventListener("click",i))),$("#ai_answer_div").show(),y(5,e,n,null)}(o.generated_rationale)}document.onvisibilitychange=()=>{document.hidden?(console.log("Window lost focus."),null!==w&&(clearInterval(w),w=null)):console.log("Window regained focus.")};const p=new URLSearchParams(window.location.search),x=p.get("start"),g=p.get("uid");if(globalThis.url_data=function(t){const e={};for(const[n,i]of t)e[n]=i;return e}(p.entries()),null==globalThis.url_data.study_id&&(globalThis.url_data.study_id="demo_study"),null==globalThis.url_data.prolific_id&&(globalThis.url_data.prolific_id="demo_user"),null==globalThis.url_data.session_id&&(globalThis.url_data.session_id="demo_session"),null!=g){if(globalThis.uid=g,"prolific_random"==globalThis.uid){let t=`${Math.floor(10*Math.random())}`.padStart(3,"0");globalThis.uid=`${p.get("prolific_queue_name")}/${t}`}}else{let t=null;for(;null==t;)t=prompt("Enter your user id. Please get in touch if you were not assigned an id but wish to participate in this experiment.");globalThis.uid=t}globalThis.url_data.session_id.startsWith("demo")&&(e=!0),console.log("Running with UID",globalThis.uid),async function(){return await $.getJSON(`baked_queues/${globalThis.uid}.json?t=${Date.now()}`)}().catch((t=>{console.log("Invalid user id."),console.log(globalThis.uid),window.location.reload()})).then((t=>{n=t,null!=x&&(i=parseInt(x)-1,console.log("Starting from",i)),b(0),function(){const t=document.getElementById("reward_instructions");t&&(t.innerHTML=`\n            If your final decision is correct, you gain a reward of $${.1.toFixed(2)}. \n            If your final decision is incorrect, you lose $${Math.abs(-.1).toFixed(2)} from your reward. \n            You will see your total reward at the end of the experiment. \n            Your payment is $2.0 plus whatever you accumulate during this experiment.\n        `)}(),$("#main_box_instructions").show(),$("#instructions_and_decorations").hide()})),console.log("Starting session with UID:",globalThis.uid);let f=!1;document.onvisibilitychange=()=>{f||(d+=1,f=!0,f=!1)}})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LElBQ0FBLEVBQW1CQyxVQUFZLDBFQ3ZGVCxHRHdGd0R0RCxRQUFRLG9FQUNqQ0gsS0FBSzBELEtDeEZqQyxJRHdGd0R2RCxRQUFRLG9NQU9qRyxDQXlZSXdELEdBQ0E5SCxFQUFFLDBCQUEwQkUsT0FDNUJGLEVBQUUsaUNBQWlDUyxNQUFNLElBRzdDbUIsUUFBUUMsSUFBSSw2QkFBOEJILFdBQVdJLEtBRXJELElBQUlpRyxHQUFlLEVBQ25COUcsU0FBUzJFLG1CQUFxQixLQUNyQm1DLElBQ0RsSSxHQUFxQixFQUNyQmtJLEdBQWUsRUFJZkEsR0FBZSxFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL2Nvbm5lY3Rvci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvbWFpbi50cyIsIndlYnBhY2s6Ly8vLi9zcmMvZ2xvYmFscy50cyIsIndlYnBhY2s6Ly8vLi9zcmMvdXRpbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgREVWTU9ERSB9IGZyb20gJy4vZ2xvYmFscydcbmltcG9ydCB7IE1PQ0tNT0RFIH0gZnJvbSAnLi9tYWluJ1xuXG5sZXQgU0VSVkVSX0xPR19ST09UID0gREVWTU9ERSA/IFwiaHR0cDovLzEyNy4wLjAuMTo1MDAwL1wiIDogXCJodHRwczovL3RlamFzc3Jpbml2YXNhbi5weXRob25hbnl3aGVyZS5jb20vXCJcblxuYXN5bmMgZnVuY3Rpb24gc2xlZXAobXM6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCBtcykpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbG9hZF9kYXRhKCk6IFByb21pc2U8YW55PiB7XG4gICAgLy8gaW5jbHVkZSB0aW1lc3RhbXAgc28gdGhhdCB0aGluZ3MgZG9uJ3QgZ2V0IGNhY2hlZFxuICAgIGxldCByZXN1bHQgPSBhd2FpdCAkLmdldEpTT04oXG4gICAgICAgIGBiYWtlZF9xdWV1ZXMvJHtnbG9iYWxUaGlzLnVpZH0uanNvbj90PSR7RGF0ZS5ub3coKX1gLFxuICAgIClcbiAgICByZXR1cm4gcmVzdWx0XG59XG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbG9nX2RhdGEoZGF0YSk6IFByb21pc2U8YW55PiB7XG4gICAgLy9pZiAoTU9DS01PREUpIHtcbiAgICAvLyAgICBjb25zb2xlLmxvZyhcImxvZ2dlZCAobW9jaylcIiwgZGF0YSlcbiAgICAvLyAgICByZXR1cm5cbiAgICAvL31cbiAgICBcbiAgICBkYXRhW1widXJsX2RhdGFcIl0gPSBnbG9iYWxUaGlzLnVybF9kYXRhXG4gICAgY29uc29sZS5sb2coXCJEYXRhXCIpXG4gICAgaWYgKCEoXCJzdHVkeV9pZFwiIGluIGRhdGFbJ3VybF9kYXRhJ10pKSB7XG4gICAgICAgIGRhdGFbJ3VybF9kYXRhJ11bXCJzdHVkeV9pZFwiXSA9IFwiZGVtb19zdHVkeVwiXG4gICAgfVxuICAgIGlmICghKFwicHJvbGlmaWNfaWRcIiBpbiBkYXRhWyd1cmxfZGF0YSddKSkge1xuICAgICAgICBkYXRhWyd1cmxfZGF0YSddW1wicHJvbGlmaWNfaWRcIl0gPSBcImRlbW9fdXNlclwiXG4gICAgfVxuICAgIGlmICghKFwic2Vzc2lvbl9pZFwiIGluIGRhdGFbJ3VybF9kYXRhJ10pKSB7XG4gICAgICAgIGRhdGFbJ3VybF9kYXRhJ11bXCJzZXNzaW9uX2lkXCJdID0gXCJkZW1vX3Nlc3Npb25cIlxuICAgIH1cbiAgICBkYXRhW1widXJsX2RhdGFcIl1bXCJxdWV1ZV9pZFwiXSA9IGdsb2JhbFRoaXMudWlkXG4gICAgY29uc29sZS5sb2coXCJsb2dnZWRcIiwgZGF0YSlcbiAgICBjb25zb2xlLmxvZyhcIkxvZ2dpbmcgdG9cIiwgU0VSVkVSX0xPR19ST09UICsgXCJsb2dcIilcblxuICAgIHRyeSB7XG4gICAgICAgIGxldCByZXN1bHQgPSBhd2FpdCAkLmFqYXgoXG4gICAgICAgICAgICBTRVJWRVJfTE9HX1JPT1QgKyBcImxvZ1wiLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgICAgICAgcHJvamVjdDogXCJ2bG0tcmF0aW9uYWxlcy1zdHVkeS9cIitkYXRhWyd1cmxfZGF0YSddWydzdHVkeV9pZCddLFxuICAgICAgICAgICAgICAgICAgICB1aWQ6IGdsb2JhbFRoaXMudWlkK1wiX1wiK2RhdGFbJ3VybF9kYXRhJ11bJ3Byb2xpZmljX2lkJ10sXG4gICAgICAgICAgICAgICAgICAgIHBheWxvYWQ6IEpTT04uc3RyaW5naWZ5KGRhdGEpLFxuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAgICAgfVxuICAgICAgICApXG4gICAgICAgIGF3YWl0IHNsZWVwKDIwMDApO1xuICAgICAgICByZXR1cm4gcmVzdWx0XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBjb25zb2xlLmxvZyhlKVxuICAgIH1cbn0iLCJpbXBvcnQgeyBERVZNT0RFLCBSRVdBUkRfQ09SUkVDVCwgUEVOQUxUWV9JTkNPUlJFQ1QsIEVOQUJMRV9USU1FUiB9IGZyb20gXCIuL2dsb2JhbHNcIlxuZXhwb3J0IHZhciBVSUQ6IHN0cmluZ1xuZXhwb3J0IHZhciBNT0NLTU9ERTogYm9vbGVhbiA9IGZhbHNlXG5pbXBvcnQgeyBsb2FkX2RhdGEsIGxvZ19kYXRhIH0gZnJvbSAnLi9jb25uZWN0b3InXG5pbXBvcnQgeyBwYXJhbXNUb09iamVjdCB9IGZyb20gXCIuL3V0aWxzXCJcblxudmFyIGRhdGE6IGFueVtdID0gW11cbmxldCBxdWVzdGlvbl9pID0gLTFcbmxldCBxdWVzdGlvbjogYW55ID0gbnVsbFxubGV0IHVzZXJzZWxlY3Rpb25fYW5zd2Vyb25seTogbnVtYmVyID0gLTFcbmxldCB1c2Vyc2VsZWN0aW9uX3dpdGhleHBsYW5hdGlvbjogbnVtYmVyID0gLTFcbmxldCB1c2Vyc2VsZWN0aW9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHk6IG51bWJlciA9IC0xXG5cbmxldCBiYWxhbmNlID0gMFxuXG5sZXQgaW5zdHJ1Y3Rpb25faTogbnVtYmVyID0gMFxubGV0IGNvdW50X2V4aXRlZF9wYWdlOiBudW1iZXIgPSAwXG5cbmZ1bmN0aW9uIGFzc2VydChjb25kaXRpb24sIG1lc3NhZ2UpIHtcbiAgICBpZiAoIWNvbmRpdGlvbikge1xuICAgICAgICB0aHJvdyBtZXNzYWdlIHx8IFwiQXNzZXJ0aW9uIGZhaWxlZFwiO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gcmVnaXN0ZXJBbnN3ZXJPbmx5VXNlclNlbGVjdGlvbih1c2VyX2Nob2ljZTogbnVtYmVyKSB7XG4gICAgdXNlcnNlbGVjdGlvbl9hbnN3ZXJvbmx5ID0gdXNlcl9jaG9pY2VcblxuICAgICQoXCIjYnV0dG9uX2Fuc3dlcm9ubHlfdXNlcnRydXN0c1wiKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJ0cnVlXCIpXG4gICAgJChcIiNidXR0b25fYW5zd2Vyb25seV91c2VyZGlzdHJ1c3RzXCIpLmF0dHIoXCJkaXNhYmxlZFwiLCBcInRydWVcIilcbiAgICAkKFwiI2J1dHRvbl9hbnN3ZXJvbmx5X3VzZXJ1bnN1cmVcIikuYXR0cihcImRpc2FibGVkXCIsIFwidHJ1ZVwiKVxuICAgIGlmICh1c2VyX2Nob2ljZSA9PSAwKSB7XG4gICAgICAgICQoXCIjYnV0dG9uX2Fuc3dlcm9ubHlfdXNlcnRydXN0c1wiKS5hdHRyKFwiYWN0aXZlZGVjaXNpb25cIiwgXCJ0cnVlXCIpXG4gICAgfSBlbHNlIGlmICh1c2VyX2Nob2ljZSA9PSAxKSB7XG4gICAgICAgICQoXCIjYnV0dG9uX2Fuc3dlcm9ubHlfdXNlcmRpc3RydXN0c1wiKS5hdHRyKFwiYWN0aXZlZGVjaXNpb25cIiwgXCJ0cnVlXCIpXG4gICAgfSBlbHNlIGlmICh1c2VyX2Nob2ljZSA9PSAyKSB7XG4gICAgICAgICQoXCIjYnV0dG9uX2Fuc3dlcm9ubHlfdXNlcnVuc3VyZVwiKS5hdHRyKFwiYWN0aXZlZGVjaXNpb25cIiwgXCJ0cnVlXCIpXG4gICAgfVxuICAgICQoXCIjYWlfZXhwbGFuYXRpb25fZGl2XCIpLnNob3coKVxufVxuLy8gRXZlbnQgbGlzdGVuZXIgZm9yIHRoZSBidXR0b24gY2xpY2tcbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXR0b25fYW5zd2Vyb25seV91c2VydHJ1c3RzJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gcmVnaXN0ZXJBbnN3ZXJPbmx5VXNlclNlbGVjdGlvbigwKSk7XG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnV0dG9uX2Fuc3dlcm9ubHlfdXNlcmRpc3RydXN0cycpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHJlZ2lzdGVyQW5zd2VyT25seVVzZXJTZWxlY3Rpb24oMSkpO1xuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1dHRvbl9hbnN3ZXJvbmx5X3VzZXJ1bnN1cmUnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiByZWdpc3RlckFuc3dlck9ubHlVc2VyU2VsZWN0aW9uKDIpKTtcblxuXG5mdW5jdGlvbiByZWdpc3RlcldpdGhFeHBsYW5hdGlvblVzZXJTZWxlY3Rpb24odXNlcl9jaG9pY2U6IG51bWJlcikge1xuICAgIHVzZXJzZWxlY3Rpb25fd2l0aGV4cGxhbmF0aW9uID0gdXNlcl9jaG9pY2VcblxuICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbl91c2VydHJ1c3RzXCIpLmF0dHIoXCJkaXNhYmxlZFwiLCBcInRydWVcIilcbiAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25fdXNlcmRpc3RydXN0c1wiKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJ0cnVlXCIpXG4gICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9uX3VzZXJ1bnN1cmVcIikuYXR0cihcImRpc2FibGVkXCIsIFwidHJ1ZVwiKVxuICAgIGlmICh1c2VyX2Nob2ljZSA9PSAwKSB7XG4gICAgICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbl91c2VydHJ1c3RzXCIpLmF0dHIoXCJhY3RpdmVkZWNpc2lvblwiLCBcInRydWVcIilcbiAgICB9IGVsc2UgaWYgKHVzZXJfY2hvaWNlID09IDEpIHtcbiAgICAgICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9uX3VzZXJkaXN0cnVzdHNcIikuYXR0cihcImFjdGl2ZWRlY2lzaW9uXCIsIFwidHJ1ZVwiKVxuICAgIH0gZWxzZSBpZiAodXNlcl9jaG9pY2UgPT0gMikge1xuICAgICAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25fdXNlcnVuc3VyZVwiKS5hdHRyKFwiYWN0aXZlZGVjaXNpb25cIiwgXCJ0cnVlXCIpXG4gICAgfVxuICAgICQoXCIjYWlfZXhwbGFuYXRpb25fcXVhbGl0eV9kaXZcIikuc2hvdygpXG59XG5cbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXR0b25fd2l0aGV4cGxhbmF0aW9uX3VzZXJ0cnVzdHMnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiByZWdpc3RlcldpdGhFeHBsYW5hdGlvblVzZXJTZWxlY3Rpb24oMCkpO1xuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1dHRvbl93aXRoZXhwbGFuYXRpb25fdXNlcmRpc3RydXN0cycpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHJlZ2lzdGVyV2l0aEV4cGxhbmF0aW9uVXNlclNlbGVjdGlvbigxKSk7XG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnV0dG9uX3dpdGhleHBsYW5hdGlvbl91c2VydW5zdXJlJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gcmVnaXN0ZXJXaXRoRXhwbGFuYXRpb25Vc2VyU2VsZWN0aW9uKDIpKTtcbiAgXG5mdW5jdGlvbiByZWdpc3RlcldpdGhFeHBsYW5hdGlvblF1YWxpdHlVc2VyU2VsZWN0aW9uKHVzZXJfY2hvaWNlOiBudW1iZXIpIHtcbiAgICB1c2Vyc2VsZWN0aW9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHkgPSB1c2VyX2Nob2ljZVxuXG4gICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eV91c2VydHJ1c3RzXCIpLmF0dHIoXCJkaXNhYmxlZFwiLCBcInRydWVcIilcbiAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5X3VzZXJkaXN0cnVzdHNcIikuYXR0cihcImRpc2FibGVkXCIsIFwidHJ1ZVwiKVxuICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHlfdXNlcnVuc3VyZVwiKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJ0cnVlXCIpXG4gICAgaWYgKHVzZXJfY2hvaWNlID09IDApIHtcbiAgICAgICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eV91c2VydHJ1c3RzXCIpLmF0dHIoXCJhY3RpdmVkZWNpc2lvblwiLCBcInRydWVcIilcbiAgICB9IGVsc2UgaWYgKHVzZXJfY2hvaWNlID09IDEpIHtcbiAgICAgICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eV91c2VyZGlzdHJ1c3RzXCIpLmF0dHIoXCJhY3RpdmVkZWNpc2lvblwiLCBcInRydWVcIilcbiAgICB9IGVsc2UgaWYgKHVzZXJfY2hvaWNlID09IDIpIHtcbiAgICAgICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eV91c2VydW5zdXJlXCIpLmF0dHIoXCJhY3RpdmVkZWNpc2lvblwiLCBcInRydWVcIilcbiAgICB9XG4gICAgJChcIiNidXR0b25fbmV4dFwiKS5zaG93KClcbiAgICAkKFwiI2J1dHRvbl9uZXh0XCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKVxufVxuXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnV0dG9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHlfdXNlcnRydXN0cycpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHJlZ2lzdGVyV2l0aEV4cGxhbmF0aW9uUXVhbGl0eVVzZXJTZWxlY3Rpb24oMCkpO1xuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1dHRvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5X3VzZXJkaXN0cnVzdHMnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiByZWdpc3RlcldpdGhFeHBsYW5hdGlvblF1YWxpdHlVc2VyU2VsZWN0aW9uKDEpKTtcbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXR0b25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eV91c2VydW5zdXJlJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gcmVnaXN0ZXJXaXRoRXhwbGFuYXRpb25RdWFsaXR5VXNlclNlbGVjdGlvbigyKSk7XG5cblxuZnVuY3Rpb24gdXBkYXRlUmV3YXJkSW5zdHJ1Y3Rpb25zKCkge1xuICAgIGNvbnN0IHJld2FyZEluc3RydWN0aW9ucyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXdhcmRfaW5zdHJ1Y3Rpb25zJyk7XG5cbiAgICBpZiAocmV3YXJkSW5zdHJ1Y3Rpb25zKSB7XG4gICAgICAgIHJld2FyZEluc3RydWN0aW9ucy5pbm5lckhUTUwgPSBgXG4gICAgICAgICAgICBJZiB5b3VyIGZpbmFsIGRlY2lzaW9uIGlzIGNvcnJlY3QsIHlvdSBnYWluIGEgcmV3YXJkIG9mICQke1JFV0FSRF9DT1JSRUNULnRvRml4ZWQoMil9LiBcbiAgICAgICAgICAgIElmIHlvdXIgZmluYWwgZGVjaXNpb24gaXMgaW5jb3JyZWN0LCB5b3UgbG9zZSAkJHtNYXRoLmFicyhQRU5BTFRZX0lOQ09SUkVDVCkudG9GaXhlZCgyKX0gZnJvbSB5b3VyIHJld2FyZC4gXG4gICAgICAgICAgICBZb3Ugd2lsbCBzZWUgeW91ciB0b3RhbCByZXdhcmQgYXQgdGhlIGVuZCBvZiB0aGUgZXhwZXJpbWVudC4gXG4gICAgICAgICAgICBZb3VyIHBheW1lbnQgaXMgJDIuMCBwbHVzIHdoYXRldmVyIHlvdSBhY2N1bXVsYXRlIGR1cmluZyB0aGlzIGV4cGVyaW1lbnQuXG4gICAgICAgIGA7XG4gICAgICAgIC8vIElmIHlvdXIgZmluYWwgZGVjaXNpb24gaXMgY29ycmVjdCwgeW91IGdhaW4gYSByZXdhcmQgb2YgJDAuMTAuIElmIHlvdXIgZmluYWwgZGVjaXNpb24gaXMgaW5jb3JyZWN0LCB5b3UgbG9zZSAkMC4xMCBmcm9tIHlvdXIgcmV3YXJkLlxuICAgICAgICAvLyBZb3Ugd2lsbCBzZWUgeW91ciB0b3RhbCByZXdhcmQgYXQgdGhlIGVuZCBvZiB0aGUgZXhwZXJpbWVudC4gWW91ciBwYXltZW50IGlzICQyLjAgcGx1cyB3aGF0ZXZlciB5b3UgYWNjdW11bGF0ZSBkdXJpbmcgdGhpcyBleHBlcmltZW50LlxuICAgIH1cbn1cblxuZnVuY3Rpb24gbmV4dF9pbnN0cnVjdGlvbnMoaW5jcmVtZW50OiBudW1iZXIpIHtcbiAgICBpbnN0cnVjdGlvbl9pICs9IGluY3JlbWVudFxuXG4gICAgaWYgKGluc3RydWN0aW9uX2kgPT0gMCkge1xuICAgICAgICAkKFwiI2J1dHRvbl9pbnN0cnVjdGlvbnNfcHJldlwiKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJ0cnVlXCIpXG4gICAgfSBlbHNlIHtcbiAgICAgICAgJChcIiNidXR0b25faW5zdHJ1Y3Rpb25zX3ByZXZcIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpXG4gICAgfVxuICAgIGlmIChpbnN0cnVjdGlvbl9pID49IDUpIHtcbiAgICAgICAgJChcIiNpbnN0cnVjdGlvbnNfYW5kX2RlY29yYXRpb25zXCIpLnNob3coKVxuICAgICAgICAkKFwiI2J1dHRvbl9pbnN0cnVjdGlvbnNfbmV4dFwiKS52YWwoXCJTdGFydCBzdHVkeVwiKVxuICAgIH0gZWxzZSB7XG4gICAgICAgICQoXCIjaW5zdHJ1Y3Rpb25zX2FuZF9kZWNvcmF0aW9uc1wiKS5oaWRlKClcbiAgICAgICAgJChcIiNidXR0b25faW5zdHJ1Y3Rpb25zX25leHRcIikudmFsKFwiTmV4dFwiKVxuICAgIH1cbiAgICBpZiAoaW5zdHJ1Y3Rpb25faSA9PSA2KSB7XG4gICAgICAgICQoXCIjaW5zdHJ1Y3Rpb25zX2FuZF9kZWNvcmF0aW9uc1wiKS5zaG93KClcbiAgICAgICAgJChcIiNtYWluX2JveF9pbnN0cnVjdGlvbnNcIikuaGlkZSgpXG4gICAgICAgICQoXCIjbWFpbl9ib3hfZXhwZXJpbWVudFwiKS5zaG93KClcbiAgICAgICAgbmV4dF9xdWVzdGlvbigpXG4gICAgfVxuXG4gICAgJChcIiNtYWluX2JveF9pbnN0cnVjdGlvbnNcIikuY2hpbGRyZW4oXCI6bm90KGlucHV0KVwiKS5lYWNoKChfLCBlbCkgPT4ge1xuICAgICAgICAkKGVsKS5oaWRlKClcbiAgICB9KVxuICAgICQoYCNpbnN0cnVjdGlvbnNfJHtpbnN0cnVjdGlvbl9pfWApLnNob3coKVxufVxuJChcIiNidXR0b25faW5zdHJ1Y3Rpb25zX25leHRcIikub24oXCJjbGlja1wiLCAoKSA9PiBuZXh0X2luc3RydWN0aW9ucygrMSkpXG4kKFwiI2J1dHRvbl9pbnN0cnVjdGlvbnNfcHJldlwiKS5vbihcImNsaWNrXCIsICgpID0+IG5leHRfaW5zdHJ1Y3Rpb25zKC0xKSlcblxuJChcIiNidXR0b25fbmV4dFwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcblxuICAgIC8vIFVwZGF0ZSB0aGUgdXNlciBiYWxhbmNlXG4gICAgbGV0IG9sZF9iYWxhbmNlID0gYmFsYW5jZVxuICAgIHVwZGF0ZV9iYWxhbmNlKClcblxuICAgIGlmIChxdWVzdGlvbl9pICE9IC0xKSB7XG4gICAgICAgIGxldCBsb2dnZWRfZGF0YSA9IHtcbiAgICAgICAgICAgIFwicXVlc3Rpb25faVwiOiBxdWVzdGlvbl9pLFxuICAgICAgICAgICAgXCJ1c2VyX3NlbGVjdGlvbnNcIjoge1xuICAgICAgICAgICAgICAgIFwiYW5zd2Vyb25seVwiOiB1c2Vyc2VsZWN0aW9uX2Fuc3dlcm9ubHksXG4gICAgICAgICAgICAgICAgXCJ3aXRoZXhwbGFuYXRpb25cIjogdXNlcnNlbGVjdGlvbl93aXRoZXhwbGFuYXRpb24sXG4gICAgICAgICAgICAgICAgXCJ3aXRoZXhwbGFuYXRpb25xdWFsaXR5XCI6IHVzZXJzZWxlY3Rpb25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwidXNlcl9pc19jb3JyZWN0XCI6IHtcbiAgICAgICAgICAgICAgICBcImFuc3dlcm9ubHlcIjogaXNfdXNlcl9jb3JyZWN0KHVzZXJzZWxlY3Rpb25fYW5zd2Vyb25seSksXG4gICAgICAgICAgICAgICAgXCJ3aXRoZXhwbGFuYXRpb25cIjogaXNfdXNlcl9jb3JyZWN0KHVzZXJzZWxlY3Rpb25fd2l0aGV4cGxhbmF0aW9uKSxcbiAgICAgICAgICAgICAgICBcIndpdGhleHBsYW5hdGlvbnF1YWxpdHlcIjogaXNfdXNlcl9jb3JyZWN0KHVzZXJzZWxlY3Rpb25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eSlcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcImJhbGFuY2VcIjoge1xuICAgICAgICAgICAgICAgIFwib2xkXCI6IG9sZF9iYWxhbmNlLFxuICAgICAgICAgICAgICAgIFwibmV3XCI6IGJhbGFuY2VcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGxvZ2dlZF9kYXRhWydxdWVzdGlvbiddID0gcXVlc3Rpb25cbiAgICAgICAgbG9nZ2VkX2RhdGFbJ2NvdW50X2V4aXRlZF9wYWdlJ10gPSBjb3VudF9leGl0ZWRfcGFnZVxuICAgICAgICBsb2dfZGF0YShsb2dnZWRfZGF0YSlcbiAgICAgICAgY291bnRfZXhpdGVkX3BhZ2UgPSAwXG4gICAgfVxuICAgIFxuXG4gICAgbmV4dF9xdWVzdGlvbigpXG59KTtcblxuXG5mdW5jdGlvbiBpc191c2VyX2NvcnJlY3Qoc2VsZWN0aW9uKSB7XG4gICAgaWYgKHNlbGVjdGlvbiAhPSAyKSB7XG4gICAgICAgIGxldCBjb3JyZWN0X3NlbGVjdGlvbiA9IDEgLSBxdWVzdGlvbltcInByZWRpY3Rpb25faXNfY29ycmVjdFwiXSAvLyAwIGlmIEFJIGlzIGNvcnJlY3QsIDEgaWYgaW5jb3JyZWN0XG4gICAgICAgIHJldHVybiBzZWxlY3Rpb24gPT0gY29ycmVjdF9zZWxlY3Rpb24gPyAxIDogMFxuICAgIH1cbiAgICByZXR1cm4gLTFcbn1cblxuZnVuY3Rpb24gdXBkYXRlX2JhbGFuY2UoKSB7XG4gICAgaWYgKHVzZXJzZWxlY3Rpb25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eSAhPSAyKSB7XG4gICAgICAgIGxldCBjb3JyZWN0X3NlbGVjdGlvbiA9IDEgLSBxdWVzdGlvbltcInByZWRpY3Rpb25faXNfY29ycmVjdFwiXSAvLyAwIGlmIEFJIGlzIGNvcnJlY3QsIDEgaWYgaW5jb3JyZWN0XG4gICAgICAgIGlmICh1c2Vyc2VsZWN0aW9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHkgPT0gY29ycmVjdF9zZWxlY3Rpb24pIHtcbiAgICAgICAgICAgIGJhbGFuY2UgKz0gUkVXQVJEX0NPUlJFQ1Q7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBiYWxhbmNlICs9IFBFTkFMVFlfSU5DT1JSRUNUO1xuICAgICAgICB9XG4gICAgfVxufVxuXG4vLyBUbyBlbnN1cmUgYmFsYW5jZSBpcyBub24tbmVnYXRpdmVcbmZ1bmN0aW9uIGZpbmFsaXplX2JhbGFuY2UoKSB7XG4gICAgYmFsYW5jZSA9IE1hdGgubWF4KDAsIGJhbGFuY2UpO1xuICAgIHJldHVybiBiYWxhbmNlO1xufVxuXG5sZXQgYWN0aXZlVGltZXI6IFJldHVyblR5cGU8dHlwZW9mIHNldEludGVydmFsPiB8IG51bGwgPSBudWxsOyAvLyBUaW1lciBpbnRlcnZhbFxuXG5mdW5jdGlvbiBzdGFydFRpbWVyKGR1cmF0aW9uLCBzdGVwRGl2LCBidXR0b25zLCBjYWxsYmFjaykge1xuICAgIGlmICghRU5BQkxFX1RJTUVSKSB7XG4gICAgICAgIC8vIElmIHRoZSB0aW1lciBpcyBkaXNhYmxlZCwgZW5hYmxlIHRoZSBidXR0b25zIGltbWVkaWF0ZWx5XG4gICAgICAgIGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gYnV0dG9uLnJlbW92ZUF0dHJpYnV0ZShcImRpc2FibGVkXCIpKTtcbiAgICAgICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjaygpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gQ2xlYXIgYW55IGV4aXN0aW5nIHRpbWVyIHRvIHByZXZlbnQgbXVsdGlwbGUgaW50ZXJ2YWxzXG4gICAgaWYgKGFjdGl2ZVRpbWVyKSB7XG4gICAgICAgIGNsZWFySW50ZXJ2YWwoYWN0aXZlVGltZXIpO1xuICAgICAgICBhY3RpdmVUaW1lciA9IG51bGw7XG4gICAgfVxuXG4gICAgLy8gRGlzYWJsZSBidXR0b25zXG4gICAgYnV0dG9ucy5mb3JFYWNoKGJ1dHRvbiA9PiBidXR0b24uc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgXCJ0cnVlXCIpKTtcbiAgICBcbiAgICAvLyBTaG93IHRpbWVyIHZpc3VhbGx5XG4gICAgbGV0IHRpbWVyRGlzcGxheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIHRpbWVyRGlzcGxheS5pZCA9IGB0aW1lcl8ke3N0ZXBEaXYuaWR9YDtcbiAgICB0aW1lckRpc3BsYXkuc3R5bGUuZm9udFdlaWdodCA9ICdib2xkJztcbiAgICBzdGVwRGl2LmFwcGVuZENoaWxkKHRpbWVyRGlzcGxheSk7XG5cbiAgICBsZXQgcmVtYWluaW5nVGltZSA9IGR1cmF0aW9uO1xuXG4gICAgLy8gSW5pdGlhbCBkaXNwbGF5XG4gICAgdGltZXJEaXNwbGF5LnRleHRDb250ZW50ID0gYFBsZWFzZSB3YWl0ICR7cmVtYWluaW5nVGltZX0gc2Vjb25kKHMpIGJlZm9yZSBtYWtpbmcgeW91ciBzZWxlY3Rpb24uYDtcblxuICAgIGFjdGl2ZVRpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICByZW1haW5pbmdUaW1lLS07XG4gICAgICAgIGlmIChyZW1haW5pbmdUaW1lID49IDApIHtcbiAgICAgICAgICAgIHRpbWVyRGlzcGxheS50ZXh0Q29udGVudCA9IGBQbGVhc2Ugd2FpdCAke3JlbWFpbmluZ1RpbWV9IHNlY29uZChzKSBiZWZvcmUgbWFraW5nIHlvdXIgc2VsZWN0aW9uLmA7XG4gICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgIGlmIChhY3RpdmVUaW1lciAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoYWN0aXZlVGltZXIpOyAvLyBTdG9wIHRoZSB0aW1lclxuICAgICAgICAgICAgICAgIGFjdGl2ZVRpbWVyID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGFjdGl2ZVRpbWVyID0gbnVsbDtcblxuICAgICAgICAgICAgLy8gUmVtb3ZlIHRpbWVyIGRpc3BsYXlcbiAgICAgICAgICAgIHN0ZXBEaXYucmVtb3ZlQ2hpbGQodGltZXJEaXNwbGF5KTtcblxuICAgICAgICAgICAgLy8gRW5hYmxlIGJ1dHRvbnNcbiAgICAgICAgICAgIGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gYnV0dG9uLnJlbW92ZUF0dHJpYnV0ZShcImRpc2FibGVkXCIpKTtcblxuICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjaygpO1xuICAgICAgICB9XG4gICAgfSwgMTAwMCk7XG59XG5cbi8vIFdoZW4gdGhlIHVzZXIgc3dpdGNoZXMgdGFicyBvciBtaW5pbWl6ZXMgdGhlIHdpbmRvdywgcGF1c2UgdGhlIHRpbWVyXG5kb2N1bWVudC5vbnZpc2liaWxpdHljaGFuZ2UgPSAoKSA9PiB7XG4gICAgaWYgKGRvY3VtZW50LmhpZGRlbikge1xuICAgICAgICBjb25zb2xlLmxvZyhcIldpbmRvdyBsb3N0IGZvY3VzLlwiKTtcbiAgICAgICAgaWYgKGFjdGl2ZVRpbWVyICE9PSBudWxsKSB7XG4gICAgICAgICAgICBjbGVhckludGVydmFsKGFjdGl2ZVRpbWVyKTsgLy8gUGF1c2UgdGhlIHRpbWVyXG4gICAgICAgICAgICBhY3RpdmVUaW1lciA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBIYW5kbGUgbG9naWMgd2hlbiB0aGUgdXNlciByZXR1cm5zXG4gICAgICAgIGNvbnNvbGUubG9nKFwiV2luZG93IHJlZ2FpbmVkIGZvY3VzLlwiKTtcbiAgICB9XG59O1xuXG4vLyBGaXJzdCBzdGVwOiBlbmZvcmNlIGEgNS1zZWNvbmQgd2FpdFxuZnVuY3Rpb24gc2V0dXBGaXJzdFN0ZXAoZXhwbGFuYXRpb25UZXh0KSB7XG4gICAgY29uc3QgZmlyc3RTdGVwRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FpX2Fuc3dlcl9kaXYnKTtcbiAgICBjb25zdCBidXR0b25zID0gW1xuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnV0dG9uX2Fuc3dlcm9ubHlfdXNlcnRydXN0cycpLFxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnV0dG9uX2Fuc3dlcm9ubHlfdXNlcmRpc3RydXN0cycpLFxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnV0dG9uX2Fuc3dlcm9ubHlfdXNlcnVuc3VyZScpXG4gICAgXTtcblxuICAgIGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gYnV0dG9uPy5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUZpcnN0U3RlcENsaWNrKSk7IC8vIFJlbW92ZSBvbGQgbGlzdGVuZXJzXG4gICAgYnV0dG9ucy5mb3JFYWNoKGJ1dHRvbiA9PiBidXR0b24/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlRmlyc3RTdGVwQ2xpY2spKTsgLy8gQWRkIG5ldyBvbmVzXG5cbiAgICBmdW5jdGlvbiBoYW5kbGVGaXJzdFN0ZXBDbGljaygpIHtcbiAgICAgICAgYnV0dG9ucy5mb3JFYWNoKGJ1dHRvbiA9PiBidXR0b24/LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlRmlyc3RTdGVwQ2xpY2spKTsgLy8gQ2xlYW51cFxuICAgICAgICBzZXR1cFNlY29uZFN0ZXAoZXhwbGFuYXRpb25UZXh0KTtcbiAgICB9XG5cbiAgICAkKFwiI2FpX2Fuc3dlcl9kaXZcIikuc2hvdygpO1xuICAgIHN0YXJ0VGltZXIoNSwgZmlyc3RTdGVwRGl2LCBidXR0b25zLCBudWxsKTtcbiAgICAvLyAkKFwiI2FpX2Fuc3dlcl9kaXZcIikuc2hvdygpOyAvLyBTaG93IHRoZSBmaXJzdCBzdGVwXG4gICAgLy8gc3RhcnRUaW1lcig1LCBmaXJzdFN0ZXBEaXYsIGJ1dHRvbnMsICgpID0+IHtcbiAgICAvLyAgICAgLy8gQnV0dG9ucyBhcmUgbm93IGVuYWJsZWQ7IHVzZXIgbXVzdCBjbGljayBvbmUgdG8gcHJvY2VlZFxuICAgIC8vICAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IHtcbiAgICAvLyAgICAgICAgIGJ1dHRvbj8uYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAvLyAgICAgICAgICAgICAnY2xpY2snLFxuICAgIC8vICAgICAgICAgICAgICgpID0+IHtcbiAgICAvLyAgICAgICAgICAgICAgICAgc2V0dXBTZWNvbmRTdGVwKGV4cGxhbmF0aW9uVGV4dCk7IC8vIFByb2NlZWQgdG8gdGhlIHNlY29uZCBzdGVwIGFmdGVyIGJ1dHRvbiBjbGlja1xuICAgIC8vICAgICAgICAgICAgIH0sXG4gICAgLy8gICAgICAgICAgICAgeyBvbmNlOiB0cnVlIH0gLy8gRW5zdXJlIHRoZSBldmVudCBsaXN0ZW5lciBpcyBleGVjdXRlZCBvbmx5IG9uY2VcbiAgICAvLyAgICAgICAgICk7XG4gICAgLy8gICAgIH0pO1xuICAgIC8vIH0pO1xufVxuXG4vLyBTZWNvbmQgc3RlcCB0aW1lciAoZHluYW1pYyBiYXNlZCBvbiByZWFkaW5nIHRpbWUpXG5mdW5jdGlvbiBzZXR1cFNlY29uZFN0ZXAoZXhwbGFuYXRpb25UZXh0KSB7XG4gICAgY29uc3Qgc2Vjb25kU3RlcERpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhaV9leHBsYW5hdGlvbl9kaXYnKTtcbiAgICBjb25zdCB3b3JkcyA9IGV4cGxhbmF0aW9uVGV4dC5zcGxpdCgnICcpLmxlbmd0aDtcbiAgICBjb25zdCByZWFkaW5nVGltZSA9IE1hdGgubWF4KE1hdGguY2VpbCgzICsgKHdvcmRzIC8gMjM4KSAqIDYwKSwgNSk7XG5cbiAgICBjb25zdCBidXR0b25zID0gW1xuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnV0dG9uX3dpdGhleHBsYW5hdGlvbl91c2VydHJ1c3RzJyksXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXR0b25fd2l0aGV4cGxhbmF0aW9uX3VzZXJkaXN0cnVzdHMnKSxcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1dHRvbl93aXRoZXhwbGFuYXRpb25fdXNlcnVuc3VyZScpXG4gICAgXTtcblxuICAgIC8vIFJlbW92ZSBvbGQgZXZlbnQgbGlzdGVuZXJzXG4gICAgYnV0dG9ucy5mb3JFYWNoKGJ1dHRvbiA9PiBidXR0b24/LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlU2Vjb25kU3RlcENsaWNrKSk7XG5cbiAgICAvLyBBZGQgbmV3IGV2ZW50IGxpc3RlbmVyc1xuICAgIGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gYnV0dG9uPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZVNlY29uZFN0ZXBDbGljaykpO1xuXG4gICAgZnVuY3Rpb24gaGFuZGxlU2Vjb25kU3RlcENsaWNrKCkge1xuICAgICAgICAvLyBDbGVhbnVwOiByZW1vdmUgZXZlbnQgbGlzdGVuZXJzXG4gICAgICAgIGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gYnV0dG9uPy5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZVNlY29uZFN0ZXBDbGljaykpO1xuICAgICAgICBzZXR1cFRoaXJkU3RlcChleHBsYW5hdGlvblRleHQpO1xuICAgIH1cblxuICAgICQoXCIjYWlfZXhwbGFuYXRpb25fZGl2XCIpLnNob3coKTsgLy8gU2hvdyB0aGUgc2Vjb25kIHN0ZXBcbiAgICBzdGFydFRpbWVyKHJlYWRpbmdUaW1lLCBzZWNvbmRTdGVwRGl2LCBidXR0b25zLCBudWxsKTsgLy8gU3RhcnQgdGltZXJcbn1cblxuLy8gVGhpcmQgc3RlcCB0aW1lciAoNSBzZWNvbmRzKVxuZnVuY3Rpb24gc2V0dXBUaGlyZFN0ZXAoZXhwbGFuYXRpb25UZXh0KSB7XG4gICAgY29uc3QgdGhpcmRTdGVwRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FpX2V4cGxhbmF0aW9uX3F1YWxpdHlfZGl2Jyk7XG4gICAgY29uc3QgYnV0dG9ucyA9IFtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1dHRvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5X3VzZXJ0cnVzdHMnKSxcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1dHRvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5X3VzZXJkaXN0cnVzdHMnKSxcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1dHRvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5X3VzZXJ1bnN1cmUnKVxuICAgIF07XG5cbiAgICAvLyBSZW1vdmUgb2xkIGV2ZW50IGxpc3RlbmVyc1xuICAgIGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gYnV0dG9uPy5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZVRoaXJkU3RlcENsaWNrKSk7XG5cbiAgICAvLyBBZGQgbmV3IGV2ZW50IGxpc3RlbmVyc1xuICAgIGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gYnV0dG9uPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZVRoaXJkU3RlcENsaWNrKSk7XG5cbiAgICBmdW5jdGlvbiBoYW5kbGVUaGlyZFN0ZXBDbGljaygpIHtcbiAgICAgICAgLy8gQ2xlYW51cDogcmVtb3ZlIGV2ZW50IGxpc3RlbmVyc1xuICAgICAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IGJ1dHRvbj8ucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVUaGlyZFN0ZXBDbGljaykpO1xuICAgICAgICAkKFwiI2J1dHRvbl9uZXh0XCIpLnNob3coKTsgLy8gRW5hYmxlIHRoZSBuZXh0IHF1ZXN0aW9uIGJ1dHRvblxuICAgIH1cblxuICAgICQoXCIjYWlfZXhwbGFuYXRpb25fcXVhbGl0eV9kaXZcIikuc2hvdygpOyAvLyBTaG93IHRoZSB0aGlyZCBzdGVwXG4gICAgc3RhcnRUaW1lcig1LCB0aGlyZFN0ZXBEaXYsIGJ1dHRvbnMsIG51bGwpOyAvLyBTdGFydCB0aW1lclxufVxuXG5mdW5jdGlvbiBuZXh0X3F1ZXN0aW9uKCkge1xuICAgIC8vIFJlc2V0IHRpbWVycyBhbmQgc3RhdGVcbiAgICBpZiAoYWN0aXZlVGltZXIpIHtcbiAgICAgICAgY2xlYXJJbnRlcnZhbChhY3RpdmVUaW1lcik7XG4gICAgICAgIGFjdGl2ZVRpbWVyID0gbnVsbDtcbiAgICB9XG5cbiAgICAvLyByZXN0b3JlIHByZXZpb3VzIHN0YXRlIG9mIFVJXG4gICAgJChcIiNidXR0b25fcmVhZHl0b2Fuc3dlclwiKS5yZW1vdmVBdHRyKFwiYWN0aXZlZGVjaXNpb25cIilcbiAgICAkKFwiI2J1dHRvbl9yZWFkeXRvYW5zd2VyXCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKVxuICAgICQoXCIjYnV0dG9uX3JlYWR5dG9hbnN3ZXJcIikuc2hvdygpXG5cbiAgICAkKFwiI2J1dHRvbl9hbnN3ZXJvbmx5X3VzZXJ0cnVzdHNcIikucmVtb3ZlQXR0cihcImFjdGl2ZWRlY2lzaW9uXCIpXG4gICAgJChcIiNidXR0b25fYW5zd2Vyb25seV91c2VydHJ1c3RzXCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKVxuICAgICQoXCIjYnV0dG9uX2Fuc3dlcm9ubHlfdXNlcmRpc3RydXN0c1wiKS5yZW1vdmVBdHRyKFwiYWN0aXZlZGVjaXNpb25cIilcbiAgICAkKFwiI2J1dHRvbl9hbnN3ZXJvbmx5X3VzZXJkaXN0cnVzdHNcIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpXG4gICAgJChcIiNidXR0b25fYW5zd2Vyb25seV91c2VydW5zdXJlXCIpLnJlbW92ZUF0dHIoXCJhY3RpdmVkZWNpc2lvblwiKVxuICAgICQoXCIjYnV0dG9uX2Fuc3dlcm9ubHlfdXNlcnVuc3VyZVwiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIilcblxuICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbl91c2VydHJ1c3RzXCIpLnJlbW92ZUF0dHIoXCJhY3RpdmVkZWNpc2lvblwiKVxuICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbl91c2VydHJ1c3RzXCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKVxuICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbl91c2VyZGlzdHJ1c3RzXCIpLnJlbW92ZUF0dHIoXCJhY3RpdmVkZWNpc2lvblwiKVxuICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbl91c2VyZGlzdHJ1c3RzXCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKVxuICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbl91c2VydW5zdXJlXCIpLnJlbW92ZUF0dHIoXCJhY3RpdmVkZWNpc2lvblwiKVxuICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbl91c2VydW5zdXJlXCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKVxuXG4gICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eV91c2VydHJ1c3RzXCIpLnJlbW92ZUF0dHIoXCJhY3RpdmVkZWNpc2lvblwiKVxuICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHlfdXNlcnRydXN0c1wiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIilcbiAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5X3VzZXJkaXN0cnVzdHNcIikucmVtb3ZlQXR0cihcImFjdGl2ZWRlY2lzaW9uXCIpXG4gICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eV91c2VyZGlzdHJ1c3RzXCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKVxuICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHlfdXNlcnVuc3VyZVwiKS5yZW1vdmVBdHRyKFwiYWN0aXZlZGVjaXNpb25cIilcbiAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5X3VzZXJ1bnN1cmVcIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpXG5cbiAgICAkKFwiI2FpX2V4cGxhbmF0aW9uX2RpdlwiKS5oaWRlKClcbiAgICAkKFwiI2FpX2V4cGxhbmF0aW9uX3F1YWxpdHlfZGl2XCIpLmhpZGUoKVxuICAgIFxuXG4gICAgJChcIiNidXR0b25fbmV4dFwiKS5oaWRlKClcbiAgICAkKCcjYnV0dG9uX3F1aXQnKS5oaWRlKClcbiAgICAvLyQoXCIjcmFuZ2VfdmFsXCIpLnZhbCh1c2VyX3RydXN0KVxuXG4gICAgcXVlc3Rpb25faSArPSAxXG4gICAgaWYgKHF1ZXN0aW9uX2kgPj0gZGF0YS5sZW5ndGgpIHtcbiAgICAgICAgJChcIiNtYWluX2JveF9leHBlcmltZW50XCIpLmhpZGUoKVxuICAgICAgICBiYWxhbmNlID0gZmluYWxpemVfYmFsYW5jZSgpXG5cbiAgICAgICAgaWYgKE1PQ0tNT0RFKSB7XG4gICAgICAgICAgICAkKCcjcmV3YXJkX2JveF9tb2NrJykudGV4dChgWW91ciB0b3RhbCByZXdhcmQgaXMgJCR7YmFsYW5jZS50b0ZpeGVkKDIpfSAoJHtxdWVzdGlvbl9pfSBxdWVzdGlvbnMgYW5zd2VyZWQpICsgJDIuYClcbiAgICAgICAgICAgICQoJyNyZXdhcmRfYm94X21vY2snKS5zaG93KClcbiAgICAgICAgICAgICQoXCIjbWFpbl9ib3hfZW5kX21vY2tcIikuc2hvdygpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkKCcjcmV3YXJkX2JveCcpLnRleHQoYFlvdXIgdG90YWwgcmV3YXJkIGlzICQke2JhbGFuY2UudG9GaXhlZCgyKX0gKCR7cXVlc3Rpb25faX0gcXVlc3Rpb25zIGFuc3dlcmVkKSArICQyLmApXG4gICAgICAgICAgICAkKCcjcmV3YXJkX2JveCcpLnNob3coKVxuICAgICAgICAgICAgJChcIiNtYWluX2JveF9lbmRcIikuc2hvdygpXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgcXVlc3Rpb24gPSBkYXRhW3F1ZXN0aW9uX2ldXG5cbiAgICBjb25zdCBxdWVzdGlvblRleHQgPSBxdWVzdGlvbiFbXCJxdWVzdGlvblwiXTtcbiAgICBjb25zdCB1cGRhdGVkUXVlc3Rpb25UZXh0ID0gcXVlc3Rpb25UZXh0LnJlcGxhY2UoXCJDaG9pY2VzOlwiLCBcIjxicj48Yj5DaG9pY2VzOjwvYj5cIik7XG4gICAgJChcIiNxdWVzdGlvbl9zcGFuXCIpLmh0bWwodXBkYXRlZFF1ZXN0aW9uVGV4dCk7XG5cbiAgICAkKFwiI2FpX3ByZWRpY3Rpb25fc3BhblwiKS5odG1sKHF1ZXN0aW9uIVtcInByZWRpY3RlZF9hbnN3ZXJcIl0pXG4gICAgJChcIiNhaV9leHBsYW5hdGlvbl9zcGFuXCIpLmh0bWwocXVlc3Rpb24hW1wiZ2VuZXJhdGVkX3JhdGlvbmFsZVwiXSlcblxuICAgIGxldCB2aXN1YWxfZmlkZWxpdHlfY29uZiA9IE1hdGgucm91bmQocXVlc3Rpb24hW1widmlzdWFsIGZpZGVsaXR5XCJdICogMTAwKVxuICAgICQoXCIjZXhwbGFuYXRpb25fZmlkZWxpdHlfc3BhblwiKS5odG1sKGAke3Zpc3VhbF9maWRlbGl0eV9jb25mfSVgKVxuICAgIGxldCB2aXN1YWxfY29udHJhc3RpdmVuZXNzX2NvbmYgPSBNYXRoLnJvdW5kKHF1ZXN0aW9uIVtcImNvbnRyYXN0aXZlbmVzc1wiXSAqIDEwMClcbiAgICAkKFwiI2V4cGxhbmF0aW9uX2NvbnRyYXN0aXZlbmVzc19zcGFuXCIpLmh0bWwoYCR7dmlzdWFsX2NvbnRyYXN0aXZlbmVzc19jb25mfSVgKVxuXG5cbiAgICAvLyBzZXQgYmV0IHZhbHVlIHJhdGlvXG4gICAgLy9pZihxdWVzdGlvbi5oYXNPd25Qcm9wZXJ0eShcInJld2FyZF9yYXRpb1wiKSkge1xuICAgIC8vICAgIGxldCBbcmF0aW8xLCByYXRpbzJdID0gcXVlc3Rpb25bXCJyZXdhcmRfcmF0aW9cIl1cbiAgICAvLyAgICByYXRpbzEgPSBOdW1iZXIocmF0aW8xKVxuICAgIC8vICAgIHJhdGlvMiA9IE51bWJlcihyYXRpbzIpXG4gICAgLy8gICAgYmV0X3ZhbF9yYXRpbyA9IHJhdGlvMS9yYXRpbzJcbiAgICAvL30gZWxzZSB7XG4gICAgLy8gICAgYmV0X3ZhbF9yYXRpbyA9IDFcbiAgICAvL31cblxuICAgIC8vdGltZV9xdWVzdGlvbl9zdGFydCA9IERhdGUubm93KClcbiAgICAkKFwiI3Byb2dyZXNzXCIpLnRleHQoYFByb2dyZXNzOiAke3F1ZXN0aW9uX2kgKyAxfSAvICR7ZGF0YS5sZW5ndGh9YClcblxuICAgIHNldHVwRmlyc3RTdGVwKHF1ZXN0aW9uW1wiZ2VuZXJhdGVkX3JhdGlvbmFsZVwiXSk7XG59XG5cblxuXG4vLyBnZXQgdXNlciBpZCBhbmQgbG9hZCBxdWV1ZVxuLy8gdHJ5IHRvIHNlZSBpZiBzdGFydCBvdmVycmlkZSB3YXMgcGFzc2VkXG5jb25zdCB1cmxQYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gpO1xuY29uc3Qgc3RhcnRPdmVycmlkZSA9IHVybFBhcmFtcy5nZXQoJ3N0YXJ0Jyk7XG5jb25zdCBVSURGcm9tVVJMID0gdXJsUGFyYW1zLmdldChcInVpZFwiKVxuZ2xvYmFsVGhpcy51cmxfZGF0YSA9IHBhcmFtc1RvT2JqZWN0KHVybFBhcmFtcy5lbnRyaWVzKCkpXG5cbmlmIChnbG9iYWxUaGlzLnVybF9kYXRhWydzdHVkeV9pZCddID09IG51bGwpIHtcbiAgICBnbG9iYWxUaGlzLnVybF9kYXRhWydzdHVkeV9pZCddID0gXCJkZW1vX3N0dWR5XCJcbn1cbmlmIChnbG9iYWxUaGlzLnVybF9kYXRhWydwcm9saWZpY19pZCddID09IG51bGwpIHtcbiAgICBnbG9iYWxUaGlzLnVybF9kYXRhWydwcm9saWZpY19pZCddID0gXCJkZW1vX3VzZXJcIlxufVxuaWYgKGdsb2JhbFRoaXMudXJsX2RhdGFbJ3Nlc3Npb25faWQnXSA9PSBudWxsKSB7XG4gICAgZ2xvYmFsVGhpcy51cmxfZGF0YVsnc2Vzc2lvbl9pZCddID0gXCJkZW1vX3Nlc3Npb25cIlxufVxuXG5pZiAoVUlERnJvbVVSTCAhPSBudWxsKSB7XG4gICAgZ2xvYmFsVGhpcy51aWQgPSBVSURGcm9tVVJMIGFzIHN0cmluZ1xuICAgIGlmIChnbG9iYWxUaGlzLnVpZCA9PSBcInByb2xpZmljX3JhbmRvbVwiKSB7XG4gICAgICAgIGxldCBxdWV1ZV9pZCA9IGAke01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKX1gLnBhZFN0YXJ0KDMsIFwiMFwiKVxuICAgICAgICBnbG9iYWxUaGlzLnVpZCA9IGAke3VybFBhcmFtcy5nZXQoXCJwcm9saWZpY19xdWV1ZV9uYW1lXCIpfS8ke3F1ZXVlX2lkfWBcbiAgICB9XG59IGVsc2UgaWYgKERFVk1PREUpIHtcbiAgICBnbG9iYWxUaGlzLnVpZCA9IFwiZGVtb1wiXG59IGVsc2Uge1xuICAgIGxldCBVSURfbWF5YmU6IGFueSA9IG51bGxcbiAgICB3aGlsZSAoVUlEX21heWJlID09IG51bGwpIHtcbiAgICAgICAgVUlEX21heWJlID0gcHJvbXB0KFwiRW50ZXIgeW91ciB1c2VyIGlkLiBQbGVhc2UgZ2V0IGluIHRvdWNoIGlmIHlvdSB3ZXJlIG5vdCBhc3NpZ25lZCBhbiBpZCBidXQgd2lzaCB0byBwYXJ0aWNpcGF0ZSBpbiB0aGlzIGV4cGVyaW1lbnQuXCIpXG4gICAgfVxuICAgIGdsb2JhbFRoaXMudWlkID0gVUlEX21heWJlIVxufVxuXG4vLyB2ZXJzaW9uIGZvciBwYXBlclxuaWYgKERFVk1PREUpIHtcbiAgICBNT0NLTU9ERSA9IHRydWVcbn0gZWxzZSBpZiAoZ2xvYmFsVGhpcy51cmxfZGF0YVsnc2Vzc2lvbl9pZCddLnN0YXJ0c1dpdGgoXCJkZW1vXCIpKSB7XG4gICAgTU9DS01PREUgPSB0cnVlXG59XG5cbmNvbnNvbGUubG9nKFwiUnVubmluZyB3aXRoIFVJRFwiLCBnbG9iYWxUaGlzLnVpZClcbmxvYWRfZGF0YSgpLmNhdGNoKChfZXJyb3IpID0+IHtcbiAgICAvL2FsZXJ0KFwiSW52YWxpZCB1c2VyIGlkLlwiKVxuICAgIGNvbnNvbGUubG9nKFwiSW52YWxpZCB1c2VyIGlkLlwiKVxuICAgIGNvbnNvbGUubG9nKGdsb2JhbFRoaXMudWlkISlcbiAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKClcbn1cbikudGhlbigobmV3X2RhdGEpID0+IHtcbiAgICBkYXRhID0gbmV3X2RhdGFcbiAgICBpZiAoc3RhcnRPdmVycmlkZSAhPSBudWxsKSB7XG4gICAgICAgIHF1ZXN0aW9uX2kgPSBwYXJzZUludChzdGFydE92ZXJyaWRlKSAtIDFcbiAgICAgICAgY29uc29sZS5sb2coXCJTdGFydGluZyBmcm9tXCIsIHF1ZXN0aW9uX2kpXG4gICAgfVxuICAgIC8vIG5leHRfcXVlc3Rpb24oKVxuICAgIG5leHRfaW5zdHJ1Y3Rpb25zKDApXG4gICAgdXBkYXRlUmV3YXJkSW5zdHJ1Y3Rpb25zKCk7XG4gICAgJChcIiNtYWluX2JveF9pbnN0cnVjdGlvbnNcIikuc2hvdygpXG4gICAgJChcIiNpbnN0cnVjdGlvbnNfYW5kX2RlY29yYXRpb25zXCIpLmhpZGUoKVxufSlcblxuY29uc29sZS5sb2coXCJTdGFydGluZyBzZXNzaW9uIHdpdGggVUlEOlwiLCBnbG9iYWxUaGlzLnVpZCEpXG5cbmxldCBhbGVydF9hY3RpdmUgPSBmYWxzZVxuZG9jdW1lbnQub252aXNpYmlsaXR5Y2hhbmdlID0gKCkgPT4ge1xuICAgIGlmICghYWxlcnRfYWN0aXZlKSB7XG4gICAgICAgIGNvdW50X2V4aXRlZF9wYWdlICs9IDFcbiAgICAgICAgYWxlcnRfYWN0aXZlID0gdHJ1ZVxuICAgICAgICAvL2lmICghKGdsb2JhbFRoaXMudWlkIS5zdGFydHNXaXRoKFwiZGVtb1wiKSkpIHtcbiAgICAgICAgLy8gICAgYWxlcnQoXCJQbGVhc2UgZG9uJ3QgbGVhdmUgdGhlIHBhZ2UuIElmIHlvdSBkbyBzbyBhZ2Fpbiwgd2UgbWF5IHJlc3RyaWN0IHBheWluZyB5b3UuXCIpXG4gICAgICAgIC8vfVxuICAgICAgICBhbGVydF9hY3RpdmUgPSBmYWxzZVxuICAgIH1cbn0iLCJkZWNsYXJlIGxldCBfREVWTU9ERTogYm9vbGVhblxuZXhwb3J0IHZhciBERVZNT0RFID0gX0RFVk1PREVcbmV4cG9ydCBjb25zdCBFTkFCTEVfVElNRVIgPSB0cnVlOyAgLy8gU2V0IHRvIGBmYWxzZWAgdG8gZGlzYWJsZSB0aGUgdGltZXIgZm9yIGRlYnVnZ2luZ1xuXG5leHBvcnQgY29uc3QgUkVXQVJEX0NPUlJFQ1QgPSAwLjE7IC8vIFJld2FyZCBmb3IgYSBjb3JyZWN0IGFuc3dlclxuZXhwb3J0IGNvbnN0IFBFTkFMVFlfSU5DT1JSRUNUID0gLTAuMTsgLy8gUGVuYWx0eSBmb3IgYW4gaW5jb3JyZWN0IGFuc3dlciIsImZ1bmN0aW9uIHBhcmFtc1RvT2JqZWN0KGVudHJpZXMpIHtcbiAgY29uc3QgcmVzdWx0ID0ge31cbiAgLy8gZWFjaCAnZW50cnknIGlzIGEgW2tleSwgdmFsdWVdIHR1cHBsZVxuICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBlbnRyaWVzKSB7XG4gICAgcmVzdWx0W2tleV0gPSB2YWx1ZTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuXG5leHBvcnQgeyBwYXJhbXNUb09iamVjdCB9Il0sIm5hbWVzIjpbIlNFUlZFUl9MT0dfUk9PVCIsIk1PQ0tNT0RFIiwiZGF0YSIsInF1ZXN0aW9uX2kiLCJxdWVzdGlvbiIsInVzZXJzZWxlY3Rpb25fYW5zd2Vyb25seSIsInVzZXJzZWxlY3Rpb25fd2l0aGV4cGxhbmF0aW9uIiwidXNlcnNlbGVjdGlvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5IiwiYmFsYW5jZSIsImluc3RydWN0aW9uX2kiLCJjb3VudF9leGl0ZWRfcGFnZSIsInJlZ2lzdGVyQW5zd2VyT25seVVzZXJTZWxlY3Rpb24iLCJ1c2VyX2Nob2ljZSIsIiQiLCJhdHRyIiwic2hvdyIsInJlZ2lzdGVyV2l0aEV4cGxhbmF0aW9uVXNlclNlbGVjdGlvbiIsInJlZ2lzdGVyV2l0aEV4cGxhbmF0aW9uUXVhbGl0eVVzZXJTZWxlY3Rpb24iLCJyZW1vdmVBdHRyIiwibmV4dF9pbnN0cnVjdGlvbnMiLCJpbmNyZW1lbnQiLCJ2YWwiLCJoaWRlIiwibmV4dF9xdWVzdGlvbiIsImNoaWxkcmVuIiwiZWFjaCIsIl8iLCJlbCIsImlzX3VzZXJfY29ycmVjdCIsInNlbGVjdGlvbiIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJhZGRFdmVudExpc3RlbmVyIiwib24iLCJvbGRfYmFsYW5jZSIsImNvcnJlY3Rfc2VsZWN0aW9uIiwidXBkYXRlX2JhbGFuY2UiLCJsb2dnZWRfZGF0YSIsImFzeW5jIiwiZ2xvYmFsVGhpcyIsInVybF9kYXRhIiwiY29uc29sZSIsImxvZyIsInVpZCIsInJlc3VsdCIsImFqYXgiLCJKU09OIiwic3RyaW5naWZ5IiwicHJvamVjdCIsInBheWxvYWQiLCJ0eXBlIiwiY29udGVudFR5cGUiLCJQcm9taXNlIiwicmVzb2x2ZSIsInNldFRpbWVvdXQiLCJzbGVlcCIsImUiLCJsb2dfZGF0YSIsImFjdGl2ZVRpbWVyIiwic3RhcnRUaW1lciIsImR1cmF0aW9uIiwic3RlcERpdiIsImJ1dHRvbnMiLCJjYWxsYmFjayIsImNsZWFySW50ZXJ2YWwiLCJmb3JFYWNoIiwiYnV0dG9uIiwic2V0QXR0cmlidXRlIiwidGltZXJEaXNwbGF5IiwiY3JlYXRlRWxlbWVudCIsImlkIiwic3R5bGUiLCJmb250V2VpZ2h0IiwiYXBwZW5kQ2hpbGQiLCJyZW1haW5pbmdUaW1lIiwidGV4dENvbnRlbnQiLCJzZXRJbnRlcnZhbCIsInJlbW92ZUNoaWxkIiwicmVtb3ZlQXR0cmlidXRlIiwibGVuZ3RoIiwiTWF0aCIsIm1heCIsInRleHQiLCJ0b0ZpeGVkIiwidXBkYXRlZFF1ZXN0aW9uVGV4dCIsInJlcGxhY2UiLCJodG1sIiwidmlzdWFsX2ZpZGVsaXR5X2NvbmYiLCJyb3VuZCIsInZpc3VhbF9jb250cmFzdGl2ZW5lc3NfY29uZiIsImV4cGxhbmF0aW9uVGV4dCIsImZpcnN0U3RlcERpdiIsImhhbmRsZUZpcnN0U3RlcENsaWNrIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInNlY29uZFN0ZXBEaXYiLCJ3b3JkcyIsInNwbGl0IiwicmVhZGluZ1RpbWUiLCJjZWlsIiwiaGFuZGxlU2Vjb25kU3RlcENsaWNrIiwidGhpcmRTdGVwRGl2IiwiaGFuZGxlVGhpcmRTdGVwQ2xpY2siLCJzZXR1cFRoaXJkU3RlcCIsInNldHVwU2Vjb25kU3RlcCIsInNldHVwRmlyc3RTdGVwIiwib252aXNpYmlsaXR5Y2hhbmdlIiwiaGlkZGVuIiwidXJsUGFyYW1zIiwiVVJMU2VhcmNoUGFyYW1zIiwid2luZG93IiwibG9jYXRpb24iLCJzZWFyY2giLCJzdGFydE92ZXJyaWRlIiwiZ2V0IiwiVUlERnJvbVVSTCIsImVudHJpZXMiLCJrZXkiLCJ2YWx1ZSIsInBhcmFtc1RvT2JqZWN0IiwicXVldWVfaWQiLCJmbG9vciIsInJhbmRvbSIsInBhZFN0YXJ0IiwiVUlEX21heWJlIiwicHJvbXB0Iiwic3RhcnRzV2l0aCIsImdldEpTT04iLCJEYXRlIiwibm93IiwibG9hZF9kYXRhIiwiY2F0Y2giLCJfZXJyb3IiLCJyZWxvYWQiLCJ0aGVuIiwibmV3X2RhdGEiLCJwYXJzZUludCIsInJld2FyZEluc3RydWN0aW9ucyIsImlubmVySFRNTCIsImFicyIsInVwZGF0ZVJld2FyZEluc3RydWN0aW9ucyIsImFsZXJ0X2FjdGl2ZSJdLCJzb3VyY2VSb290IjoiIn0=