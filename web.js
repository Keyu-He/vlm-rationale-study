(()=>{"use strict";let t="https://tejassrinivasan.pythonanywhere.com/";var e=!1,n=[];let i=-1,o=null,s=-1,a=-1,r=-1,u=0,l=0,d=0,_=0,c=0,h=0;function b(t){s=t,$("#button_answeronly_usertrusts").attr("disabled","true"),$("#button_answeronly_userdistrusts").attr("disabled","true"),$("#button_answeronly_userunsure").attr("disabled","true"),0==t?$("#button_answeronly_usertrusts").attr("activedecision","true"):1==t?$("#button_answeronly_userdistrusts").attr("activedecision","true"):2==t&&$("#button_answeronly_userunsure").attr("activedecision","true"),$("#ai_explanation_div").show()}function m(t){a=t,$("#button_withexplanation_usertrusts").attr("disabled","true"),$("#button_withexplanation_userdistrusts").attr("disabled","true"),$("#button_withexplanation_userunsure").attr("disabled","true"),0==t?$("#button_withexplanation_usertrusts").attr("activedecision","true"):1==t?$("#button_withexplanation_userdistrusts").attr("activedecision","true"):2==t&&$("#button_withexplanation_userunsure").attr("activedecision","true"),$("#ai_explanation_quality_div").show()}function w(t){r=t,$("#button_withexplanationquality_usertrusts").attr("disabled","true"),$("#button_withexplanationquality_userdistrusts").attr("disabled","true"),$("#button_withexplanationquality_userunsure").attr("disabled","true"),0==t?$("#button_withexplanationquality_usertrusts").attr("activedecision","true"):1==t?$("#button_withexplanationquality_userdistrusts").attr("activedecision","true"):2==t&&$("#button_withexplanationquality_userunsure").attr("activedecision","true"),$("#button_next").show(),$("#button_next").removeAttr("disabled")}function y(t){c+=t,0==c?$("#button_instructions_prev").attr("disabled","true"):$("#button_instructions_prev").removeAttr("disabled"),c>=5?($("#instructions_and_decorations").show(),$("#button_instructions_next").val("Start study")):($("#instructions_and_decorations").hide(),$("#button_instructions_next").val("Next")),6==c&&($("#instructions_and_decorations").show(),$("#main_box_instructions").hide(),$("#main_box_experiment").show(),x()),$("#main_box_instructions").children(":not(input)").each(((t,e)=>{$(e).hide()})),$(`#instructions_${c}`).show()}function p(t){return 2!=t?t==1-o.prediction_is_correct?1:0:-1}document.getElementById("button_answeronly_usertrusts")?.addEventListener("click",(()=>b(0))),document.getElementById("button_answeronly_userdistrusts")?.addEventListener("click",(()=>b(1))),document.getElementById("button_answeronly_userunsure")?.addEventListener("click",(()=>b(2))),document.getElementById("button_withexplanation_usertrusts")?.addEventListener("click",(()=>m(0))),document.getElementById("button_withexplanation_userdistrusts")?.addEventListener("click",(()=>m(1))),document.getElementById("button_withexplanation_userunsure")?.addEventListener("click",(()=>m(2))),document.getElementById("button_withexplanationquality_usertrusts")?.addEventListener("click",(()=>w(0))),document.getElementById("button_withexplanationquality_userdistrusts")?.addEventListener("click",(()=>w(1))),document.getElementById("button_withexplanationquality_userunsure")?.addEventListener("click",(()=>w(2))),$("#button_instructions_next").on("click",(()=>y(1))),$("#button_instructions_prev").on("click",(()=>y(-1))),$("#button_next").on("click",(()=>{let e=_;if(function(){if(2!=r){let t=1-o.prediction_is_correct;r==t?(_+=.1,u+=1):(_+=-.1,l+=1)}else d+=1}(),-1!=i){let n={question_i:i,user_selections:{answeronly:s,withexplanation:a,withexplanationquality:r},user_is_correct:{answeronly:p(s),withexplanation:p(a),withexplanationquality:p(r)},balance:{old:e,new:_}};n.question=o,n.count_exited_page=h,async function(e){e.url_data=globalThis.url_data,console.log("Data"),"study_id"in e.url_data||(e.url_data.study_id="demo_study"),"prolific_id"in e.url_data||(e.url_data.prolific_id="demo_user"),"session_id"in e.url_data||(e.url_data.session_id="demo_session"),e.url_data.queue_id=globalThis.uid,console.log("logged",e),console.log("Logging to",t+"log");try{let n=await $.ajax(t+"log",{data:JSON.stringify({project:"vlm-rationales-study/"+e.url_data.study_id,uid:globalThis.uid+"_"+e.url_data.prolific_id,payload:JSON.stringify(e)}),type:"POST",contentType:"application/json"});return await async function(){return new Promise((t=>setTimeout(t,2e3)))}(),n}catch(t){console.log(t)}}(n),h=0}x()}));let v=null;function g(t,e,n,i){v&&(clearInterval(v),v=null),n.forEach((t=>t.setAttribute("disabled","true")));let o=document.createElement("div");o.id=`timer_${e.id}`,o.style.fontWeight="bold",o.style.marginTop="10px",e.appendChild(o);let s=t;o.textContent=`Please wait ${s} second(s) before making your selection.`,v=setInterval((()=>{s--,s>=0?o.textContent=`Please wait ${s} second(s) before making your selection.`:(null!==v&&(clearInterval(v),v=null),v=null,e.removeChild(o),n.forEach((t=>t.removeAttribute("disabled"))),i&&i())}),1e3)}function x(){if(v&&(clearInterval(v),v=null),$("#button_readytoanswer").removeAttr("activedecision"),$("#button_readytoanswer").removeAttr("disabled"),$("#button_readytoanswer").show(),$("#button_answeronly_usertrusts").removeAttr("activedecision"),$("#button_answeronly_usertrusts").removeAttr("disabled"),$("#button_answeronly_userdistrusts").removeAttr("activedecision"),$("#button_answeronly_userdistrusts").removeAttr("disabled"),$("#button_answeronly_userunsure").removeAttr("activedecision"),$("#button_answeronly_userunsure").removeAttr("disabled"),$("#button_withexplanation_usertrusts").removeAttr("activedecision"),$("#button_withexplanation_usertrusts").removeAttr("disabled"),$("#button_withexplanation_userdistrusts").removeAttr("activedecision"),$("#button_withexplanation_userdistrusts").removeAttr("disabled"),$("#button_withexplanation_userunsure").removeAttr("activedecision"),$("#button_withexplanation_userunsure").removeAttr("disabled"),$("#button_withexplanationquality_usertrusts").removeAttr("activedecision"),$("#button_withexplanationquality_usertrusts").removeAttr("disabled"),$("#button_withexplanationquality_userdistrusts").removeAttr("activedecision"),$("#button_withexplanationquality_userdistrusts").removeAttr("disabled"),$("#button_withexplanationquality_userunsure").removeAttr("activedecision"),$("#button_withexplanationquality_userunsure").removeAttr("disabled"),$("#ai_explanation_div").hide(),$("#ai_explanation_quality_div").hide(),$("#button_next").hide(),$("#button_quit").hide(),i+=1,i>=n.length){$("#main_box_experiment").hide(),_=Math.max(0,_);let t=`Your total reward is <b>$${_.toFixed(2)} + $2</b>.`;return t+=`<br>You answered a total of ${i} questions: ${u} correct, ${l} incorrect, ${d} unsure.`,void(e?($("#reward_box_mock").html(t),$("#reward_box_mock").show(),$("#main_box_end_mock").show()):($("#reward_box").html(t),$("#reward_box").show(),$("#main_box_end").show()))}o=n[i];const t=o.question.replace("Choices:","<br><b>Choices:</b>");$("#question_span").html(t),$("#ai_prediction_span").html(o.predicted_answer),$("#ai_explanation_span").html(o.generated_rationale);let s=Math.round(100*o.visual_fidelity);$("#explanation_fidelity_span").html(`${s}%`);let a=Math.round(100*o.contrastiveness);$("#explanation_contrastiveness_span").html(`${a}%`),$("#progress").text(`Progress: ${i+1} / ${n.length}`),function(t){const e=document.getElementById("ai_answer_div"),n=[document.getElementById("button_answeronly_usertrusts"),document.getElementById("button_answeronly_userdistrusts"),document.getElementById("button_answeronly_userunsure")];function i(){n.forEach((t=>t?.removeEventListener("click",i))),function(t){const e=document.getElementById("ai_explanation_div"),n=t.split(" ").length,i=Math.max(Math.ceil(3+n/238*60),5),o=[document.getElementById("button_withexplanation_usertrusts"),document.getElementById("button_withexplanation_userdistrusts"),document.getElementById("button_withexplanation_userunsure")];function s(){o.forEach((t=>t?.removeEventListener("click",s))),function(){const t=document.getElementById("ai_explanation_quality_div"),e=[document.getElementById("button_withexplanationquality_usertrusts"),document.getElementById("button_withexplanationquality_userdistrusts"),document.getElementById("button_withexplanationquality_userunsure")];function n(){e.forEach((t=>t?.removeEventListener("click",n))),$("#button_next").show()}e.forEach((t=>t?.removeEventListener("click",n))),e.forEach((t=>t?.addEventListener("click",n))),$("#ai_explanation_quality_div").show(),g(5,t,e,null)}()}o.forEach((t=>t?.removeEventListener("click",s))),o.forEach((t=>t?.addEventListener("click",s))),$("#ai_explanation_div").show(),g(i,e,o,null)}(t)}n.forEach((t=>t?.removeEventListener("click",i))),n.forEach((t=>t?.addEventListener("click",i))),$("#ai_answer_div").show(),g(5,e,n,null)}(o.generated_rationale)}document.onvisibilitychange=()=>{document.hidden?(console.log("Window lost focus."),null!==v&&(clearInterval(v),v=null)):console.log("Window regained focus.")};const f=new URLSearchParams(window.location.search),E=f.get("start"),q=f.get("uid");if(globalThis.url_data=function(t){const e={};for(const[n,i]of t)e[n]=i;return e}(f.entries()),null==globalThis.url_data.study_id&&(globalThis.url_data.study_id="demo_study"),null==globalThis.url_data.prolific_id&&(globalThis.url_data.prolific_id="demo_user"),null==globalThis.url_data.session_id&&(globalThis.url_data.session_id="demo_session"),null!=q){if(globalThis.uid=q,"prolific_random"==globalThis.uid){let t=`${Math.floor(10*Math.random())}`.padStart(3,"0");globalThis.uid=`${f.get("prolific_queue_name")}/${t}`}}else{let t=null;for(;null==t;)t=prompt("Enter your user id. Please get in touch if you were not assigned an id but wish to participate in this experiment.");globalThis.uid=t}globalThis.url_data.session_id.startsWith("demo")&&(e=!0),console.log("Running with UID",globalThis.uid),async function(){return await $.getJSON(`baked_queues/${globalThis.uid}.json?t=${Date.now()}`)}().catch((t=>{console.log("Invalid user id."),console.log(globalThis.uid),window.location.reload()})).then((t=>{n=t,null!=E&&(i=parseInt(E)-1,console.log("Starting from",i)),y(0),function(){const t=document.getElementById("reward_instructions");t&&(t.innerHTML=`\n            If your final decision is correct, you gain a reward of $${.1.toFixed(2)}. \n            If your final decision is incorrect, you lose $${Math.abs(-.1).toFixed(2)} from your reward. \n            You will see your total reward at the end of the experiment. \n            Your payment is $2.0 plus whatever you accumulate during this experiment.\n        `)}(),$("#main_box_instructions").show(),$("#instructions_and_decorations").hide()})),console.log("Starting session with UID:",globalThis.uid);let I=!1;document.onvisibilitychange=()=>{I||(h+=1,I=!0,I=!1)}})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TUFBTUMsSUFDSnpJLEVBQU95SSxFQUNjLE1BQWpCdEIsSUFDQWxILEVBQWF5SSxTQUFTdkIsR0FBaUIsRUFDdkN6RSxRQUFRQyxJQUFJLGdCQUFpQjFDLElBR2pDbUIsRUFBa0IsR0E1WnRCLFdBQ0ksTUFBTXVILEVBQXFCNUcsU0FBU0MsZUFBZSx1QkFFL0MyRyxJQUNBQSxFQUFtQkMsVUFBWSwwRUMxRlQsR0QyRndEdkQsUUFBUSxvRUFDakNILEtBQUsyRCxLQzNGakMsSUQyRndEeEQsUUFBUSxvTUFPakcsQ0FnWkl5RCxHQUNBaEksRUFBRSwwQkFBMEJFLE9BQzVCRixFQUFFLGlDQUFpQ1MsTUFBTSxJQUc3Q21CLFFBQVFDLElBQUksNkJBQThCSCxXQUFXSSxLQUVyRCxJQUFJbUcsR0FBZSxFQUNuQmhILFNBQVM2RSxtQkFBcUIsS0FDckJtQyxJQUNEcEksR0FBcUIsRUFDckJvSSxHQUFlLEVBSWZBLEdBQWUsRSIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9jb25uZWN0b3IudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL21haW4udHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2dsb2JhbHMudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3V0aWxzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERFVk1PREUgfSBmcm9tICcuL2dsb2JhbHMnXG5pbXBvcnQgeyBNT0NLTU9ERSB9IGZyb20gJy4vbWFpbidcblxubGV0IFNFUlZFUl9MT0dfUk9PVCA9IERFVk1PREUgPyBcImh0dHA6Ly8xMjcuMC4wLjE6NTAwMC9cIiA6IFwiaHR0cHM6Ly90ZWphc3NyaW5pdmFzYW4ucHl0aG9uYW55d2hlcmUuY29tL1wiXG5cbmFzeW5jIGZ1bmN0aW9uIHNsZWVwKG1zOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvYWRfZGF0YSgpOiBQcm9taXNlPGFueT4ge1xuICAgIC8vIGluY2x1ZGUgdGltZXN0YW1wIHNvIHRoYXQgdGhpbmdzIGRvbid0IGdldCBjYWNoZWRcbiAgICBsZXQgcmVzdWx0ID0gYXdhaXQgJC5nZXRKU09OKFxuICAgICAgICBgYmFrZWRfcXVldWVzLyR7Z2xvYmFsVGhpcy51aWR9Lmpzb24/dD0ke0RhdGUubm93KCl9YCxcbiAgICApXG4gICAgcmV0dXJuIHJlc3VsdFxufVxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvZ19kYXRhKGRhdGEpOiBQcm9taXNlPGFueT4ge1xuICAgIC8vaWYgKE1PQ0tNT0RFKSB7XG4gICAgLy8gICAgY29uc29sZS5sb2coXCJsb2dnZWQgKG1vY2spXCIsIGRhdGEpXG4gICAgLy8gICAgcmV0dXJuXG4gICAgLy99XG4gICAgXG4gICAgZGF0YVtcInVybF9kYXRhXCJdID0gZ2xvYmFsVGhpcy51cmxfZGF0YVxuICAgIGNvbnNvbGUubG9nKFwiRGF0YVwiKVxuICAgIGlmICghKFwic3R1ZHlfaWRcIiBpbiBkYXRhWyd1cmxfZGF0YSddKSkge1xuICAgICAgICBkYXRhWyd1cmxfZGF0YSddW1wic3R1ZHlfaWRcIl0gPSBcImRlbW9fc3R1ZHlcIlxuICAgIH1cbiAgICBpZiAoIShcInByb2xpZmljX2lkXCIgaW4gZGF0YVsndXJsX2RhdGEnXSkpIHtcbiAgICAgICAgZGF0YVsndXJsX2RhdGEnXVtcInByb2xpZmljX2lkXCJdID0gXCJkZW1vX3VzZXJcIlxuICAgIH1cbiAgICBpZiAoIShcInNlc3Npb25faWRcIiBpbiBkYXRhWyd1cmxfZGF0YSddKSkge1xuICAgICAgICBkYXRhWyd1cmxfZGF0YSddW1wic2Vzc2lvbl9pZFwiXSA9IFwiZGVtb19zZXNzaW9uXCJcbiAgICB9XG4gICAgZGF0YVtcInVybF9kYXRhXCJdW1wicXVldWVfaWRcIl0gPSBnbG9iYWxUaGlzLnVpZFxuICAgIGNvbnNvbGUubG9nKFwibG9nZ2VkXCIsIGRhdGEpXG4gICAgY29uc29sZS5sb2coXCJMb2dnaW5nIHRvXCIsIFNFUlZFUl9MT0dfUk9PVCArIFwibG9nXCIpXG5cbiAgICB0cnkge1xuICAgICAgICBsZXQgcmVzdWx0ID0gYXdhaXQgJC5hamF4KFxuICAgICAgICAgICAgU0VSVkVSX0xPR19ST09UICsgXCJsb2dcIixcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgICAgIHByb2plY3Q6IFwidmxtLXJhdGlvbmFsZXMtc3R1ZHkvXCIrZGF0YVsndXJsX2RhdGEnXVsnc3R1ZHlfaWQnXSxcbiAgICAgICAgICAgICAgICAgICAgdWlkOiBnbG9iYWxUaGlzLnVpZCtcIl9cIitkYXRhWyd1cmxfZGF0YSddWydwcm9saWZpY19pZCddLFxuICAgICAgICAgICAgICAgICAgICBwYXlsb2FkOiBKU09OLnN0cmluZ2lmeShkYXRhKSxcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAgIH1cbiAgICAgICAgKVxuICAgICAgICBhd2FpdCBzbGVlcCgyMDAwKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdFxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS5sb2coZSlcbiAgICB9XG59IiwiaW1wb3J0IHsgREVWTU9ERSwgUkVXQVJEX0NPUlJFQ1QsIFBFTkFMVFlfSU5DT1JSRUNULCBFTkFCTEVfVElNRVIgfSBmcm9tIFwiLi9nbG9iYWxzXCJcbmV4cG9ydCB2YXIgVUlEOiBzdHJpbmdcbmV4cG9ydCB2YXIgTU9DS01PREU6IGJvb2xlYW4gPSBmYWxzZVxuaW1wb3J0IHsgbG9hZF9kYXRhLCBsb2dfZGF0YSB9IGZyb20gJy4vY29ubmVjdG9yJ1xuaW1wb3J0IHsgcGFyYW1zVG9PYmplY3QgfSBmcm9tIFwiLi91dGlsc1wiXG5cbnZhciBkYXRhOiBhbnlbXSA9IFtdXG5sZXQgcXVlc3Rpb25faSA9IC0xXG5sZXQgcXVlc3Rpb246IGFueSA9IG51bGxcbmxldCB1c2Vyc2VsZWN0aW9uX2Fuc3dlcm9ubHk6IG51bWJlciA9IC0xXG5sZXQgdXNlcnNlbGVjdGlvbl93aXRoZXhwbGFuYXRpb246IG51bWJlciA9IC0xXG5sZXQgdXNlcnNlbGVjdGlvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5OiBudW1iZXIgPSAtMVxubGV0IG51bV9jb3JyZWN0ID0gMFxubGV0IG51bV9pbmNvcnJlY3QgPSAwXG5sZXQgbnVtX3Vuc3VyZSA9IDBcblxubGV0IGJhbGFuY2UgPSAwXG5cbmxldCBpbnN0cnVjdGlvbl9pOiBudW1iZXIgPSAwXG5sZXQgY291bnRfZXhpdGVkX3BhZ2U6IG51bWJlciA9IDBcblxuZnVuY3Rpb24gYXNzZXJ0KGNvbmRpdGlvbiwgbWVzc2FnZSkge1xuICAgIGlmICghY29uZGl0aW9uKSB7XG4gICAgICAgIHRocm93IG1lc3NhZ2UgfHwgXCJBc3NlcnRpb24gZmFpbGVkXCI7XG4gICAgfVxufVxuXG5mdW5jdGlvbiByZWdpc3RlckFuc3dlck9ubHlVc2VyU2VsZWN0aW9uKHVzZXJfY2hvaWNlOiBudW1iZXIpIHtcbiAgICB1c2Vyc2VsZWN0aW9uX2Fuc3dlcm9ubHkgPSB1c2VyX2Nob2ljZVxuXG4gICAgJChcIiNidXR0b25fYW5zd2Vyb25seV91c2VydHJ1c3RzXCIpLmF0dHIoXCJkaXNhYmxlZFwiLCBcInRydWVcIilcbiAgICAkKFwiI2J1dHRvbl9hbnN3ZXJvbmx5X3VzZXJkaXN0cnVzdHNcIikuYXR0cihcImRpc2FibGVkXCIsIFwidHJ1ZVwiKVxuICAgICQoXCIjYnV0dG9uX2Fuc3dlcm9ubHlfdXNlcnVuc3VyZVwiKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJ0cnVlXCIpXG4gICAgaWYgKHVzZXJfY2hvaWNlID09IDApIHtcbiAgICAgICAgJChcIiNidXR0b25fYW5zd2Vyb25seV91c2VydHJ1c3RzXCIpLmF0dHIoXCJhY3RpdmVkZWNpc2lvblwiLCBcInRydWVcIilcbiAgICB9IGVsc2UgaWYgKHVzZXJfY2hvaWNlID09IDEpIHtcbiAgICAgICAgJChcIiNidXR0b25fYW5zd2Vyb25seV91c2VyZGlzdHJ1c3RzXCIpLmF0dHIoXCJhY3RpdmVkZWNpc2lvblwiLCBcInRydWVcIilcbiAgICB9IGVsc2UgaWYgKHVzZXJfY2hvaWNlID09IDIpIHtcbiAgICAgICAgJChcIiNidXR0b25fYW5zd2Vyb25seV91c2VydW5zdXJlXCIpLmF0dHIoXCJhY3RpdmVkZWNpc2lvblwiLCBcInRydWVcIilcbiAgICB9XG4gICAgJChcIiNhaV9leHBsYW5hdGlvbl9kaXZcIikuc2hvdygpXG59XG4vLyBFdmVudCBsaXN0ZW5lciBmb3IgdGhlIGJ1dHRvbiBjbGlja1xuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1dHRvbl9hbnN3ZXJvbmx5X3VzZXJ0cnVzdHMnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiByZWdpc3RlckFuc3dlck9ubHlVc2VyU2VsZWN0aW9uKDApKTtcbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXR0b25fYW5zd2Vyb25seV91c2VyZGlzdHJ1c3RzJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gcmVnaXN0ZXJBbnN3ZXJPbmx5VXNlclNlbGVjdGlvbigxKSk7XG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnV0dG9uX2Fuc3dlcm9ubHlfdXNlcnVuc3VyZScpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHJlZ2lzdGVyQW5zd2VyT25seVVzZXJTZWxlY3Rpb24oMikpO1xuXG5cbmZ1bmN0aW9uIHJlZ2lzdGVyV2l0aEV4cGxhbmF0aW9uVXNlclNlbGVjdGlvbih1c2VyX2Nob2ljZTogbnVtYmVyKSB7XG4gICAgdXNlcnNlbGVjdGlvbl93aXRoZXhwbGFuYXRpb24gPSB1c2VyX2Nob2ljZVxuXG4gICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9uX3VzZXJ0cnVzdHNcIikuYXR0cihcImRpc2FibGVkXCIsIFwidHJ1ZVwiKVxuICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbl91c2VyZGlzdHJ1c3RzXCIpLmF0dHIoXCJkaXNhYmxlZFwiLCBcInRydWVcIilcbiAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25fdXNlcnVuc3VyZVwiKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJ0cnVlXCIpXG4gICAgaWYgKHVzZXJfY2hvaWNlID09IDApIHtcbiAgICAgICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9uX3VzZXJ0cnVzdHNcIikuYXR0cihcImFjdGl2ZWRlY2lzaW9uXCIsIFwidHJ1ZVwiKVxuICAgIH0gZWxzZSBpZiAodXNlcl9jaG9pY2UgPT0gMSkge1xuICAgICAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25fdXNlcmRpc3RydXN0c1wiKS5hdHRyKFwiYWN0aXZlZGVjaXNpb25cIiwgXCJ0cnVlXCIpXG4gICAgfSBlbHNlIGlmICh1c2VyX2Nob2ljZSA9PSAyKSB7XG4gICAgICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbl91c2VydW5zdXJlXCIpLmF0dHIoXCJhY3RpdmVkZWNpc2lvblwiLCBcInRydWVcIilcbiAgICB9XG4gICAgJChcIiNhaV9leHBsYW5hdGlvbl9xdWFsaXR5X2RpdlwiKS5zaG93KClcbn1cblxuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1dHRvbl93aXRoZXhwbGFuYXRpb25fdXNlcnRydXN0cycpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHJlZ2lzdGVyV2l0aEV4cGxhbmF0aW9uVXNlclNlbGVjdGlvbigwKSk7XG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnV0dG9uX3dpdGhleHBsYW5hdGlvbl91c2VyZGlzdHJ1c3RzJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gcmVnaXN0ZXJXaXRoRXhwbGFuYXRpb25Vc2VyU2VsZWN0aW9uKDEpKTtcbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXR0b25fd2l0aGV4cGxhbmF0aW9uX3VzZXJ1bnN1cmUnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiByZWdpc3RlcldpdGhFeHBsYW5hdGlvblVzZXJTZWxlY3Rpb24oMikpO1xuICBcbmZ1bmN0aW9uIHJlZ2lzdGVyV2l0aEV4cGxhbmF0aW9uUXVhbGl0eVVzZXJTZWxlY3Rpb24odXNlcl9jaG9pY2U6IG51bWJlcikge1xuICAgIHVzZXJzZWxlY3Rpb25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eSA9IHVzZXJfY2hvaWNlXG5cbiAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5X3VzZXJ0cnVzdHNcIikuYXR0cihcImRpc2FibGVkXCIsIFwidHJ1ZVwiKVxuICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHlfdXNlcmRpc3RydXN0c1wiKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJ0cnVlXCIpXG4gICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eV91c2VydW5zdXJlXCIpLmF0dHIoXCJkaXNhYmxlZFwiLCBcInRydWVcIilcbiAgICBpZiAodXNlcl9jaG9pY2UgPT0gMCkge1xuICAgICAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5X3VzZXJ0cnVzdHNcIikuYXR0cihcImFjdGl2ZWRlY2lzaW9uXCIsIFwidHJ1ZVwiKVxuICAgIH0gZWxzZSBpZiAodXNlcl9jaG9pY2UgPT0gMSkge1xuICAgICAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5X3VzZXJkaXN0cnVzdHNcIikuYXR0cihcImFjdGl2ZWRlY2lzaW9uXCIsIFwidHJ1ZVwiKVxuICAgIH0gZWxzZSBpZiAodXNlcl9jaG9pY2UgPT0gMikge1xuICAgICAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5X3VzZXJ1bnN1cmVcIikuYXR0cihcImFjdGl2ZWRlY2lzaW9uXCIsIFwidHJ1ZVwiKVxuICAgIH1cbiAgICAkKFwiI2J1dHRvbl9uZXh0XCIpLnNob3coKVxuICAgICQoXCIjYnV0dG9uX25leHRcIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpXG59XG5cbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXR0b25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eV91c2VydHJ1c3RzJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gcmVnaXN0ZXJXaXRoRXhwbGFuYXRpb25RdWFsaXR5VXNlclNlbGVjdGlvbigwKSk7XG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnV0dG9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHlfdXNlcmRpc3RydXN0cycpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHJlZ2lzdGVyV2l0aEV4cGxhbmF0aW9uUXVhbGl0eVVzZXJTZWxlY3Rpb24oMSkpO1xuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1dHRvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5X3VzZXJ1bnN1cmUnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiByZWdpc3RlcldpdGhFeHBsYW5hdGlvblF1YWxpdHlVc2VyU2VsZWN0aW9uKDIpKTtcblxuXG5mdW5jdGlvbiB1cGRhdGVSZXdhcmRJbnN0cnVjdGlvbnMoKSB7XG4gICAgY29uc3QgcmV3YXJkSW5zdHJ1Y3Rpb25zID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jld2FyZF9pbnN0cnVjdGlvbnMnKTtcblxuICAgIGlmIChyZXdhcmRJbnN0cnVjdGlvbnMpIHtcbiAgICAgICAgcmV3YXJkSW5zdHJ1Y3Rpb25zLmlubmVySFRNTCA9IGBcbiAgICAgICAgICAgIElmIHlvdXIgZmluYWwgZGVjaXNpb24gaXMgY29ycmVjdCwgeW91IGdhaW4gYSByZXdhcmQgb2YgJCR7UkVXQVJEX0NPUlJFQ1QudG9GaXhlZCgyKX0uIFxuICAgICAgICAgICAgSWYgeW91ciBmaW5hbCBkZWNpc2lvbiBpcyBpbmNvcnJlY3QsIHlvdSBsb3NlICQke01hdGguYWJzKFBFTkFMVFlfSU5DT1JSRUNUKS50b0ZpeGVkKDIpfSBmcm9tIHlvdXIgcmV3YXJkLiBcbiAgICAgICAgICAgIFlvdSB3aWxsIHNlZSB5b3VyIHRvdGFsIHJld2FyZCBhdCB0aGUgZW5kIG9mIHRoZSBleHBlcmltZW50LiBcbiAgICAgICAgICAgIFlvdXIgcGF5bWVudCBpcyAkMi4wIHBsdXMgd2hhdGV2ZXIgeW91IGFjY3VtdWxhdGUgZHVyaW5nIHRoaXMgZXhwZXJpbWVudC5cbiAgICAgICAgYDtcbiAgICAgICAgLy8gSWYgeW91ciBmaW5hbCBkZWNpc2lvbiBpcyBjb3JyZWN0LCB5b3UgZ2FpbiBhIHJld2FyZCBvZiAkMC4xMC4gSWYgeW91ciBmaW5hbCBkZWNpc2lvbiBpcyBpbmNvcnJlY3QsIHlvdSBsb3NlICQwLjEwIGZyb20geW91ciByZXdhcmQuXG4gICAgICAgIC8vIFlvdSB3aWxsIHNlZSB5b3VyIHRvdGFsIHJld2FyZCBhdCB0aGUgZW5kIG9mIHRoZSBleHBlcmltZW50LiBZb3VyIHBheW1lbnQgaXMgJDIuMCBwbHVzIHdoYXRldmVyIHlvdSBhY2N1bXVsYXRlIGR1cmluZyB0aGlzIGV4cGVyaW1lbnQuXG4gICAgfVxufVxuXG5mdW5jdGlvbiBuZXh0X2luc3RydWN0aW9ucyhpbmNyZW1lbnQ6IG51bWJlcikge1xuICAgIGluc3RydWN0aW9uX2kgKz0gaW5jcmVtZW50XG5cbiAgICBpZiAoaW5zdHJ1Y3Rpb25faSA9PSAwKSB7XG4gICAgICAgICQoXCIjYnV0dG9uX2luc3RydWN0aW9uc19wcmV2XCIpLmF0dHIoXCJkaXNhYmxlZFwiLCBcInRydWVcIilcbiAgICB9IGVsc2Uge1xuICAgICAgICAkKFwiI2J1dHRvbl9pbnN0cnVjdGlvbnNfcHJldlwiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIilcbiAgICB9XG4gICAgaWYgKGluc3RydWN0aW9uX2kgPj0gNSkge1xuICAgICAgICAkKFwiI2luc3RydWN0aW9uc19hbmRfZGVjb3JhdGlvbnNcIikuc2hvdygpXG4gICAgICAgICQoXCIjYnV0dG9uX2luc3RydWN0aW9uc19uZXh0XCIpLnZhbChcIlN0YXJ0IHN0dWR5XCIpXG4gICAgfSBlbHNlIHtcbiAgICAgICAgJChcIiNpbnN0cnVjdGlvbnNfYW5kX2RlY29yYXRpb25zXCIpLmhpZGUoKVxuICAgICAgICAkKFwiI2J1dHRvbl9pbnN0cnVjdGlvbnNfbmV4dFwiKS52YWwoXCJOZXh0XCIpXG4gICAgfVxuICAgIGlmIChpbnN0cnVjdGlvbl9pID09IDYpIHtcbiAgICAgICAgJChcIiNpbnN0cnVjdGlvbnNfYW5kX2RlY29yYXRpb25zXCIpLnNob3coKVxuICAgICAgICAkKFwiI21haW5fYm94X2luc3RydWN0aW9uc1wiKS5oaWRlKClcbiAgICAgICAgJChcIiNtYWluX2JveF9leHBlcmltZW50XCIpLnNob3coKVxuICAgICAgICBuZXh0X3F1ZXN0aW9uKClcbiAgICB9XG5cbiAgICAkKFwiI21haW5fYm94X2luc3RydWN0aW9uc1wiKS5jaGlsZHJlbihcIjpub3QoaW5wdXQpXCIpLmVhY2goKF8sIGVsKSA9PiB7XG4gICAgICAgICQoZWwpLmhpZGUoKVxuICAgIH0pXG4gICAgJChgI2luc3RydWN0aW9uc18ke2luc3RydWN0aW9uX2l9YCkuc2hvdygpXG59XG4kKFwiI2J1dHRvbl9pbnN0cnVjdGlvbnNfbmV4dFwiKS5vbihcImNsaWNrXCIsICgpID0+IG5leHRfaW5zdHJ1Y3Rpb25zKCsxKSlcbiQoXCIjYnV0dG9uX2luc3RydWN0aW9uc19wcmV2XCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4gbmV4dF9pbnN0cnVjdGlvbnMoLTEpKVxuXG4kKFwiI2J1dHRvbl9uZXh0XCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuXG4gICAgLy8gVXBkYXRlIHRoZSB1c2VyIGJhbGFuY2VcbiAgICBsZXQgb2xkX2JhbGFuY2UgPSBiYWxhbmNlXG4gICAgdXBkYXRlX2JhbGFuY2UoKVxuXG4gICAgaWYgKHF1ZXN0aW9uX2kgIT0gLTEpIHtcbiAgICAgICAgbGV0IGxvZ2dlZF9kYXRhID0ge1xuICAgICAgICAgICAgXCJxdWVzdGlvbl9pXCI6IHF1ZXN0aW9uX2ksXG4gICAgICAgICAgICBcInVzZXJfc2VsZWN0aW9uc1wiOiB7XG4gICAgICAgICAgICAgICAgXCJhbnN3ZXJvbmx5XCI6IHVzZXJzZWxlY3Rpb25fYW5zd2Vyb25seSxcbiAgICAgICAgICAgICAgICBcIndpdGhleHBsYW5hdGlvblwiOiB1c2Vyc2VsZWN0aW9uX3dpdGhleHBsYW5hdGlvbixcbiAgICAgICAgICAgICAgICBcIndpdGhleHBsYW5hdGlvbnF1YWxpdHlcIjogdXNlcnNlbGVjdGlvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJ1c2VyX2lzX2NvcnJlY3RcIjoge1xuICAgICAgICAgICAgICAgIFwiYW5zd2Vyb25seVwiOiBpc191c2VyX2NvcnJlY3QodXNlcnNlbGVjdGlvbl9hbnN3ZXJvbmx5KSxcbiAgICAgICAgICAgICAgICBcIndpdGhleHBsYW5hdGlvblwiOiBpc191c2VyX2NvcnJlY3QodXNlcnNlbGVjdGlvbl93aXRoZXhwbGFuYXRpb24pLFxuICAgICAgICAgICAgICAgIFwid2l0aGV4cGxhbmF0aW9ucXVhbGl0eVwiOiBpc191c2VyX2NvcnJlY3QodXNlcnNlbGVjdGlvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5KVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwiYmFsYW5jZVwiOiB7XG4gICAgICAgICAgICAgICAgXCJvbGRcIjogb2xkX2JhbGFuY2UsXG4gICAgICAgICAgICAgICAgXCJuZXdcIjogYmFsYW5jZVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgbG9nZ2VkX2RhdGFbJ3F1ZXN0aW9uJ10gPSBxdWVzdGlvblxuICAgICAgICBsb2dnZWRfZGF0YVsnY291bnRfZXhpdGVkX3BhZ2UnXSA9IGNvdW50X2V4aXRlZF9wYWdlXG4gICAgICAgIGxvZ19kYXRhKGxvZ2dlZF9kYXRhKVxuICAgICAgICBjb3VudF9leGl0ZWRfcGFnZSA9IDBcbiAgICB9XG4gICAgXG5cbiAgICBuZXh0X3F1ZXN0aW9uKClcbn0pO1xuXG5cbmZ1bmN0aW9uIGlzX3VzZXJfY29ycmVjdChzZWxlY3Rpb24pIHtcbiAgICBpZiAoc2VsZWN0aW9uICE9IDIpIHtcbiAgICAgICAgbGV0IGNvcnJlY3Rfc2VsZWN0aW9uID0gMSAtIHF1ZXN0aW9uW1wicHJlZGljdGlvbl9pc19jb3JyZWN0XCJdIC8vIDAgaWYgQUkgaXMgY29ycmVjdCwgMSBpZiBpbmNvcnJlY3RcbiAgICAgICAgcmV0dXJuIHNlbGVjdGlvbiA9PSBjb3JyZWN0X3NlbGVjdGlvbiA/IDEgOiAwXG4gICAgfVxuICAgIHJldHVybiAtMVxufVxuXG5mdW5jdGlvbiB1cGRhdGVfYmFsYW5jZSgpIHtcbiAgICBpZiAodXNlcnNlbGVjdGlvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5ICE9IDIpIHtcbiAgICAgICAgbGV0IGNvcnJlY3Rfc2VsZWN0aW9uID0gMSAtIHF1ZXN0aW9uW1wicHJlZGljdGlvbl9pc19jb3JyZWN0XCJdIC8vIDAgaWYgQUkgaXMgY29ycmVjdCwgMSBpZiBpbmNvcnJlY3RcbiAgICAgICAgaWYgKHVzZXJzZWxlY3Rpb25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eSA9PSBjb3JyZWN0X3NlbGVjdGlvbikge1xuICAgICAgICAgICAgYmFsYW5jZSArPSBSRVdBUkRfQ09SUkVDVDtcbiAgICAgICAgICAgIG51bV9jb3JyZWN0ICs9IDE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBiYWxhbmNlICs9IFBFTkFMVFlfSU5DT1JSRUNUO1xuICAgICAgICAgICAgbnVtX2luY29ycmVjdCArPSAxO1xuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgbnVtX3Vuc3VyZSArPSAxO1xuICAgIH1cbn1cblxuLy8gVG8gZW5zdXJlIGJhbGFuY2UgaXMgbm9uLW5lZ2F0aXZlXG5mdW5jdGlvbiBmaW5hbGl6ZV9iYWxhbmNlKCkge1xuICAgIGJhbGFuY2UgPSBNYXRoLm1heCgwLCBiYWxhbmNlKTtcbiAgICByZXR1cm4gYmFsYW5jZTtcbn1cblxubGV0IGFjdGl2ZVRpbWVyOiBSZXR1cm5UeXBlPHR5cGVvZiBzZXRJbnRlcnZhbD4gfCBudWxsID0gbnVsbDsgLy8gVGltZXIgaW50ZXJ2YWxcblxuZnVuY3Rpb24gc3RhcnRUaW1lcihkdXJhdGlvbiwgc3RlcERpdiwgYnV0dG9ucywgY2FsbGJhY2spIHtcbiAgICBpZiAoIUVOQUJMRV9USU1FUikge1xuICAgICAgICAvLyBJZiB0aGUgdGltZXIgaXMgZGlzYWJsZWQsIGVuYWJsZSB0aGUgYnV0dG9ucyBpbW1lZGlhdGVseVxuICAgICAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IGJ1dHRvbi5yZW1vdmVBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKSk7XG4gICAgICAgIGlmIChjYWxsYmFjaykgY2FsbGJhY2soKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIENsZWFyIGFueSBleGlzdGluZyB0aW1lciB0byBwcmV2ZW50IG11bHRpcGxlIGludGVydmFsc1xuICAgIGlmIChhY3RpdmVUaW1lcikge1xuICAgICAgICBjbGVhckludGVydmFsKGFjdGl2ZVRpbWVyKTtcbiAgICAgICAgYWN0aXZlVGltZXIgPSBudWxsO1xuICAgIH1cblxuICAgIC8vIERpc2FibGUgYnV0dG9uc1xuICAgIGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gYnV0dG9uLnNldEF0dHJpYnV0ZShcImRpc2FibGVkXCIsIFwidHJ1ZVwiKSk7XG4gICAgXG4gICAgLy8gU2hvdyB0aW1lciB2aXN1YWxseVxuICAgIGxldCB0aW1lckRpc3BsYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICB0aW1lckRpc3BsYXkuaWQgPSBgdGltZXJfJHtzdGVwRGl2LmlkfWA7XG4gICAgdGltZXJEaXNwbGF5LnN0eWxlLmZvbnRXZWlnaHQgPSAnYm9sZCc7XG4gICAgdGltZXJEaXNwbGF5LnN0eWxlLm1hcmdpblRvcCA9ICcxMHB4JztcbiAgICBzdGVwRGl2LmFwcGVuZENoaWxkKHRpbWVyRGlzcGxheSk7XG5cbiAgICBsZXQgcmVtYWluaW5nVGltZSA9IGR1cmF0aW9uO1xuXG4gICAgLy8gSW5pdGlhbCBkaXNwbGF5XG4gICAgdGltZXJEaXNwbGF5LnRleHRDb250ZW50ID0gYFBsZWFzZSB3YWl0ICR7cmVtYWluaW5nVGltZX0gc2Vjb25kKHMpIGJlZm9yZSBtYWtpbmcgeW91ciBzZWxlY3Rpb24uYDtcblxuICAgIGFjdGl2ZVRpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICByZW1haW5pbmdUaW1lLS07XG4gICAgICAgIGlmIChyZW1haW5pbmdUaW1lID49IDApIHtcbiAgICAgICAgICAgIHRpbWVyRGlzcGxheS50ZXh0Q29udGVudCA9IGBQbGVhc2Ugd2FpdCAke3JlbWFpbmluZ1RpbWV9IHNlY29uZChzKSBiZWZvcmUgbWFraW5nIHlvdXIgc2VsZWN0aW9uLmA7XG4gICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgIGlmIChhY3RpdmVUaW1lciAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoYWN0aXZlVGltZXIpOyAvLyBTdG9wIHRoZSB0aW1lclxuICAgICAgICAgICAgICAgIGFjdGl2ZVRpbWVyID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGFjdGl2ZVRpbWVyID0gbnVsbDtcblxuICAgICAgICAgICAgLy8gUmVtb3ZlIHRpbWVyIGRpc3BsYXlcbiAgICAgICAgICAgIHN0ZXBEaXYucmVtb3ZlQ2hpbGQodGltZXJEaXNwbGF5KTtcblxuICAgICAgICAgICAgLy8gRW5hYmxlIGJ1dHRvbnNcbiAgICAgICAgICAgIGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gYnV0dG9uLnJlbW92ZUF0dHJpYnV0ZShcImRpc2FibGVkXCIpKTtcblxuICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjaygpO1xuICAgICAgICB9XG4gICAgfSwgMTAwMCk7XG59XG5cbi8vIFdoZW4gdGhlIHVzZXIgc3dpdGNoZXMgdGFicyBvciBtaW5pbWl6ZXMgdGhlIHdpbmRvdywgcGF1c2UgdGhlIHRpbWVyXG5kb2N1bWVudC5vbnZpc2liaWxpdHljaGFuZ2UgPSAoKSA9PiB7XG4gICAgaWYgKGRvY3VtZW50LmhpZGRlbikge1xuICAgICAgICBjb25zb2xlLmxvZyhcIldpbmRvdyBsb3N0IGZvY3VzLlwiKTtcbiAgICAgICAgaWYgKGFjdGl2ZVRpbWVyICE9PSBudWxsKSB7XG4gICAgICAgICAgICBjbGVhckludGVydmFsKGFjdGl2ZVRpbWVyKTsgLy8gUGF1c2UgdGhlIHRpbWVyXG4gICAgICAgICAgICBhY3RpdmVUaW1lciA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBIYW5kbGUgbG9naWMgd2hlbiB0aGUgdXNlciByZXR1cm5zXG4gICAgICAgIGNvbnNvbGUubG9nKFwiV2luZG93IHJlZ2FpbmVkIGZvY3VzLlwiKTtcbiAgICB9XG59O1xuXG4vLyBGaXJzdCBzdGVwOiBlbmZvcmNlIGEgNS1zZWNvbmQgd2FpdFxuZnVuY3Rpb24gc2V0dXBGaXJzdFN0ZXAoZXhwbGFuYXRpb25UZXh0KSB7XG4gICAgY29uc3QgZmlyc3RTdGVwRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FpX2Fuc3dlcl9kaXYnKTtcbiAgICBjb25zdCBidXR0b25zID0gW1xuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnV0dG9uX2Fuc3dlcm9ubHlfdXNlcnRydXN0cycpLFxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnV0dG9uX2Fuc3dlcm9ubHlfdXNlcmRpc3RydXN0cycpLFxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnV0dG9uX2Fuc3dlcm9ubHlfdXNlcnVuc3VyZScpXG4gICAgXTtcblxuICAgIGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gYnV0dG9uPy5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUZpcnN0U3RlcENsaWNrKSk7IC8vIFJlbW92ZSBvbGQgbGlzdGVuZXJzXG4gICAgYnV0dG9ucy5mb3JFYWNoKGJ1dHRvbiA9PiBidXR0b24/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlRmlyc3RTdGVwQ2xpY2spKTsgLy8gQWRkIG5ldyBvbmVzXG5cbiAgICBmdW5jdGlvbiBoYW5kbGVGaXJzdFN0ZXBDbGljaygpIHtcbiAgICAgICAgYnV0dG9ucy5mb3JFYWNoKGJ1dHRvbiA9PiBidXR0b24/LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlRmlyc3RTdGVwQ2xpY2spKTsgLy8gQ2xlYW51cFxuICAgICAgICBzZXR1cFNlY29uZFN0ZXAoZXhwbGFuYXRpb25UZXh0KTtcbiAgICB9XG5cbiAgICAkKFwiI2FpX2Fuc3dlcl9kaXZcIikuc2hvdygpO1xuICAgIHN0YXJ0VGltZXIoNSwgZmlyc3RTdGVwRGl2LCBidXR0b25zLCBudWxsKTtcbiAgICAvLyAkKFwiI2FpX2Fuc3dlcl9kaXZcIikuc2hvdygpOyAvLyBTaG93IHRoZSBmaXJzdCBzdGVwXG4gICAgLy8gc3RhcnRUaW1lcig1LCBmaXJzdFN0ZXBEaXYsIGJ1dHRvbnMsICgpID0+IHtcbiAgICAvLyAgICAgLy8gQnV0dG9ucyBhcmUgbm93IGVuYWJsZWQ7IHVzZXIgbXVzdCBjbGljayBvbmUgdG8gcHJvY2VlZFxuICAgIC8vICAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IHtcbiAgICAvLyAgICAgICAgIGJ1dHRvbj8uYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAvLyAgICAgICAgICAgICAnY2xpY2snLFxuICAgIC8vICAgICAgICAgICAgICgpID0+IHtcbiAgICAvLyAgICAgICAgICAgICAgICAgc2V0dXBTZWNvbmRTdGVwKGV4cGxhbmF0aW9uVGV4dCk7IC8vIFByb2NlZWQgdG8gdGhlIHNlY29uZCBzdGVwIGFmdGVyIGJ1dHRvbiBjbGlja1xuICAgIC8vICAgICAgICAgICAgIH0sXG4gICAgLy8gICAgICAgICAgICAgeyBvbmNlOiB0cnVlIH0gLy8gRW5zdXJlIHRoZSBldmVudCBsaXN0ZW5lciBpcyBleGVjdXRlZCBvbmx5IG9uY2VcbiAgICAvLyAgICAgICAgICk7XG4gICAgLy8gICAgIH0pO1xuICAgIC8vIH0pO1xufVxuXG4vLyBTZWNvbmQgc3RlcCB0aW1lciAoZHluYW1pYyBiYXNlZCBvbiByZWFkaW5nIHRpbWUpXG5mdW5jdGlvbiBzZXR1cFNlY29uZFN0ZXAoZXhwbGFuYXRpb25UZXh0KSB7XG4gICAgY29uc3Qgc2Vjb25kU3RlcERpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhaV9leHBsYW5hdGlvbl9kaXYnKTtcbiAgICBjb25zdCB3b3JkcyA9IGV4cGxhbmF0aW9uVGV4dC5zcGxpdCgnICcpLmxlbmd0aDtcbiAgICBjb25zdCByZWFkaW5nVGltZSA9IE1hdGgubWF4KE1hdGguY2VpbCgzICsgKHdvcmRzIC8gMjM4KSAqIDYwKSwgNSk7XG5cbiAgICBjb25zdCBidXR0b25zID0gW1xuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnV0dG9uX3dpdGhleHBsYW5hdGlvbl91c2VydHJ1c3RzJyksXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXR0b25fd2l0aGV4cGxhbmF0aW9uX3VzZXJkaXN0cnVzdHMnKSxcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1dHRvbl93aXRoZXhwbGFuYXRpb25fdXNlcnVuc3VyZScpXG4gICAgXTtcblxuICAgIC8vIFJlbW92ZSBvbGQgZXZlbnQgbGlzdGVuZXJzXG4gICAgYnV0dG9ucy5mb3JFYWNoKGJ1dHRvbiA9PiBidXR0b24/LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlU2Vjb25kU3RlcENsaWNrKSk7XG5cbiAgICAvLyBBZGQgbmV3IGV2ZW50IGxpc3RlbmVyc1xuICAgIGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gYnV0dG9uPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZVNlY29uZFN0ZXBDbGljaykpO1xuXG4gICAgZnVuY3Rpb24gaGFuZGxlU2Vjb25kU3RlcENsaWNrKCkge1xuICAgICAgICAvLyBDbGVhbnVwOiByZW1vdmUgZXZlbnQgbGlzdGVuZXJzXG4gICAgICAgIGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gYnV0dG9uPy5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZVNlY29uZFN0ZXBDbGljaykpO1xuICAgICAgICBzZXR1cFRoaXJkU3RlcChleHBsYW5hdGlvblRleHQpO1xuICAgIH1cblxuICAgICQoXCIjYWlfZXhwbGFuYXRpb25fZGl2XCIpLnNob3coKTsgLy8gU2hvdyB0aGUgc2Vjb25kIHN0ZXBcbiAgICBzdGFydFRpbWVyKHJlYWRpbmdUaW1lLCBzZWNvbmRTdGVwRGl2LCBidXR0b25zLCBudWxsKTsgLy8gU3RhcnQgdGltZXJcbn1cblxuLy8gVGhpcmQgc3RlcCB0aW1lciAoNSBzZWNvbmRzKVxuZnVuY3Rpb24gc2V0dXBUaGlyZFN0ZXAoZXhwbGFuYXRpb25UZXh0KSB7XG4gICAgY29uc3QgdGhpcmRTdGVwRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FpX2V4cGxhbmF0aW9uX3F1YWxpdHlfZGl2Jyk7XG4gICAgY29uc3QgYnV0dG9ucyA9IFtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1dHRvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5X3VzZXJ0cnVzdHMnKSxcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1dHRvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5X3VzZXJkaXN0cnVzdHMnKSxcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1dHRvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5X3VzZXJ1bnN1cmUnKVxuICAgIF07XG5cbiAgICAvLyBSZW1vdmUgb2xkIGV2ZW50IGxpc3RlbmVyc1xuICAgIGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gYnV0dG9uPy5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZVRoaXJkU3RlcENsaWNrKSk7XG5cbiAgICAvLyBBZGQgbmV3IGV2ZW50IGxpc3RlbmVyc1xuICAgIGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gYnV0dG9uPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZVRoaXJkU3RlcENsaWNrKSk7XG5cbiAgICBmdW5jdGlvbiBoYW5kbGVUaGlyZFN0ZXBDbGljaygpIHtcbiAgICAgICAgLy8gQ2xlYW51cDogcmVtb3ZlIGV2ZW50IGxpc3RlbmVyc1xuICAgICAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IGJ1dHRvbj8ucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVUaGlyZFN0ZXBDbGljaykpO1xuICAgICAgICAkKFwiI2J1dHRvbl9uZXh0XCIpLnNob3coKTsgLy8gRW5hYmxlIHRoZSBuZXh0IHF1ZXN0aW9uIGJ1dHRvblxuICAgIH1cblxuICAgICQoXCIjYWlfZXhwbGFuYXRpb25fcXVhbGl0eV9kaXZcIikuc2hvdygpOyAvLyBTaG93IHRoZSB0aGlyZCBzdGVwXG4gICAgc3RhcnRUaW1lcig1LCB0aGlyZFN0ZXBEaXYsIGJ1dHRvbnMsIG51bGwpOyAvLyBTdGFydCB0aW1lclxufVxuXG5mdW5jdGlvbiBuZXh0X3F1ZXN0aW9uKCkge1xuICAgIC8vIFJlc2V0IHRpbWVycyBhbmQgc3RhdGVcbiAgICBpZiAoYWN0aXZlVGltZXIpIHtcbiAgICAgICAgY2xlYXJJbnRlcnZhbChhY3RpdmVUaW1lcik7XG4gICAgICAgIGFjdGl2ZVRpbWVyID0gbnVsbDtcbiAgICB9XG5cbiAgICAvLyByZXN0b3JlIHByZXZpb3VzIHN0YXRlIG9mIFVJXG4gICAgJChcIiNidXR0b25fcmVhZHl0b2Fuc3dlclwiKS5yZW1vdmVBdHRyKFwiYWN0aXZlZGVjaXNpb25cIilcbiAgICAkKFwiI2J1dHRvbl9yZWFkeXRvYW5zd2VyXCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKVxuICAgICQoXCIjYnV0dG9uX3JlYWR5dG9hbnN3ZXJcIikuc2hvdygpXG5cbiAgICAkKFwiI2J1dHRvbl9hbnN3ZXJvbmx5X3VzZXJ0cnVzdHNcIikucmVtb3ZlQXR0cihcImFjdGl2ZWRlY2lzaW9uXCIpXG4gICAgJChcIiNidXR0b25fYW5zd2Vyb25seV91c2VydHJ1c3RzXCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKVxuICAgICQoXCIjYnV0dG9uX2Fuc3dlcm9ubHlfdXNlcmRpc3RydXN0c1wiKS5yZW1vdmVBdHRyKFwiYWN0aXZlZGVjaXNpb25cIilcbiAgICAkKFwiI2J1dHRvbl9hbnN3ZXJvbmx5X3VzZXJkaXN0cnVzdHNcIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpXG4gICAgJChcIiNidXR0b25fYW5zd2Vyb25seV91c2VydW5zdXJlXCIpLnJlbW92ZUF0dHIoXCJhY3RpdmVkZWNpc2lvblwiKVxuICAgICQoXCIjYnV0dG9uX2Fuc3dlcm9ubHlfdXNlcnVuc3VyZVwiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIilcblxuICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbl91c2VydHJ1c3RzXCIpLnJlbW92ZUF0dHIoXCJhY3RpdmVkZWNpc2lvblwiKVxuICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbl91c2VydHJ1c3RzXCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKVxuICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbl91c2VyZGlzdHJ1c3RzXCIpLnJlbW92ZUF0dHIoXCJhY3RpdmVkZWNpc2lvblwiKVxuICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbl91c2VyZGlzdHJ1c3RzXCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKVxuICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbl91c2VydW5zdXJlXCIpLnJlbW92ZUF0dHIoXCJhY3RpdmVkZWNpc2lvblwiKVxuICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbl91c2VydW5zdXJlXCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKVxuXG4gICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eV91c2VydHJ1c3RzXCIpLnJlbW92ZUF0dHIoXCJhY3RpdmVkZWNpc2lvblwiKVxuICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHlfdXNlcnRydXN0c1wiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIilcbiAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5X3VzZXJkaXN0cnVzdHNcIikucmVtb3ZlQXR0cihcImFjdGl2ZWRlY2lzaW9uXCIpXG4gICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eV91c2VyZGlzdHJ1c3RzXCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKVxuICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHlfdXNlcnVuc3VyZVwiKS5yZW1vdmVBdHRyKFwiYWN0aXZlZGVjaXNpb25cIilcbiAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5X3VzZXJ1bnN1cmVcIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpXG5cbiAgICAkKFwiI2FpX2V4cGxhbmF0aW9uX2RpdlwiKS5oaWRlKClcbiAgICAkKFwiI2FpX2V4cGxhbmF0aW9uX3F1YWxpdHlfZGl2XCIpLmhpZGUoKVxuICAgIFxuXG4gICAgJChcIiNidXR0b25fbmV4dFwiKS5oaWRlKClcbiAgICAkKCcjYnV0dG9uX3F1aXQnKS5oaWRlKClcbiAgICAvLyQoXCIjcmFuZ2VfdmFsXCIpLnZhbCh1c2VyX3RydXN0KVxuXG4gICAgcXVlc3Rpb25faSArPSAxXG4gICAgaWYgKHF1ZXN0aW9uX2kgPj0gZGF0YS5sZW5ndGgpIHtcbiAgICAgICAgJChcIiNtYWluX2JveF9leHBlcmltZW50XCIpLmhpZGUoKVxuICAgICAgICBiYWxhbmNlID0gZmluYWxpemVfYmFsYW5jZSgpXG5cbiAgICAgICAgbGV0IHJld2FyZF90ZXh0ID0gYFlvdXIgdG90YWwgcmV3YXJkIGlzIDxiPiQke2JhbGFuY2UudG9GaXhlZCgyKX0gKyAkMjwvYj4uYFxuICAgICAgICByZXdhcmRfdGV4dCArPSBgPGJyPllvdSBhbnN3ZXJlZCBhIHRvdGFsIG9mICR7cXVlc3Rpb25faX0gcXVlc3Rpb25zOiAke251bV9jb3JyZWN0fSBjb3JyZWN0LCAke251bV9pbmNvcnJlY3R9IGluY29ycmVjdCwgJHtudW1fdW5zdXJlfSB1bnN1cmUuYFxuICAgICAgICBpZiAoTU9DS01PREUpIHtcbiAgICAgICAgICAgICQoJyNyZXdhcmRfYm94X21vY2snKS5odG1sKHJld2FyZF90ZXh0KVxuICAgICAgICAgICAgJCgnI3Jld2FyZF9ib3hfbW9jaycpLnNob3coKVxuICAgICAgICAgICAgJChcIiNtYWluX2JveF9lbmRfbW9ja1wiKS5zaG93KClcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICQoJyNyZXdhcmRfYm94JykuaHRtbChyZXdhcmRfdGV4dClcbiAgICAgICAgICAgICQoJyNyZXdhcmRfYm94Jykuc2hvdygpXG4gICAgICAgICAgICAkKFwiI21haW5fYm94X2VuZFwiKS5zaG93KClcbiAgICAgICAgfVxuICAgICAgICByZXR1cm5cbiAgICB9XG5cbiAgICBxdWVzdGlvbiA9IGRhdGFbcXVlc3Rpb25faV1cblxuICAgIGNvbnN0IHF1ZXN0aW9uVGV4dCA9IHF1ZXN0aW9uIVtcInF1ZXN0aW9uXCJdO1xuICAgIGNvbnN0IHVwZGF0ZWRRdWVzdGlvblRleHQgPSBxdWVzdGlvblRleHQucmVwbGFjZShcIkNob2ljZXM6XCIsIFwiPGJyPjxiPkNob2ljZXM6PC9iPlwiKTtcbiAgICAkKFwiI3F1ZXN0aW9uX3NwYW5cIikuaHRtbCh1cGRhdGVkUXVlc3Rpb25UZXh0KTtcblxuICAgICQoXCIjYWlfcHJlZGljdGlvbl9zcGFuXCIpLmh0bWwocXVlc3Rpb24hW1wicHJlZGljdGVkX2Fuc3dlclwiXSlcbiAgICAkKFwiI2FpX2V4cGxhbmF0aW9uX3NwYW5cIikuaHRtbChxdWVzdGlvbiFbXCJnZW5lcmF0ZWRfcmF0aW9uYWxlXCJdKVxuXG4gICAgbGV0IHZpc3VhbF9maWRlbGl0eV9jb25mID0gTWF0aC5yb3VuZChxdWVzdGlvbiFbXCJ2aXN1YWxfZmlkZWxpdHlcIl0gKiAxMDApXG4gICAgJChcIiNleHBsYW5hdGlvbl9maWRlbGl0eV9zcGFuXCIpLmh0bWwoYCR7dmlzdWFsX2ZpZGVsaXR5X2NvbmZ9JWApXG4gICAgbGV0IHZpc3VhbF9jb250cmFzdGl2ZW5lc3NfY29uZiA9IE1hdGgucm91bmQocXVlc3Rpb24hW1wiY29udHJhc3RpdmVuZXNzXCJdICogMTAwKVxuICAgICQoXCIjZXhwbGFuYXRpb25fY29udHJhc3RpdmVuZXNzX3NwYW5cIikuaHRtbChgJHt2aXN1YWxfY29udHJhc3RpdmVuZXNzX2NvbmZ9JWApXG5cblxuICAgIC8vIHNldCBiZXQgdmFsdWUgcmF0aW9cbiAgICAvL2lmKHF1ZXN0aW9uLmhhc093blByb3BlcnR5KFwicmV3YXJkX3JhdGlvXCIpKSB7XG4gICAgLy8gICAgbGV0IFtyYXRpbzEsIHJhdGlvMl0gPSBxdWVzdGlvbltcInJld2FyZF9yYXRpb1wiXVxuICAgIC8vICAgIHJhdGlvMSA9IE51bWJlcihyYXRpbzEpXG4gICAgLy8gICAgcmF0aW8yID0gTnVtYmVyKHJhdGlvMilcbiAgICAvLyAgICBiZXRfdmFsX3JhdGlvID0gcmF0aW8xL3JhdGlvMlxuICAgIC8vfSBlbHNlIHtcbiAgICAvLyAgICBiZXRfdmFsX3JhdGlvID0gMVxuICAgIC8vfVxuXG4gICAgLy90aW1lX3F1ZXN0aW9uX3N0YXJ0ID0gRGF0ZS5ub3coKVxuICAgICQoXCIjcHJvZ3Jlc3NcIikudGV4dChgUHJvZ3Jlc3M6ICR7cXVlc3Rpb25faSArIDF9IC8gJHtkYXRhLmxlbmd0aH1gKVxuXG4gICAgc2V0dXBGaXJzdFN0ZXAocXVlc3Rpb25bXCJnZW5lcmF0ZWRfcmF0aW9uYWxlXCJdKTtcbn1cblxuXG5cbi8vIGdldCB1c2VyIGlkIGFuZCBsb2FkIHF1ZXVlXG4vLyB0cnkgdG8gc2VlIGlmIHN0YXJ0IG92ZXJyaWRlIHdhcyBwYXNzZWRcbmNvbnN0IHVybFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMod2luZG93LmxvY2F0aW9uLnNlYXJjaCk7XG5jb25zdCBzdGFydE92ZXJyaWRlID0gdXJsUGFyYW1zLmdldCgnc3RhcnQnKTtcbmNvbnN0IFVJREZyb21VUkwgPSB1cmxQYXJhbXMuZ2V0KFwidWlkXCIpXG5nbG9iYWxUaGlzLnVybF9kYXRhID0gcGFyYW1zVG9PYmplY3QodXJsUGFyYW1zLmVudHJpZXMoKSlcblxuaWYgKGdsb2JhbFRoaXMudXJsX2RhdGFbJ3N0dWR5X2lkJ10gPT0gbnVsbCkge1xuICAgIGdsb2JhbFRoaXMudXJsX2RhdGFbJ3N0dWR5X2lkJ10gPSBcImRlbW9fc3R1ZHlcIlxufVxuaWYgKGdsb2JhbFRoaXMudXJsX2RhdGFbJ3Byb2xpZmljX2lkJ10gPT0gbnVsbCkge1xuICAgIGdsb2JhbFRoaXMudXJsX2RhdGFbJ3Byb2xpZmljX2lkJ10gPSBcImRlbW9fdXNlclwiXG59XG5pZiAoZ2xvYmFsVGhpcy51cmxfZGF0YVsnc2Vzc2lvbl9pZCddID09IG51bGwpIHtcbiAgICBnbG9iYWxUaGlzLnVybF9kYXRhWydzZXNzaW9uX2lkJ10gPSBcImRlbW9fc2Vzc2lvblwiXG59XG5cbmlmIChVSURGcm9tVVJMICE9IG51bGwpIHtcbiAgICBnbG9iYWxUaGlzLnVpZCA9IFVJREZyb21VUkwgYXMgc3RyaW5nXG4gICAgaWYgKGdsb2JhbFRoaXMudWlkID09IFwicHJvbGlmaWNfcmFuZG9tXCIpIHtcbiAgICAgICAgbGV0IHF1ZXVlX2lkID0gYCR7TWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApfWAucGFkU3RhcnQoMywgXCIwXCIpXG4gICAgICAgIGdsb2JhbFRoaXMudWlkID0gYCR7dXJsUGFyYW1zLmdldChcInByb2xpZmljX3F1ZXVlX25hbWVcIil9LyR7cXVldWVfaWR9YFxuICAgIH1cbn0gZWxzZSBpZiAoREVWTU9ERSkge1xuICAgIGdsb2JhbFRoaXMudWlkID0gXCJkZW1vXCJcbn0gZWxzZSB7XG4gICAgbGV0IFVJRF9tYXliZTogYW55ID0gbnVsbFxuICAgIHdoaWxlIChVSURfbWF5YmUgPT0gbnVsbCkge1xuICAgICAgICBVSURfbWF5YmUgPSBwcm9tcHQoXCJFbnRlciB5b3VyIHVzZXIgaWQuIFBsZWFzZSBnZXQgaW4gdG91Y2ggaWYgeW91IHdlcmUgbm90IGFzc2lnbmVkIGFuIGlkIGJ1dCB3aXNoIHRvIHBhcnRpY2lwYXRlIGluIHRoaXMgZXhwZXJpbWVudC5cIilcbiAgICB9XG4gICAgZ2xvYmFsVGhpcy51aWQgPSBVSURfbWF5YmUhXG59XG5cbi8vIHZlcnNpb24gZm9yIHBhcGVyXG5pZiAoREVWTU9ERSkge1xuICAgIE1PQ0tNT0RFID0gdHJ1ZVxufSBlbHNlIGlmIChnbG9iYWxUaGlzLnVybF9kYXRhWydzZXNzaW9uX2lkJ10uc3RhcnRzV2l0aChcImRlbW9cIikpIHtcbiAgICBNT0NLTU9ERSA9IHRydWVcbn1cblxuY29uc29sZS5sb2coXCJSdW5uaW5nIHdpdGggVUlEXCIsIGdsb2JhbFRoaXMudWlkKVxubG9hZF9kYXRhKCkuY2F0Y2goKF9lcnJvcikgPT4ge1xuICAgIC8vYWxlcnQoXCJJbnZhbGlkIHVzZXIgaWQuXCIpXG4gICAgY29uc29sZS5sb2coXCJJbnZhbGlkIHVzZXIgaWQuXCIpXG4gICAgY29uc29sZS5sb2coZ2xvYmFsVGhpcy51aWQhKVxuICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKVxufVxuKS50aGVuKChuZXdfZGF0YSkgPT4ge1xuICAgIGRhdGEgPSBuZXdfZGF0YVxuICAgIGlmIChzdGFydE92ZXJyaWRlICE9IG51bGwpIHtcbiAgICAgICAgcXVlc3Rpb25faSA9IHBhcnNlSW50KHN0YXJ0T3ZlcnJpZGUpIC0gMVxuICAgICAgICBjb25zb2xlLmxvZyhcIlN0YXJ0aW5nIGZyb21cIiwgcXVlc3Rpb25faSlcbiAgICB9XG4gICAgLy8gbmV4dF9xdWVzdGlvbigpXG4gICAgbmV4dF9pbnN0cnVjdGlvbnMoMClcbiAgICB1cGRhdGVSZXdhcmRJbnN0cnVjdGlvbnMoKTtcbiAgICAkKFwiI21haW5fYm94X2luc3RydWN0aW9uc1wiKS5zaG93KClcbiAgICAkKFwiI2luc3RydWN0aW9uc19hbmRfZGVjb3JhdGlvbnNcIikuaGlkZSgpXG59KVxuXG5jb25zb2xlLmxvZyhcIlN0YXJ0aW5nIHNlc3Npb24gd2l0aCBVSUQ6XCIsIGdsb2JhbFRoaXMudWlkISlcblxubGV0IGFsZXJ0X2FjdGl2ZSA9IGZhbHNlXG5kb2N1bWVudC5vbnZpc2liaWxpdHljaGFuZ2UgPSAoKSA9PiB7XG4gICAgaWYgKCFhbGVydF9hY3RpdmUpIHtcbiAgICAgICAgY291bnRfZXhpdGVkX3BhZ2UgKz0gMVxuICAgICAgICBhbGVydF9hY3RpdmUgPSB0cnVlXG4gICAgICAgIC8vaWYgKCEoZ2xvYmFsVGhpcy51aWQhLnN0YXJ0c1dpdGgoXCJkZW1vXCIpKSkge1xuICAgICAgICAvLyAgICBhbGVydChcIlBsZWFzZSBkb24ndCBsZWF2ZSB0aGUgcGFnZS4gSWYgeW91IGRvIHNvIGFnYWluLCB3ZSBtYXkgcmVzdHJpY3QgcGF5aW5nIHlvdS5cIilcbiAgICAgICAgLy99XG4gICAgICAgIGFsZXJ0X2FjdGl2ZSA9IGZhbHNlXG4gICAgfVxufSIsImRlY2xhcmUgbGV0IF9ERVZNT0RFOiBib29sZWFuXG5leHBvcnQgdmFyIERFVk1PREUgPSBfREVWTU9ERVxuZXhwb3J0IGNvbnN0IEVOQUJMRV9USU1FUiA9IHRydWU7ICAvLyBTZXQgdG8gYGZhbHNlYCB0byBkaXNhYmxlIHRoZSB0aW1lciBmb3IgZGVidWdnaW5nXG5cbmV4cG9ydCBjb25zdCBSRVdBUkRfQ09SUkVDVCA9IDAuMTsgLy8gUmV3YXJkIGZvciBhIGNvcnJlY3QgYW5zd2VyXG5leHBvcnQgY29uc3QgUEVOQUxUWV9JTkNPUlJFQ1QgPSAtMC4xOyAvLyBQZW5hbHR5IGZvciBhbiBpbmNvcnJlY3QgYW5zd2VyIiwiZnVuY3Rpb24gcGFyYW1zVG9PYmplY3QoZW50cmllcykge1xuICBjb25zdCByZXN1bHQgPSB7fVxuICAvLyBlYWNoICdlbnRyeScgaXMgYSBba2V5LCB2YWx1ZV0gdHVwcGxlXG4gIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIGVudHJpZXMpIHtcbiAgICByZXN1bHRba2V5XSA9IHZhbHVlO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmV4cG9ydCB7IHBhcmFtc1RvT2JqZWN0IH0iXSwibmFtZXMiOlsiU0VSVkVSX0xPR19ST09UIiwiTU9DS01PREUiLCJkYXRhIiwicXVlc3Rpb25faSIsInF1ZXN0aW9uIiwidXNlcnNlbGVjdGlvbl9hbnN3ZXJvbmx5IiwidXNlcnNlbGVjdGlvbl93aXRoZXhwbGFuYXRpb24iLCJ1c2Vyc2VsZWN0aW9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHkiLCJudW1fY29ycmVjdCIsIm51bV9pbmNvcnJlY3QiLCJudW1fdW5zdXJlIiwiYmFsYW5jZSIsImluc3RydWN0aW9uX2kiLCJjb3VudF9leGl0ZWRfcGFnZSIsInJlZ2lzdGVyQW5zd2VyT25seVVzZXJTZWxlY3Rpb24iLCJ1c2VyX2Nob2ljZSIsIiQiLCJhdHRyIiwic2hvdyIsInJlZ2lzdGVyV2l0aEV4cGxhbmF0aW9uVXNlclNlbGVjdGlvbiIsInJlZ2lzdGVyV2l0aEV4cGxhbmF0aW9uUXVhbGl0eVVzZXJTZWxlY3Rpb24iLCJyZW1vdmVBdHRyIiwibmV4dF9pbnN0cnVjdGlvbnMiLCJpbmNyZW1lbnQiLCJ2YWwiLCJoaWRlIiwibmV4dF9xdWVzdGlvbiIsImNoaWxkcmVuIiwiZWFjaCIsIl8iLCJlbCIsImlzX3VzZXJfY29ycmVjdCIsInNlbGVjdGlvbiIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJhZGRFdmVudExpc3RlbmVyIiwib24iLCJvbGRfYmFsYW5jZSIsImNvcnJlY3Rfc2VsZWN0aW9uIiwidXBkYXRlX2JhbGFuY2UiLCJsb2dnZWRfZGF0YSIsImFzeW5jIiwiZ2xvYmFsVGhpcyIsInVybF9kYXRhIiwiY29uc29sZSIsImxvZyIsInVpZCIsInJlc3VsdCIsImFqYXgiLCJKU09OIiwic3RyaW5naWZ5IiwicHJvamVjdCIsInBheWxvYWQiLCJ0eXBlIiwiY29udGVudFR5cGUiLCJQcm9taXNlIiwicmVzb2x2ZSIsInNldFRpbWVvdXQiLCJzbGVlcCIsImUiLCJsb2dfZGF0YSIsImFjdGl2ZVRpbWVyIiwic3RhcnRUaW1lciIsImR1cmF0aW9uIiwic3RlcERpdiIsImJ1dHRvbnMiLCJjYWxsYmFjayIsImNsZWFySW50ZXJ2YWwiLCJmb3JFYWNoIiwiYnV0dG9uIiwic2V0QXR0cmlidXRlIiwidGltZXJEaXNwbGF5IiwiY3JlYXRlRWxlbWVudCIsImlkIiwic3R5bGUiLCJmb250V2VpZ2h0IiwibWFyZ2luVG9wIiwiYXBwZW5kQ2hpbGQiLCJyZW1haW5pbmdUaW1lIiwidGV4dENvbnRlbnQiLCJzZXRJbnRlcnZhbCIsInJlbW92ZUNoaWxkIiwicmVtb3ZlQXR0cmlidXRlIiwibGVuZ3RoIiwiTWF0aCIsIm1heCIsInJld2FyZF90ZXh0IiwidG9GaXhlZCIsImh0bWwiLCJ1cGRhdGVkUXVlc3Rpb25UZXh0IiwicmVwbGFjZSIsInZpc3VhbF9maWRlbGl0eV9jb25mIiwicm91bmQiLCJ2aXN1YWxfY29udHJhc3RpdmVuZXNzX2NvbmYiLCJ0ZXh0IiwiZXhwbGFuYXRpb25UZXh0IiwiZmlyc3RTdGVwRGl2IiwiaGFuZGxlRmlyc3RTdGVwQ2xpY2siLCJyZW1vdmVFdmVudExpc3RlbmVyIiwic2Vjb25kU3RlcERpdiIsIndvcmRzIiwic3BsaXQiLCJyZWFkaW5nVGltZSIsImNlaWwiLCJoYW5kbGVTZWNvbmRTdGVwQ2xpY2siLCJ0aGlyZFN0ZXBEaXYiLCJoYW5kbGVUaGlyZFN0ZXBDbGljayIsInNldHVwVGhpcmRTdGVwIiwic2V0dXBTZWNvbmRTdGVwIiwic2V0dXBGaXJzdFN0ZXAiLCJvbnZpc2liaWxpdHljaGFuZ2UiLCJoaWRkZW4iLCJ1cmxQYXJhbXMiLCJVUkxTZWFyY2hQYXJhbXMiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsInNlYXJjaCIsInN0YXJ0T3ZlcnJpZGUiLCJnZXQiLCJVSURGcm9tVVJMIiwiZW50cmllcyIsImtleSIsInZhbHVlIiwicGFyYW1zVG9PYmplY3QiLCJxdWV1ZV9pZCIsImZsb29yIiwicmFuZG9tIiwicGFkU3RhcnQiLCJVSURfbWF5YmUiLCJwcm9tcHQiLCJzdGFydHNXaXRoIiwiZ2V0SlNPTiIsIkRhdGUiLCJub3ciLCJsb2FkX2RhdGEiLCJjYXRjaCIsIl9lcnJvciIsInJlbG9hZCIsInRoZW4iLCJuZXdfZGF0YSIsInBhcnNlSW50IiwicmV3YXJkSW5zdHJ1Y3Rpb25zIiwiaW5uZXJIVE1MIiwiYWJzIiwidXBkYXRlUmV3YXJkSW5zdHJ1Y3Rpb25zIiwiYWxlcnRfYWN0aXZlIl0sInNvdXJjZVJvb3QiOiIifQ==