(()=>{"use strict";let t="https://tejassrinivasan.pythonanywhere.com/";var e=!1,n=[];let i=-1,o=null,r=-1,a=-1,s=-1,u=0,l=0,c=0,d=0,_=0,h=0;function b(t){r=t,$("#button_answeronly_usertrusts").attr("disabled","true"),$("#button_answeronly_userdistrusts").attr("disabled","true"),$("#button_answeronly_userunsure").attr("disabled","true"),0==t?$("#button_answeronly_usertrusts").attr("activedecision","true"):1==t?$("#button_answeronly_userdistrusts").attr("activedecision","true"):2==t&&$("#button_answeronly_userunsure").attr("activedecision","true"),$("#ai_explanation_div").show()}function m(t){a=t,$("#button_withexplanation_usertrusts").attr("disabled","true"),$("#button_withexplanation_userdistrusts").attr("disabled","true"),$("#button_withexplanation_userunsure").attr("disabled","true"),0==t?$("#button_withexplanation_usertrusts").attr("activedecision","true"):1==t?$("#button_withexplanation_userdistrusts").attr("activedecision","true"):2==t&&$("#button_withexplanation_userunsure").attr("activedecision","true"),"vf_only"!=k&&"vf_contr_both"!=k||("numeric"==T&&$("#vf_numeric_div").show(),"descriptive"==T&&$("#vf_descriptive_div").show()),"contr_only"!=k&&"vf_contr_both"!=k||("numeric"==T&&$("#contr_numeric_div").show(),"descriptive"==T&&$("#contr_descriptive_div").show()),"single_numeric"==k&&(function(t){if(!t)throw"qualityFormat must be numeric for single_numeric"}("numeric"==T),$("#single_numeric_div").show())}function v(t){s=t,$("#button_withexplanationquality_usertrusts").attr("disabled","true"),$("#button_withexplanationquality_userdistrusts").attr("disabled","true"),$("#button_withexplanationquality_userunsure").attr("disabled","true"),0==t?$("#button_withexplanationquality_usertrusts").attr("activedecision","true"):1==t?$("#button_withexplanationquality_userdistrusts").attr("activedecision","true"):2==t&&$("#button_withexplanationquality_userunsure").attr("activedecision","true"),$("#button_next").show(),$("#button_next").removeAttr("disabled")}function y(t){_+=t,0==_?$("#button_instructions_prev").attr("disabled","true"):$("#button_instructions_prev").removeAttr("disabled"),_>=5?($("#instructions_and_decorations").show(),$("#button_instructions_next").val("Start study")):($("#instructions_and_decorations").hide(),$("#button_instructions_next").val("Next")),6==_&&($("#instructions_and_decorations").show(),$("#main_box_instructions").hide(),$("#main_box_experiment").show(),x()),$("#main_box_instructions").children(":not(input)").each(((t,e)=>{$(e).hide()})),$(`#instructions_${_}`).show(),4==_&&($("#instructions_4").children("div").each(((t,e)=>{$(e).hide()})),"vf_contr_both"==k&&"numeric"==T&&$("#instruction_vf_contr_both_numeric").show(),"vf_only"==k&&"numeric"==T&&$("#instruction_vf_numeric").show(),"contr_only"==k&&"numeric"==T&&$("#instruction_contr_numeric").show(),"single_numeric"==k&&"numeric"==T&&$("#instruction_single_numeric").show(),"vf_contr_both"==k&&"descriptive"==T&&$("#instruction_vf_contr_both_descriptive").show(),"vf_only"==k&&"descriptive"==T&&$("#instruction_vf_descriptive").show(),"contr_only"==k&&"descriptive"==T&&$("#instruction_contr_descriptive").show())}function p(t){let e=0;return e=2==t?0:t==1-o.prediction_is_correct?1:-1,e}function w(t){return 2!=t?t==1-o.prediction_is_correct?1:0:-1}document.getElementById("button_answeronly_usertrusts")?.addEventListener("click",(()=>b(0))),document.getElementById("button_answeronly_userdistrusts")?.addEventListener("click",(()=>b(1))),document.getElementById("button_answeronly_userunsure")?.addEventListener("click",(()=>b(2))),document.getElementById("button_withexplanation_usertrusts")?.addEventListener("click",(()=>m(0))),document.getElementById("button_withexplanation_userdistrusts")?.addEventListener("click",(()=>m(1))),document.getElementById("button_withexplanation_userunsure")?.addEventListener("click",(()=>m(2))),document.getElementById("button_withexplanationquality_usertrusts")?.addEventListener("click",(()=>v(0))),document.getElementById("button_withexplanationquality_userdistrusts")?.addEventListener("click",(()=>v(1))),document.getElementById("button_withexplanationquality_userunsure")?.addEventListener("click",(()=>v(2))),$("#button_instructions_next").on("click",(()=>y(1))),$("#button_instructions_prev").on("click",(()=>y(-1))),$("#button_next").on("click",(()=>{let e=d;if(function(){if(2!=s){let t=1-o.prediction_is_correct;s==t?(d+=.1,u+=1):(d+=-.1,l+=1)}else c+=1}(),-1!=i){let n={question_i:i,user_selections:{answeronly:r,withexplanation:a,withexplanationquality:s},user_is_correct:{answeronly:w(r),withexplanation:w(a),withexplanationquality:w(s)},utility_of_explanation:p(a)-p(r),utility_of_quality_metrics:p(s)-p(a),balance:{old:e,new:d}};n.question=o,n.count_exited_page=h,async function(e){e.url_data=globalThis.url_data,console.log("Data"),"study_id"in e.url_data||(e.url_data.study_id="demo_study"),"prolific_id"in e.url_data||(e.url_data.prolific_id="demo_user"),"session_id"in e.url_data||(e.url_data.session_id="demo_session"),e.url_data.queue_id=globalThis.uid,console.log("logged",e),console.log("Logging to",t+"log");try{let n=await $.ajax(t+"log",{data:JSON.stringify({project:"vlm-rationales-study/"+e.url_data.study_id,uid:globalThis.uid.replace("/","_")+"_"+e.url_data.prolific_id,payload:JSON.stringify(e)}),type:"POST",contentType:"application/json"});return await async function(){return new Promise((t=>setTimeout(t,2e3)))}(),n}catch(t){console.log(t)}}(n),h=0}x()}));let g=null;function f(t,e,n,i){g&&(clearInterval(g),g=null),n.forEach((t=>t.setAttribute("disabled","true")));let o=document.createElement("div");o.id=`timer_${e.id}`,o.style.fontWeight="bold",o.style.marginTop="10px",e.appendChild(o);let r=t;o.textContent=`Please wait ${r} second(s) before making your selection.`,g=setInterval((()=>{r--,r>=0?o.textContent=`Please wait ${r} second(s) before making your selection.`:(null!==g&&(clearInterval(g),g=null),g=null,e.removeChild(o),n.forEach((t=>t.removeAttribute("disabled"))),i&&i())}),1e3)}function x(){if(g&&(clearInterval(g),g=null),$("#button_readytoanswer").removeAttr("activedecision"),$("#button_readytoanswer").removeAttr("disabled"),$("#button_readytoanswer").show(),$("#button_answeronly_usertrusts").removeAttr("activedecision"),$("#button_answeronly_usertrusts").removeAttr("disabled"),$("#button_answeronly_userdistrusts").removeAttr("activedecision"),$("#button_answeronly_userdistrusts").removeAttr("disabled"),$("#button_answeronly_userunsure").removeAttr("activedecision"),$("#button_answeronly_userunsure").removeAttr("disabled"),$("#button_withexplanation_usertrusts").removeAttr("activedecision"),$("#button_withexplanation_usertrusts").removeAttr("disabled"),$("#button_withexplanation_userdistrusts").removeAttr("activedecision"),$("#button_withexplanation_userdistrusts").removeAttr("disabled"),$("#button_withexplanation_userunsure").removeAttr("activedecision"),$("#button_withexplanation_userunsure").removeAttr("disabled"),$("#button_withexplanationquality_usertrusts").removeAttr("activedecision"),$("#button_withexplanationquality_usertrusts").removeAttr("disabled"),$("#button_withexplanationquality_userdistrusts").removeAttr("activedecision"),$("#button_withexplanationquality_userdistrusts").removeAttr("disabled"),$("#button_withexplanationquality_userunsure").removeAttr("activedecision"),$("#button_withexplanationquality_userunsure").removeAttr("disabled"),$("#ai_explanation_div").hide(),$("#ai_explanation_quality_div").hide(),$("#button_next").hide(),$("#button_quit").hide(),i+=1,i>=n.length){$("#main_box_experiment").hide(),d=Math.max(0,d);let t=`Your total reward is <b>$${d.toFixed(2)} + $2</b>.`;return t+=`<br>You answered a total of ${i} questions: ${u} correct, ${l} incorrect, ${c} unsure.`,void(e?($("#reward_box_mock").html(t),$("#reward_box_mock").show(),$("#main_box_end_mock").show()):($("#reward_box").html(t),$("#reward_box").show(),$("#main_box_end").show()))}o=n[i];const t=o.question.replace("Choices:","<br><b>Choices:</b>");$("#question_span").html(t),$("#ai_prediction_span").html(o.predicted_answer),$("#ai_explanation_span").html(o.generated_rationale);let r=Math.round(100*o.visual_fidelity);$("#explanation_fidelity_numeric_span").html(`${r}%`);let a=Math.round(100*o.contrastiveness);$("#explanation_contrastiveness_numeric_span").html(`${a}%`);let s=Math.round((o.visual_fidelity+o.contrastiveness)/2*100);$("#explanation_single_numeric_span").html(`${s}%`);let _="";""==o.reason_vf_correct?_+="<b>There are no details about the image in the explanation that are likely correct.</b>":(_+="<b>Details in the explanation that are likely correct:</b>",_+=o.reason_vf_correct.replace(/<br> -/g,"<br> ✅")),""==o.reason_vf_incorrect?_+="<br><br><b>There are no details about the image in the explanation that are likely incorrect.</b>":(_+="<br><br><b>Details in the explanation that are likely NOT correct:</b>",_+=o.reason_vf_incorrect.replace(/<br> -/g,"<br> ❌")),$("#explanation_fidelity_descriptive_span").html(_);let h="";""==o.reason_contr?h+="<b>None of the other choices are likely correct, based on the explanation.</b>":(h+="<b>Other choices that could be correct, based on the explanation: </b>",h+=o.reason_contr),$("#explanation_contrastiveness_descriptive_span").html(h),$("#progress").text(`Progress: ${i+1} / ${n.length}`),function(t){const e=document.getElementById("ai_answer_div"),n=[document.getElementById("button_answeronly_usertrusts"),document.getElementById("button_answeronly_userdistrusts"),document.getElementById("button_answeronly_userunsure")];function i(){n.forEach((t=>t?.removeEventListener("click",i))),function(t){const e=document.getElementById("ai_explanation_div"),n=t.split(" ").length,i=Math.max(Math.ceil(3+n/238*60),5),o=[document.getElementById("button_withexplanation_usertrusts"),document.getElementById("button_withexplanation_userdistrusts"),document.getElementById("button_withexplanation_userunsure")];function r(){o.forEach((t=>t?.removeEventListener("click",r))),function(){const t=document.getElementById("ai_explanation_quality_div"),e=[document.getElementById("button_withexplanationquality_usertrusts"),document.getElementById("button_withexplanationquality_userdistrusts"),document.getElementById("button_withexplanationquality_userunsure")];function n(){e.forEach((t=>t?.removeEventListener("click",n))),$("#button_next").show()}e.forEach((t=>t?.removeEventListener("click",n))),e.forEach((t=>t?.addEventListener("click",n))),$("#ai_explanation_quality_div").show(),f(5,t,e,null)}()}o.forEach((t=>t?.removeEventListener("click",r))),o.forEach((t=>t?.addEventListener("click",r))),$("#ai_explanation_div").show(),f(i,e,o,null)}(t)}n.forEach((t=>t?.removeEventListener("click",i))),n.forEach((t=>t?.addEventListener("click",i))),$("#ai_answer_div").show(),f(5,e,n,null)}(o.generated_rationale)}document.onvisibilitychange=()=>{document.hidden?(console.log("Window lost focus."),null!==g&&(clearInterval(g),g=null)):console.log("Window regained focus.")};const E=new URLSearchParams(window.location.search),q=E.get("start"),I=E.get("uid");if(globalThis.url_data=function(t){const e={};for(const[n,i]of t)e[n]=i;return e}(E.entries()),null==globalThis.url_data.study_id&&(globalThis.url_data.study_id="demo_study"),null==globalThis.url_data.prolific_id&&(globalThis.url_data.prolific_id="demo_user"),null==globalThis.url_data.session_id&&(globalThis.url_data.session_id="demo_session"),null!=I){if(globalThis.uid=I,"prolific_random"==globalThis.uid){let t=`${Math.floor(10*Math.random())}`.padStart(3,"0");globalThis.uid=`${E.get("prolific_queue_name")}/${t}`}}else{let t=null;for(;null==t;)t=prompt("Enter your user id. Please get in touch if you were not assigned an id but wish to participate in this experiment.");globalThis.uid=t}let k=E.get("quality_type");if(null==k&&(k="vf_contr_both"),!["vf_only","contr_only","vf_contr_both","single_numeric"].includes(k))throw new Error("Invalid quality type");let T=E.get("quality_format");if(null==T&&(T="numeric"),!["numeric","descriptive"].includes(T))throw new Error("Invalid quality format");globalThis.url_data.explanation_quality_params={quality_type:k,quality_format:T},console.log("Quality params",globalThis.url_data.explanation_quality_params),globalThis.url_data.session_id.startsWith("demo")&&(e=!0),console.log("Running with UID",globalThis.uid),async function(){return await $.getJSON(`baked_queues/${globalThis.uid}.json?t=${Date.now()}`)}().catch((t=>{console.log("Invalid user id."),console.log(globalThis.uid),window.location.reload()})).then((t=>{n=t,null!=q&&(i=parseInt(q)-1,console.log("Starting from",i)),y(0),function(){const t=document.getElementById("reward_instructions");t&&(t.innerHTML=`\n            If your final decision is correct, you gain a reward of $${.1.toFixed(2)}. \n            If your final decision is incorrect, you lose $${Math.abs(-.1).toFixed(2)} from your reward. \n            You will see your total reward at the end of the experiment. \n            Your payment is $2.0 plus whatever you accumulate during this experiment.\n        `)}(),$("#main_box_instructions").show(),$("#instructions_and_decorations").hide()})),console.log("Starting session with UID:",globalThis.uid);let A=!1;document.onvisibilitychange=()=>{A||(h+=1,A=!0,globalThis.uid.startsWith("demo")||alert("Please don't leave the page. If you do so again, we may restrict paying you."),A=!1)}})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RS9DZ0gsSUFDQUEsRUFBbUJDLFVBQVksMEVDeEdULEdEeUd3RDNELFFBQVEsb0VBQ2pDSCxLQUFLK0QsS0N6R2pDLElEeUd3RDVELFFBQVEsb01BT2pHLENBNGNJNkQsR0FDQTNJLEVBQUUsMEJBQTBCRSxPQUM1QkYsRUFBRSxpQ0FBaUNhLE1BQU0sSUE2QjdDcUIsUUFBUUMsSUFBSSw2QkFBOEJILFdBQVdJLEtBRXJELElBQUl3RyxHQUFlLEVBQ25CckgsU0FBU2dGLG1CQUFxQixLQUNyQnFDLElBQ0QvSSxHQUFxQixFQUNyQitJLEdBQWUsRUFDVDVHLFdBQVdJLElBQUt5RixXQUFXLFNBRTlCZ0IsTUFBTSxnRkFFVEQsR0FBZSxFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL2Nvbm5lY3Rvci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvbWFpbi50cyIsIndlYnBhY2s6Ly8vLi9zcmMvZ2xvYmFscy50cyIsIndlYnBhY2s6Ly8vLi9zcmMvdXRpbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgREVWTU9ERSB9IGZyb20gJy4vZ2xvYmFscydcbmltcG9ydCB7IE1PQ0tNT0RFIH0gZnJvbSAnLi9tYWluJ1xuXG5sZXQgU0VSVkVSX0xPR19ST09UID0gREVWTU9ERSA/IFwiaHR0cDovLzEyNy4wLjAuMTo1MDAwL1wiIDogXCJodHRwczovL3RlamFzc3Jpbml2YXNhbi5weXRob25hbnl3aGVyZS5jb20vXCJcblxuYXN5bmMgZnVuY3Rpb24gc2xlZXAobXM6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCBtcykpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbG9hZF9kYXRhKCk6IFByb21pc2U8YW55PiB7XG4gICAgLy8gaW5jbHVkZSB0aW1lc3RhbXAgc28gdGhhdCB0aGluZ3MgZG9uJ3QgZ2V0IGNhY2hlZFxuICAgIGxldCByZXN1bHQgPSBhd2FpdCAkLmdldEpTT04oXG4gICAgICAgIGBiYWtlZF9xdWV1ZXMvJHtnbG9iYWxUaGlzLnVpZH0uanNvbj90PSR7RGF0ZS5ub3coKX1gLFxuICAgIClcbiAgICByZXR1cm4gcmVzdWx0XG59XG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbG9nX2RhdGEoZGF0YSk6IFByb21pc2U8YW55PiB7XG4gICAgLy9pZiAoTU9DS01PREUpIHtcbiAgICAvLyAgICBjb25zb2xlLmxvZyhcImxvZ2dlZCAobW9jaylcIiwgZGF0YSlcbiAgICAvLyAgICByZXR1cm5cbiAgICAvL31cbiAgICBcbiAgICBkYXRhW1widXJsX2RhdGFcIl0gPSBnbG9iYWxUaGlzLnVybF9kYXRhXG4gICAgY29uc29sZS5sb2coXCJEYXRhXCIpXG4gICAgaWYgKCEoXCJzdHVkeV9pZFwiIGluIGRhdGFbJ3VybF9kYXRhJ10pKSB7XG4gICAgICAgIGRhdGFbJ3VybF9kYXRhJ11bXCJzdHVkeV9pZFwiXSA9IFwiZGVtb19zdHVkeVwiXG4gICAgfVxuICAgIGlmICghKFwicHJvbGlmaWNfaWRcIiBpbiBkYXRhWyd1cmxfZGF0YSddKSkge1xuICAgICAgICBkYXRhWyd1cmxfZGF0YSddW1wicHJvbGlmaWNfaWRcIl0gPSBcImRlbW9fdXNlclwiXG4gICAgfVxuICAgIGlmICghKFwic2Vzc2lvbl9pZFwiIGluIGRhdGFbJ3VybF9kYXRhJ10pKSB7XG4gICAgICAgIGRhdGFbJ3VybF9kYXRhJ11bXCJzZXNzaW9uX2lkXCJdID0gXCJkZW1vX3Nlc3Npb25cIlxuICAgIH1cbiAgICBkYXRhW1widXJsX2RhdGFcIl1bXCJxdWV1ZV9pZFwiXSA9IGdsb2JhbFRoaXMudWlkXG4gICAgY29uc29sZS5sb2coXCJsb2dnZWRcIiwgZGF0YSlcbiAgICBjb25zb2xlLmxvZyhcIkxvZ2dpbmcgdG9cIiwgU0VSVkVSX0xPR19ST09UICsgXCJsb2dcIilcblxuICAgIHRyeSB7XG4gICAgICAgIGxldCByZXN1bHQgPSBhd2FpdCAkLmFqYXgoXG4gICAgICAgICAgICBTRVJWRVJfTE9HX1JPT1QgKyBcImxvZ1wiLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgICAgICAgcHJvamVjdDogXCJ2bG0tcmF0aW9uYWxlcy1zdHVkeS9cIitkYXRhWyd1cmxfZGF0YSddWydzdHVkeV9pZCddLFxuICAgICAgICAgICAgICAgICAgICB1aWQ6IGdsb2JhbFRoaXMudWlkLnJlcGxhY2UoXCIvXCIsIFwiX1wiKSArIFwiX1wiICsgZGF0YVsndXJsX2RhdGEnXVsncHJvbGlmaWNfaWQnXSxcbiAgICAgICAgICAgICAgICAgICAgcGF5bG9hZDogSlNPTi5zdHJpbmdpZnkoZGF0YSksXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICB9XG4gICAgICAgIClcbiAgICAgICAgYXdhaXQgc2xlZXAoMjAwMCk7XG4gICAgICAgIHJldHVybiByZXN1bHRcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGUpXG4gICAgfVxufSIsImltcG9ydCB7IERFVk1PREUsIFJFV0FSRF9DT1JSRUNULCBQRU5BTFRZX0lOQ09SUkVDVCwgRU5BQkxFX1RJTUVSIH0gZnJvbSBcIi4vZ2xvYmFsc1wiXG5leHBvcnQgdmFyIFVJRDogc3RyaW5nXG5leHBvcnQgdmFyIE1PQ0tNT0RFOiBib29sZWFuID0gZmFsc2VcbmltcG9ydCB7IGxvYWRfZGF0YSwgbG9nX2RhdGEgfSBmcm9tICcuL2Nvbm5lY3RvcidcbmltcG9ydCB7IHBhcmFtc1RvT2JqZWN0IH0gZnJvbSBcIi4vdXRpbHNcIlxuXG52YXIgZGF0YTogYW55W10gPSBbXVxubGV0IHF1ZXN0aW9uX2kgPSAtMVxubGV0IHF1ZXN0aW9uOiBhbnkgPSBudWxsXG5sZXQgdXNlcnNlbGVjdGlvbl9hbnN3ZXJvbmx5OiBudW1iZXIgPSAtMVxubGV0IHVzZXJzZWxlY3Rpb25fd2l0aGV4cGxhbmF0aW9uOiBudW1iZXIgPSAtMVxubGV0IHVzZXJzZWxlY3Rpb25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eTogbnVtYmVyID0gLTFcbmxldCBudW1fY29ycmVjdCA9IDBcbmxldCBudW1faW5jb3JyZWN0ID0gMFxubGV0IG51bV91bnN1cmUgPSAwXG5cbmxldCBiYWxhbmNlID0gMFxuXG5sZXQgaW5zdHJ1Y3Rpb25faTogbnVtYmVyID0gMFxubGV0IGNvdW50X2V4aXRlZF9wYWdlOiBudW1iZXIgPSAwXG5cbmZ1bmN0aW9uIGFzc2VydChjb25kaXRpb24sIG1lc3NhZ2UpIHtcbiAgICBpZiAoIWNvbmRpdGlvbikge1xuICAgICAgICB0aHJvdyBtZXNzYWdlIHx8IFwiQXNzZXJ0aW9uIGZhaWxlZFwiO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gcmVnaXN0ZXJBbnN3ZXJPbmx5VXNlclNlbGVjdGlvbih1c2VyX2Nob2ljZTogbnVtYmVyKSB7XG4gICAgdXNlcnNlbGVjdGlvbl9hbnN3ZXJvbmx5ID0gdXNlcl9jaG9pY2VcblxuICAgICQoXCIjYnV0dG9uX2Fuc3dlcm9ubHlfdXNlcnRydXN0c1wiKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJ0cnVlXCIpXG4gICAgJChcIiNidXR0b25fYW5zd2Vyb25seV91c2VyZGlzdHJ1c3RzXCIpLmF0dHIoXCJkaXNhYmxlZFwiLCBcInRydWVcIilcbiAgICAkKFwiI2J1dHRvbl9hbnN3ZXJvbmx5X3VzZXJ1bnN1cmVcIikuYXR0cihcImRpc2FibGVkXCIsIFwidHJ1ZVwiKVxuICAgIGlmICh1c2VyX2Nob2ljZSA9PSAwKSB7XG4gICAgICAgICQoXCIjYnV0dG9uX2Fuc3dlcm9ubHlfdXNlcnRydXN0c1wiKS5hdHRyKFwiYWN0aXZlZGVjaXNpb25cIiwgXCJ0cnVlXCIpXG4gICAgfSBlbHNlIGlmICh1c2VyX2Nob2ljZSA9PSAxKSB7XG4gICAgICAgICQoXCIjYnV0dG9uX2Fuc3dlcm9ubHlfdXNlcmRpc3RydXN0c1wiKS5hdHRyKFwiYWN0aXZlZGVjaXNpb25cIiwgXCJ0cnVlXCIpXG4gICAgfSBlbHNlIGlmICh1c2VyX2Nob2ljZSA9PSAyKSB7XG4gICAgICAgICQoXCIjYnV0dG9uX2Fuc3dlcm9ubHlfdXNlcnVuc3VyZVwiKS5hdHRyKFwiYWN0aXZlZGVjaXNpb25cIiwgXCJ0cnVlXCIpXG4gICAgfVxuICAgICQoXCIjYWlfZXhwbGFuYXRpb25fZGl2XCIpLnNob3coKVxufVxuLy8gRXZlbnQgbGlzdGVuZXIgZm9yIHRoZSBidXR0b24gY2xpY2tcbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXR0b25fYW5zd2Vyb25seV91c2VydHJ1c3RzJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gcmVnaXN0ZXJBbnN3ZXJPbmx5VXNlclNlbGVjdGlvbigwKSk7XG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnV0dG9uX2Fuc3dlcm9ubHlfdXNlcmRpc3RydXN0cycpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHJlZ2lzdGVyQW5zd2VyT25seVVzZXJTZWxlY3Rpb24oMSkpO1xuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1dHRvbl9hbnN3ZXJvbmx5X3VzZXJ1bnN1cmUnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiByZWdpc3RlckFuc3dlck9ubHlVc2VyU2VsZWN0aW9uKDIpKTtcblxuXG5mdW5jdGlvbiByZWdpc3RlcldpdGhFeHBsYW5hdGlvblVzZXJTZWxlY3Rpb24odXNlcl9jaG9pY2U6IG51bWJlcikge1xuICAgIHVzZXJzZWxlY3Rpb25fd2l0aGV4cGxhbmF0aW9uID0gdXNlcl9jaG9pY2VcblxuICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbl91c2VydHJ1c3RzXCIpLmF0dHIoXCJkaXNhYmxlZFwiLCBcInRydWVcIilcbiAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25fdXNlcmRpc3RydXN0c1wiKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJ0cnVlXCIpXG4gICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9uX3VzZXJ1bnN1cmVcIikuYXR0cihcImRpc2FibGVkXCIsIFwidHJ1ZVwiKVxuICAgIGlmICh1c2VyX2Nob2ljZSA9PSAwKSB7XG4gICAgICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbl91c2VydHJ1c3RzXCIpLmF0dHIoXCJhY3RpdmVkZWNpc2lvblwiLCBcInRydWVcIilcbiAgICB9IGVsc2UgaWYgKHVzZXJfY2hvaWNlID09IDEpIHtcbiAgICAgICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9uX3VzZXJkaXN0cnVzdHNcIikuYXR0cihcImFjdGl2ZWRlY2lzaW9uXCIsIFwidHJ1ZVwiKVxuICAgIH0gZWxzZSBpZiAodXNlcl9jaG9pY2UgPT0gMikge1xuICAgICAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25fdXNlcnVuc3VyZVwiKS5hdHRyKFwiYWN0aXZlZGVjaXNpb25cIiwgXCJ0cnVlXCIpXG4gICAgfVxuICAgIHNob3dRdWFsaXR5RGl2KClcbn1cblxuZnVuY3Rpb24gc2hvd1F1YWxpdHlEaXYoKSB7XG4gICAgaWYgKHF1YWxpdHlUeXBlID09IFwidmZfb25seVwiIHx8IHF1YWxpdHlUeXBlID09IFwidmZfY29udHJfYm90aFwiKSB7XG4gICAgICAgIGlmIChxdWFsaXR5Rm9ybWF0ID09IFwibnVtZXJpY1wiKSB7ICQoXCIjdmZfbnVtZXJpY19kaXZcIikuc2hvdygpIH1cbiAgICAgICAgaWYgKHF1YWxpdHlGb3JtYXQgPT0gXCJkZXNjcmlwdGl2ZVwiKSB7ICQoXCIjdmZfZGVzY3JpcHRpdmVfZGl2XCIpLnNob3coKSB9XG4gICAgfVxuICAgIGlmIChxdWFsaXR5VHlwZSA9PSBcImNvbnRyX29ubHlcIiB8fCBxdWFsaXR5VHlwZSA9PSBcInZmX2NvbnRyX2JvdGhcIikge1xuICAgICAgICBpZiAocXVhbGl0eUZvcm1hdCA9PSBcIm51bWVyaWNcIikgeyAkKFwiI2NvbnRyX251bWVyaWNfZGl2XCIpLnNob3coKSB9XG4gICAgICAgIGlmIChxdWFsaXR5Rm9ybWF0ID09IFwiZGVzY3JpcHRpdmVcIikgeyAkKFwiI2NvbnRyX2Rlc2NyaXB0aXZlX2RpdlwiKS5zaG93KCkgfVxuICAgIH1cbiAgICBpZiAocXVhbGl0eVR5cGUgPT0gXCJzaW5nbGVfbnVtZXJpY1wiKSB7XG4gICAgICAgIGFzc2VydCAocXVhbGl0eUZvcm1hdCA9PSBcIm51bWVyaWNcIiwgXCJxdWFsaXR5Rm9ybWF0IG11c3QgYmUgbnVtZXJpYyBmb3Igc2luZ2xlX251bWVyaWNcIilcbiAgICAgICAgJChcIiNzaW5nbGVfbnVtZXJpY19kaXZcIikuc2hvdygpXG4gICAgfVxufVxuXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnV0dG9uX3dpdGhleHBsYW5hdGlvbl91c2VydHJ1c3RzJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gcmVnaXN0ZXJXaXRoRXhwbGFuYXRpb25Vc2VyU2VsZWN0aW9uKDApKTtcbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXR0b25fd2l0aGV4cGxhbmF0aW9uX3VzZXJkaXN0cnVzdHMnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiByZWdpc3RlcldpdGhFeHBsYW5hdGlvblVzZXJTZWxlY3Rpb24oMSkpO1xuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1dHRvbl93aXRoZXhwbGFuYXRpb25fdXNlcnVuc3VyZScpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHJlZ2lzdGVyV2l0aEV4cGxhbmF0aW9uVXNlclNlbGVjdGlvbigyKSk7XG4gIFxuZnVuY3Rpb24gcmVnaXN0ZXJXaXRoRXhwbGFuYXRpb25RdWFsaXR5VXNlclNlbGVjdGlvbih1c2VyX2Nob2ljZTogbnVtYmVyKSB7XG4gICAgdXNlcnNlbGVjdGlvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5ID0gdXNlcl9jaG9pY2VcblxuICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHlfdXNlcnRydXN0c1wiKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJ0cnVlXCIpXG4gICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eV91c2VyZGlzdHJ1c3RzXCIpLmF0dHIoXCJkaXNhYmxlZFwiLCBcInRydWVcIilcbiAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5X3VzZXJ1bnN1cmVcIikuYXR0cihcImRpc2FibGVkXCIsIFwidHJ1ZVwiKVxuICAgIGlmICh1c2VyX2Nob2ljZSA9PSAwKSB7XG4gICAgICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHlfdXNlcnRydXN0c1wiKS5hdHRyKFwiYWN0aXZlZGVjaXNpb25cIiwgXCJ0cnVlXCIpXG4gICAgfSBlbHNlIGlmICh1c2VyX2Nob2ljZSA9PSAxKSB7XG4gICAgICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHlfdXNlcmRpc3RydXN0c1wiKS5hdHRyKFwiYWN0aXZlZGVjaXNpb25cIiwgXCJ0cnVlXCIpXG4gICAgfSBlbHNlIGlmICh1c2VyX2Nob2ljZSA9PSAyKSB7XG4gICAgICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHlfdXNlcnVuc3VyZVwiKS5hdHRyKFwiYWN0aXZlZGVjaXNpb25cIiwgXCJ0cnVlXCIpXG4gICAgfVxuICAgICQoXCIjYnV0dG9uX25leHRcIikuc2hvdygpXG4gICAgJChcIiNidXR0b25fbmV4dFwiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIilcbn1cblxuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1dHRvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5X3VzZXJ0cnVzdHMnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiByZWdpc3RlcldpdGhFeHBsYW5hdGlvblF1YWxpdHlVc2VyU2VsZWN0aW9uKDApKTtcbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXR0b25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eV91c2VyZGlzdHJ1c3RzJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gcmVnaXN0ZXJXaXRoRXhwbGFuYXRpb25RdWFsaXR5VXNlclNlbGVjdGlvbigxKSk7XG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnV0dG9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHlfdXNlcnVuc3VyZScpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHJlZ2lzdGVyV2l0aEV4cGxhbmF0aW9uUXVhbGl0eVVzZXJTZWxlY3Rpb24oMikpO1xuXG5cbmZ1bmN0aW9uIHVwZGF0ZVJld2FyZEluc3RydWN0aW9ucygpIHtcbiAgICBjb25zdCByZXdhcmRJbnN0cnVjdGlvbnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV3YXJkX2luc3RydWN0aW9ucycpO1xuXG4gICAgaWYgKHJld2FyZEluc3RydWN0aW9ucykge1xuICAgICAgICByZXdhcmRJbnN0cnVjdGlvbnMuaW5uZXJIVE1MID0gYFxuICAgICAgICAgICAgSWYgeW91ciBmaW5hbCBkZWNpc2lvbiBpcyBjb3JyZWN0LCB5b3UgZ2FpbiBhIHJld2FyZCBvZiAkJHtSRVdBUkRfQ09SUkVDVC50b0ZpeGVkKDIpfS4gXG4gICAgICAgICAgICBJZiB5b3VyIGZpbmFsIGRlY2lzaW9uIGlzIGluY29ycmVjdCwgeW91IGxvc2UgJCR7TWF0aC5hYnMoUEVOQUxUWV9JTkNPUlJFQ1QpLnRvRml4ZWQoMil9IGZyb20geW91ciByZXdhcmQuIFxuICAgICAgICAgICAgWW91IHdpbGwgc2VlIHlvdXIgdG90YWwgcmV3YXJkIGF0IHRoZSBlbmQgb2YgdGhlIGV4cGVyaW1lbnQuIFxuICAgICAgICAgICAgWW91ciBwYXltZW50IGlzICQyLjAgcGx1cyB3aGF0ZXZlciB5b3UgYWNjdW11bGF0ZSBkdXJpbmcgdGhpcyBleHBlcmltZW50LlxuICAgICAgICBgO1xuICAgICAgICAvLyBJZiB5b3VyIGZpbmFsIGRlY2lzaW9uIGlzIGNvcnJlY3QsIHlvdSBnYWluIGEgcmV3YXJkIG9mICQwLjEwLiBJZiB5b3VyIGZpbmFsIGRlY2lzaW9uIGlzIGluY29ycmVjdCwgeW91IGxvc2UgJDAuMTAgZnJvbSB5b3VyIHJld2FyZC5cbiAgICAgICAgLy8gWW91IHdpbGwgc2VlIHlvdXIgdG90YWwgcmV3YXJkIGF0IHRoZSBlbmQgb2YgdGhlIGV4cGVyaW1lbnQuIFlvdXIgcGF5bWVudCBpcyAkMi4wIHBsdXMgd2hhdGV2ZXIgeW91IGFjY3VtdWxhdGUgZHVyaW5nIHRoaXMgZXhwZXJpbWVudC5cbiAgICB9XG59XG5cbmZ1bmN0aW9uIG5leHRfaW5zdHJ1Y3Rpb25zKGluY3JlbWVudDogbnVtYmVyKSB7XG4gICAgaW5zdHJ1Y3Rpb25faSArPSBpbmNyZW1lbnRcblxuICAgIGlmIChpbnN0cnVjdGlvbl9pID09IDApIHtcbiAgICAgICAgJChcIiNidXR0b25faW5zdHJ1Y3Rpb25zX3ByZXZcIikuYXR0cihcImRpc2FibGVkXCIsIFwidHJ1ZVwiKVxuICAgIH0gZWxzZSB7XG4gICAgICAgICQoXCIjYnV0dG9uX2luc3RydWN0aW9uc19wcmV2XCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKVxuICAgIH1cbiAgICBpZiAoaW5zdHJ1Y3Rpb25faSA+PSA1KSB7XG4gICAgICAgICQoXCIjaW5zdHJ1Y3Rpb25zX2FuZF9kZWNvcmF0aW9uc1wiKS5zaG93KClcbiAgICAgICAgJChcIiNidXR0b25faW5zdHJ1Y3Rpb25zX25leHRcIikudmFsKFwiU3RhcnQgc3R1ZHlcIilcbiAgICB9IGVsc2Uge1xuICAgICAgICAkKFwiI2luc3RydWN0aW9uc19hbmRfZGVjb3JhdGlvbnNcIikuaGlkZSgpXG4gICAgICAgICQoXCIjYnV0dG9uX2luc3RydWN0aW9uc19uZXh0XCIpLnZhbChcIk5leHRcIilcbiAgICB9XG4gICAgaWYgKGluc3RydWN0aW9uX2kgPT0gNikge1xuICAgICAgICAkKFwiI2luc3RydWN0aW9uc19hbmRfZGVjb3JhdGlvbnNcIikuc2hvdygpXG4gICAgICAgICQoXCIjbWFpbl9ib3hfaW5zdHJ1Y3Rpb25zXCIpLmhpZGUoKVxuICAgICAgICAkKFwiI21haW5fYm94X2V4cGVyaW1lbnRcIikuc2hvdygpXG4gICAgICAgIG5leHRfcXVlc3Rpb24oKVxuICAgIH1cblxuICAgICQoXCIjbWFpbl9ib3hfaW5zdHJ1Y3Rpb25zXCIpLmNoaWxkcmVuKFwiOm5vdChpbnB1dClcIikuZWFjaCgoXywgZWwpID0+IHtcbiAgICAgICAgJChlbCkuaGlkZSgpXG4gICAgfSlcbiAgICAkKGAjaW5zdHJ1Y3Rpb25zXyR7aW5zdHJ1Y3Rpb25faX1gKS5zaG93KClcbiAgICBpZiAoaW5zdHJ1Y3Rpb25faSA9PSA0KSB7XG4gICAgICAgICQoXCIjaW5zdHJ1Y3Rpb25zXzRcIikuY2hpbGRyZW4oXCJkaXZcIikuZWFjaCgoXywgZWwpID0+IHsgJChlbCkuaGlkZSgpICB9KVxuICAgICAgICBpZiAocXVhbGl0eVR5cGUgPT0gXCJ2Zl9jb250cl9ib3RoXCIgJiYgcXVhbGl0eUZvcm1hdCA9PSBcIm51bWVyaWNcIikgeyAkKFwiI2luc3RydWN0aW9uX3ZmX2NvbnRyX2JvdGhfbnVtZXJpY1wiKS5zaG93KCkgfVxuICAgICAgICBpZiAocXVhbGl0eVR5cGUgPT0gXCJ2Zl9vbmx5XCIgJiYgcXVhbGl0eUZvcm1hdCA9PSBcIm51bWVyaWNcIikgeyAkKFwiI2luc3RydWN0aW9uX3ZmX251bWVyaWNcIikuc2hvdygpIH1cbiAgICAgICAgaWYgKHF1YWxpdHlUeXBlID09IFwiY29udHJfb25seVwiICYmIHF1YWxpdHlGb3JtYXQgPT0gXCJudW1lcmljXCIpIHsgJChcIiNpbnN0cnVjdGlvbl9jb250cl9udW1lcmljXCIpLnNob3coKSB9XG4gICAgICAgIGlmIChxdWFsaXR5VHlwZSA9PSBcInNpbmdsZV9udW1lcmljXCIgJiYgcXVhbGl0eUZvcm1hdCA9PSBcIm51bWVyaWNcIikgeyAkKFwiI2luc3RydWN0aW9uX3NpbmdsZV9udW1lcmljXCIpLnNob3coKSB9XG4gICAgICAgIGlmIChxdWFsaXR5VHlwZSA9PSBcInZmX2NvbnRyX2JvdGhcIiAmJiBxdWFsaXR5Rm9ybWF0ID09IFwiZGVzY3JpcHRpdmVcIikgeyAkKFwiI2luc3RydWN0aW9uX3ZmX2NvbnRyX2JvdGhfZGVzY3JpcHRpdmVcIikuc2hvdygpIH1cbiAgICAgICAgaWYgKHF1YWxpdHlUeXBlID09IFwidmZfb25seVwiICYmIHF1YWxpdHlGb3JtYXQgPT0gXCJkZXNjcmlwdGl2ZVwiKSB7ICQoXCIjaW5zdHJ1Y3Rpb25fdmZfZGVzY3JpcHRpdmVcIikuc2hvdygpIH1cbiAgICAgICAgaWYgKHF1YWxpdHlUeXBlID09IFwiY29udHJfb25seVwiICYmIHF1YWxpdHlGb3JtYXQgPT0gXCJkZXNjcmlwdGl2ZVwiKSB7ICQoXCIjaW5zdHJ1Y3Rpb25fY29udHJfZGVzY3JpcHRpdmVcIikuc2hvdygpIH1cbiAgICB9XG59XG4kKFwiI2J1dHRvbl9pbnN0cnVjdGlvbnNfbmV4dFwiKS5vbihcImNsaWNrXCIsICgpID0+IG5leHRfaW5zdHJ1Y3Rpb25zKCsxKSlcbiQoXCIjYnV0dG9uX2luc3RydWN0aW9uc19wcmV2XCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4gbmV4dF9pbnN0cnVjdGlvbnMoLTEpKVxuXG5mdW5jdGlvbiB1dGlsaXR5X29mX3NlbGVjdGlvbihzZWxlY3Rpb246IG51bWJlcikge1xuICAgIGxldCB1dGlsaXR5OiBudW1iZXIgPSAwXG4gICAgaWYgKHNlbGVjdGlvbiA9PSAyKSB7XG4gICAgICAgIHV0aWxpdHkgPSAwXG4gICAgfSBlbHNlIHtcbiAgICAgICAgbGV0IGNvcnJlY3Rfc2VsZWN0aW9uID0gMSAtIHF1ZXN0aW9uW1wicHJlZGljdGlvbl9pc19jb3JyZWN0XCJdIC8vIDAgaWYgQUkgaXMgY29ycmVjdCwgMSBpZiBpbmNvcnJlY3RcbiAgICAgICAgdXRpbGl0eSA9IChzZWxlY3Rpb24gPT0gY29ycmVjdF9zZWxlY3Rpb24pID8gMSA6IC0xXG4gICAgfVxuICAgIHJldHVybiB1dGlsaXR5XG59XG5cbiQoXCIjYnV0dG9uX25leHRcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG5cbiAgICAvLyBVcGRhdGUgdGhlIHVzZXIgYmFsYW5jZVxuICAgIGxldCBvbGRfYmFsYW5jZSA9IGJhbGFuY2VcbiAgICB1cGRhdGVfYmFsYW5jZSgpXG5cbiAgICBpZiAocXVlc3Rpb25faSAhPSAtMSkge1xuICAgICAgICBsZXQgbG9nZ2VkX2RhdGEgPSB7XG4gICAgICAgICAgICBcInF1ZXN0aW9uX2lcIjogcXVlc3Rpb25faSxcbiAgICAgICAgICAgIFwidXNlcl9zZWxlY3Rpb25zXCI6IHtcbiAgICAgICAgICAgICAgICBcImFuc3dlcm9ubHlcIjogdXNlcnNlbGVjdGlvbl9hbnN3ZXJvbmx5LFxuICAgICAgICAgICAgICAgIFwid2l0aGV4cGxhbmF0aW9uXCI6IHVzZXJzZWxlY3Rpb25fd2l0aGV4cGxhbmF0aW9uLFxuICAgICAgICAgICAgICAgIFwid2l0aGV4cGxhbmF0aW9ucXVhbGl0eVwiOiB1c2Vyc2VsZWN0aW9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHlcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcInVzZXJfaXNfY29ycmVjdFwiOiB7XG4gICAgICAgICAgICAgICAgXCJhbnN3ZXJvbmx5XCI6IGlzX3VzZXJfY29ycmVjdCh1c2Vyc2VsZWN0aW9uX2Fuc3dlcm9ubHkpLFxuICAgICAgICAgICAgICAgIFwid2l0aGV4cGxhbmF0aW9uXCI6IGlzX3VzZXJfY29ycmVjdCh1c2Vyc2VsZWN0aW9uX3dpdGhleHBsYW5hdGlvbiksXG4gICAgICAgICAgICAgICAgXCJ3aXRoZXhwbGFuYXRpb25xdWFsaXR5XCI6IGlzX3VzZXJfY29ycmVjdCh1c2Vyc2VsZWN0aW9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHkpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJ1dGlsaXR5X29mX2V4cGxhbmF0aW9uXCI6IHV0aWxpdHlfb2Zfc2VsZWN0aW9uKHVzZXJzZWxlY3Rpb25fd2l0aGV4cGxhbmF0aW9uKSAtIHV0aWxpdHlfb2Zfc2VsZWN0aW9uKHVzZXJzZWxlY3Rpb25fYW5zd2Vyb25seSksXG4gICAgICAgICAgICBcInV0aWxpdHlfb2ZfcXVhbGl0eV9tZXRyaWNzXCI6IHV0aWxpdHlfb2Zfc2VsZWN0aW9uKHVzZXJzZWxlY3Rpb25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eSkgLSB1dGlsaXR5X29mX3NlbGVjdGlvbih1c2Vyc2VsZWN0aW9uX3dpdGhleHBsYW5hdGlvbiksXG4gICAgICAgICAgICBcImJhbGFuY2VcIjoge1xuICAgICAgICAgICAgICAgIFwib2xkXCI6IG9sZF9iYWxhbmNlLFxuICAgICAgICAgICAgICAgIFwibmV3XCI6IGJhbGFuY2VcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGxvZ2dlZF9kYXRhWydxdWVzdGlvbiddID0gcXVlc3Rpb25cbiAgICAgICAgbG9nZ2VkX2RhdGFbJ2NvdW50X2V4aXRlZF9wYWdlJ10gPSBjb3VudF9leGl0ZWRfcGFnZVxuICAgICAgICBsb2dfZGF0YShsb2dnZWRfZGF0YSlcbiAgICAgICAgY291bnRfZXhpdGVkX3BhZ2UgPSAwXG4gICAgfVxuICAgIFxuXG4gICAgbmV4dF9xdWVzdGlvbigpXG59KTtcblxuXG5mdW5jdGlvbiBpc191c2VyX2NvcnJlY3Qoc2VsZWN0aW9uKSB7XG4gICAgaWYgKHNlbGVjdGlvbiAhPSAyKSB7XG4gICAgICAgIGxldCBjb3JyZWN0X3NlbGVjdGlvbiA9IDEgLSBxdWVzdGlvbltcInByZWRpY3Rpb25faXNfY29ycmVjdFwiXSAvLyAwIGlmIEFJIGlzIGNvcnJlY3QsIDEgaWYgaW5jb3JyZWN0XG4gICAgICAgIHJldHVybiBzZWxlY3Rpb24gPT0gY29ycmVjdF9zZWxlY3Rpb24gPyAxIDogMFxuICAgIH1cbiAgICByZXR1cm4gLTFcbn1cblxuZnVuY3Rpb24gdXBkYXRlX2JhbGFuY2UoKSB7XG4gICAgaWYgKHVzZXJzZWxlY3Rpb25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eSAhPSAyKSB7XG4gICAgICAgIGxldCBjb3JyZWN0X3NlbGVjdGlvbiA9IDEgLSBxdWVzdGlvbltcInByZWRpY3Rpb25faXNfY29ycmVjdFwiXSAvLyAwIGlmIEFJIGlzIGNvcnJlY3QsIDEgaWYgaW5jb3JyZWN0XG4gICAgICAgIGlmICh1c2Vyc2VsZWN0aW9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHkgPT0gY29ycmVjdF9zZWxlY3Rpb24pIHtcbiAgICAgICAgICAgIGJhbGFuY2UgKz0gUkVXQVJEX0NPUlJFQ1Q7XG4gICAgICAgICAgICBudW1fY29ycmVjdCArPSAxO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYmFsYW5jZSArPSBQRU5BTFRZX0lOQ09SUkVDVDtcbiAgICAgICAgICAgIG51bV9pbmNvcnJlY3QgKz0gMTtcbiAgICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAgIG51bV91bnN1cmUgKz0gMTtcbiAgICB9XG59XG5cbi8vIFRvIGVuc3VyZSBiYWxhbmNlIGlzIG5vbi1uZWdhdGl2ZVxuZnVuY3Rpb24gZmluYWxpemVfYmFsYW5jZSgpIHtcbiAgICBiYWxhbmNlID0gTWF0aC5tYXgoMCwgYmFsYW5jZSk7XG4gICAgcmV0dXJuIGJhbGFuY2U7XG59XG5cbmxldCBhY3RpdmVUaW1lcjogUmV0dXJuVHlwZTx0eXBlb2Ygc2V0SW50ZXJ2YWw+IHwgbnVsbCA9IG51bGw7IC8vIFRpbWVyIGludGVydmFsXG5cbmZ1bmN0aW9uIHN0YXJ0VGltZXIoZHVyYXRpb24sIHN0ZXBEaXYsIGJ1dHRvbnMsIGNhbGxiYWNrKSB7XG4gICAgaWYgKCFFTkFCTEVfVElNRVIpIHtcbiAgICAgICAgLy8gSWYgdGhlIHRpbWVyIGlzIGRpc2FibGVkLCBlbmFibGUgdGhlIGJ1dHRvbnMgaW1tZWRpYXRlbHlcbiAgICAgICAgYnV0dG9ucy5mb3JFYWNoKGJ1dHRvbiA9PiBidXR0b24ucmVtb3ZlQXR0cmlidXRlKFwiZGlzYWJsZWRcIikpO1xuICAgICAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBDbGVhciBhbnkgZXhpc3RpbmcgdGltZXIgdG8gcHJldmVudCBtdWx0aXBsZSBpbnRlcnZhbHNcbiAgICBpZiAoYWN0aXZlVGltZXIpIHtcbiAgICAgICAgY2xlYXJJbnRlcnZhbChhY3RpdmVUaW1lcik7XG4gICAgICAgIGFjdGl2ZVRpbWVyID0gbnVsbDtcbiAgICB9XG5cbiAgICAvLyBEaXNhYmxlIGJ1dHRvbnNcbiAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IGJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCBcInRydWVcIikpO1xuICAgIFxuICAgIC8vIFNob3cgdGltZXIgdmlzdWFsbHlcbiAgICBsZXQgdGltZXJEaXNwbGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgdGltZXJEaXNwbGF5LmlkID0gYHRpbWVyXyR7c3RlcERpdi5pZH1gO1xuICAgIHRpbWVyRGlzcGxheS5zdHlsZS5mb250V2VpZ2h0ID0gJ2JvbGQnO1xuICAgIHRpbWVyRGlzcGxheS5zdHlsZS5tYXJnaW5Ub3AgPSAnMTBweCc7XG4gICAgc3RlcERpdi5hcHBlbmRDaGlsZCh0aW1lckRpc3BsYXkpO1xuXG4gICAgbGV0IHJlbWFpbmluZ1RpbWUgPSBkdXJhdGlvbjtcblxuICAgIC8vIEluaXRpYWwgZGlzcGxheVxuICAgIHRpbWVyRGlzcGxheS50ZXh0Q29udGVudCA9IGBQbGVhc2Ugd2FpdCAke3JlbWFpbmluZ1RpbWV9IHNlY29uZChzKSBiZWZvcmUgbWFraW5nIHlvdXIgc2VsZWN0aW9uLmA7XG5cbiAgICBhY3RpdmVUaW1lciA9IHNldEludGVydmFsKCgpID0+IHtcbiAgICAgICAgcmVtYWluaW5nVGltZS0tO1xuICAgICAgICBpZiAocmVtYWluaW5nVGltZSA+PSAwKSB7XG4gICAgICAgICAgICB0aW1lckRpc3BsYXkudGV4dENvbnRlbnQgPSBgUGxlYXNlIHdhaXQgJHtyZW1haW5pbmdUaW1lfSBzZWNvbmQocykgYmVmb3JlIG1ha2luZyB5b3VyIHNlbGVjdGlvbi5gO1xuICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICBpZiAoYWN0aXZlVGltZXIgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKGFjdGl2ZVRpbWVyKTsgLy8gU3RvcCB0aGUgdGltZXJcbiAgICAgICAgICAgICAgICBhY3RpdmVUaW1lciA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhY3RpdmVUaW1lciA9IG51bGw7XG5cbiAgICAgICAgICAgIC8vIFJlbW92ZSB0aW1lciBkaXNwbGF5XG4gICAgICAgICAgICBzdGVwRGl2LnJlbW92ZUNoaWxkKHRpbWVyRGlzcGxheSk7XG5cbiAgICAgICAgICAgIC8vIEVuYWJsZSBidXR0b25zXG4gICAgICAgICAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IGJ1dHRvbi5yZW1vdmVBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKSk7XG5cbiAgICAgICAgICAgIGlmIChjYWxsYmFjaykgY2FsbGJhY2soKTtcbiAgICAgICAgfVxuICAgIH0sIDEwMDApO1xufVxuXG4vLyBXaGVuIHRoZSB1c2VyIHN3aXRjaGVzIHRhYnMgb3IgbWluaW1pemVzIHRoZSB3aW5kb3csIHBhdXNlIHRoZSB0aW1lclxuZG9jdW1lbnQub252aXNpYmlsaXR5Y2hhbmdlID0gKCkgPT4ge1xuICAgIGlmIChkb2N1bWVudC5oaWRkZW4pIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJXaW5kb3cgbG9zdCBmb2N1cy5cIik7XG4gICAgICAgIGlmIChhY3RpdmVUaW1lciAhPT0gbnVsbCkge1xuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChhY3RpdmVUaW1lcik7IC8vIFBhdXNlIHRoZSB0aW1lclxuICAgICAgICAgICAgYWN0aXZlVGltZXIgPSBudWxsO1xuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgLy8gSGFuZGxlIGxvZ2ljIHdoZW4gdGhlIHVzZXIgcmV0dXJuc1xuICAgICAgICBjb25zb2xlLmxvZyhcIldpbmRvdyByZWdhaW5lZCBmb2N1cy5cIik7XG4gICAgfVxufTtcblxuLy8gRmlyc3Qgc3RlcDogZW5mb3JjZSBhIDUtc2Vjb25kIHdhaXRcbmZ1bmN0aW9uIHNldHVwRmlyc3RTdGVwKGV4cGxhbmF0aW9uVGV4dCkge1xuICAgIGNvbnN0IGZpcnN0U3RlcERpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhaV9hbnN3ZXJfZGl2Jyk7XG4gICAgY29uc3QgYnV0dG9ucyA9IFtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1dHRvbl9hbnN3ZXJvbmx5X3VzZXJ0cnVzdHMnKSxcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1dHRvbl9hbnN3ZXJvbmx5X3VzZXJkaXN0cnVzdHMnKSxcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1dHRvbl9hbnN3ZXJvbmx5X3VzZXJ1bnN1cmUnKVxuICAgIF07XG5cbiAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IGJ1dHRvbj8ucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVGaXJzdFN0ZXBDbGljaykpOyAvLyBSZW1vdmUgb2xkIGxpc3RlbmVyc1xuICAgIGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gYnV0dG9uPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUZpcnN0U3RlcENsaWNrKSk7IC8vIEFkZCBuZXcgb25lc1xuXG4gICAgZnVuY3Rpb24gaGFuZGxlRmlyc3RTdGVwQ2xpY2soKSB7XG4gICAgICAgIGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gYnV0dG9uPy5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUZpcnN0U3RlcENsaWNrKSk7IC8vIENsZWFudXBcbiAgICAgICAgc2V0dXBTZWNvbmRTdGVwKGV4cGxhbmF0aW9uVGV4dCk7XG4gICAgfVxuXG4gICAgJChcIiNhaV9hbnN3ZXJfZGl2XCIpLnNob3coKTtcbiAgICBzdGFydFRpbWVyKDUsIGZpcnN0U3RlcERpdiwgYnV0dG9ucywgbnVsbCk7XG4gICAgLy8gJChcIiNhaV9hbnN3ZXJfZGl2XCIpLnNob3coKTsgLy8gU2hvdyB0aGUgZmlyc3Qgc3RlcFxuICAgIC8vIHN0YXJ0VGltZXIoNSwgZmlyc3RTdGVwRGl2LCBidXR0b25zLCAoKSA9PiB7XG4gICAgLy8gICAgIC8vIEJ1dHRvbnMgYXJlIG5vdyBlbmFibGVkOyB1c2VyIG11c3QgY2xpY2sgb25lIHRvIHByb2NlZWRcbiAgICAvLyAgICAgYnV0dG9ucy5mb3JFYWNoKGJ1dHRvbiA9PiB7XG4gICAgLy8gICAgICAgICBidXR0b24/LmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgLy8gICAgICAgICAgICAgJ2NsaWNrJyxcbiAgICAvLyAgICAgICAgICAgICAoKSA9PiB7XG4gICAgLy8gICAgICAgICAgICAgICAgIHNldHVwU2Vjb25kU3RlcChleHBsYW5hdGlvblRleHQpOyAvLyBQcm9jZWVkIHRvIHRoZSBzZWNvbmQgc3RlcCBhZnRlciBidXR0b24gY2xpY2tcbiAgICAvLyAgICAgICAgICAgICB9LFxuICAgIC8vICAgICAgICAgICAgIHsgb25jZTogdHJ1ZSB9IC8vIEVuc3VyZSB0aGUgZXZlbnQgbGlzdGVuZXIgaXMgZXhlY3V0ZWQgb25seSBvbmNlXG4gICAgLy8gICAgICAgICApO1xuICAgIC8vICAgICB9KTtcbiAgICAvLyB9KTtcbn1cblxuLy8gU2Vjb25kIHN0ZXAgdGltZXIgKGR5bmFtaWMgYmFzZWQgb24gcmVhZGluZyB0aW1lKVxuZnVuY3Rpb24gc2V0dXBTZWNvbmRTdGVwKGV4cGxhbmF0aW9uVGV4dCkge1xuICAgIGNvbnN0IHNlY29uZFN0ZXBEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWlfZXhwbGFuYXRpb25fZGl2Jyk7XG4gICAgY29uc3Qgd29yZHMgPSBleHBsYW5hdGlvblRleHQuc3BsaXQoJyAnKS5sZW5ndGg7XG4gICAgY29uc3QgcmVhZGluZ1RpbWUgPSBNYXRoLm1heChNYXRoLmNlaWwoMyArICh3b3JkcyAvIDIzOCkgKiA2MCksIDUpO1xuXG4gICAgY29uc3QgYnV0dG9ucyA9IFtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1dHRvbl93aXRoZXhwbGFuYXRpb25fdXNlcnRydXN0cycpLFxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnV0dG9uX3dpdGhleHBsYW5hdGlvbl91c2VyZGlzdHJ1c3RzJyksXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXR0b25fd2l0aGV4cGxhbmF0aW9uX3VzZXJ1bnN1cmUnKVxuICAgIF07XG5cbiAgICAvLyBSZW1vdmUgb2xkIGV2ZW50IGxpc3RlbmVyc1xuICAgIGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gYnV0dG9uPy5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZVNlY29uZFN0ZXBDbGljaykpO1xuXG4gICAgLy8gQWRkIG5ldyBldmVudCBsaXN0ZW5lcnNcbiAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IGJ1dHRvbj8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVTZWNvbmRTdGVwQ2xpY2spKTtcblxuICAgIGZ1bmN0aW9uIGhhbmRsZVNlY29uZFN0ZXBDbGljaygpIHtcbiAgICAgICAgLy8gQ2xlYW51cDogcmVtb3ZlIGV2ZW50IGxpc3RlbmVyc1xuICAgICAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IGJ1dHRvbj8ucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVTZWNvbmRTdGVwQ2xpY2spKTtcbiAgICAgICAgc2V0dXBUaGlyZFN0ZXAoZXhwbGFuYXRpb25UZXh0KTtcbiAgICB9XG5cbiAgICAkKFwiI2FpX2V4cGxhbmF0aW9uX2RpdlwiKS5zaG93KCk7IC8vIFNob3cgdGhlIHNlY29uZCBzdGVwXG4gICAgc3RhcnRUaW1lcihyZWFkaW5nVGltZSwgc2Vjb25kU3RlcERpdiwgYnV0dG9ucywgbnVsbCk7IC8vIFN0YXJ0IHRpbWVyXG59XG5cbi8vIFRoaXJkIHN0ZXAgdGltZXIgKDUgc2Vjb25kcylcbmZ1bmN0aW9uIHNldHVwVGhpcmRTdGVwKGV4cGxhbmF0aW9uVGV4dCkge1xuICAgIGNvbnN0IHRoaXJkU3RlcERpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhaV9leHBsYW5hdGlvbl9xdWFsaXR5X2RpdicpO1xuICAgIGNvbnN0IGJ1dHRvbnMgPSBbXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXR0b25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eV91c2VydHJ1c3RzJyksXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXR0b25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eV91c2VyZGlzdHJ1c3RzJyksXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXR0b25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eV91c2VydW5zdXJlJylcbiAgICBdO1xuXG4gICAgLy8gUmVtb3ZlIG9sZCBldmVudCBsaXN0ZW5lcnNcbiAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IGJ1dHRvbj8ucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVUaGlyZFN0ZXBDbGljaykpO1xuXG4gICAgLy8gQWRkIG5ldyBldmVudCBsaXN0ZW5lcnNcbiAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IGJ1dHRvbj8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVUaGlyZFN0ZXBDbGljaykpO1xuXG4gICAgZnVuY3Rpb24gaGFuZGxlVGhpcmRTdGVwQ2xpY2soKSB7XG4gICAgICAgIC8vIENsZWFudXA6IHJlbW92ZSBldmVudCBsaXN0ZW5lcnNcbiAgICAgICAgYnV0dG9ucy5mb3JFYWNoKGJ1dHRvbiA9PiBidXR0b24/LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlVGhpcmRTdGVwQ2xpY2spKTtcbiAgICAgICAgJChcIiNidXR0b25fbmV4dFwiKS5zaG93KCk7IC8vIEVuYWJsZSB0aGUgbmV4dCBxdWVzdGlvbiBidXR0b25cbiAgICB9XG5cbiAgICAkKFwiI2FpX2V4cGxhbmF0aW9uX3F1YWxpdHlfZGl2XCIpLnNob3coKTsgLy8gU2hvdyB0aGUgdGhpcmQgc3RlcFxuICAgIHN0YXJ0VGltZXIoNSwgdGhpcmRTdGVwRGl2LCBidXR0b25zLCBudWxsKTsgLy8gU3RhcnQgdGltZXJcbn1cblxuZnVuY3Rpb24gbmV4dF9xdWVzdGlvbigpIHtcbiAgICAvLyBSZXNldCB0aW1lcnMgYW5kIHN0YXRlXG4gICAgaWYgKGFjdGl2ZVRpbWVyKSB7XG4gICAgICAgIGNsZWFySW50ZXJ2YWwoYWN0aXZlVGltZXIpO1xuICAgICAgICBhY3RpdmVUaW1lciA9IG51bGw7XG4gICAgfVxuXG4gICAgLy8gcmVzdG9yZSBwcmV2aW91cyBzdGF0ZSBvZiBVSVxuICAgICQoXCIjYnV0dG9uX3JlYWR5dG9hbnN3ZXJcIikucmVtb3ZlQXR0cihcImFjdGl2ZWRlY2lzaW9uXCIpXG4gICAgJChcIiNidXR0b25fcmVhZHl0b2Fuc3dlclwiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIilcbiAgICAkKFwiI2J1dHRvbl9yZWFkeXRvYW5zd2VyXCIpLnNob3coKVxuXG4gICAgJChcIiNidXR0b25fYW5zd2Vyb25seV91c2VydHJ1c3RzXCIpLnJlbW92ZUF0dHIoXCJhY3RpdmVkZWNpc2lvblwiKVxuICAgICQoXCIjYnV0dG9uX2Fuc3dlcm9ubHlfdXNlcnRydXN0c1wiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIilcbiAgICAkKFwiI2J1dHRvbl9hbnN3ZXJvbmx5X3VzZXJkaXN0cnVzdHNcIikucmVtb3ZlQXR0cihcImFjdGl2ZWRlY2lzaW9uXCIpXG4gICAgJChcIiNidXR0b25fYW5zd2Vyb25seV91c2VyZGlzdHJ1c3RzXCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKVxuICAgICQoXCIjYnV0dG9uX2Fuc3dlcm9ubHlfdXNlcnVuc3VyZVwiKS5yZW1vdmVBdHRyKFwiYWN0aXZlZGVjaXNpb25cIilcbiAgICAkKFwiI2J1dHRvbl9hbnN3ZXJvbmx5X3VzZXJ1bnN1cmVcIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpXG5cbiAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25fdXNlcnRydXN0c1wiKS5yZW1vdmVBdHRyKFwiYWN0aXZlZGVjaXNpb25cIilcbiAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25fdXNlcnRydXN0c1wiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIilcbiAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25fdXNlcmRpc3RydXN0c1wiKS5yZW1vdmVBdHRyKFwiYWN0aXZlZGVjaXNpb25cIilcbiAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25fdXNlcmRpc3RydXN0c1wiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIilcbiAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25fdXNlcnVuc3VyZVwiKS5yZW1vdmVBdHRyKFwiYWN0aXZlZGVjaXNpb25cIilcbiAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25fdXNlcnVuc3VyZVwiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIilcblxuICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHlfdXNlcnRydXN0c1wiKS5yZW1vdmVBdHRyKFwiYWN0aXZlZGVjaXNpb25cIilcbiAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5X3VzZXJ0cnVzdHNcIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpXG4gICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eV91c2VyZGlzdHJ1c3RzXCIpLnJlbW92ZUF0dHIoXCJhY3RpdmVkZWNpc2lvblwiKVxuICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHlfdXNlcmRpc3RydXN0c1wiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIilcbiAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5X3VzZXJ1bnN1cmVcIikucmVtb3ZlQXR0cihcImFjdGl2ZWRlY2lzaW9uXCIpXG4gICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eV91c2VydW5zdXJlXCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKVxuXG4gICAgJChcIiNhaV9leHBsYW5hdGlvbl9kaXZcIikuaGlkZSgpXG4gICAgJChcIiNhaV9leHBsYW5hdGlvbl9xdWFsaXR5X2RpdlwiKS5oaWRlKClcbiAgICBcblxuICAgICQoXCIjYnV0dG9uX25leHRcIikuaGlkZSgpXG4gICAgJCgnI2J1dHRvbl9xdWl0JykuaGlkZSgpXG4gICAgLy8kKFwiI3JhbmdlX3ZhbFwiKS52YWwodXNlcl90cnVzdClcblxuICAgIHF1ZXN0aW9uX2kgKz0gMVxuICAgIGlmIChxdWVzdGlvbl9pID49IGRhdGEubGVuZ3RoKSB7XG4gICAgICAgICQoXCIjbWFpbl9ib3hfZXhwZXJpbWVudFwiKS5oaWRlKClcbiAgICAgICAgYmFsYW5jZSA9IGZpbmFsaXplX2JhbGFuY2UoKVxuXG4gICAgICAgIGxldCByZXdhcmRfdGV4dCA9IGBZb3VyIHRvdGFsIHJld2FyZCBpcyA8Yj4kJHtiYWxhbmNlLnRvRml4ZWQoMil9ICsgJDI8L2I+LmBcbiAgICAgICAgcmV3YXJkX3RleHQgKz0gYDxicj5Zb3UgYW5zd2VyZWQgYSB0b3RhbCBvZiAke3F1ZXN0aW9uX2l9IHF1ZXN0aW9uczogJHtudW1fY29ycmVjdH0gY29ycmVjdCwgJHtudW1faW5jb3JyZWN0fSBpbmNvcnJlY3QsICR7bnVtX3Vuc3VyZX0gdW5zdXJlLmBcbiAgICAgICAgaWYgKE1PQ0tNT0RFKSB7XG4gICAgICAgICAgICAkKCcjcmV3YXJkX2JveF9tb2NrJykuaHRtbChyZXdhcmRfdGV4dClcbiAgICAgICAgICAgICQoJyNyZXdhcmRfYm94X21vY2snKS5zaG93KClcbiAgICAgICAgICAgICQoXCIjbWFpbl9ib3hfZW5kX21vY2tcIikuc2hvdygpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkKCcjcmV3YXJkX2JveCcpLmh0bWwocmV3YXJkX3RleHQpXG4gICAgICAgICAgICAkKCcjcmV3YXJkX2JveCcpLnNob3coKVxuICAgICAgICAgICAgJChcIiNtYWluX2JveF9lbmRcIikuc2hvdygpXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgcXVlc3Rpb24gPSBkYXRhW3F1ZXN0aW9uX2ldXG5cbiAgICBjb25zdCBxdWVzdGlvblRleHQgPSBxdWVzdGlvbiFbXCJxdWVzdGlvblwiXTtcbiAgICBjb25zdCB1cGRhdGVkUXVlc3Rpb25UZXh0ID0gcXVlc3Rpb25UZXh0LnJlcGxhY2UoXCJDaG9pY2VzOlwiLCBcIjxicj48Yj5DaG9pY2VzOjwvYj5cIik7XG4gICAgJChcIiNxdWVzdGlvbl9zcGFuXCIpLmh0bWwodXBkYXRlZFF1ZXN0aW9uVGV4dCk7XG5cbiAgICAkKFwiI2FpX3ByZWRpY3Rpb25fc3BhblwiKS5odG1sKHF1ZXN0aW9uIVtcInByZWRpY3RlZF9hbnN3ZXJcIl0pXG4gICAgJChcIiNhaV9leHBsYW5hdGlvbl9zcGFuXCIpLmh0bWwocXVlc3Rpb24hW1wiZ2VuZXJhdGVkX3JhdGlvbmFsZVwiXSlcblxuICAgIGxldCB2aXN1YWxfZmlkZWxpdHlfY29uZiA9IE1hdGgucm91bmQocXVlc3Rpb24hW1widmlzdWFsX2ZpZGVsaXR5XCJdICogMTAwKVxuICAgICQoXCIjZXhwbGFuYXRpb25fZmlkZWxpdHlfbnVtZXJpY19zcGFuXCIpLmh0bWwoYCR7dmlzdWFsX2ZpZGVsaXR5X2NvbmZ9JWApXG4gICAgbGV0IHZpc3VhbF9jb250cmFzdGl2ZW5lc3NfY29uZiA9IE1hdGgucm91bmQocXVlc3Rpb24hW1wiY29udHJhc3RpdmVuZXNzXCJdICogMTAwKVxuICAgICQoXCIjZXhwbGFuYXRpb25fY29udHJhc3RpdmVuZXNzX251bWVyaWNfc3BhblwiKS5odG1sKGAke3Zpc3VhbF9jb250cmFzdGl2ZW5lc3NfY29uZn0lYClcbiAgICAvLyBUYWtlIHByb2R1Y3Qgb2YgdGhlIGFib3ZlIHR3b1xuICAgIGxldCBzaW5nbGVfbnVtZXJpY19jb25mID0gTWF0aC5yb3VuZCgocXVlc3Rpb24hW1widmlzdWFsX2ZpZGVsaXR5XCJdICsgcXVlc3Rpb24hW1wiY29udHJhc3RpdmVuZXNzXCJdKS8yICogMTAwKVxuICAgICQoXCIjZXhwbGFuYXRpb25fc2luZ2xlX251bWVyaWNfc3BhblwiKS5odG1sKGAke3NpbmdsZV9udW1lcmljX2NvbmZ9JWApXG4gICAgLy8gVE9ETzogRmlsbCBpbiB0aGUgZGV0YWlscyBmb3IgdGhlIGRlc2NyaXB0aXZlIHF1YWxpdGllc1xuXG4gICAgbGV0IHZmX2Rlc2NyaXB0aXZlID0gXCJcIlxuICAgIGlmKHF1ZXN0aW9uW1wicmVhc29uX3ZmX2NvcnJlY3RcIl0gPT0gXCJcIikge1xuICAgICAgICB2Zl9kZXNjcmlwdGl2ZSArPSBcIjxiPlRoZXJlIGFyZSBubyBkZXRhaWxzIGFib3V0IHRoZSBpbWFnZSBpbiB0aGUgZXhwbGFuYXRpb24gdGhhdCBhcmUgbGlrZWx5IGNvcnJlY3QuPC9iPlwiXG4gICAgfSBlbHNlIHtcbiAgICAgICAgdmZfZGVzY3JpcHRpdmUgKz0gXCI8Yj5EZXRhaWxzIGluIHRoZSBleHBsYW5hdGlvbiB0aGF0IGFyZSBsaWtlbHkgY29ycmVjdDo8L2I+XCJcbiAgICAgICAgdmZfZGVzY3JpcHRpdmUgKz0gcXVlc3Rpb25bXCJyZWFzb25fdmZfY29ycmVjdFwiXS5yZXBsYWNlKC88YnI+IC0vZywgXCI8YnI+IFxcdTI3MDVcIilcbiAgICB9XG4gICAgaWYgKHF1ZXN0aW9uW1wicmVhc29uX3ZmX2luY29ycmVjdFwiXSA9PSBcIlwiKSB7XG4gICAgICAgIHZmX2Rlc2NyaXB0aXZlICs9IFwiPGJyPjxicj48Yj5UaGVyZSBhcmUgbm8gZGV0YWlscyBhYm91dCB0aGUgaW1hZ2UgaW4gdGhlIGV4cGxhbmF0aW9uIHRoYXQgYXJlIGxpa2VseSBpbmNvcnJlY3QuPC9iPlwiXG4gICAgfSBlbHNlIHtcbiAgICAgICAgdmZfZGVzY3JpcHRpdmUgKz0gXCI8YnI+PGJyPjxiPkRldGFpbHMgaW4gdGhlIGV4cGxhbmF0aW9uIHRoYXQgYXJlIGxpa2VseSBOT1QgY29ycmVjdDo8L2I+XCJcbiAgICAgICAgdmZfZGVzY3JpcHRpdmUgKz0gcXVlc3Rpb25bXCJyZWFzb25fdmZfaW5jb3JyZWN0XCJdLnJlcGxhY2UoLzxicj4gLS9nLCBcIjxicj4gXFx1Mjc0Y1wiKVxuICAgIH1cbiAgICAkKFwiI2V4cGxhbmF0aW9uX2ZpZGVsaXR5X2Rlc2NyaXB0aXZlX3NwYW5cIikuaHRtbCh2Zl9kZXNjcmlwdGl2ZSlcblxuICAgIGxldCBjb250cl9kZXNjcmlwdGl2ZSA9IFwiXCJcbiAgICBpZihxdWVzdGlvbltcInJlYXNvbl9jb250clwiXSA9PSBcIlwiKSB7XG4gICAgICAgIGNvbnRyX2Rlc2NyaXB0aXZlICs9IFwiPGI+Tm9uZSBvZiB0aGUgb3RoZXIgY2hvaWNlcyBhcmUgbGlrZWx5IGNvcnJlY3QsIGJhc2VkIG9uIHRoZSBleHBsYW5hdGlvbi48L2I+XCJcbiAgICB9IGVsc2Uge1xuICAgICAgICBjb250cl9kZXNjcmlwdGl2ZSArPSBcIjxiPk90aGVyIGNob2ljZXMgdGhhdCBjb3VsZCBiZSBjb3JyZWN0LCBiYXNlZCBvbiB0aGUgZXhwbGFuYXRpb246IDwvYj5cIlxuICAgICAgICBjb250cl9kZXNjcmlwdGl2ZSArPSBxdWVzdGlvbltcInJlYXNvbl9jb250clwiXVxuICAgIH1cbiAgICAkKFwiI2V4cGxhbmF0aW9uX2NvbnRyYXN0aXZlbmVzc19kZXNjcmlwdGl2ZV9zcGFuXCIpLmh0bWwoY29udHJfZGVzY3JpcHRpdmUpXG5cbiAgICAvL3RpbWVfcXVlc3Rpb25fc3RhcnQgPSBEYXRlLm5vdygpXG4gICAgJChcIiNwcm9ncmVzc1wiKS50ZXh0KGBQcm9ncmVzczogJHtxdWVzdGlvbl9pICsgMX0gLyAke2RhdGEubGVuZ3RofWApXG5cbiAgICBzZXR1cEZpcnN0U3RlcChxdWVzdGlvbltcImdlbmVyYXRlZF9yYXRpb25hbGVcIl0pO1xufVxuXG5cblxuLy8gZ2V0IHVzZXIgaWQgYW5kIGxvYWQgcXVldWVcbi8vIHRyeSB0byBzZWUgaWYgc3RhcnQgb3ZlcnJpZGUgd2FzIHBhc3NlZFxuY29uc3QgdXJsUGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh3aW5kb3cubG9jYXRpb24uc2VhcmNoKTtcbmNvbnN0IHN0YXJ0T3ZlcnJpZGUgPSB1cmxQYXJhbXMuZ2V0KCdzdGFydCcpO1xuY29uc3QgVUlERnJvbVVSTCA9IHVybFBhcmFtcy5nZXQoXCJ1aWRcIilcbmdsb2JhbFRoaXMudXJsX2RhdGEgPSBwYXJhbXNUb09iamVjdCh1cmxQYXJhbXMuZW50cmllcygpKVxuXG5pZiAoZ2xvYmFsVGhpcy51cmxfZGF0YVsnc3R1ZHlfaWQnXSA9PSBudWxsKSB7XG4gICAgZ2xvYmFsVGhpcy51cmxfZGF0YVsnc3R1ZHlfaWQnXSA9IFwiZGVtb19zdHVkeVwiXG59XG5pZiAoZ2xvYmFsVGhpcy51cmxfZGF0YVsncHJvbGlmaWNfaWQnXSA9PSBudWxsKSB7XG4gICAgZ2xvYmFsVGhpcy51cmxfZGF0YVsncHJvbGlmaWNfaWQnXSA9IFwiZGVtb191c2VyXCJcbn1cbmlmIChnbG9iYWxUaGlzLnVybF9kYXRhWydzZXNzaW9uX2lkJ10gPT0gbnVsbCkge1xuICAgIGdsb2JhbFRoaXMudXJsX2RhdGFbJ3Nlc3Npb25faWQnXSA9IFwiZGVtb19zZXNzaW9uXCJcbn1cblxuaWYgKFVJREZyb21VUkwgIT0gbnVsbCkge1xuICAgIGdsb2JhbFRoaXMudWlkID0gVUlERnJvbVVSTCBhcyBzdHJpbmdcbiAgICBpZiAoZ2xvYmFsVGhpcy51aWQgPT0gXCJwcm9saWZpY19yYW5kb21cIikge1xuICAgICAgICBsZXQgcXVldWVfaWQgPSBgJHtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCl9YC5wYWRTdGFydCgzLCBcIjBcIilcbiAgICAgICAgZ2xvYmFsVGhpcy51aWQgPSBgJHt1cmxQYXJhbXMuZ2V0KFwicHJvbGlmaWNfcXVldWVfbmFtZVwiKX0vJHtxdWV1ZV9pZH1gXG4gICAgfVxufSBlbHNlIGlmIChERVZNT0RFKSB7XG4gICAgZ2xvYmFsVGhpcy51aWQgPSBcImRlbW9cIlxufSBlbHNlIHtcbiAgICBsZXQgVUlEX21heWJlOiBhbnkgPSBudWxsXG4gICAgd2hpbGUgKFVJRF9tYXliZSA9PSBudWxsKSB7XG4gICAgICAgIFVJRF9tYXliZSA9IHByb21wdChcIkVudGVyIHlvdXIgdXNlciBpZC4gUGxlYXNlIGdldCBpbiB0b3VjaCBpZiB5b3Ugd2VyZSBub3QgYXNzaWduZWQgYW4gaWQgYnV0IHdpc2ggdG8gcGFydGljaXBhdGUgaW4gdGhpcyBleHBlcmltZW50LlwiKVxuICAgIH1cbiAgICBnbG9iYWxUaGlzLnVpZCA9IFVJRF9tYXliZSFcbn1cblxuY29uc3QgdmFsaWRRdWFsaXR5VHlwZXMgPSBbXCJ2Zl9vbmx5XCIsIFwiY29udHJfb25seVwiLCBcInZmX2NvbnRyX2JvdGhcIiwgXCJzaW5nbGVfbnVtZXJpY1wiXVxubGV0IHF1YWxpdHlUeXBlID0gdXJsUGFyYW1zLmdldChcInF1YWxpdHlfdHlwZVwiKVxuaWYgKHF1YWxpdHlUeXBlID09IG51bGwpIHsgcXVhbGl0eVR5cGUgPSBcInZmX2NvbnRyX2JvdGhcIiB9XG5pZiAoIXZhbGlkUXVhbGl0eVR5cGVzLmluY2x1ZGVzKHF1YWxpdHlUeXBlKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgcXVhbGl0eSB0eXBlXCIpXG59XG5cbmNvbnN0IHZhbGlkUXVhbGl0eUZvcm1hdHMgPSBbXCJudW1lcmljXCIsIFwiZGVzY3JpcHRpdmVcIl1cbmxldCBxdWFsaXR5Rm9ybWF0ID0gdXJsUGFyYW1zLmdldChcInF1YWxpdHlfZm9ybWF0XCIpXG5pZiAocXVhbGl0eUZvcm1hdCA9PSBudWxsKSB7IHF1YWxpdHlGb3JtYXQgPSBcIm51bWVyaWNcIiB9XG5pZiAoIXZhbGlkUXVhbGl0eUZvcm1hdHMuaW5jbHVkZXMocXVhbGl0eUZvcm1hdCkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHF1YWxpdHkgZm9ybWF0XCIpXG59XG5cbmdsb2JhbFRoaXMudXJsX2RhdGFbXCJleHBsYW5hdGlvbl9xdWFsaXR5X3BhcmFtc1wiXSA9IHtcbiAgICBcInF1YWxpdHlfdHlwZVwiOiBxdWFsaXR5VHlwZSxcbiAgICBcInF1YWxpdHlfZm9ybWF0XCI6IHF1YWxpdHlGb3JtYXRcbn1cbmNvbnNvbGUubG9nKFwiUXVhbGl0eSBwYXJhbXNcIiwgZ2xvYmFsVGhpcy51cmxfZGF0YVtcImV4cGxhbmF0aW9uX3F1YWxpdHlfcGFyYW1zXCJdKVxuXG4vLyB2ZXJzaW9uIGZvciBwYXBlclxuaWYgKERFVk1PREUpIHtcbiAgICBNT0NLTU9ERSA9IHRydWVcbn0gZWxzZSBpZiAoZ2xvYmFsVGhpcy51cmxfZGF0YVsnc2Vzc2lvbl9pZCddLnN0YXJ0c1dpdGgoXCJkZW1vXCIpKSB7XG4gICAgTU9DS01PREUgPSB0cnVlXG59XG5cbmNvbnNvbGUubG9nKFwiUnVubmluZyB3aXRoIFVJRFwiLCBnbG9iYWxUaGlzLnVpZClcbmxvYWRfZGF0YSgpLmNhdGNoKChfZXJyb3IpID0+IHtcbiAgICAvL2FsZXJ0KFwiSW52YWxpZCB1c2VyIGlkLlwiKVxuICAgIGNvbnNvbGUubG9nKFwiSW52YWxpZCB1c2VyIGlkLlwiKVxuICAgIGNvbnNvbGUubG9nKGdsb2JhbFRoaXMudWlkISlcbiAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKClcbn1cbikudGhlbigobmV3X2RhdGEpID0+IHtcbiAgICBkYXRhID0gbmV3X2RhdGFcbiAgICBpZiAoc3RhcnRPdmVycmlkZSAhPSBudWxsKSB7XG4gICAgICAgIHF1ZXN0aW9uX2kgPSBwYXJzZUludChzdGFydE92ZXJyaWRlKSAtIDFcbiAgICAgICAgY29uc29sZS5sb2coXCJTdGFydGluZyBmcm9tXCIsIHF1ZXN0aW9uX2kpXG4gICAgfVxuICAgIC8vIG5leHRfcXVlc3Rpb24oKVxuICAgIG5leHRfaW5zdHJ1Y3Rpb25zKDApXG4gICAgdXBkYXRlUmV3YXJkSW5zdHJ1Y3Rpb25zKCk7XG4gICAgJChcIiNtYWluX2JveF9pbnN0cnVjdGlvbnNcIikuc2hvdygpXG4gICAgJChcIiNpbnN0cnVjdGlvbnNfYW5kX2RlY29yYXRpb25zXCIpLmhpZGUoKVxufSlcblxuLy8gLy8gRHluYW1pY2FsbHkgbG9hZCBkYXRhc2V0IGJhc2VkIG9uIERBVEFTRVRcbi8vIGZldGNoKGAuL2Jha2VkX3F1ZXVlcy8ke0RBVEFTRVR9YClcbi8vICAgICAudGhlbihyZXNwb25zZSA9PiB7XG4vLyAgICAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbi8vICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byBsb2FkIGRhdGFzZXQuXCIpO1xuLy8gICAgICAgICB9XG4vLyAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4vLyAgICAgfSlcbi8vICAgICAudGhlbigobmV3X2RhdGEpID0+IHtcbi8vICAgICAgICAgZGF0YSA9IG5ld19kYXRhO1xuLy8gICAgICAgICBpZiAoc3RhcnRPdmVycmlkZSAhPSBudWxsKSB7XG4vLyAgICAgICAgICAgICBxdWVzdGlvbl9pID0gcGFyc2VJbnQoc3RhcnRPdmVycmlkZSkgLSAxO1xuLy8gICAgICAgICAgICAgY29uc29sZS5sb2coXCJTdGFydGluZyBmcm9tXCIsIHF1ZXN0aW9uX2kpO1xuLy8gICAgICAgICB9XG4vLyAgICAgICAgIG5leHRfaW5zdHJ1Y3Rpb25zKDApO1xuLy8gICAgICAgICB1cGRhdGVSZXdhcmRJbnN0cnVjdGlvbnMoKTtcbi8vICAgICAgICAgJChcIiNtYWluX2JveF9pbnN0cnVjdGlvbnNcIikuc2hvdygpO1xuLy8gICAgICAgICAkKFwiI2luc3RydWN0aW9uc19hbmRfZGVjb3JhdGlvbnNcIikuaGlkZSgpO1xuLy8gICAgIH0pXG4vLyAgICAgLmNhdGNoKChfZXJyb3IpID0+IHtcbi8vICAgICAgICAgY29uc29sZS5lcnJvcihcIkludmFsaWQgdXNlciBpZCBvciBkYXRhc2V0IGxvYWRpbmcgZmFpbGVkLlwiKTtcbi8vICAgICAgICAgY29uc29sZS5sb2coZ2xvYmFsVGhpcy51aWQhKTtcbi8vICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuLy8gICAgIH0pO1xuXG5cbmNvbnNvbGUubG9nKFwiU3RhcnRpbmcgc2Vzc2lvbiB3aXRoIFVJRDpcIiwgZ2xvYmFsVGhpcy51aWQhKVxuXG5sZXQgYWxlcnRfYWN0aXZlID0gZmFsc2VcbmRvY3VtZW50Lm9udmlzaWJpbGl0eWNoYW5nZSA9ICgpID0+IHtcbiAgICBpZiAoIWFsZXJ0X2FjdGl2ZSkge1xuICAgICAgICBjb3VudF9leGl0ZWRfcGFnZSArPSAxXG4gICAgICAgIGFsZXJ0X2FjdGl2ZSA9IHRydWVcbiAgICAgICAgaWYgKCEoZ2xvYmFsVGhpcy51aWQhLnN0YXJ0c1dpdGgoXCJkZW1vXCIpKSkge1xuICAgICAgICAgICAgLy8gcGF1c2UgdGhlIHRpbWVyXG4gICAgICAgICAgIGFsZXJ0KFwiUGxlYXNlIGRvbid0IGxlYXZlIHRoZSBwYWdlLiBJZiB5b3UgZG8gc28gYWdhaW4sIHdlIG1heSByZXN0cmljdCBwYXlpbmcgeW91LlwiKVxuICAgICAgICB9XG4gICAgICAgIGFsZXJ0X2FjdGl2ZSA9IGZhbHNlXG4gICAgfVxuICAgIGVsc2V7XG4gICAgICAgIC8vY29udGludWUgdGhlIHRpbWVyP1xuICAgIH1cbn0iLCJkZWNsYXJlIGxldCBfREVWTU9ERTogYm9vbGVhblxuXG5leHBvcnQgdmFyIERFVk1PREUgPSBfREVWTU9ERVxuZXhwb3J0IGNvbnN0IEVOQUJMRV9USU1FUiA9IHRydWU7ICAvLyBTZXQgdG8gYGZhbHNlYCB0byBkaXNhYmxlIHRoZSB0aW1lciBmb3IgZGVidWdnaW5nXG5cbmV4cG9ydCBjb25zdCBSRVdBUkRfQ09SUkVDVCA9IDAuMTsgLy8gUmV3YXJkIGZvciBhIGNvcnJlY3QgYW5zd2VyXG5leHBvcnQgY29uc3QgUEVOQUxUWV9JTkNPUlJFQ1QgPSAtMC4xOyAvLyBQZW5hbHR5IGZvciBhbiBpbmNvcnJlY3QgYW5zd2VyIiwiZnVuY3Rpb24gcGFyYW1zVG9PYmplY3QoZW50cmllcykge1xuICBjb25zdCByZXN1bHQgPSB7fVxuICAvLyBlYWNoICdlbnRyeScgaXMgYSBba2V5LCB2YWx1ZV0gdHVwcGxlXG4gIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIGVudHJpZXMpIHtcbiAgICByZXN1bHRba2V5XSA9IHZhbHVlO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmV4cG9ydCB7IHBhcmFtc1RvT2JqZWN0IH0iXSwibmFtZXMiOlsiU0VSVkVSX0xPR19ST09UIiwiTU9DS01PREUiLCJkYXRhIiwicXVlc3Rpb25faSIsInF1ZXN0aW9uIiwidXNlcnNlbGVjdGlvbl9hbnN3ZXJvbmx5IiwidXNlcnNlbGVjdGlvbl93aXRoZXhwbGFuYXRpb24iLCJ1c2Vyc2VsZWN0aW9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHkiLCJudW1fY29ycmVjdCIsIm51bV9pbmNvcnJlY3QiLCJudW1fdW5zdXJlIiwiYmFsYW5jZSIsImluc3RydWN0aW9uX2kiLCJjb3VudF9leGl0ZWRfcGFnZSIsInJlZ2lzdGVyQW5zd2VyT25seVVzZXJTZWxlY3Rpb24iLCJ1c2VyX2Nob2ljZSIsIiQiLCJhdHRyIiwic2hvdyIsInJlZ2lzdGVyV2l0aEV4cGxhbmF0aW9uVXNlclNlbGVjdGlvbiIsInF1YWxpdHlUeXBlIiwicXVhbGl0eUZvcm1hdCIsImNvbmRpdGlvbiIsImFzc2VydCIsInJlZ2lzdGVyV2l0aEV4cGxhbmF0aW9uUXVhbGl0eVVzZXJTZWxlY3Rpb24iLCJyZW1vdmVBdHRyIiwibmV4dF9pbnN0cnVjdGlvbnMiLCJpbmNyZW1lbnQiLCJ2YWwiLCJoaWRlIiwibmV4dF9xdWVzdGlvbiIsImNoaWxkcmVuIiwiZWFjaCIsIl8iLCJlbCIsInV0aWxpdHlfb2Zfc2VsZWN0aW9uIiwic2VsZWN0aW9uIiwidXRpbGl0eSIsImlzX3VzZXJfY29ycmVjdCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJhZGRFdmVudExpc3RlbmVyIiwib24iLCJvbGRfYmFsYW5jZSIsImNvcnJlY3Rfc2VsZWN0aW9uIiwidXBkYXRlX2JhbGFuY2UiLCJsb2dnZWRfZGF0YSIsImFzeW5jIiwiZ2xvYmFsVGhpcyIsInVybF9kYXRhIiwiY29uc29sZSIsImxvZyIsInVpZCIsInJlc3VsdCIsImFqYXgiLCJKU09OIiwic3RyaW5naWZ5IiwicHJvamVjdCIsInJlcGxhY2UiLCJwYXlsb2FkIiwidHlwZSIsImNvbnRlbnRUeXBlIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0Iiwic2xlZXAiLCJlIiwibG9nX2RhdGEiLCJhY3RpdmVUaW1lciIsInN0YXJ0VGltZXIiLCJkdXJhdGlvbiIsInN0ZXBEaXYiLCJidXR0b25zIiwiY2FsbGJhY2siLCJjbGVhckludGVydmFsIiwiZm9yRWFjaCIsImJ1dHRvbiIsInNldEF0dHJpYnV0ZSIsInRpbWVyRGlzcGxheSIsImNyZWF0ZUVsZW1lbnQiLCJpZCIsInN0eWxlIiwiZm9udFdlaWdodCIsIm1hcmdpblRvcCIsImFwcGVuZENoaWxkIiwicmVtYWluaW5nVGltZSIsInRleHRDb250ZW50Iiwic2V0SW50ZXJ2YWwiLCJyZW1vdmVDaGlsZCIsInJlbW92ZUF0dHJpYnV0ZSIsImxlbmd0aCIsIk1hdGgiLCJtYXgiLCJyZXdhcmRfdGV4dCIsInRvRml4ZWQiLCJodG1sIiwidXBkYXRlZFF1ZXN0aW9uVGV4dCIsInZpc3VhbF9maWRlbGl0eV9jb25mIiwicm91bmQiLCJ2aXN1YWxfY29udHJhc3RpdmVuZXNzX2NvbmYiLCJzaW5nbGVfbnVtZXJpY19jb25mIiwidmZfZGVzY3JpcHRpdmUiLCJjb250cl9kZXNjcmlwdGl2ZSIsInRleHQiLCJleHBsYW5hdGlvblRleHQiLCJmaXJzdFN0ZXBEaXYiLCJoYW5kbGVGaXJzdFN0ZXBDbGljayIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJzZWNvbmRTdGVwRGl2Iiwid29yZHMiLCJzcGxpdCIsInJlYWRpbmdUaW1lIiwiY2VpbCIsImhhbmRsZVNlY29uZFN0ZXBDbGljayIsInRoaXJkU3RlcERpdiIsImhhbmRsZVRoaXJkU3RlcENsaWNrIiwic2V0dXBUaGlyZFN0ZXAiLCJzZXR1cFNlY29uZFN0ZXAiLCJzZXR1cEZpcnN0U3RlcCIsIm9udmlzaWJpbGl0eWNoYW5nZSIsImhpZGRlbiIsInVybFBhcmFtcyIsIlVSTFNlYXJjaFBhcmFtcyIsIndpbmRvdyIsImxvY2F0aW9uIiwic2VhcmNoIiwic3RhcnRPdmVycmlkZSIsImdldCIsIlVJREZyb21VUkwiLCJlbnRyaWVzIiwia2V5IiwidmFsdWUiLCJwYXJhbXNUb09iamVjdCIsInF1ZXVlX2lkIiwiZmxvb3IiLCJyYW5kb20iLCJwYWRTdGFydCIsIlVJRF9tYXliZSIsInByb21wdCIsImluY2x1ZGVzIiwiRXJyb3IiLCJzdGFydHNXaXRoIiwiZ2V0SlNPTiIsIkRhdGUiLCJub3ciLCJsb2FkX2RhdGEiLCJjYXRjaCIsIl9lcnJvciIsInJlbG9hZCIsInRoZW4iLCJuZXdfZGF0YSIsInBhcnNlSW50IiwicmV3YXJkSW5zdHJ1Y3Rpb25zIiwiaW5uZXJIVE1MIiwiYWJzIiwidXBkYXRlUmV3YXJkSW5zdHJ1Y3Rpb25zIiwiYWxlcnRfYWN0aXZlIiwiYWxlcnQiXSwic291cmNlUm9vdCI6IiJ9