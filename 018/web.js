(()=>{"use strict";let t="https://tejassrinivasan.pythonanywhere.com/";var e=!1,n=[];let i=-1,o=null,s=-1,a=-1,r=-1,u=0,l=0,d=0,_=0,c=0,h=0;function b(t){s=t,$("#button_answeronly_usertrusts").attr("disabled","true"),$("#button_answeronly_userdistrusts").attr("disabled","true"),$("#button_answeronly_userunsure").attr("disabled","true"),0==t?$("#button_answeronly_usertrusts").attr("activedecision","true"):1==t?$("#button_answeronly_userdistrusts").attr("activedecision","true"):2==t&&$("#button_answeronly_userunsure").attr("activedecision","true"),$("#ai_explanation_div").show()}function m(t){a=t,$("#button_withexplanation_usertrusts").attr("disabled","true"),$("#button_withexplanation_userdistrusts").attr("disabled","true"),$("#button_withexplanation_userunsure").attr("disabled","true"),0==t?$("#button_withexplanation_usertrusts").attr("activedecision","true"):1==t?$("#button_withexplanation_userdistrusts").attr("activedecision","true"):2==t&&$("#button_withexplanation_userunsure").attr("activedecision","true"),$("#ai_explanation_quality_div").show()}function w(t){r=t,$("#button_withexplanationquality_usertrusts").attr("disabled","true"),$("#button_withexplanationquality_userdistrusts").attr("disabled","true"),$("#button_withexplanationquality_userunsure").attr("disabled","true"),0==t?$("#button_withexplanationquality_usertrusts").attr("activedecision","true"):1==t?$("#button_withexplanationquality_userdistrusts").attr("activedecision","true"):2==t&&$("#button_withexplanationquality_userunsure").attr("activedecision","true"),$("#button_next").show(),$("#button_next").removeAttr("disabled")}function y(t){c+=t,0==c?$("#button_instructions_prev").attr("disabled","true"):$("#button_instructions_prev").removeAttr("disabled"),c>=5?($("#instructions_and_decorations").show(),$("#button_instructions_next").val("Start study")):($("#instructions_and_decorations").hide(),$("#button_instructions_next").val("Next")),6==c&&($("#instructions_and_decorations").show(),$("#main_box_instructions").hide(),$("#main_box_experiment").show(),g()),$("#main_box_instructions").children(":not(input)").each(((t,e)=>{$(e).hide()})),$(`#instructions_${c}`).show()}function p(t){return 2!=t?t==1-o.prediction_is_correct?1:0:-1}document.getElementById("button_answeronly_usertrusts")?.addEventListener("click",(()=>b(0))),document.getElementById("button_answeronly_userdistrusts")?.addEventListener("click",(()=>b(1))),document.getElementById("button_answeronly_userunsure")?.addEventListener("click",(()=>b(2))),document.getElementById("button_withexplanation_usertrusts")?.addEventListener("click",(()=>m(0))),document.getElementById("button_withexplanation_userdistrusts")?.addEventListener("click",(()=>m(1))),document.getElementById("button_withexplanation_userunsure")?.addEventListener("click",(()=>m(2))),document.getElementById("button_withexplanationquality_usertrusts")?.addEventListener("click",(()=>w(0))),document.getElementById("button_withexplanationquality_userdistrusts")?.addEventListener("click",(()=>w(1))),document.getElementById("button_withexplanationquality_userunsure")?.addEventListener("click",(()=>w(2))),$("#button_instructions_next").on("click",(()=>y(1))),$("#button_instructions_prev").on("click",(()=>y(-1))),$("#button_next").on("click",(()=>{let e=_;if(function(){if(2!=r){let t=1-o.prediction_is_correct;r==t?(_+=.1,u+=1):(_+=-.1,l+=1)}else d+=1}(),-1!=i){let n={question_i:i,user_selections:{answeronly:s,withexplanation:a,withexplanationquality:r},user_is_correct:{answeronly:p(s),withexplanation:p(a),withexplanationquality:p(r)},balance:{old:e,new:_}};n.question=o,n.count_exited_page=h,async function(e){e.url_data=globalThis.url_data,console.log("Data"),"study_id"in e.url_data||(e.url_data.study_id="demo_study"),"prolific_id"in e.url_data||(e.url_data.prolific_id="demo_user"),"session_id"in e.url_data||(e.url_data.session_id="demo_session"),e.url_data.queue_id=globalThis.uid,console.log("logged",e),console.log("Logging to",t+"log");try{let n=await $.ajax(t+"log",{data:JSON.stringify({project:"vlm-rationales-study/"+e.url_data.study_id,uid:globalThis.uid+"_"+e.url_data.prolific_id,payload:JSON.stringify(e)}),type:"POST",contentType:"application/json"});return await async function(){return new Promise((t=>setTimeout(t,2e3)))}(),n}catch(t){console.log(t)}}(n),h=0}g()}));let v=null;function x(t,e,n,i){v&&(clearInterval(v),v=null),n.forEach((t=>t.setAttribute("disabled","true")));let o=document.createElement("div");o.id=`timer_${e.id}`,o.style.fontWeight="bold",o.style.marginTop="10px",e.appendChild(o);let s=t;o.textContent=`Please wait ${s} second(s) before making your selection.`,v=setInterval((()=>{s--,s>=0?o.textContent=`Please wait ${s} second(s) before making your selection.`:(null!==v&&(clearInterval(v),v=null),v=null,e.removeChild(o),n.forEach((t=>t.removeAttribute("disabled"))),i&&i())}),1e3)}function g(){if(v&&(clearInterval(v),v=null),$("#button_readytoanswer").removeAttr("activedecision"),$("#button_readytoanswer").removeAttr("disabled"),$("#button_readytoanswer").show(),$("#button_answeronly_usertrusts").removeAttr("activedecision"),$("#button_answeronly_usertrusts").removeAttr("disabled"),$("#button_answeronly_userdistrusts").removeAttr("activedecision"),$("#button_answeronly_userdistrusts").removeAttr("disabled"),$("#button_answeronly_userunsure").removeAttr("activedecision"),$("#button_answeronly_userunsure").removeAttr("disabled"),$("#button_withexplanation_usertrusts").removeAttr("activedecision"),$("#button_withexplanation_usertrusts").removeAttr("disabled"),$("#button_withexplanation_userdistrusts").removeAttr("activedecision"),$("#button_withexplanation_userdistrusts").removeAttr("disabled"),$("#button_withexplanation_userunsure").removeAttr("activedecision"),$("#button_withexplanation_userunsure").removeAttr("disabled"),$("#button_withexplanationquality_usertrusts").removeAttr("activedecision"),$("#button_withexplanationquality_usertrusts").removeAttr("disabled"),$("#button_withexplanationquality_userdistrusts").removeAttr("activedecision"),$("#button_withexplanationquality_userdistrusts").removeAttr("disabled"),$("#button_withexplanationquality_userunsure").removeAttr("activedecision"),$("#button_withexplanationquality_userunsure").removeAttr("disabled"),$("#ai_explanation_div").hide(),$("#ai_explanation_quality_div").hide(),$("#button_next").hide(),$("#button_quit").hide(),i+=1,i>=n.length){$("#main_box_experiment").hide(),_=Math.max(0,_);let t=`Your total reward is <b>$${_.toFixed(2)} + $2</b>.`;return t+=`<br>You answered a total of ${i} questions: ${u} correct, ${l} incorrect, ${d} unsure.`,void(e?($("#reward_box_mock").html(t),$("#reward_box_mock").show(),$("#main_box_end_mock").show()):($("#reward_box").html(t),$("#reward_box").show(),$("#main_box_end").show()))}o=n[i];const t=o.question.replace("Choices:","<br><b>Choices:</b>");$("#question_span").html(t),$("#ai_prediction_span").html(o.predicted_answer),$("#ai_explanation_span").html(o.generated_rationale);let s=Math.round(100*o.visual_fidelity);$("#explanation_fidelity_span").html(`${s}%`);let a=Math.round(100*o.contrastiveness);$("#explanation_contrastiveness_span").html(`${a}%`),$("#progress").text(`Progress: ${i+1} / ${n.length}`),function(t){const e=document.getElementById("ai_answer_div"),n=[document.getElementById("button_answeronly_usertrusts"),document.getElementById("button_answeronly_userdistrusts"),document.getElementById("button_answeronly_userunsure")];function i(){n.forEach((t=>t?.removeEventListener("click",i))),function(t){const e=document.getElementById("ai_explanation_div"),n=t.split(" ").length,i=Math.max(Math.ceil(3+n/238*60),5),o=[document.getElementById("button_withexplanation_usertrusts"),document.getElementById("button_withexplanation_userdistrusts"),document.getElementById("button_withexplanation_userunsure")];function s(){o.forEach((t=>t?.removeEventListener("click",s))),function(){const t=document.getElementById("ai_explanation_quality_div"),e=[document.getElementById("button_withexplanationquality_usertrusts"),document.getElementById("button_withexplanationquality_userdistrusts"),document.getElementById("button_withexplanationquality_userunsure")];function n(){e.forEach((t=>t?.removeEventListener("click",n))),$("#button_next").show()}e.forEach((t=>t?.removeEventListener("click",n))),e.forEach((t=>t?.addEventListener("click",n))),$("#ai_explanation_quality_div").show(),x(5,t,e,null)}()}o.forEach((t=>t?.removeEventListener("click",s))),o.forEach((t=>t?.addEventListener("click",s))),$("#ai_explanation_div").show(),x(i,e,o,null)}(t)}n.forEach((t=>t?.removeEventListener("click",i))),n.forEach((t=>t?.addEventListener("click",i))),$("#ai_answer_div").show(),x(5,e,n,null)}(o.generated_rationale)}document.onvisibilitychange=()=>{document.hidden?(console.log("Window lost focus."),null!==v&&(clearInterval(v),v=null)):console.log("Window regained focus.")};const f=new URLSearchParams(window.location.search),E=f.get("start"),q=f.get("uid");if(globalThis.url_data=function(t){const e={};for(const[n,i]of t)e[n]=i;return e}(f.entries()),null==globalThis.url_data.study_id&&(globalThis.url_data.study_id="demo_study"),null==globalThis.url_data.prolific_id&&(globalThis.url_data.prolific_id="demo_user"),null==globalThis.url_data.session_id&&(globalThis.url_data.session_id="demo_session"),null!=q){if(globalThis.uid=q,"prolific_random"==globalThis.uid){let t=`${Math.floor(10*Math.random())}`.padStart(3,"0");globalThis.uid=`${f.get("prolific_queue_name")}/${t}`}}else{let t=null;for(;null==t;)t=prompt("Enter your user id. Please get in touch if you were not assigned an id but wish to participate in this experiment.");globalThis.uid=t}globalThis.url_data.session_id.startsWith("demo")&&(e=!0),console.log("Running with UID",globalThis.uid),fetch("./baked_queues/llava1.5_with_image_q20_i10_s0/018.json").then((t=>{if(!t.ok)throw new Error("Failed to load dataset.");return t.json()})).then((t=>{n=t,null!=E&&(i=parseInt(E)-1,console.log("Starting from",i)),y(0),function(){const t=document.getElementById("reward_instructions");t&&(t.innerHTML=`\n            If your final decision is correct, you gain a reward of $${.1.toFixed(2)}. \n            If your final decision is incorrect, you lose $${Math.abs(-.1).toFixed(2)} from your reward. \n            You will see your total reward at the end of the experiment. \n            Your payment is $2.0 plus whatever you accumulate during this experiment.\n        `)}(),$("#main_box_instructions").show(),$("#instructions_and_decorations").hide()})).catch((t=>{console.error("Invalid user id or dataset loading failed."),console.log(globalThis.uid),window.location.reload()})),console.log("Starting session with UID:",globalThis.uid);let I=!1;document.onvisibilitychange=()=>{I||(h+=1,I=!0,I=!1)}})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UUFBUUMsSUFBSSxnQkFBaUIxQyxJQUVqQ21CLEVBQWtCLEdBaGIxQixXQUNJLE1BQU1xSCxFQUFxQjFHLFNBQVNDLGVBQWUsdUJBRS9DeUcsSUFDQUEsRUFBbUJDLFVBQVksMEVDdkZULEdEd0Z3RHJELFFBQVEsb0VBQ2pDSCxLQUFLeUQsS0N4RmpDLElEd0Z3RHRELFFBQVEsb01BT2pHLENBb2FRdUQsR0FDQTlILEVBQUUsMEJBQTBCRSxPQUM1QkYsRUFBRSxpQ0FBaUNTLE1BQU0sSUFFNUNzSCxPQUFPQyxJQUNKcEcsUUFBUXFHLE1BQU0sOENBQ2RyRyxRQUFRQyxJQUFJSCxXQUFXSSxLQUN2Qm9FLE9BQU9DLFNBQVMrQixRQUFRLElBSWhDdEcsUUFBUUMsSUFBSSw2QkFBOEJILFdBQVdJLEtBRXJELElBQUlxRyxHQUFlLEVBQ25CbEgsU0FBUzZFLG1CQUFxQixLQUNyQnFDLElBQ0R0SSxHQUFxQixFQUNyQnNJLEdBQWUsRUFJZkEsR0FBZSxFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL2Nvbm5lY3Rvci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvbWFpbi50cyIsIndlYnBhY2s6Ly8vLi9zcmMvZ2xvYmFscy50cyIsIndlYnBhY2s6Ly8vLi9zcmMvdXRpbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgREVWTU9ERSB9IGZyb20gJy4vZ2xvYmFscydcbmltcG9ydCB7IE1PQ0tNT0RFIH0gZnJvbSAnLi9tYWluJ1xuXG5sZXQgU0VSVkVSX0xPR19ST09UID0gREVWTU9ERSA/IFwiaHR0cDovLzEyNy4wLjAuMTo1MDAwL1wiIDogXCJodHRwczovL3RlamFzc3Jpbml2YXNhbi5weXRob25hbnl3aGVyZS5jb20vXCJcblxuYXN5bmMgZnVuY3Rpb24gc2xlZXAobXM6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCBtcykpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbG9hZF9kYXRhKCk6IFByb21pc2U8YW55PiB7XG4gICAgLy8gaW5jbHVkZSB0aW1lc3RhbXAgc28gdGhhdCB0aGluZ3MgZG9uJ3QgZ2V0IGNhY2hlZFxuICAgIGxldCByZXN1bHQgPSBhd2FpdCAkLmdldEpTT04oXG4gICAgICAgIGBiYWtlZF9xdWV1ZXMvJHtnbG9iYWxUaGlzLnVpZH0uanNvbj90PSR7RGF0ZS5ub3coKX1gLFxuICAgIClcbiAgICByZXR1cm4gcmVzdWx0XG59XG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbG9nX2RhdGEoZGF0YSk6IFByb21pc2U8YW55PiB7XG4gICAgLy9pZiAoTU9DS01PREUpIHtcbiAgICAvLyAgICBjb25zb2xlLmxvZyhcImxvZ2dlZCAobW9jaylcIiwgZGF0YSlcbiAgICAvLyAgICByZXR1cm5cbiAgICAvL31cbiAgICBcbiAgICBkYXRhW1widXJsX2RhdGFcIl0gPSBnbG9iYWxUaGlzLnVybF9kYXRhXG4gICAgY29uc29sZS5sb2coXCJEYXRhXCIpXG4gICAgaWYgKCEoXCJzdHVkeV9pZFwiIGluIGRhdGFbJ3VybF9kYXRhJ10pKSB7XG4gICAgICAgIGRhdGFbJ3VybF9kYXRhJ11bXCJzdHVkeV9pZFwiXSA9IFwiZGVtb19zdHVkeVwiXG4gICAgfVxuICAgIGlmICghKFwicHJvbGlmaWNfaWRcIiBpbiBkYXRhWyd1cmxfZGF0YSddKSkge1xuICAgICAgICBkYXRhWyd1cmxfZGF0YSddW1wicHJvbGlmaWNfaWRcIl0gPSBcImRlbW9fdXNlclwiXG4gICAgfVxuICAgIGlmICghKFwic2Vzc2lvbl9pZFwiIGluIGRhdGFbJ3VybF9kYXRhJ10pKSB7XG4gICAgICAgIGRhdGFbJ3VybF9kYXRhJ11bXCJzZXNzaW9uX2lkXCJdID0gXCJkZW1vX3Nlc3Npb25cIlxuICAgIH1cbiAgICBkYXRhW1widXJsX2RhdGFcIl1bXCJxdWV1ZV9pZFwiXSA9IGdsb2JhbFRoaXMudWlkXG4gICAgY29uc29sZS5sb2coXCJsb2dnZWRcIiwgZGF0YSlcbiAgICBjb25zb2xlLmxvZyhcIkxvZ2dpbmcgdG9cIiwgU0VSVkVSX0xPR19ST09UICsgXCJsb2dcIilcblxuICAgIHRyeSB7XG4gICAgICAgIGxldCByZXN1bHQgPSBhd2FpdCAkLmFqYXgoXG4gICAgICAgICAgICBTRVJWRVJfTE9HX1JPT1QgKyBcImxvZ1wiLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgICAgICAgcHJvamVjdDogXCJ2bG0tcmF0aW9uYWxlcy1zdHVkeS9cIitkYXRhWyd1cmxfZGF0YSddWydzdHVkeV9pZCddLFxuICAgICAgICAgICAgICAgICAgICB1aWQ6IGdsb2JhbFRoaXMudWlkK1wiX1wiK2RhdGFbJ3VybF9kYXRhJ11bJ3Byb2xpZmljX2lkJ10sXG4gICAgICAgICAgICAgICAgICAgIHBheWxvYWQ6IEpTT04uc3RyaW5naWZ5KGRhdGEpLFxuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAgICAgfVxuICAgICAgICApXG4gICAgICAgIGF3YWl0IHNsZWVwKDIwMDApO1xuICAgICAgICByZXR1cm4gcmVzdWx0XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBjb25zb2xlLmxvZyhlKVxuICAgIH1cbn0iLCJpbXBvcnQgeyBERVZNT0RFLCBEQVRBU0VULCBSRVdBUkRfQ09SUkVDVCwgUEVOQUxUWV9JTkNPUlJFQ1QsIEVOQUJMRV9USU1FUiB9IGZyb20gXCIuL2dsb2JhbHNcIlxuZXhwb3J0IHZhciBVSUQ6IHN0cmluZ1xuZXhwb3J0IHZhciBNT0NLTU9ERTogYm9vbGVhbiA9IGZhbHNlXG5pbXBvcnQgeyBsb2FkX2RhdGEsIGxvZ19kYXRhIH0gZnJvbSAnLi9jb25uZWN0b3InXG5pbXBvcnQgeyBwYXJhbXNUb09iamVjdCB9IGZyb20gXCIuL3V0aWxzXCJcblxudmFyIGRhdGE6IGFueVtdID0gW11cbmxldCBxdWVzdGlvbl9pID0gLTFcbmxldCBxdWVzdGlvbjogYW55ID0gbnVsbFxubGV0IHVzZXJzZWxlY3Rpb25fYW5zd2Vyb25seTogbnVtYmVyID0gLTFcbmxldCB1c2Vyc2VsZWN0aW9uX3dpdGhleHBsYW5hdGlvbjogbnVtYmVyID0gLTFcbmxldCB1c2Vyc2VsZWN0aW9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHk6IG51bWJlciA9IC0xXG5sZXQgbnVtX2NvcnJlY3QgPSAwXG5sZXQgbnVtX2luY29ycmVjdCA9IDBcbmxldCBudW1fdW5zdXJlID0gMFxuXG5sZXQgYmFsYW5jZSA9IDBcblxubGV0IGluc3RydWN0aW9uX2k6IG51bWJlciA9IDBcbmxldCBjb3VudF9leGl0ZWRfcGFnZTogbnVtYmVyID0gMFxuXG5mdW5jdGlvbiBhc3NlcnQoY29uZGl0aW9uLCBtZXNzYWdlKSB7XG4gICAgaWYgKCFjb25kaXRpb24pIHtcbiAgICAgICAgdGhyb3cgbWVzc2FnZSB8fCBcIkFzc2VydGlvbiBmYWlsZWRcIjtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHJlZ2lzdGVyQW5zd2VyT25seVVzZXJTZWxlY3Rpb24odXNlcl9jaG9pY2U6IG51bWJlcikge1xuICAgIHVzZXJzZWxlY3Rpb25fYW5zd2Vyb25seSA9IHVzZXJfY2hvaWNlXG5cbiAgICAkKFwiI2J1dHRvbl9hbnN3ZXJvbmx5X3VzZXJ0cnVzdHNcIikuYXR0cihcImRpc2FibGVkXCIsIFwidHJ1ZVwiKVxuICAgICQoXCIjYnV0dG9uX2Fuc3dlcm9ubHlfdXNlcmRpc3RydXN0c1wiKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJ0cnVlXCIpXG4gICAgJChcIiNidXR0b25fYW5zd2Vyb25seV91c2VydW5zdXJlXCIpLmF0dHIoXCJkaXNhYmxlZFwiLCBcInRydWVcIilcbiAgICBpZiAodXNlcl9jaG9pY2UgPT0gMCkge1xuICAgICAgICAkKFwiI2J1dHRvbl9hbnN3ZXJvbmx5X3VzZXJ0cnVzdHNcIikuYXR0cihcImFjdGl2ZWRlY2lzaW9uXCIsIFwidHJ1ZVwiKVxuICAgIH0gZWxzZSBpZiAodXNlcl9jaG9pY2UgPT0gMSkge1xuICAgICAgICAkKFwiI2J1dHRvbl9hbnN3ZXJvbmx5X3VzZXJkaXN0cnVzdHNcIikuYXR0cihcImFjdGl2ZWRlY2lzaW9uXCIsIFwidHJ1ZVwiKVxuICAgIH0gZWxzZSBpZiAodXNlcl9jaG9pY2UgPT0gMikge1xuICAgICAgICAkKFwiI2J1dHRvbl9hbnN3ZXJvbmx5X3VzZXJ1bnN1cmVcIikuYXR0cihcImFjdGl2ZWRlY2lzaW9uXCIsIFwidHJ1ZVwiKVxuICAgIH1cbiAgICAkKFwiI2FpX2V4cGxhbmF0aW9uX2RpdlwiKS5zaG93KClcbn1cbi8vIEV2ZW50IGxpc3RlbmVyIGZvciB0aGUgYnV0dG9uIGNsaWNrXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnV0dG9uX2Fuc3dlcm9ubHlfdXNlcnRydXN0cycpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHJlZ2lzdGVyQW5zd2VyT25seVVzZXJTZWxlY3Rpb24oMCkpO1xuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1dHRvbl9hbnN3ZXJvbmx5X3VzZXJkaXN0cnVzdHMnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiByZWdpc3RlckFuc3dlck9ubHlVc2VyU2VsZWN0aW9uKDEpKTtcbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXR0b25fYW5zd2Vyb25seV91c2VydW5zdXJlJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gcmVnaXN0ZXJBbnN3ZXJPbmx5VXNlclNlbGVjdGlvbigyKSk7XG5cblxuZnVuY3Rpb24gcmVnaXN0ZXJXaXRoRXhwbGFuYXRpb25Vc2VyU2VsZWN0aW9uKHVzZXJfY2hvaWNlOiBudW1iZXIpIHtcbiAgICB1c2Vyc2VsZWN0aW9uX3dpdGhleHBsYW5hdGlvbiA9IHVzZXJfY2hvaWNlXG5cbiAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25fdXNlcnRydXN0c1wiKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJ0cnVlXCIpXG4gICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9uX3VzZXJkaXN0cnVzdHNcIikuYXR0cihcImRpc2FibGVkXCIsIFwidHJ1ZVwiKVxuICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbl91c2VydW5zdXJlXCIpLmF0dHIoXCJkaXNhYmxlZFwiLCBcInRydWVcIilcbiAgICBpZiAodXNlcl9jaG9pY2UgPT0gMCkge1xuICAgICAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25fdXNlcnRydXN0c1wiKS5hdHRyKFwiYWN0aXZlZGVjaXNpb25cIiwgXCJ0cnVlXCIpXG4gICAgfSBlbHNlIGlmICh1c2VyX2Nob2ljZSA9PSAxKSB7XG4gICAgICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbl91c2VyZGlzdHJ1c3RzXCIpLmF0dHIoXCJhY3RpdmVkZWNpc2lvblwiLCBcInRydWVcIilcbiAgICB9IGVsc2UgaWYgKHVzZXJfY2hvaWNlID09IDIpIHtcbiAgICAgICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9uX3VzZXJ1bnN1cmVcIikuYXR0cihcImFjdGl2ZWRlY2lzaW9uXCIsIFwidHJ1ZVwiKVxuICAgIH1cbiAgICAkKFwiI2FpX2V4cGxhbmF0aW9uX3F1YWxpdHlfZGl2XCIpLnNob3coKVxufVxuXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnV0dG9uX3dpdGhleHBsYW5hdGlvbl91c2VydHJ1c3RzJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gcmVnaXN0ZXJXaXRoRXhwbGFuYXRpb25Vc2VyU2VsZWN0aW9uKDApKTtcbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXR0b25fd2l0aGV4cGxhbmF0aW9uX3VzZXJkaXN0cnVzdHMnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiByZWdpc3RlcldpdGhFeHBsYW5hdGlvblVzZXJTZWxlY3Rpb24oMSkpO1xuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1dHRvbl93aXRoZXhwbGFuYXRpb25fdXNlcnVuc3VyZScpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHJlZ2lzdGVyV2l0aEV4cGxhbmF0aW9uVXNlclNlbGVjdGlvbigyKSk7XG4gIFxuZnVuY3Rpb24gcmVnaXN0ZXJXaXRoRXhwbGFuYXRpb25RdWFsaXR5VXNlclNlbGVjdGlvbih1c2VyX2Nob2ljZTogbnVtYmVyKSB7XG4gICAgdXNlcnNlbGVjdGlvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5ID0gdXNlcl9jaG9pY2VcblxuICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHlfdXNlcnRydXN0c1wiKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJ0cnVlXCIpXG4gICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eV91c2VyZGlzdHJ1c3RzXCIpLmF0dHIoXCJkaXNhYmxlZFwiLCBcInRydWVcIilcbiAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5X3VzZXJ1bnN1cmVcIikuYXR0cihcImRpc2FibGVkXCIsIFwidHJ1ZVwiKVxuICAgIGlmICh1c2VyX2Nob2ljZSA9PSAwKSB7XG4gICAgICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHlfdXNlcnRydXN0c1wiKS5hdHRyKFwiYWN0aXZlZGVjaXNpb25cIiwgXCJ0cnVlXCIpXG4gICAgfSBlbHNlIGlmICh1c2VyX2Nob2ljZSA9PSAxKSB7XG4gICAgICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHlfdXNlcmRpc3RydXN0c1wiKS5hdHRyKFwiYWN0aXZlZGVjaXNpb25cIiwgXCJ0cnVlXCIpXG4gICAgfSBlbHNlIGlmICh1c2VyX2Nob2ljZSA9PSAyKSB7XG4gICAgICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHlfdXNlcnVuc3VyZVwiKS5hdHRyKFwiYWN0aXZlZGVjaXNpb25cIiwgXCJ0cnVlXCIpXG4gICAgfVxuICAgICQoXCIjYnV0dG9uX25leHRcIikuc2hvdygpXG4gICAgJChcIiNidXR0b25fbmV4dFwiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIilcbn1cblxuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1dHRvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5X3VzZXJ0cnVzdHMnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiByZWdpc3RlcldpdGhFeHBsYW5hdGlvblF1YWxpdHlVc2VyU2VsZWN0aW9uKDApKTtcbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXR0b25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eV91c2VyZGlzdHJ1c3RzJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gcmVnaXN0ZXJXaXRoRXhwbGFuYXRpb25RdWFsaXR5VXNlclNlbGVjdGlvbigxKSk7XG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnV0dG9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHlfdXNlcnVuc3VyZScpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHJlZ2lzdGVyV2l0aEV4cGxhbmF0aW9uUXVhbGl0eVVzZXJTZWxlY3Rpb24oMikpO1xuXG5cbmZ1bmN0aW9uIHVwZGF0ZVJld2FyZEluc3RydWN0aW9ucygpIHtcbiAgICBjb25zdCByZXdhcmRJbnN0cnVjdGlvbnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV3YXJkX2luc3RydWN0aW9ucycpO1xuXG4gICAgaWYgKHJld2FyZEluc3RydWN0aW9ucykge1xuICAgICAgICByZXdhcmRJbnN0cnVjdGlvbnMuaW5uZXJIVE1MID0gYFxuICAgICAgICAgICAgSWYgeW91ciBmaW5hbCBkZWNpc2lvbiBpcyBjb3JyZWN0LCB5b3UgZ2FpbiBhIHJld2FyZCBvZiAkJHtSRVdBUkRfQ09SUkVDVC50b0ZpeGVkKDIpfS4gXG4gICAgICAgICAgICBJZiB5b3VyIGZpbmFsIGRlY2lzaW9uIGlzIGluY29ycmVjdCwgeW91IGxvc2UgJCR7TWF0aC5hYnMoUEVOQUxUWV9JTkNPUlJFQ1QpLnRvRml4ZWQoMil9IGZyb20geW91ciByZXdhcmQuIFxuICAgICAgICAgICAgWW91IHdpbGwgc2VlIHlvdXIgdG90YWwgcmV3YXJkIGF0IHRoZSBlbmQgb2YgdGhlIGV4cGVyaW1lbnQuIFxuICAgICAgICAgICAgWW91ciBwYXltZW50IGlzICQyLjAgcGx1cyB3aGF0ZXZlciB5b3UgYWNjdW11bGF0ZSBkdXJpbmcgdGhpcyBleHBlcmltZW50LlxuICAgICAgICBgO1xuICAgICAgICAvLyBJZiB5b3VyIGZpbmFsIGRlY2lzaW9uIGlzIGNvcnJlY3QsIHlvdSBnYWluIGEgcmV3YXJkIG9mICQwLjEwLiBJZiB5b3VyIGZpbmFsIGRlY2lzaW9uIGlzIGluY29ycmVjdCwgeW91IGxvc2UgJDAuMTAgZnJvbSB5b3VyIHJld2FyZC5cbiAgICAgICAgLy8gWW91IHdpbGwgc2VlIHlvdXIgdG90YWwgcmV3YXJkIGF0IHRoZSBlbmQgb2YgdGhlIGV4cGVyaW1lbnQuIFlvdXIgcGF5bWVudCBpcyAkMi4wIHBsdXMgd2hhdGV2ZXIgeW91IGFjY3VtdWxhdGUgZHVyaW5nIHRoaXMgZXhwZXJpbWVudC5cbiAgICB9XG59XG5cbmZ1bmN0aW9uIG5leHRfaW5zdHJ1Y3Rpb25zKGluY3JlbWVudDogbnVtYmVyKSB7XG4gICAgaW5zdHJ1Y3Rpb25faSArPSBpbmNyZW1lbnRcblxuICAgIGlmIChpbnN0cnVjdGlvbl9pID09IDApIHtcbiAgICAgICAgJChcIiNidXR0b25faW5zdHJ1Y3Rpb25zX3ByZXZcIikuYXR0cihcImRpc2FibGVkXCIsIFwidHJ1ZVwiKVxuICAgIH0gZWxzZSB7XG4gICAgICAgICQoXCIjYnV0dG9uX2luc3RydWN0aW9uc19wcmV2XCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKVxuICAgIH1cbiAgICBpZiAoaW5zdHJ1Y3Rpb25faSA+PSA1KSB7XG4gICAgICAgICQoXCIjaW5zdHJ1Y3Rpb25zX2FuZF9kZWNvcmF0aW9uc1wiKS5zaG93KClcbiAgICAgICAgJChcIiNidXR0b25faW5zdHJ1Y3Rpb25zX25leHRcIikudmFsKFwiU3RhcnQgc3R1ZHlcIilcbiAgICB9IGVsc2Uge1xuICAgICAgICAkKFwiI2luc3RydWN0aW9uc19hbmRfZGVjb3JhdGlvbnNcIikuaGlkZSgpXG4gICAgICAgICQoXCIjYnV0dG9uX2luc3RydWN0aW9uc19uZXh0XCIpLnZhbChcIk5leHRcIilcbiAgICB9XG4gICAgaWYgKGluc3RydWN0aW9uX2kgPT0gNikge1xuICAgICAgICAkKFwiI2luc3RydWN0aW9uc19hbmRfZGVjb3JhdGlvbnNcIikuc2hvdygpXG4gICAgICAgICQoXCIjbWFpbl9ib3hfaW5zdHJ1Y3Rpb25zXCIpLmhpZGUoKVxuICAgICAgICAkKFwiI21haW5fYm94X2V4cGVyaW1lbnRcIikuc2hvdygpXG4gICAgICAgIG5leHRfcXVlc3Rpb24oKVxuICAgIH1cblxuICAgICQoXCIjbWFpbl9ib3hfaW5zdHJ1Y3Rpb25zXCIpLmNoaWxkcmVuKFwiOm5vdChpbnB1dClcIikuZWFjaCgoXywgZWwpID0+IHtcbiAgICAgICAgJChlbCkuaGlkZSgpXG4gICAgfSlcbiAgICAkKGAjaW5zdHJ1Y3Rpb25zXyR7aW5zdHJ1Y3Rpb25faX1gKS5zaG93KClcbn1cbiQoXCIjYnV0dG9uX2luc3RydWN0aW9uc19uZXh0XCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4gbmV4dF9pbnN0cnVjdGlvbnMoKzEpKVxuJChcIiNidXR0b25faW5zdHJ1Y3Rpb25zX3ByZXZcIikub24oXCJjbGlja1wiLCAoKSA9PiBuZXh0X2luc3RydWN0aW9ucygtMSkpXG5cbiQoXCIjYnV0dG9uX25leHRcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG5cbiAgICAvLyBVcGRhdGUgdGhlIHVzZXIgYmFsYW5jZVxuICAgIGxldCBvbGRfYmFsYW5jZSA9IGJhbGFuY2VcbiAgICB1cGRhdGVfYmFsYW5jZSgpXG5cbiAgICBpZiAocXVlc3Rpb25faSAhPSAtMSkge1xuICAgICAgICBsZXQgbG9nZ2VkX2RhdGEgPSB7XG4gICAgICAgICAgICBcInF1ZXN0aW9uX2lcIjogcXVlc3Rpb25faSxcbiAgICAgICAgICAgIFwidXNlcl9zZWxlY3Rpb25zXCI6IHtcbiAgICAgICAgICAgICAgICBcImFuc3dlcm9ubHlcIjogdXNlcnNlbGVjdGlvbl9hbnN3ZXJvbmx5LFxuICAgICAgICAgICAgICAgIFwid2l0aGV4cGxhbmF0aW9uXCI6IHVzZXJzZWxlY3Rpb25fd2l0aGV4cGxhbmF0aW9uLFxuICAgICAgICAgICAgICAgIFwid2l0aGV4cGxhbmF0aW9ucXVhbGl0eVwiOiB1c2Vyc2VsZWN0aW9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHlcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcInVzZXJfaXNfY29ycmVjdFwiOiB7XG4gICAgICAgICAgICAgICAgXCJhbnN3ZXJvbmx5XCI6IGlzX3VzZXJfY29ycmVjdCh1c2Vyc2VsZWN0aW9uX2Fuc3dlcm9ubHkpLFxuICAgICAgICAgICAgICAgIFwid2l0aGV4cGxhbmF0aW9uXCI6IGlzX3VzZXJfY29ycmVjdCh1c2Vyc2VsZWN0aW9uX3dpdGhleHBsYW5hdGlvbiksXG4gICAgICAgICAgICAgICAgXCJ3aXRoZXhwbGFuYXRpb25xdWFsaXR5XCI6IGlzX3VzZXJfY29ycmVjdCh1c2Vyc2VsZWN0aW9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHkpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJiYWxhbmNlXCI6IHtcbiAgICAgICAgICAgICAgICBcIm9sZFwiOiBvbGRfYmFsYW5jZSxcbiAgICAgICAgICAgICAgICBcIm5ld1wiOiBiYWxhbmNlXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBsb2dnZWRfZGF0YVsncXVlc3Rpb24nXSA9IHF1ZXN0aW9uXG4gICAgICAgIGxvZ2dlZF9kYXRhWydjb3VudF9leGl0ZWRfcGFnZSddID0gY291bnRfZXhpdGVkX3BhZ2VcbiAgICAgICAgbG9nX2RhdGEobG9nZ2VkX2RhdGEpXG4gICAgICAgIGNvdW50X2V4aXRlZF9wYWdlID0gMFxuICAgIH1cbiAgICBcblxuICAgIG5leHRfcXVlc3Rpb24oKVxufSk7XG5cblxuZnVuY3Rpb24gaXNfdXNlcl9jb3JyZWN0KHNlbGVjdGlvbikge1xuICAgIGlmIChzZWxlY3Rpb24gIT0gMikge1xuICAgICAgICBsZXQgY29ycmVjdF9zZWxlY3Rpb24gPSAxIC0gcXVlc3Rpb25bXCJwcmVkaWN0aW9uX2lzX2NvcnJlY3RcIl0gLy8gMCBpZiBBSSBpcyBjb3JyZWN0LCAxIGlmIGluY29ycmVjdFxuICAgICAgICByZXR1cm4gc2VsZWN0aW9uID09IGNvcnJlY3Rfc2VsZWN0aW9uID8gMSA6IDBcbiAgICB9XG4gICAgcmV0dXJuIC0xXG59XG5cbmZ1bmN0aW9uIHVwZGF0ZV9iYWxhbmNlKCkge1xuICAgIGlmICh1c2Vyc2VsZWN0aW9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHkgIT0gMikge1xuICAgICAgICBsZXQgY29ycmVjdF9zZWxlY3Rpb24gPSAxIC0gcXVlc3Rpb25bXCJwcmVkaWN0aW9uX2lzX2NvcnJlY3RcIl0gLy8gMCBpZiBBSSBpcyBjb3JyZWN0LCAxIGlmIGluY29ycmVjdFxuICAgICAgICBpZiAodXNlcnNlbGVjdGlvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5ID09IGNvcnJlY3Rfc2VsZWN0aW9uKSB7XG4gICAgICAgICAgICBiYWxhbmNlICs9IFJFV0FSRF9DT1JSRUNUO1xuICAgICAgICAgICAgbnVtX2NvcnJlY3QgKz0gMTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGJhbGFuY2UgKz0gUEVOQUxUWV9JTkNPUlJFQ1Q7XG4gICAgICAgICAgICBudW1faW5jb3JyZWN0ICs9IDE7XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICBudW1fdW5zdXJlICs9IDE7XG4gICAgfVxufVxuXG4vLyBUbyBlbnN1cmUgYmFsYW5jZSBpcyBub24tbmVnYXRpdmVcbmZ1bmN0aW9uIGZpbmFsaXplX2JhbGFuY2UoKSB7XG4gICAgYmFsYW5jZSA9IE1hdGgubWF4KDAsIGJhbGFuY2UpO1xuICAgIHJldHVybiBiYWxhbmNlO1xufVxuXG5sZXQgYWN0aXZlVGltZXI6IFJldHVyblR5cGU8dHlwZW9mIHNldEludGVydmFsPiB8IG51bGwgPSBudWxsOyAvLyBUaW1lciBpbnRlcnZhbFxuXG5mdW5jdGlvbiBzdGFydFRpbWVyKGR1cmF0aW9uLCBzdGVwRGl2LCBidXR0b25zLCBjYWxsYmFjaykge1xuICAgIGlmICghRU5BQkxFX1RJTUVSKSB7XG4gICAgICAgIC8vIElmIHRoZSB0aW1lciBpcyBkaXNhYmxlZCwgZW5hYmxlIHRoZSBidXR0b25zIGltbWVkaWF0ZWx5XG4gICAgICAgIGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gYnV0dG9uLnJlbW92ZUF0dHJpYnV0ZShcImRpc2FibGVkXCIpKTtcbiAgICAgICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjaygpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gQ2xlYXIgYW55IGV4aXN0aW5nIHRpbWVyIHRvIHByZXZlbnQgbXVsdGlwbGUgaW50ZXJ2YWxzXG4gICAgaWYgKGFjdGl2ZVRpbWVyKSB7XG4gICAgICAgIGNsZWFySW50ZXJ2YWwoYWN0aXZlVGltZXIpO1xuICAgICAgICBhY3RpdmVUaW1lciA9IG51bGw7XG4gICAgfVxuXG4gICAgLy8gRGlzYWJsZSBidXR0b25zXG4gICAgYnV0dG9ucy5mb3JFYWNoKGJ1dHRvbiA9PiBidXR0b24uc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgXCJ0cnVlXCIpKTtcbiAgICBcbiAgICAvLyBTaG93IHRpbWVyIHZpc3VhbGx5XG4gICAgbGV0IHRpbWVyRGlzcGxheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIHRpbWVyRGlzcGxheS5pZCA9IGB0aW1lcl8ke3N0ZXBEaXYuaWR9YDtcbiAgICB0aW1lckRpc3BsYXkuc3R5bGUuZm9udFdlaWdodCA9ICdib2xkJztcbiAgICB0aW1lckRpc3BsYXkuc3R5bGUubWFyZ2luVG9wID0gJzEwcHgnO1xuICAgIHN0ZXBEaXYuYXBwZW5kQ2hpbGQodGltZXJEaXNwbGF5KTtcblxuICAgIGxldCByZW1haW5pbmdUaW1lID0gZHVyYXRpb247XG5cbiAgICAvLyBJbml0aWFsIGRpc3BsYXlcbiAgICB0aW1lckRpc3BsYXkudGV4dENvbnRlbnQgPSBgUGxlYXNlIHdhaXQgJHtyZW1haW5pbmdUaW1lfSBzZWNvbmQocykgYmVmb3JlIG1ha2luZyB5b3VyIHNlbGVjdGlvbi5gO1xuXG4gICAgYWN0aXZlVGltZXIgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgIHJlbWFpbmluZ1RpbWUtLTtcbiAgICAgICAgaWYgKHJlbWFpbmluZ1RpbWUgPj0gMCkge1xuICAgICAgICAgICAgdGltZXJEaXNwbGF5LnRleHRDb250ZW50ID0gYFBsZWFzZSB3YWl0ICR7cmVtYWluaW5nVGltZX0gc2Vjb25kKHMpIGJlZm9yZSBtYWtpbmcgeW91ciBzZWxlY3Rpb24uYDtcbiAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgaWYgKGFjdGl2ZVRpbWVyICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChhY3RpdmVUaW1lcik7IC8vIFN0b3AgdGhlIHRpbWVyXG4gICAgICAgICAgICAgICAgYWN0aXZlVGltZXIgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYWN0aXZlVGltZXIgPSBudWxsO1xuXG4gICAgICAgICAgICAvLyBSZW1vdmUgdGltZXIgZGlzcGxheVxuICAgICAgICAgICAgc3RlcERpdi5yZW1vdmVDaGlsZCh0aW1lckRpc3BsYXkpO1xuXG4gICAgICAgICAgICAvLyBFbmFibGUgYnV0dG9uc1xuICAgICAgICAgICAgYnV0dG9ucy5mb3JFYWNoKGJ1dHRvbiA9PiBidXR0b24ucmVtb3ZlQXR0cmlidXRlKFwiZGlzYWJsZWRcIikpO1xuXG4gICAgICAgICAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKCk7XG4gICAgICAgIH1cbiAgICB9LCAxMDAwKTtcbn1cblxuLy8gV2hlbiB0aGUgdXNlciBzd2l0Y2hlcyB0YWJzIG9yIG1pbmltaXplcyB0aGUgd2luZG93LCBwYXVzZSB0aGUgdGltZXJcbmRvY3VtZW50Lm9udmlzaWJpbGl0eWNoYW5nZSA9ICgpID0+IHtcbiAgICBpZiAoZG9jdW1lbnQuaGlkZGVuKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiV2luZG93IGxvc3QgZm9jdXMuXCIpO1xuICAgICAgICBpZiAoYWN0aXZlVGltZXIgIT09IG51bGwpIHtcbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoYWN0aXZlVGltZXIpOyAvLyBQYXVzZSB0aGUgdGltZXJcbiAgICAgICAgICAgIGFjdGl2ZVRpbWVyID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEhhbmRsZSBsb2dpYyB3aGVuIHRoZSB1c2VyIHJldHVybnNcbiAgICAgICAgY29uc29sZS5sb2coXCJXaW5kb3cgcmVnYWluZWQgZm9jdXMuXCIpO1xuICAgIH1cbn07XG5cbi8vIEZpcnN0IHN0ZXA6IGVuZm9yY2UgYSA1LXNlY29uZCB3YWl0XG5mdW5jdGlvbiBzZXR1cEZpcnN0U3RlcChleHBsYW5hdGlvblRleHQpIHtcbiAgICBjb25zdCBmaXJzdFN0ZXBEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWlfYW5zd2VyX2RpdicpO1xuICAgIGNvbnN0IGJ1dHRvbnMgPSBbXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXR0b25fYW5zd2Vyb25seV91c2VydHJ1c3RzJyksXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXR0b25fYW5zd2Vyb25seV91c2VyZGlzdHJ1c3RzJyksXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXR0b25fYW5zd2Vyb25seV91c2VydW5zdXJlJylcbiAgICBdO1xuXG4gICAgYnV0dG9ucy5mb3JFYWNoKGJ1dHRvbiA9PiBidXR0b24/LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlRmlyc3RTdGVwQ2xpY2spKTsgLy8gUmVtb3ZlIG9sZCBsaXN0ZW5lcnNcbiAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IGJ1dHRvbj8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVGaXJzdFN0ZXBDbGljaykpOyAvLyBBZGQgbmV3IG9uZXNcblxuICAgIGZ1bmN0aW9uIGhhbmRsZUZpcnN0U3RlcENsaWNrKCkge1xuICAgICAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IGJ1dHRvbj8ucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVGaXJzdFN0ZXBDbGljaykpOyAvLyBDbGVhbnVwXG4gICAgICAgIHNldHVwU2Vjb25kU3RlcChleHBsYW5hdGlvblRleHQpO1xuICAgIH1cblxuICAgICQoXCIjYWlfYW5zd2VyX2RpdlwiKS5zaG93KCk7XG4gICAgc3RhcnRUaW1lcig1LCBmaXJzdFN0ZXBEaXYsIGJ1dHRvbnMsIG51bGwpO1xuICAgIC8vICQoXCIjYWlfYW5zd2VyX2RpdlwiKS5zaG93KCk7IC8vIFNob3cgdGhlIGZpcnN0IHN0ZXBcbiAgICAvLyBzdGFydFRpbWVyKDUsIGZpcnN0U3RlcERpdiwgYnV0dG9ucywgKCkgPT4ge1xuICAgIC8vICAgICAvLyBCdXR0b25zIGFyZSBub3cgZW5hYmxlZDsgdXNlciBtdXN0IGNsaWNrIG9uZSB0byBwcm9jZWVkXG4gICAgLy8gICAgIGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4ge1xuICAgIC8vICAgICAgICAgYnV0dG9uPy5hZGRFdmVudExpc3RlbmVyKFxuICAgIC8vICAgICAgICAgICAgICdjbGljaycsXG4gICAgLy8gICAgICAgICAgICAgKCkgPT4ge1xuICAgIC8vICAgICAgICAgICAgICAgICBzZXR1cFNlY29uZFN0ZXAoZXhwbGFuYXRpb25UZXh0KTsgLy8gUHJvY2VlZCB0byB0aGUgc2Vjb25kIHN0ZXAgYWZ0ZXIgYnV0dG9uIGNsaWNrXG4gICAgLy8gICAgICAgICAgICAgfSxcbiAgICAvLyAgICAgICAgICAgICB7IG9uY2U6IHRydWUgfSAvLyBFbnN1cmUgdGhlIGV2ZW50IGxpc3RlbmVyIGlzIGV4ZWN1dGVkIG9ubHkgb25jZVxuICAgIC8vICAgICAgICAgKTtcbiAgICAvLyAgICAgfSk7XG4gICAgLy8gfSk7XG59XG5cbi8vIFNlY29uZCBzdGVwIHRpbWVyIChkeW5hbWljIGJhc2VkIG9uIHJlYWRpbmcgdGltZSlcbmZ1bmN0aW9uIHNldHVwU2Vjb25kU3RlcChleHBsYW5hdGlvblRleHQpIHtcbiAgICBjb25zdCBzZWNvbmRTdGVwRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FpX2V4cGxhbmF0aW9uX2RpdicpO1xuICAgIGNvbnN0IHdvcmRzID0gZXhwbGFuYXRpb25UZXh0LnNwbGl0KCcgJykubGVuZ3RoO1xuICAgIGNvbnN0IHJlYWRpbmdUaW1lID0gTWF0aC5tYXgoTWF0aC5jZWlsKDMgKyAod29yZHMgLyAyMzgpICogNjApLCA1KTtcblxuICAgIGNvbnN0IGJ1dHRvbnMgPSBbXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXR0b25fd2l0aGV4cGxhbmF0aW9uX3VzZXJ0cnVzdHMnKSxcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1dHRvbl93aXRoZXhwbGFuYXRpb25fdXNlcmRpc3RydXN0cycpLFxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnV0dG9uX3dpdGhleHBsYW5hdGlvbl91c2VydW5zdXJlJylcbiAgICBdO1xuXG4gICAgLy8gUmVtb3ZlIG9sZCBldmVudCBsaXN0ZW5lcnNcbiAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IGJ1dHRvbj8ucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVTZWNvbmRTdGVwQ2xpY2spKTtcblxuICAgIC8vIEFkZCBuZXcgZXZlbnQgbGlzdGVuZXJzXG4gICAgYnV0dG9ucy5mb3JFYWNoKGJ1dHRvbiA9PiBidXR0b24/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlU2Vjb25kU3RlcENsaWNrKSk7XG5cbiAgICBmdW5jdGlvbiBoYW5kbGVTZWNvbmRTdGVwQ2xpY2soKSB7XG4gICAgICAgIC8vIENsZWFudXA6IHJlbW92ZSBldmVudCBsaXN0ZW5lcnNcbiAgICAgICAgYnV0dG9ucy5mb3JFYWNoKGJ1dHRvbiA9PiBidXR0b24/LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlU2Vjb25kU3RlcENsaWNrKSk7XG4gICAgICAgIHNldHVwVGhpcmRTdGVwKGV4cGxhbmF0aW9uVGV4dCk7XG4gICAgfVxuXG4gICAgJChcIiNhaV9leHBsYW5hdGlvbl9kaXZcIikuc2hvdygpOyAvLyBTaG93IHRoZSBzZWNvbmQgc3RlcFxuICAgIHN0YXJ0VGltZXIocmVhZGluZ1RpbWUsIHNlY29uZFN0ZXBEaXYsIGJ1dHRvbnMsIG51bGwpOyAvLyBTdGFydCB0aW1lclxufVxuXG4vLyBUaGlyZCBzdGVwIHRpbWVyICg1IHNlY29uZHMpXG5mdW5jdGlvbiBzZXR1cFRoaXJkU3RlcChleHBsYW5hdGlvblRleHQpIHtcbiAgICBjb25zdCB0aGlyZFN0ZXBEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWlfZXhwbGFuYXRpb25fcXVhbGl0eV9kaXYnKTtcbiAgICBjb25zdCBidXR0b25zID0gW1xuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnV0dG9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHlfdXNlcnRydXN0cycpLFxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnV0dG9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHlfdXNlcmRpc3RydXN0cycpLFxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnV0dG9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHlfdXNlcnVuc3VyZScpXG4gICAgXTtcblxuICAgIC8vIFJlbW92ZSBvbGQgZXZlbnQgbGlzdGVuZXJzXG4gICAgYnV0dG9ucy5mb3JFYWNoKGJ1dHRvbiA9PiBidXR0b24/LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlVGhpcmRTdGVwQ2xpY2spKTtcblxuICAgIC8vIEFkZCBuZXcgZXZlbnQgbGlzdGVuZXJzXG4gICAgYnV0dG9ucy5mb3JFYWNoKGJ1dHRvbiA9PiBidXR0b24/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlVGhpcmRTdGVwQ2xpY2spKTtcblxuICAgIGZ1bmN0aW9uIGhhbmRsZVRoaXJkU3RlcENsaWNrKCkge1xuICAgICAgICAvLyBDbGVhbnVwOiByZW1vdmUgZXZlbnQgbGlzdGVuZXJzXG4gICAgICAgIGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gYnV0dG9uPy5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZVRoaXJkU3RlcENsaWNrKSk7XG4gICAgICAgICQoXCIjYnV0dG9uX25leHRcIikuc2hvdygpOyAvLyBFbmFibGUgdGhlIG5leHQgcXVlc3Rpb24gYnV0dG9uXG4gICAgfVxuXG4gICAgJChcIiNhaV9leHBsYW5hdGlvbl9xdWFsaXR5X2RpdlwiKS5zaG93KCk7IC8vIFNob3cgdGhlIHRoaXJkIHN0ZXBcbiAgICBzdGFydFRpbWVyKDUsIHRoaXJkU3RlcERpdiwgYnV0dG9ucywgbnVsbCk7IC8vIFN0YXJ0IHRpbWVyXG59XG5cbmZ1bmN0aW9uIG5leHRfcXVlc3Rpb24oKSB7XG4gICAgLy8gUmVzZXQgdGltZXJzIGFuZCBzdGF0ZVxuICAgIGlmIChhY3RpdmVUaW1lcikge1xuICAgICAgICBjbGVhckludGVydmFsKGFjdGl2ZVRpbWVyKTtcbiAgICAgICAgYWN0aXZlVGltZXIgPSBudWxsO1xuICAgIH1cblxuICAgIC8vIHJlc3RvcmUgcHJldmlvdXMgc3RhdGUgb2YgVUlcbiAgICAkKFwiI2J1dHRvbl9yZWFkeXRvYW5zd2VyXCIpLnJlbW92ZUF0dHIoXCJhY3RpdmVkZWNpc2lvblwiKVxuICAgICQoXCIjYnV0dG9uX3JlYWR5dG9hbnN3ZXJcIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpXG4gICAgJChcIiNidXR0b25fcmVhZHl0b2Fuc3dlclwiKS5zaG93KClcblxuICAgICQoXCIjYnV0dG9uX2Fuc3dlcm9ubHlfdXNlcnRydXN0c1wiKS5yZW1vdmVBdHRyKFwiYWN0aXZlZGVjaXNpb25cIilcbiAgICAkKFwiI2J1dHRvbl9hbnN3ZXJvbmx5X3VzZXJ0cnVzdHNcIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpXG4gICAgJChcIiNidXR0b25fYW5zd2Vyb25seV91c2VyZGlzdHJ1c3RzXCIpLnJlbW92ZUF0dHIoXCJhY3RpdmVkZWNpc2lvblwiKVxuICAgICQoXCIjYnV0dG9uX2Fuc3dlcm9ubHlfdXNlcmRpc3RydXN0c1wiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIilcbiAgICAkKFwiI2J1dHRvbl9hbnN3ZXJvbmx5X3VzZXJ1bnN1cmVcIikucmVtb3ZlQXR0cihcImFjdGl2ZWRlY2lzaW9uXCIpXG4gICAgJChcIiNidXR0b25fYW5zd2Vyb25seV91c2VydW5zdXJlXCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKVxuXG4gICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9uX3VzZXJ0cnVzdHNcIikucmVtb3ZlQXR0cihcImFjdGl2ZWRlY2lzaW9uXCIpXG4gICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9uX3VzZXJ0cnVzdHNcIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpXG4gICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9uX3VzZXJkaXN0cnVzdHNcIikucmVtb3ZlQXR0cihcImFjdGl2ZWRlY2lzaW9uXCIpXG4gICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9uX3VzZXJkaXN0cnVzdHNcIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpXG4gICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9uX3VzZXJ1bnN1cmVcIikucmVtb3ZlQXR0cihcImFjdGl2ZWRlY2lzaW9uXCIpXG4gICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9uX3VzZXJ1bnN1cmVcIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpXG5cbiAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5X3VzZXJ0cnVzdHNcIikucmVtb3ZlQXR0cihcImFjdGl2ZWRlY2lzaW9uXCIpXG4gICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eV91c2VydHJ1c3RzXCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKVxuICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHlfdXNlcmRpc3RydXN0c1wiKS5yZW1vdmVBdHRyKFwiYWN0aXZlZGVjaXNpb25cIilcbiAgICAkKFwiI2J1dHRvbl93aXRoZXhwbGFuYXRpb25xdWFsaXR5X3VzZXJkaXN0cnVzdHNcIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpXG4gICAgJChcIiNidXR0b25fd2l0aGV4cGxhbmF0aW9ucXVhbGl0eV91c2VydW5zdXJlXCIpLnJlbW92ZUF0dHIoXCJhY3RpdmVkZWNpc2lvblwiKVxuICAgICQoXCIjYnV0dG9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHlfdXNlcnVuc3VyZVwiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIilcblxuICAgICQoXCIjYWlfZXhwbGFuYXRpb25fZGl2XCIpLmhpZGUoKVxuICAgICQoXCIjYWlfZXhwbGFuYXRpb25fcXVhbGl0eV9kaXZcIikuaGlkZSgpXG4gICAgXG5cbiAgICAkKFwiI2J1dHRvbl9uZXh0XCIpLmhpZGUoKVxuICAgICQoJyNidXR0b25fcXVpdCcpLmhpZGUoKVxuICAgIC8vJChcIiNyYW5nZV92YWxcIikudmFsKHVzZXJfdHJ1c3QpXG5cbiAgICBxdWVzdGlvbl9pICs9IDFcbiAgICBpZiAocXVlc3Rpb25faSA+PSBkYXRhLmxlbmd0aCkge1xuICAgICAgICAkKFwiI21haW5fYm94X2V4cGVyaW1lbnRcIikuaGlkZSgpXG4gICAgICAgIGJhbGFuY2UgPSBmaW5hbGl6ZV9iYWxhbmNlKClcblxuICAgICAgICBsZXQgcmV3YXJkX3RleHQgPSBgWW91ciB0b3RhbCByZXdhcmQgaXMgPGI+JCR7YmFsYW5jZS50b0ZpeGVkKDIpfSArICQyPC9iPi5gXG4gICAgICAgIHJld2FyZF90ZXh0ICs9IGA8YnI+WW91IGFuc3dlcmVkIGEgdG90YWwgb2YgJHtxdWVzdGlvbl9pfSBxdWVzdGlvbnM6ICR7bnVtX2NvcnJlY3R9IGNvcnJlY3QsICR7bnVtX2luY29ycmVjdH0gaW5jb3JyZWN0LCAke251bV91bnN1cmV9IHVuc3VyZS5gXG4gICAgICAgIGlmIChNT0NLTU9ERSkge1xuICAgICAgICAgICAgJCgnI3Jld2FyZF9ib3hfbW9jaycpLmh0bWwocmV3YXJkX3RleHQpXG4gICAgICAgICAgICAkKCcjcmV3YXJkX2JveF9tb2NrJykuc2hvdygpXG4gICAgICAgICAgICAkKFwiI21haW5fYm94X2VuZF9tb2NrXCIpLnNob3coKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJCgnI3Jld2FyZF9ib3gnKS5odG1sKHJld2FyZF90ZXh0KVxuICAgICAgICAgICAgJCgnI3Jld2FyZF9ib3gnKS5zaG93KClcbiAgICAgICAgICAgICQoXCIjbWFpbl9ib3hfZW5kXCIpLnNob3coKVxuICAgICAgICB9XG4gICAgICAgIHJldHVyblxuICAgIH1cblxuICAgIHF1ZXN0aW9uID0gZGF0YVtxdWVzdGlvbl9pXVxuXG4gICAgY29uc3QgcXVlc3Rpb25UZXh0ID0gcXVlc3Rpb24hW1wicXVlc3Rpb25cIl07XG4gICAgY29uc3QgdXBkYXRlZFF1ZXN0aW9uVGV4dCA9IHF1ZXN0aW9uVGV4dC5yZXBsYWNlKFwiQ2hvaWNlczpcIiwgXCI8YnI+PGI+Q2hvaWNlczo8L2I+XCIpO1xuICAgICQoXCIjcXVlc3Rpb25fc3BhblwiKS5odG1sKHVwZGF0ZWRRdWVzdGlvblRleHQpO1xuXG4gICAgJChcIiNhaV9wcmVkaWN0aW9uX3NwYW5cIikuaHRtbChxdWVzdGlvbiFbXCJwcmVkaWN0ZWRfYW5zd2VyXCJdKVxuICAgICQoXCIjYWlfZXhwbGFuYXRpb25fc3BhblwiKS5odG1sKHF1ZXN0aW9uIVtcImdlbmVyYXRlZF9yYXRpb25hbGVcIl0pXG5cbiAgICBsZXQgdmlzdWFsX2ZpZGVsaXR5X2NvbmYgPSBNYXRoLnJvdW5kKHF1ZXN0aW9uIVtcInZpc3VhbF9maWRlbGl0eVwiXSAqIDEwMClcbiAgICAkKFwiI2V4cGxhbmF0aW9uX2ZpZGVsaXR5X3NwYW5cIikuaHRtbChgJHt2aXN1YWxfZmlkZWxpdHlfY29uZn0lYClcbiAgICBsZXQgdmlzdWFsX2NvbnRyYXN0aXZlbmVzc19jb25mID0gTWF0aC5yb3VuZChxdWVzdGlvbiFbXCJjb250cmFzdGl2ZW5lc3NcIl0gKiAxMDApXG4gICAgJChcIiNleHBsYW5hdGlvbl9jb250cmFzdGl2ZW5lc3Nfc3BhblwiKS5odG1sKGAke3Zpc3VhbF9jb250cmFzdGl2ZW5lc3NfY29uZn0lYClcblxuXG4gICAgLy8gc2V0IGJldCB2YWx1ZSByYXRpb1xuICAgIC8vaWYocXVlc3Rpb24uaGFzT3duUHJvcGVydHkoXCJyZXdhcmRfcmF0aW9cIikpIHtcbiAgICAvLyAgICBsZXQgW3JhdGlvMSwgcmF0aW8yXSA9IHF1ZXN0aW9uW1wicmV3YXJkX3JhdGlvXCJdXG4gICAgLy8gICAgcmF0aW8xID0gTnVtYmVyKHJhdGlvMSlcbiAgICAvLyAgICByYXRpbzIgPSBOdW1iZXIocmF0aW8yKVxuICAgIC8vICAgIGJldF92YWxfcmF0aW8gPSByYXRpbzEvcmF0aW8yXG4gICAgLy99IGVsc2Uge1xuICAgIC8vICAgIGJldF92YWxfcmF0aW8gPSAxXG4gICAgLy99XG5cbiAgICAvL3RpbWVfcXVlc3Rpb25fc3RhcnQgPSBEYXRlLm5vdygpXG4gICAgJChcIiNwcm9ncmVzc1wiKS50ZXh0KGBQcm9ncmVzczogJHtxdWVzdGlvbl9pICsgMX0gLyAke2RhdGEubGVuZ3RofWApXG5cbiAgICBzZXR1cEZpcnN0U3RlcChxdWVzdGlvbltcImdlbmVyYXRlZF9yYXRpb25hbGVcIl0pO1xufVxuXG5cblxuLy8gZ2V0IHVzZXIgaWQgYW5kIGxvYWQgcXVldWVcbi8vIHRyeSB0byBzZWUgaWYgc3RhcnQgb3ZlcnJpZGUgd2FzIHBhc3NlZFxuY29uc3QgdXJsUGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh3aW5kb3cubG9jYXRpb24uc2VhcmNoKTtcbmNvbnN0IHN0YXJ0T3ZlcnJpZGUgPSB1cmxQYXJhbXMuZ2V0KCdzdGFydCcpO1xuY29uc3QgVUlERnJvbVVSTCA9IHVybFBhcmFtcy5nZXQoXCJ1aWRcIilcbmdsb2JhbFRoaXMudXJsX2RhdGEgPSBwYXJhbXNUb09iamVjdCh1cmxQYXJhbXMuZW50cmllcygpKVxuXG5pZiAoZ2xvYmFsVGhpcy51cmxfZGF0YVsnc3R1ZHlfaWQnXSA9PSBudWxsKSB7XG4gICAgZ2xvYmFsVGhpcy51cmxfZGF0YVsnc3R1ZHlfaWQnXSA9IFwiZGVtb19zdHVkeVwiXG59XG5pZiAoZ2xvYmFsVGhpcy51cmxfZGF0YVsncHJvbGlmaWNfaWQnXSA9PSBudWxsKSB7XG4gICAgZ2xvYmFsVGhpcy51cmxfZGF0YVsncHJvbGlmaWNfaWQnXSA9IFwiZGVtb191c2VyXCJcbn1cbmlmIChnbG9iYWxUaGlzLnVybF9kYXRhWydzZXNzaW9uX2lkJ10gPT0gbnVsbCkge1xuICAgIGdsb2JhbFRoaXMudXJsX2RhdGFbJ3Nlc3Npb25faWQnXSA9IFwiZGVtb19zZXNzaW9uXCJcbn1cblxuaWYgKFVJREZyb21VUkwgIT0gbnVsbCkge1xuICAgIGdsb2JhbFRoaXMudWlkID0gVUlERnJvbVVSTCBhcyBzdHJpbmdcbiAgICBpZiAoZ2xvYmFsVGhpcy51aWQgPT0gXCJwcm9saWZpY19yYW5kb21cIikge1xuICAgICAgICBsZXQgcXVldWVfaWQgPSBgJHtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCl9YC5wYWRTdGFydCgzLCBcIjBcIilcbiAgICAgICAgZ2xvYmFsVGhpcy51aWQgPSBgJHt1cmxQYXJhbXMuZ2V0KFwicHJvbGlmaWNfcXVldWVfbmFtZVwiKX0vJHtxdWV1ZV9pZH1gXG4gICAgfVxufSBlbHNlIGlmIChERVZNT0RFKSB7XG4gICAgZ2xvYmFsVGhpcy51aWQgPSBcImRlbW9cIlxufSBlbHNlIHtcbiAgICBsZXQgVUlEX21heWJlOiBhbnkgPSBudWxsXG4gICAgd2hpbGUgKFVJRF9tYXliZSA9PSBudWxsKSB7XG4gICAgICAgIFVJRF9tYXliZSA9IHByb21wdChcIkVudGVyIHlvdXIgdXNlciBpZC4gUGxlYXNlIGdldCBpbiB0b3VjaCBpZiB5b3Ugd2VyZSBub3QgYXNzaWduZWQgYW4gaWQgYnV0IHdpc2ggdG8gcGFydGljaXBhdGUgaW4gdGhpcyBleHBlcmltZW50LlwiKVxuICAgIH1cbiAgICBnbG9iYWxUaGlzLnVpZCA9IFVJRF9tYXliZSFcbn1cblxuLy8gdmVyc2lvbiBmb3IgcGFwZXJcbmlmIChERVZNT0RFKSB7XG4gICAgTU9DS01PREUgPSB0cnVlXG59IGVsc2UgaWYgKGdsb2JhbFRoaXMudXJsX2RhdGFbJ3Nlc3Npb25faWQnXS5zdGFydHNXaXRoKFwiZGVtb1wiKSkge1xuICAgIE1PQ0tNT0RFID0gdHJ1ZVxufVxuXG5jb25zb2xlLmxvZyhcIlJ1bm5pbmcgd2l0aCBVSURcIiwgZ2xvYmFsVGhpcy51aWQpXG4vLyBsb2FkX2RhdGEoKS5jYXRjaCgoX2Vycm9yKSA9PiB7XG4vLyAgICAgLy9hbGVydChcIkludmFsaWQgdXNlciBpZC5cIilcbi8vICAgICBjb25zb2xlLmxvZyhcIkludmFsaWQgdXNlciBpZC5cIilcbi8vICAgICBjb25zb2xlLmxvZyhnbG9iYWxUaGlzLnVpZCEpXG4vLyAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpXG4vLyB9XG4vLyApLnRoZW4oKG5ld19kYXRhKSA9PiB7XG4vLyAgICAgZGF0YSA9IG5ld19kYXRhXG4vLyAgICAgaWYgKHN0YXJ0T3ZlcnJpZGUgIT0gbnVsbCkge1xuLy8gICAgICAgICBxdWVzdGlvbl9pID0gcGFyc2VJbnQoc3RhcnRPdmVycmlkZSkgLSAxXG4vLyAgICAgICAgIGNvbnNvbGUubG9nKFwiU3RhcnRpbmcgZnJvbVwiLCBxdWVzdGlvbl9pKVxuLy8gICAgIH1cbi8vICAgICAvLyBuZXh0X3F1ZXN0aW9uKClcbi8vICAgICBuZXh0X2luc3RydWN0aW9ucygwKVxuLy8gICAgIHVwZGF0ZVJld2FyZEluc3RydWN0aW9ucygpO1xuLy8gICAgICQoXCIjbWFpbl9ib3hfaW5zdHJ1Y3Rpb25zXCIpLnNob3coKVxuLy8gICAgICQoXCIjaW5zdHJ1Y3Rpb25zX2FuZF9kZWNvcmF0aW9uc1wiKS5oaWRlKClcbi8vIH0pXG5cbi8vIER5bmFtaWNhbGx5IGxvYWQgZGF0YXNldCBiYXNlZCBvbiBEQVRBU0VUXG5mZXRjaChgLi9iYWtlZF9xdWV1ZXMvJHtEQVRBU0VUfWApXG4gICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJGYWlsZWQgdG8gbG9hZCBkYXRhc2V0LlwiKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICAgIH0pXG4gICAgLnRoZW4oKG5ld19kYXRhKSA9PiB7XG4gICAgICAgIGRhdGEgPSBuZXdfZGF0YTtcbiAgICAgICAgaWYgKHN0YXJ0T3ZlcnJpZGUgIT0gbnVsbCkge1xuICAgICAgICAgICAgcXVlc3Rpb25faSA9IHBhcnNlSW50KHN0YXJ0T3ZlcnJpZGUpIC0gMTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiU3RhcnRpbmcgZnJvbVwiLCBxdWVzdGlvbl9pKTtcbiAgICAgICAgfVxuICAgICAgICBuZXh0X2luc3RydWN0aW9ucygwKTtcbiAgICAgICAgdXBkYXRlUmV3YXJkSW5zdHJ1Y3Rpb25zKCk7XG4gICAgICAgICQoXCIjbWFpbl9ib3hfaW5zdHJ1Y3Rpb25zXCIpLnNob3coKTtcbiAgICAgICAgJChcIiNpbnN0cnVjdGlvbnNfYW5kX2RlY29yYXRpb25zXCIpLmhpZGUoKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoX2Vycm9yKSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJJbnZhbGlkIHVzZXIgaWQgb3IgZGF0YXNldCBsb2FkaW5nIGZhaWxlZC5cIik7XG4gICAgICAgIGNvbnNvbGUubG9nKGdsb2JhbFRoaXMudWlkISk7XG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgICB9KTtcblxuXG5jb25zb2xlLmxvZyhcIlN0YXJ0aW5nIHNlc3Npb24gd2l0aCBVSUQ6XCIsIGdsb2JhbFRoaXMudWlkISlcblxubGV0IGFsZXJ0X2FjdGl2ZSA9IGZhbHNlXG5kb2N1bWVudC5vbnZpc2liaWxpdHljaGFuZ2UgPSAoKSA9PiB7XG4gICAgaWYgKCFhbGVydF9hY3RpdmUpIHtcbiAgICAgICAgY291bnRfZXhpdGVkX3BhZ2UgKz0gMVxuICAgICAgICBhbGVydF9hY3RpdmUgPSB0cnVlXG4gICAgICAgIC8vaWYgKCEoZ2xvYmFsVGhpcy51aWQhLnN0YXJ0c1dpdGgoXCJkZW1vXCIpKSkge1xuICAgICAgICAvLyAgICBhbGVydChcIlBsZWFzZSBkb24ndCBsZWF2ZSB0aGUgcGFnZS4gSWYgeW91IGRvIHNvIGFnYWluLCB3ZSBtYXkgcmVzdHJpY3QgcGF5aW5nIHlvdS5cIilcbiAgICAgICAgLy99XG4gICAgICAgIGFsZXJ0X2FjdGl2ZSA9IGZhbHNlXG4gICAgfVxufSIsImRlY2xhcmUgbGV0IF9ERVZNT0RFOiBib29sZWFuXG5kZWNsYXJlIGNvbnN0IF9EQVRBU0VUOiBzdHJpbmc7XG5cbmV4cG9ydCB2YXIgREVWTU9ERSA9IF9ERVZNT0RFXG5leHBvcnQgdmFyIERBVEFTRVQgPSBfREFUQVNFVFxuZXhwb3J0IGNvbnN0IEVOQUJMRV9USU1FUiA9IHRydWU7ICAvLyBTZXQgdG8gYGZhbHNlYCB0byBkaXNhYmxlIHRoZSB0aW1lciBmb3IgZGVidWdnaW5nXG5cbmV4cG9ydCBjb25zdCBSRVdBUkRfQ09SUkVDVCA9IDAuMTsgLy8gUmV3YXJkIGZvciBhIGNvcnJlY3QgYW5zd2VyXG5leHBvcnQgY29uc3QgUEVOQUxUWV9JTkNPUlJFQ1QgPSAtMC4xOyAvLyBQZW5hbHR5IGZvciBhbiBpbmNvcnJlY3QgYW5zd2VyIiwiZnVuY3Rpb24gcGFyYW1zVG9PYmplY3QoZW50cmllcykge1xuICBjb25zdCByZXN1bHQgPSB7fVxuICAvLyBlYWNoICdlbnRyeScgaXMgYSBba2V5LCB2YWx1ZV0gdHVwcGxlXG4gIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIGVudHJpZXMpIHtcbiAgICByZXN1bHRba2V5XSA9IHZhbHVlO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmV4cG9ydCB7IHBhcmFtc1RvT2JqZWN0IH0iXSwibmFtZXMiOlsiU0VSVkVSX0xPR19ST09UIiwiTU9DS01PREUiLCJkYXRhIiwicXVlc3Rpb25faSIsInF1ZXN0aW9uIiwidXNlcnNlbGVjdGlvbl9hbnN3ZXJvbmx5IiwidXNlcnNlbGVjdGlvbl93aXRoZXhwbGFuYXRpb24iLCJ1c2Vyc2VsZWN0aW9uX3dpdGhleHBsYW5hdGlvbnF1YWxpdHkiLCJudW1fY29ycmVjdCIsIm51bV9pbmNvcnJlY3QiLCJudW1fdW5zdXJlIiwiYmFsYW5jZSIsImluc3RydWN0aW9uX2kiLCJjb3VudF9leGl0ZWRfcGFnZSIsInJlZ2lzdGVyQW5zd2VyT25seVVzZXJTZWxlY3Rpb24iLCJ1c2VyX2Nob2ljZSIsIiQiLCJhdHRyIiwic2hvdyIsInJlZ2lzdGVyV2l0aEV4cGxhbmF0aW9uVXNlclNlbGVjdGlvbiIsInJlZ2lzdGVyV2l0aEV4cGxhbmF0aW9uUXVhbGl0eVVzZXJTZWxlY3Rpb24iLCJyZW1vdmVBdHRyIiwibmV4dF9pbnN0cnVjdGlvbnMiLCJpbmNyZW1lbnQiLCJ2YWwiLCJoaWRlIiwibmV4dF9xdWVzdGlvbiIsImNoaWxkcmVuIiwiZWFjaCIsIl8iLCJlbCIsImlzX3VzZXJfY29ycmVjdCIsInNlbGVjdGlvbiIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJhZGRFdmVudExpc3RlbmVyIiwib24iLCJvbGRfYmFsYW5jZSIsImNvcnJlY3Rfc2VsZWN0aW9uIiwidXBkYXRlX2JhbGFuY2UiLCJsb2dnZWRfZGF0YSIsImFzeW5jIiwiZ2xvYmFsVGhpcyIsInVybF9kYXRhIiwiY29uc29sZSIsImxvZyIsInVpZCIsInJlc3VsdCIsImFqYXgiLCJKU09OIiwic3RyaW5naWZ5IiwicHJvamVjdCIsInBheWxvYWQiLCJ0eXBlIiwiY29udGVudFR5cGUiLCJQcm9taXNlIiwicmVzb2x2ZSIsInNldFRpbWVvdXQiLCJzbGVlcCIsImUiLCJsb2dfZGF0YSIsImFjdGl2ZVRpbWVyIiwic3RhcnRUaW1lciIsImR1cmF0aW9uIiwic3RlcERpdiIsImJ1dHRvbnMiLCJjYWxsYmFjayIsImNsZWFySW50ZXJ2YWwiLCJmb3JFYWNoIiwiYnV0dG9uIiwic2V0QXR0cmlidXRlIiwidGltZXJEaXNwbGF5IiwiY3JlYXRlRWxlbWVudCIsImlkIiwic3R5bGUiLCJmb250V2VpZ2h0IiwibWFyZ2luVG9wIiwiYXBwZW5kQ2hpbGQiLCJyZW1haW5pbmdUaW1lIiwidGV4dENvbnRlbnQiLCJzZXRJbnRlcnZhbCIsInJlbW92ZUNoaWxkIiwicmVtb3ZlQXR0cmlidXRlIiwibGVuZ3RoIiwiTWF0aCIsIm1heCIsInJld2FyZF90ZXh0IiwidG9GaXhlZCIsImh0bWwiLCJ1cGRhdGVkUXVlc3Rpb25UZXh0IiwicmVwbGFjZSIsInZpc3VhbF9maWRlbGl0eV9jb25mIiwicm91bmQiLCJ2aXN1YWxfY29udHJhc3RpdmVuZXNzX2NvbmYiLCJ0ZXh0IiwiZXhwbGFuYXRpb25UZXh0IiwiZmlyc3RTdGVwRGl2IiwiaGFuZGxlRmlyc3RTdGVwQ2xpY2siLCJyZW1vdmVFdmVudExpc3RlbmVyIiwic2Vjb25kU3RlcERpdiIsIndvcmRzIiwic3BsaXQiLCJyZWFkaW5nVGltZSIsImNlaWwiLCJoYW5kbGVTZWNvbmRTdGVwQ2xpY2siLCJ0aGlyZFN0ZXBEaXYiLCJoYW5kbGVUaGlyZFN0ZXBDbGljayIsInNldHVwVGhpcmRTdGVwIiwic2V0dXBTZWNvbmRTdGVwIiwic2V0dXBGaXJzdFN0ZXAiLCJvbnZpc2liaWxpdHljaGFuZ2UiLCJoaWRkZW4iLCJ1cmxQYXJhbXMiLCJVUkxTZWFyY2hQYXJhbXMiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsInNlYXJjaCIsInN0YXJ0T3ZlcnJpZGUiLCJnZXQiLCJVSURGcm9tVVJMIiwiZW50cmllcyIsImtleSIsInZhbHVlIiwicGFyYW1zVG9PYmplY3QiLCJxdWV1ZV9pZCIsImZsb29yIiwicmFuZG9tIiwicGFkU3RhcnQiLCJVSURfbWF5YmUiLCJwcm9tcHQiLCJzdGFydHNXaXRoIiwiZmV0Y2giLCJ0aGVuIiwicmVzcG9uc2UiLCJvayIsIkVycm9yIiwianNvbiIsIm5ld19kYXRhIiwicGFyc2VJbnQiLCJyZXdhcmRJbnN0cnVjdGlvbnMiLCJpbm5lckhUTUwiLCJhYnMiLCJ1cGRhdGVSZXdhcmRJbnN0cnVjdGlvbnMiLCJjYXRjaCIsIl9lcnJvciIsImVycm9yIiwicmVsb2FkIiwiYWxlcnRfYWN0aXZlIl0sInNvdXJjZVJvb3QiOiIifQ==